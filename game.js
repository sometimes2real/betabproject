function printStackTrace(t){t=t||{guess:!0};for(var e=t.e||null,i=!!t.guess,o=new printStackTrace.implementation,n=o.run(e),s=i?o.guessAnonymousFunctions(n):n,r=0;4>r;r++)s.shift();return s}function shareOnFB(){FB.ui({method:"feed",link:"http://www.braains.io",picture:"https://i.redd.it/rv6qyefuj0tx.png",name:"braains.io - Survive the zombie attack!!",caption:"braains.io",description:"braains.io is the best html5 zombie game out there!"},function(t){var e=JSON.stringify(t),i=JSON.parse(e);i.post_id!=""&&($.cookie("fb-shared",!0),$(".btn-buy-skin").removeClass("disabled"))})}function prerollComplete(){isShoppingTime&&$("#shopping-modal").modal("show"),ige.client.adFinished.resolve(),ige.client.adsDue=!1,adIsPlaying=!1}function showAipPreroll(){typeof aipPlayer!="undefined"?(adplayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!1,PREROLL_ELEM:document.getElementById("preroll"),AIP_COMPLETE:function(){prerollComplete()}}),adIsPlaying=!0,adplayer.startPreRoll()):prerollComplete()}function showAipMidroll(){typeof aipPlayer!="undefined"?(adplayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!1,PREROLL_ELEM:document.getElementById("preroll"),AIP_COMPLETE:function(){prerollComplete()}}),adIsPlaying=!0,$("#shopping-modal").modal("hide"),adplayer.startMidRoll()):prerollComplete()}function getScript(t){var e=document.getElementsByTagName("script"),i=document.createElement("script"),o=!0;i.async="async",i.type="text/javascript",i.charset="UTF-8",i.src=t,i.onload=i.onreadystatechange=function(){!o||i.readyState&&!/loaded|complete/.test(i.readyState)||(o=!1,i.onload=i.onreadystatechange=null)},e[0].parentNode.insertBefore(i,e[0])}printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(t){t=t||this.createException();var e=this.mode(t);return e==="other"?this.other(arguments.callee):this[e](t)},createException:function(){try{return this.undef(),null}catch(t){return t}},mode:function(t){return this._mode=t.arguments&&t.stack?"chrome":t.message&&typeof window!="undefined"&&window.opera?t.stacktrace?"opera10":"opera":t.stack?"firefox":"other"},instrumentFunction:function(t,e,i){t=t||window;var o=t[e];t[e]=function(){return i.call(this,printStackTrace().slice(4)),t[e]._instrumented.apply(this,arguments)},t[e]._instrumented=o},deinstrumentFunction:function(t,e){t[e].constructor===Function&&t[e]._instrumented&&t[e]._instrumented.constructor===Function&&(t[e]=t[e]._instrumented)},chrome:function(t){var e=(t.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return e.pop(),e},firefox:function(t){return t.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera10:function(t){var e,i,o,n=t.stacktrace,s=n.split("\n"),r="{anonymous}",a=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i;for(e=2,i=0,o=s.length;o-2>e;e++)if(a.test(s[e])){var h=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2,l=RegExp.$3;l=l.replace(/<anonymous function\:?\s?(\S+)?>/g,r),s[i++]=l+"@"+h}return s.splice(i,s.length-i),s},opera:function(t){var e,i,o,n=t.message.split("\n"),s="{anonymous}",r=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i;for(e=4,i=0,o=n.length;o>e;e+=2)r.test(n[e])&&(n[i++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:s+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+n[e+1].replace(/^\s+/,""));return n.splice(i,n.length-i),n},other:function(t){var e,i,o="{anonymous}",n=/function\s*([\w\-$]+)?\s*\(/i,s=[],r=10;while(t&&r>s.length)e=n.test(t+"")?RegExp.$1||o:o,i=Array.prototype.slice.call(t.arguments||[]),s[s.length]=e+"("+this.stringifyArguments(i)+")",t=t.caller;return s},stringifyArguments:function(t){for(var e=Array.prototype.slice,i=0;t.length>i;++i){var o=t[i];o===void 0?t[i]="undefined":o===null?t[i]="null":o.constructor&&(o.constructor===Array?t[i]=3>o.length?"["+this.stringifyArguments(o)+"]":"["+this.stringifyArguments(e.call(o,0,1))+"..."+this.stringifyArguments(e.call(o,-1))+"]":o.constructor===Object?t[i]="#object":o.constructor===Function?t[i]="#function":o.constructor===String&&(t[i]='"'+o+'"'))}return t.join(",")},sourceCache:{},ajax:function(t){var e=this.createXMLHTTPObject();if(e)return e.open("GET",t,!1),e.send(""),e.responseText},createXMLHTTPObject:function(){for(var t,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],i=0;e.length>i;i++)try{return t=e[i](),this.createXMLHTTPObject=e[i],t}catch(o){}},isSameDomain:function(t){return t.indexOf(location.hostname)!==-1},getSource:function(t){return t in this.sourceCache||(this.sourceCache[t]=this.ajax(t).split("\n")),this.sourceCache[t]},guessAnonymousFunctions:function(t){for(var e=0;t.length>e;++e){var i=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/,o=t[e],n=i.exec(o);if(n){var s=n[1],r=n[4],a=n[7]||0;if(s&&this.isSameDomain(s)&&r){var h=this.guessAnonymousFunction(s,r,a);t[e]=o.replace("{anonymous}",h)}}}return t},guessAnonymousFunction:function(t,e){var i;try{i=this.findFunctionName(this.getSource(t),e)}catch(o){i="getSource failed with url: "+t+", exception: "+(o+"")}return i},findFunctionName:function(t,e){for(var i,o,n=/function\s+([^(]*?)\s*\(([^)]*)\)/,s=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,r=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,a="",h=10,l=0;h>l;++l)if(i=t[e-l]){if(a=i+a,o=s.exec(a),o&&o[1])return o[1];if(o=n.exec(a),o&&o[1])return o[1];if(o=r.exec(a),o&&o[1])return o[1]}return"(?)"}},ige=null,igeVersion="v1.6.0@2015-04-29.001",igeClassStore={},igeConfig={debug:{_enabled:!1,_node:typeof module!="undefined"&&module.exports!==void 0,_level:["log","warning","error"],_stacks:!0,_throwErrors:!0,_timing:!0,enabled:function(t){return t!==void 0?(this._enabled=t,t||(this._timing=!1,ige&&ige.showStats(0)),this):this._enabled}}},igeConfig.debug._node&&(igeConfig.debug._util=require("util")),Object.defineProperty(Object.prototype,"tween",{enumerable:!1,writable:!0,configurable:!0}),Object.prototype.tween=function(t,e,i){var o=(new $i_53).targetObj(this).properties(t).duration(e);return i&&(i.beforeTween&&o.beforeTween(i.beforeTween),i.afterTween&&o.afterTween(i.afterTween),i.easing&&o.easing(i.easing),i.startTime&&o.startTime(i.startTime)),o},Object.defineProperty(Object.prototype,"theSameAs",{enumerable:!1,writable:!0,configurable:!0}),Object.prototype.theSameAs=function(t){return JSON.stringify(this)===JSON.stringify(t)},Object.defineProperty(Array.prototype,"clone",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.clone=function(){var t,e=[];for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t]instanceof Array?this[t].clone():this[t]);return e},Object.defineProperty(Array.prototype,"pull",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.pull=function(t){var e=this.indexOf(t);return e>-1?(this.splice(e,1),e):-1},Object.defineProperty(Array.prototype,"pushUnique",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.pushUnique=function(t){var e=this.indexOf(t);return e===-1?(this.push(t),!0):!1},Object.defineProperty(Array.prototype,"each",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.each=function(t){var e,i=this.length;for(e=0;i>e;e++)t(this[e])},Object.defineProperty(Array.prototype,"eachReverse",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachReverse=function(t){var e,i=this.length;for(e=i-1;e>=0;e--)t(this[e])},Object.defineProperty(Array.prototype,"destroyAll",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.destroyAll=function(){var t,e=this.length;for(t=e-1;t>=0;t--)typeof this[t].destroy=="function"&&this[t].destroy()},Object.defineProperty(Array.prototype,"eachIsolated",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.eachIsolated=function(t){var e,i=[],o=i.length;for(e=0;o>e;e++)i[e]=this[e];for(e=0;o>e;e++)t(i[e])},Object.defineProperty(Math,"PI180",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180=Math.PI/180,Object.defineProperty(Math,"PI180R",{enumerable:!1,writable:!0,configurable:!0}),Math.PI180R=180/Math.PI,Object.defineProperty(Math,"toIso",{enumerable:!1,writable:!0,configurable:!0}),Math.toIso=function(t,e,i){var o=t-e,n=-i*1.2247+(t+e)*.5;return{x:o,y:n}},Object.defineProperty(Math,"radians",{enumerable:!1,writable:!0,configurable:!0}),Math.radians=function(t){return t*Math.PI180},Object.defineProperty(Math,"degrees",{enumerable:!1,writable:!0,configurable:!0}),Math.degrees=function(t){return t*Math.PI180R},Object.defineProperty(Math,"distance",{enumerable:!1,writable:!0,configurable:!0}),Math.distance=function(t,e,i,o){return Math.sqrt((t-i)*(t-i)+(e-o)*(e-o))},typeof CanvasRenderingContext2D!="undefined"&&(Object.defineProperty(CanvasRenderingContext2D.prototype,"circle",{enumerable:!1,writable:!0,configurable:!0}),Object.defineProperty(CanvasRenderingContext2D.prototype,"strokeCircle",{enumerable:!1,writable:!0,configurable:!0}),Object.defineProperty(CanvasRenderingContext2D.prototype,"fillCircle",{enumerable:!1,writable:!0,configurable:!0}),CanvasRenderingContext2D.prototype.circle=function(t,e,i){this.arc(t,e,i,0,2*Math.PI,!1)},CanvasRenderingContext2D.prototype.strokeCircle=function(t,e,i){this.save(),this.beginPath(),this.arc(t,e,i,0,2*Math.PI,!1),this.stroke(),this.restore()},CanvasRenderingContext2D.prototype.fillCircle=function(t,e,i){this.save(),this.beginPath(),this.arc(t,e,i,0,2*Math.PI,!1),this.fill(),this.restore()}),typeof ImageData!="undefined"&&(Object.defineProperty(ImageData.prototype,"pixelAt",{enumerable:!1,writable:!0,configurable:!0}),ImageData.prototype.pixelAt=function(t,e){var i=this.data,o=e*this.width*4+t*4;return{r:i[o],g:i[o+1],b:i[o+2],a:i[o+3]}},Object.defineProperty(ImageData.prototype,"isTransparent",{enumerable:!1,writable:!0,configurable:!0}),ImageData.prototype.isTransparent=function(t,e){var i=this.data,o=e*this.width*4+t*4;return i[o+3]===0},Object.defineProperty(ImageData.prototype,"makeTransparent",{enumerable:!1,writable:!0,configurable:!0}),ImageData.prototype.makeTransparent=function(t,e){var i=this.data,o=e*this.width*4+t*4;i[o+3]=0});var disableContextMenu=function(t){t!==null&&(t.oncontextmenu=function(){return!1})};Array.prototype.indexOf||(Object.defineProperty(Array.prototype,"indexOf",{enumerable:!1,writable:!0,configurable:!0}),Array.prototype.indexOf=function(t){var e,i=this.length;for(e=0;i>e;e++)if(this[e]===t)return e;return-1}),requestAnimFrame=typeof window!="undefined"?function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(function(){t((new Date).getTime())},1e3/60)}}():function(){return function(t){setTimeout(function(){t((new Date).getTime())},1e3/60)}}(),typeof console=="object"?typeof console.log=="function"&&(console.info===void 0&&(console.info=console.log),console.warn===void 0&&(console.warn=console.log)):console={log:function(){},warn:function(){},info:function(){},error:function(){}};var $i_2=function(){var t=!1,e=(/xyz/.test(function(){})?/\b_super\b/:/.*/,function(){}),i=function(t,e,i){if(igeConfig.debug._enabled){var o,n,s="";if(n=this._id!==void 0?":"+this._id:"",e=e||"log",i!==void 0&&console.warn(i),(e==="warning"||e==="error")&&igeConfig.debug._stacks&&(igeConfig.debug._node?console.trace?console.trace():(o=Error().stack,console.log(color.magenta("Stack:"),color.red(o)),console.log("Stack:",o)):typeof printStackTrace=="function"&&console.log("Stack:",printStackTrace().join("\n ---- "))),e==="error"){if(typeof ige!="undefined"&&(console.log(s+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+n+"] : "+"Error encountered, stopping engine to prevent console spamming..."),ige.stop()),igeConfig.debug._throwErrors)throw s+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+n+"] : "+t;console.log(s+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+n+"] : "+t)}else console.log(s+"IGE *"+e+"* ["+(this._classId||this.prototype._classId)+n+"] : "+t)}return this},o=function(){return this._classId},n=function(t,e){var i=new t(this,e);return this[i.componentId]=i,this._components=this._components||[],this._components.push(i),this},s=function(t){return this[t]&&this[t].destroy&&this[t].destroy(),this._components&&this._components.pull(this[t]),delete this[t],this},r=function(t,e){var i,o=t.prototype||t;for(i in o)o.hasOwnProperty(i)&&(e||this[i]===void 0)&&(this[i]=o[i]);return this},a=function(t,e){return t!==void 0?e!==void 0?(this._data=this._data||{},this._data[t]=e,this):this._data?this._data[t]:null:void 0};return e.extend=function(){function e(){!t&&this.init&&this.init.apply(this,arguments)}var h,l,c,m,_,u,d,p=arguments[arguments.length-1],y=arguments[0];if(!p.classId)throw console.log(p),"Cannot create a new class without giving the class a classId property!";if(igeClassStore[p.classId])throw'Cannot create class with classId "'+p.classId+'" because a class with that ID has already been created!';t=!0,l=new this,t=!1;for(h in p)p.hasOwnProperty(h)&&(l[h]=p[h]);if(arguments.length>1&&y&&y.length)for(_=0;y.length>_;_++){c=y[_],d=c.extension.prototype||c.extension,m=c.overwrite;for(u in d)d.hasOwnProperty(u)&&(m||l[u]===void 0)&&(l[u]=d[u])}return e.prototype=l,e.prototype.constructor=e,e.extend=arguments.callee,e.prototype.log=i,e.prototype.data=a,e.prototype.classId=o,e.prototype._classId=p.classId||"$i_2",e.prototype.addComponent=n,e.prototype.removeComponent=s,e.prototype.implement=r,e.prototype.__igeEditor=p.editorOptions,igeClassStore[p.classId]=e,e},e.vanilla=function(t){var e=t.init||function(){},h=new this;for(name in t)t.hasOwnProperty(name)&&name!=="init"&&(h[name]=t[name]);return e.prototype=h,e.prototype.constructor=e,e.extend=this.extend,e.prototype.log=i,e.prototype.data=a,e.prototype.classId=o,e.prototype._classId=t.classId||"$i_2",e.prototype.addComponent=n,e.prototype.removeComponent=s,e.prototype.implement=r,igeClassStore[t.classId]=e,e},e.prototype._classId="$i_2",e}();typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_2);var $i_3=$i_2.extend({classId:"$i_3",on:function(t,e,i,o,n){var s,r,a,h,l,c,m,_,u,d=this;if(this._eventListeners=this._eventListeners||{},typeof e=="function"){if(typeof t=="string")return s={call:e,context:i,oneShot:o,sendEventName:n},h=this._eventListeners[t]=this._eventListeners[t]||[],r=!0,a=h.indexOf(s),a>-1&&(r=!1),r&&h.push(s),s;if(t.length){l=[],l[0]=0,l[1]=0,l[3]=function(){l[1]++,l[0]===l[1]&&e.apply(i||d)};for(c in t)t.hasOwnProperty(c)&&(m=t[c],_=m[0],u=m[1],l[0]++,_.on(u,l[3],null,!0,!0))}}else typeof t!="string"&&(t="*Multi-Event*"),this.log('Cannot register event listener for event "'+t+'" because the passed callback is not a function!',"error")},off:function(t,e,i){if(this._eventListeners){if(this._eventListeners._processing)return this._eventListeners._removeQueue=this._eventListeners._removeQueue||[],this._eventListeners._removeQueue.push([t,e,i]),-1;if(this._eventListeners[t]){var o=this._eventListeners[t].indexOf(e);if(o>-1)return this._eventListeners[t].splice(o,1),i&&i(!0),!0;this.log('Failed to cancel event listener for event named "'+t+'" !',"warning",e)}else this.log("Failed to cancel event listener!")}return i&&i(!1),!1},emit:function(t,e){if(this._eventListeners&&this._eventListeners[t]){var i,o,n,s,r,a,h=this._eventListeners[t].length,l=this._eventListeners[t].length-1;if(h){if(i=[],typeof e=="object"&&e!==null&&e[0]!==null&&e[0]!==void 0)for(o in e)e.hasOwnProperty(o)&&(i[o]=e[o]);else i=[e];n=!1,this._eventListeners._processing=!0;while(h--)s=l-h,r=this._eventListeners[t][s],r.sendEventName&&(i=[t]),a=r.call.apply(r.context||this,i),a===!0&&(n=!0),r.oneShot&&this.off(t,r)===!0&&l--;if(this._eventListeners&&(this._eventListeners._processing=!1,this._processRemovals()),n)return 1}}},eventList:function(){return this._eventListeners},_processRemovals:function(){if(this._eventListeners){var t,e,i,o=this._eventListeners._removeQueue;if(o){t=o.length;while(t--)e=o[t],i=this.off(e[0],e[1]),typeof o[2]=="function"&&o[2](i)}delete this._eventListeners._removeQueue}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_3);var $i_4=$i_2.extend({classId:"$i_4",init:function(t,e,i){return this.x=t=t!==void 0?t:0,this.y=e=e!==void 0?e:0,this._floor=i!==void 0,this._floor?(this.x2=Math.floor(t/2),this.y2=Math.floor(e/2)):(this.x2=t/2,this.y2=e/2),this},floor:function(t){return t!==void 0?(this._floor=t,this):this._floor},compare:function(t){return t&&this.x===t.x&&this.y===t.y},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},toIso:function(){var t=this.x-this.y,e=(this.x+this.y)*.5;return{x:t,y:e}},thisToIso:function(){var t=this.toIso();return this.x=t.x,this.y=t.y,this},to2d:function(){var t=this.y+this.x/2,e=this.y-this.x/2;return{x:t,y:e}},thisTo2d:function(){var t=this.to2d();return this.x=t.x,this.y=t.y,this},addPoint:function(t){return new $i_4(this.x+t.x,this.y+t.y)},thisAddPoint:function(t){return this.x+=t.x,this.y+=t.y,this},minusPoint:function(t){return new $i_4(this.x-t.x,this.y-t.y)},thisMinusPoint:function(t){return this.x-=t.x,this.y-=t.y,this},multiply:function(t,e){return new $i_4(this.x*t,this.y*e)},multiplyPoint:function(t){return new $i_4(this.x*t.x,this.y*t.y)},thisMultiply:function(t,e){return this.x*=t,this.y*=e,this},divide:function(t,e){return new $i_4(this.x/t,this.y/e)},dividePoint:function(t){var e=this.x,i=this.y;return t.x&&(e=this.x/t.x),t.y&&(i=this.y/t.y),new $i_4(e,i)},thisDivide:function(t,e){return this.x/=t,this.y/=e,this},clone:function(){return new $i_4(this.x,this.y)},interpolate:function(t,e,i,o){var n=t.x-this.x,s=t.y-this.y,r=o-e,a=r-(i-e),h=a/r;return new $i_4(t.x-n*h,t.y-s*h)},rotate:function(t){var e=Math.sin(t),i=Math.cos(t),o=i*this.x-e*this.y,n=e*this.x-i*this.y;return new $i_4(o,n)},thisRotate:function(t){var e=Math.sin(t),i=Math.cos(t),o=this.x,n=this.y;return this.x=i*o-e*n,this.y=e*o-i*n,this},toString:function(t){return t===void 0&&(t=2),this.x==void 0||this.y==void 0?"0,0":parseFloat(this.x).toFixed(t)+","+parseFloat(this.y).toFixed(t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_4);var $i_5=$i_2.extend({classId:"$i_5",init:function(t,e,i,o){return this.x=t=t!==void 0?t:0,this.y=e=e!==void 0?e:0,this.z=i=i!==void 0?i:0,this._floor=o!==void 0,this._floor?(this.x2=Math.floor(t/2),this.y2=Math.floor(e/2),this.z2=Math.floor(i/2)):(this.x2=t/2,this.y2=e/2,this.z2=i/2),this},floor:function(t){return t!==void 0?(this._floor=t,this):this._floor},compare:function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},toIso:function(){var t=this.x-this.y,e=-this.z*1.2247+(this.x+this.y)*.5;return{x:t,y:e}},thisToIso:function(){var t=this.toIso();return this.x=t.x,this.y=t.y,this},to2d:function(){var t=this.y+this.x/2,e=this.y-this.x/2;return{x:t,y:e}},thisTo2d:function(){var t=this.to2d();return this.x=t.x,this.y=t.y,this.z=0,this},addPoint:function(t){return new $i_5(this.x+t.x,this.y+t.y,this.z+t.z)},thisAddPoint:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},minusPoint:function(t){return new $i_5(this.x-t.x,this.y-t.y,this.z-t.z)},thisMinusPoint:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiply:function(t,e,i){return new $i_5(this.x*t,this.y*e,this.z*i)},multiplyPoint:function(t){return new $i_5(this.x*t.x,this.y*t.y,this.z*t.z)},thisMultiply:function(t,e,i){return this.x*=t,this.y*=e,this.z*=i,this},divide:function(t,e,i){return new $i_5(this.x/t,this.y/e,this.z/i)},dividePoint:function(t){var e=this.x,i=this.y,o=this.z;return t.x&&(e=this.x/t.x),t.y&&(i=this.y/t.y),t.z&&(o=this.z/t.z),new $i_5(e,i,o)},thisDivide:function(t,e,i){return this.x/=t,this.y/=e,this.z/=i,this},clone:function(){return new $i_5(this.x,this.y,this.z)},interpolate:function(t,e,i,o){var n=t.x-this.x,s=t.y-this.y,r=t.z-this.z,a=o-e,h=a-(i-e),l=h/a;return new $i_5(t.x-n*l,t.y-s*l,t.z-r*l)},rotate:function(t){var e=Math.sin(t),i=Math.cos(t),o=i*this.x-e*this.y,n=e*this.x-i*this.y;return new $i_5(o,n,this.z)},thisRotate:function(t){var e=Math.sin(t),i=Math.cos(t),o=this.x,n=this.y;return this.x=i*o-e*n,this.y=e*o-i*n,this},toString:function(t){return t===void 0&&(t=2),this.x==void 0||this.y==void 0||this.z==void 0?"0,0,0":parseFloat(this.x).toFixed(t)+","+parseFloat(this.y).toFixed(t)+","+parseFloat(this.z).toFixed(t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_5);var $i_6=$i_2.extend({classId:"$i_6",init:function(){this._poly=[],this._scale=new $i_4(1,1)},scale:function(t,e){return t!==void 0&&e!==void 0?(this._scale.x=t,this._scale.y=e,this):this._scale},multiply:function(t){if(t!==void 0){var e,i=this._poly,o=i.length;for(e=0;o>e;e++)i[e].x*=t,i[e].y*=t}return this},divide:function(t){if(t!==void 0){var e,i=this._poly,o=i.length;for(e=0;o>e;e++)i[e].x/=t,i[e].y/=t}return this},addPoint:function(t,e){return this._poly.push(new $i_4(t,e)),this},length:function(){return this._poly.length},pointInPoly:function(t){var e,i=this._poly,o=i.length,n=o-1,s=0;for(e=0;o>e;n=e++)i[e].y>t.y!=i[n].y>t.y&&(i[n].x-i[e].x)*(t.y-i[e].y)/(i[n].y-i[e].y)+i[e].x>t.x&&(s=!s);return Boolean(s)},xyInside:function(t,e){var i,o=this._poly,n=o.length,s=n-1,r=0;for(i=0;n>i;s=i++)o[i].y>e!=o[s].y>e&&(o[s].x-o[i].x)*(e-o[i].y)/(o[s].y-o[i].y)+o[i].x>t&&(r=!r);return Boolean(r)},aabb:function(){var t,e,i,o,n,s=[],r=[],a=this._poly,h=a.length;for(n=0;h>n;n++)s.push(a[n].x),r.push(a[n].y);return t=Math.min.apply(Math,s),e=Math.min.apply(Math,r),i=Math.max.apply(Math,s),o=Math.max.apply(Math,r),new $i_7(t,e,i-t,o-e)},clone:function(){var t,e=new $i_6,i=this._poly,o=i.length;for(t=0;o>t;t++)e.addPoint(i[t].x,i[t].y);return e.scale(this._scale.x,this._scale.y),e},clockWiseTriangle:function(){var t,e,i,o,n=this._poly;return e=n[0],i=n[1],o=n[2],t=e.x*i.y+i.x*o.y+o.x*e.y-i.y*o.x-o.y*e.x-e.y*i.x,t>0},makeClockWiseTriangle:function(){if(!this.clockWiseTriangle()){var t=(this._poly[0],this._poly[1]),e=this._poly[2];this._poly[2]=t,this._poly[1]=e}},triangulate:function(){var t,e,i,o,n,s=this._poly,r=[],a=this.triangulationIndices();for(t=0;a.length>t;t+=3)e=s[a[t]],i=s[a[t+1]],o=s[a[t+2]],n=new $i_6,n.addPoint(e.x,e.y),n.addPoint(i.x,i.y),n.addPoint(o.x,o.y),n.makeClockWiseTriangle(),r.push(n);return r},triangulationIndices:function(){var t,e,i,o,n,s,r,a,h,l,c=[],m=this._poly.length,_=[],u=[];if(3>m)return c;if(this._area()>0)for(_=0;m>_;_++)u[_]=_;else for(_=0;m>_;_++)u[_]=m-1-_;for(t=m,e=2*t,i=0,_=t-1;t>2;){if(0>=e--)return c;if(o=_,t>o||(o=0),_=o+1,t>_||(_=0),n=_+1,t>n||(n=0),this._snip(o,_,n,t,u)){for(s=u[o],r=u[_],a=u[n],c.push(s),c.push(r),c.push(a),i++,h=_,l=_+1;t>l;l++)u[h]=u[l],h++;t--,e=2*t}}return c.reverse(),c},_area:function(){var t,e,i,o=this._poly.length,n=0,s=0;for(t=o-1;o>s;t=s++)e=this._poly[t],i=this._poly[s],n+=e.x*i.y-i.x*e.y;return n*.5},_snip:function(t,e,i,o,n){var s,r,a=this._poly[n[t]],h=this._poly[n[e]],l=this._poly[n[i]];if(1e-5>(h.x-a.x)*(l.y-a.y)-(h.y-a.y)*(l.x-a.x))return!1;for(s=0;o>s;s++)if(s!=t&&s!=e&&s!=i&&(r=this._poly[n[s]],this._insideTriangle(a,h,l,r)))return!1;return!0},_insideTriangle:function(t,e,i,o){var n,s,r,a,h,l,c,m,_,u,d,p,y,x,f;return n=i.x-e.x,s=i.y-e.y,r=t.x-i.x,a=t.y-i.y,h=e.x-t.x,l=e.y-t.y,c=o.x-t.x,m=o.y-t.y,_=o.x-e.x,u=o.y-e.y,d=o.x-i.x,p=o.y-i.y,f=n*u-s*_,y=h*m-l*c,x=r*p-a*d,f>=0&&x>=0&&y>=0},render:function(t,e){var i,o=this._poly,n=o.length,s=this._scale.x,r=this._scale.y;for(t.beginPath(),t.moveTo(o[0].x*s,o[0].y*r),i=1;n>i;i++)t.lineTo(o[i].x*s,o[i].y*r);return t.lineTo(o[0].x*s,o[0].y*r),e&&t.fill(),t.stroke(),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_6);var $i_7=$i_2.extend({classId:"$i_7",init:function(t,e,i,o){return this.x=t=t!==void 0?t:0,this.y=e=e!==void 0?e:0,this.width=i=i!==void 0?i:0,this.height=o=o!==void 0?o:0,this.x2=this.x/2,this.y2=this.y/2,this},combineRect:function(t){var e=this.x+this.width,i=this.y+this.height,o=t.x+t.width,n=t.y+t.height,s=Math.min(this.x,t.x),r=Math.min(this.y,t.y),a=Math.max(e-this.x,o-this.x),h=Math.max(i-this.y,n-this.y);return new $i_7(s,r,a,h)},thisCombineRect:function(t){var e=this.x+this.width,i=this.y+this.height,o=t.x+t.width,n=t.y+t.height;this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(e-this.x,o-this.x),this.height=Math.max(i-this.y,n-this.y)},minusPoint:function(t){return new $i_7(this.x-t.x,this.y-t.y,this.width,this.height)},compare:function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},xyInside:function(t,e){return t>=this.x&&e>this.y&&this.x+this.width>=t&&this.y+this.height>=e},pointInside:function(t){return t.x>=this.x&&t.y>this.y&&this.x+this.width>=t.x&&this.y+this.height>=t.y},rectIntersect:function(t){return this.log('rectIntersect has been renamed to "intersects". Please update your code. rectIntersect will be removed in a later version of IGE.',"warning"),this.intersects(t)},intersects:function(t){if(t){var e=this.x,i=this.y,o=this.width,n=this.height,s=t.x,r=t.y,a=t.width,h=t.height,l=e+o,c=i+n,m=s+a,_=r+h;if(m>e&&l>s&&_>i&&c>r)return!0}return!1},multiply:function(t,e,i,o){return new $i_7(this.x*t,this.y*e,this.width*i,this.height*o)},thisMultiply:function(t,e,i,o){return this.x*=t,this.y*=e,this.width*=i,this.height*=o,this},clone:function(){return new $i_7(this.x,this.y,this.width,this.height)},toString:function(t){return t===void 0&&(t=2),this.x.toFixed(t)+","+this.y.toFixed(t)+","+this.width.toFixed(t)+","+this.height.toFixed(t)},render:function(t,e){return t.rect(this.x,this.y,this.width,this.height),e&&t.fill(),t.stroke(),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_7);var $i_8=function(){this.matrix=[1,0,0,0,1,0,0,0,1],this._rotateOrigin=new $i_5(0,0,0),this._scaleOrigin=new $i_5(0,0,0)};$i_8.prototype={matrix:null,transformCoord:function(t,e){var i=t.x,o=t.y,n=this.matrix;return t.x=i*n[0]+o*n[1]+n[2],t.y=i*n[3]+o*n[4]+n[5],(isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])||isNaN(n[4])||isNaN(n[5]))&&e.log("The matrix operation produced a NaN value!","error"),t},transformCoordInverse:function(t,e){var i=t.x,o=t.y,n=this.matrix;return t.x=i*n[0]-o*n[1]+n[2],t.y=i*n[3]+o*n[4]-n[5],(isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])||isNaN(n[4])||isNaN(n[5]))&&e.log("The matrix operation produced a NaN value!","error"),t},transform:function(t,e){var i,o=t.length;for(i=0;o>i;i++)this.transformCoord(t[i],e);return t},_newRotate:function(t){var e=new $i_8;return e.rotateTo(t),e},rotateBy:function(t){var e=new $i_8;return e.translateBy(this._rotateOrigin.x,this._rotateOrigin.y),e.rotateTo(t),e.translateBy(-this._rotateOrigin.x,-this._rotateOrigin.y),this.multiply(e),this},rotateTo:function(t){var e=this.matrix,i=Math.cos(t),o=Math.sin(t);return e[0]=i,e[1]=-o,e[3]=o,e[4]=i,(isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])||isNaN(e[4])||isNaN(e[5]))&&console.log("The matrix operation produced a NaN value!","error",e),this},rotationRadians:function(){return Math.asin(this.matrix[3])},rotationDegrees:function(){return Math.degrees(Math.acos(this.matrix[0]))},_newScale:function(t,e){var i=new $i_8;return i.matrix[0]=t,i.matrix[4]=e,i},scaleBy:function(t,e){var i=new $i_8;return i.matrix[0]=t,i.matrix[4]=e,this.multiply(i),this},scaleTo:function(t,e){var i=this.matrix;return i[0]=t,i[4]=e,(isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])||isNaN(i[4])||isNaN(i[5]))&&this.log("The matrix operation produced a NaN value!","error"),this},_newTranslate:function(t,e){var i=new $i_8;return i.matrix[2]=t,i.matrix[5]=e,i},translateBy:function(t,e){var i=new $i_8;return i.matrix[2]=t,i.matrix[5]=e,this.multiply(i),this},translateTo:function(t,e){var i=this.matrix;return i[2]=t,i[5]=e,(isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])||isNaN(i[4])||isNaN(i[5]))&&this.log("The matrix operation produced a NaN value!","error"),this},copy:function(t){t=t.matrix;var e=this.matrix;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},compare:function(t){for(var e=this.matrix,i=t.matrix,o=0;9>o;o++)if(e[o]!==i[o])return!1;return!0},identity:function(){var t=this.matrix;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},multiply:function(t){var e=this.matrix,i=t.matrix,o=e[0],n=e[1],s=e[2],r=e[3],a=e[4],h=e[5],l=e[6],c=e[7],m=e[8],_=i[0],u=i[1],d=i[2],p=i[3],y=i[4],x=i[5],f=i[6],g=i[7],v=i[8];return e[0]=o*_+n*p+s*f,e[1]=o*u+n*y+s*g,e[2]=o*d+n*x+s*v,e[3]=r*_+a*p+h*f,e[4]=r*u+a*y+h*g,e[5]=r*d+a*x+h*v,e[6]=l*_+c*p+m*f,e[7]=l*u+c*y+m*g,e[8]=l*d+c*x+m*v,this},premultiply:function(t){var e=t.matrix[0]*this.matrix[0]+t.matrix[1]*this.matrix[3]+t.matrix[2]*this.matrix[6],i=t.matrix[0]*this.matrix[1]+t.matrix[1]*this.matrix[4]+t.matrix[2]*this.matrix[7],o=t.matrix[0]*this.matrix[2]+t.matrix[1]*this.matrix[5]+t.matrix[2]*this.matrix[8],n=t.matrix[3]*this.matrix[0]+t.matrix[4]*this.matrix[3]+t.matrix[5]*this.matrix[6],s=t.matrix[3]*this.matrix[1]+t.matrix[4]*this.matrix[4]+t.matrix[5]*this.matrix[7],r=t.matrix[3]*this.matrix[2]+t.matrix[4]*this.matrix[5]+t.matrix[5]*this.matrix[8],a=t.matrix[6]*this.matrix[0]+t.matrix[7]*this.matrix[3]+t.matrix[8]*this.matrix[6],h=t.matrix[6]*this.matrix[1]+t.matrix[7]*this.matrix[4]+t.matrix[8]*this.matrix[7],l=t.matrix[6]*this.matrix[2]+t.matrix[7]*this.matrix[5]+t.matrix[8]*this.matrix[8];return this.matrix[0]=e,this.matrix[1]=i,this.matrix[2]=o,this.matrix[3]=n,this.matrix[4]=s,this.matrix[5]=r,this.matrix[6]=a,this.matrix[7]=h,this.matrix[8]=l,this},getInverse:function(){var t=this.matrix,e=t[0],i=t[1],o=t[2],n=t[3],s=t[4],r=t[5],a=t[6],h=t[7],l=t[8],c=new $i_8,m=e*(s*l-h*r)-n*(i*l-h*o)+a*(i*r-s*o);if(m===0)return null;var _=c.matrix;return _[0]=s*l-r*h,_[1]=o*h-i*l,_[2]=i*r-o*s,_[3]=r*a-n*l,_[4]=e*l-o*a,_[5]=o*n-e*r,_[6]=n*h-s*a,_[7]=i*a-e*h,_[8]=e*s-i*n,c.multiplyScalar(1/m),c},multiplyScalar:function(t){var e;for(e=0;9>e;e++)this.matrix[e]*=t;return this},transformRenderingContextSet:function(t){var e=this.matrix;return t.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this},transformRenderingContext:function(t){var e=this.matrix;return t.transform(e[0],e[3],e[1],e[4],e[2],e[5]),this}},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_8);var $i_9=$i_3.extend({classId:"$i_9",componentId:"time",init:function(t){this._entity=t,this._timers=[],this._additions=[],this._removals=[],t.addBehaviour("time",this._update)},addTimer:function(t){return t&&(this._updating?this._additions.push(t):this._timers.push(t)),this},removeTimer:function(t){return t&&(this._updating?this._removals.push(t):this._timers.pull(t)),this},_update:function(){var t=ige.time,e=ige._tickDelta,i=t._timers,o=i.length;while(o--)i[o].addTime(e).update();return t._processRemovals(),t._processAdditions(),t},_processAdditions:function(){var t=this._additions,e=t.length;if(e){while(e--)this._timers.push(t[e]);this._additions=[]}return this},_processRemovals:function(){var t=this._removals,e=t.length;if(e){while(e--)this._timers.pull(t[e]);this._removals=[]}return this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_9);var $i_11=$i_2.extend({classId:"$i_11",componentId:"velocity",init:function(t){this._entity=t,this._velocity=new $i_5(0,0,0),this._friction=new $i_5(1,1,1),t.addBehaviour("velocity",this._behaviour)
},_behaviour:function(t){this.velocity!=void 0&&this.velocity.tick(t)},byAngleAndPower:function(t,e,i){var o=this._velocity,n=Math.cos(t)*e,s=Math.sin(t)*e,r=0;return i?(o.x+=n,o.y+=s,o.z+=r):(o.x=n,o.y=s,o.z=r),this._entity},xyz:function(t,e,i,o){var n=this._velocity;return o?(n.x+=t,n.y+=e,n.z+=i):(n.x=t,n.y=e,n.z=i),this._entity},x:function(t,e){var i=this._velocity;return e?i.x+=t:i.x=t,this._entity},y:function(t,e){var i=this._velocity;return e?i.y+=t:i.y=t,this._entity},z:function(t,e){var i=this._velocity;return e?i.z+=t:i.z=y,this._entity},vector3:function(t,e){typeof t.scale!="number"&&(t.scale=1);var i=this._velocity,o=t.x,n=t.y,s=t.z;return e?(i.x+=o,i.y+=n,i.z+=s):(i.x=o,i.y=n,i.z=s),this._entity},friction:function(t){var e=1-t;return 0>e&&(e=0),this._friction=new $i_5(e,e,e),this._entity},linearForce:function(t,e){e/=1e3;var i=t*Math.PI/180,o=Math.cos(i)*e,n=Math.sin(i)*e,s=o*n;return this._linearForce=new $i_5(o,n,s),this._entity},linearForceXYZ:function(t,e,i){return this._linearForce=new $i_5(t,e,i),this._entity},linearForceVector3:function(t,e,i){var o=this._linearForce=this._linearForce||new $i_5(0,0,0),n=t.x/1e3,s=t.y/1e3,r=t.z/1e3;return i?(o.x+=n||0,o.y+=s||0,o.z+=r||0):(o.x=n||0,o.y=s||0,o.z=r||0),this._entity},_applyLinearForce:function(t){if(this._linearForce){var e=this._velocity;e.x+=this._linearForce.x*t,e.y+=this._linearForce.y*t,e.z+=this._linearForce.z*t}},_applyFriction:function(){var t=this._velocity,e=this._friction;t.x*=e.x,t.y*=e.y,t.z*=e.z},tick:function(){var t,e,i,o=ige._tickDelta,n=this._velocity;o&&(this._applyLinearForce(o),t=n.x*o,e=n.y*o,i=n.z*o,(t||e||i)&&this._entity.translateBy(t,e,i))}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_11);var $i_12=$i_2.extend({classId:"$i_12",componentId:"tween",init:function(t){this._entity=t,this._transform=t.transform,this._tweens=[],t.addBehaviour("tween",this.update)},start:function(t){return t._startTime>ige._currentTime?this._tweens.push(t):(t._currentStep=0,this._setupStep(t,!1)&&this._tweens.push(t)),this.enable(),t},_setupStep:function(t,e){var i,o,n,s=t._targetObj,r=t._steps[t._currentStep],a=[];if(r&&(i=r.props),s){t._currentStep!==0||e?t._startTime=ige._currentTime:t._startTime===void 0&&(t._startTime=ige._currentTime),o=r.durationMs?r.durationMs:t._durationMs,t._selectedEasing=r.easing?r.easing:t._easing,t._endTime=t._startTime+o;for(n in i)i.hasOwnProperty(n)&&a.push({targetObj:s,propName:n,deltaVal:i[n]-(r.isDelta?0:s[n]),oldDelta:0});return t._targetData=a,t._destTime=t._endTime-t._startTime,t}this.log('Cannot start tweening properties of the specified object "'+obj+'" because it does not exist!',"error")},stop:function(t){return this._tweens.pull(t),this._tweens.length||this.disable(),this},stopAll:function(){return this.disable(),delete this._tweens,this._tweens=[],this},enable:function(){return this._tweening||(this._tweening=!0),this},disable:function(){return this._tweening&&(this._tweening=!1),this},update:function(){var t=this.tween;if(t._tweens&&t._tweens.length){var e,i,o,n,s,r,a,h,l,c,m,_,u=ige._tickStart,d=t._tweens,p=d.length;while(p--)if(e=d[p],m=!1,e._started||u>=e._startTime)if(e._started||(e._currentStep===-1&&(e._currentStep=0,t._setupStep(e,!1)),typeof e._beforeTween=="function"&&(e._beforeTween(e),delete e._beforeTween),typeof e._beforeStep=="function"&&(c=e._stepDirection?e._steps.length-(e._currentStep+1):e._currentStep,e._beforeStep(e,c)),e._started=!0),i=u-e._startTime,o=e._destTime,n=e._selectedEasing,o>i){h=e._targetData;for(l in h)if(h.hasOwnProperty(l)){s=h[l];var _=t.easing[n](i,s.deltaVal,o);s.targetObj[s.propName]+=_-s.oldDelta,s.oldDelta=_}typeof e._afterChange=="function"&&e._afterChange(e,c)}else{h=e._targetData;for(l in h)if(h.hasOwnProperty(l)){s=h[l],r=s.targetObj,a=r[s.propName],_=o!==0?t.easing[n](o,s.deltaVal,o):s.deltaVal,a+=_-s.oldDelta;var y=Math.pow(10,15-(a.toFixed(0)+"").length);r[s.propName]=Math.round(a*y)/y}typeof e._afterStep=="function"&&(c=e._stepDirection?e._steps.length-(e._currentStep+1):e._currentStep,e._afterStep(e,c)),e._steps.length===e._currentStep+1?(e._repeatMode?(e._repeatCount!==-1&&(e._repeatedCount++,e._repeatCount===e._repeatedCount&&(m=!0)),m||(e._repeatMode===1&&(e._currentStep=0),e._repeatMode===2&&(e._stepDirection=!e._stepDirection,e._steps.reverse(),e._currentStep=1),typeof e._stepsComplete=="function"&&e._stepsComplete(e,e._currentStep),typeof e._beforeStep=="function"&&(c=e._stepDirection?e._steps.length-(e._currentStep+1):e._currentStep,e._beforeStep(e,c)),t._setupStep(e,!0))):m=!0,m&&(e.stop(),typeof e._afterTween=="function"&&(e._afterTween(e),delete e._afterTween))):(e._currentStep++,typeof e._beforeStep=="function"&&(c=e._stepDirection?e._steps.length-(e._currentStep+1):e._currentStep,e._beforeStep(e,c)),t._setupStep(e,!0)),typeof e._afterChange=="function"&&e._afterChange(e,c)}}},easing:{none:function(t,e,i){return e*t/i},inQuad:function(t,e,i){return e*(t/=i)*t},outQuad:function(t,e,i){return-e*(t/=i)*(t-2)},inOutQuad:function(t,e,i){return 1>(t/=i/2)?e/2*t*t:-e/2*(--t*(t-2)-1)},inCubic:function(t,e,i){return e*(t/=i)*t*t},outCubic:function(t,e,i){return e*((t=t/i-1)*t*t+1)},inOutCubic:function(t,e,i){return 1>(t/=i/2)?e/2*t*t*t:e/2*((t-=2)*t*t+2)},outInCubic:function(t,e,i){return i/2>t?this.outCubic(t*2,e/2,i):this.inCubic(t*2-i,e/2,e/2,i)},inQuart:function(t,e,i){return e*(t/=i)*t*t*t},outQuart:function(t,e,i){return-e*((t=t/i-1)*t*t*t-1)},inOutQuart:function(t,e,i){return 1>(t/=i/2)?e/2*t*t*t*t:-e/2*((t-=2)*t*t*t-2)},outInQuart:function(t,e,i){return i/2>t?this.outQuart(t*2,e/2,i):this.inQuart(t*2-i,e/2,e/2,i)},inQuint:function(t,e,i){return e*(t/=i)*t*t*t*t},outQuint:function(t,e,i){return e*((t=t/i-1)*t*t*t*t+1)},inOutQuint:function(t,e,i){return 1>(t/=i/2)?e/2*t*t*t*t*t:e/2*((t-=2)*t*t*t*t+2)},outInQuint:function(t,e,i){return i/2>t?this.outQuint(t*2,e/2,i):this.inQuint(t*2-i,e/2,e/2,i)},inSine:function(t,e,i){return-e*Math.cos(t/i*(Math.PI/2))+e},outSine:function(t,e,i){return e*Math.sin(t/i*(Math.PI/2))},inOutSine:function(t,e,i){return-e/2*(Math.cos(Math.PI*t/i)-1)},outInSine:function(t,e,i){return i/2>t?this.outSine(t*2,e/2,i):this.inSine(t*2-i,e/2,e/2,i)},inExpo:function(t,e,i){return t===0?0:e*Math.pow(2,10*(t/i-1))-e*.001},outExpo:function(t,e,i){return t===i?e:e*1.001*(-Math.pow(2,-10*t/i)+1)},inOutExpo:function(t,e,i){return t===0?0:t===i?e:1>(t/=i/2)?e/2*Math.pow(2,10*(t-1))-e*5e-4:e/2*1.0005*(-Math.pow(2,-10*--t)+2)},outInExpo:function(t,e,i){return i/2>t?this.outExpo(t*2,e/2,i):this.inExpo(t*2-i,e/2,e/2,i)},inCirc:function(t,e,i){return-e*(Math.sqrt(1-(t/=i)*t)-1)},outCirc:function(t,e,i){return e*Math.sqrt(1-(t=t/i-1)*t)},inOutCirc:function(t,e,i){return 1>(t/=i/2)?-e/2*(Math.sqrt(1-t*t)-1):e/2*(Math.sqrt(1-(t-=2)*t)+1)},outInCirc:function(t,e,i){return i/2>t?this.outCirc(t*2,e/2,i):this.inCirc(t*2-i,e/2,e/2,i)},inElastic:function(t,e,i,o,n){var s;return t===0?0:(t/=i)===1?e:(n||(n=i*.3),!o||Math.abs(e)>o?(o=e,s=n/4):s=n/(2*Math.PI)*Math.asin(e/o),-(o*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/n)))},outElastic:function(t,e,i,o,n){var s;return t===0?0:(t/=i)===1?e:(n||(n=i*.3),!o||Math.abs(e)>o?(o=e,s=n/4):s=n/(2*Math.PI)*Math.asin(e/o),o*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/n)+e)},inOutElastic:function(t,e,i,o,n){var s;return t===0?0:(t/=i/2)===2?e:(n||(n=i*.3*1.5),!o||Math.abs(e)>o?(o=e,s=n/4):s=n/(2*Math.PI)*Math.asin(e/o),1>t?-.5*o*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/n):o*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/n)*.5+e)},outInElastic:function(t,e,i,o,n){return i/2>t?this.outElastic(t*2,e/2,i,o,n):this.inElastic(t*2-i,e/2,e/2,i,o,n)},inBack:function(t,e,i,o){return o===void 0&&(o=1.70158),e*(t/=i)*t*((o+1)*t-o)},outBack:function(t,e,i,o){return o===void 0&&(o=1.70158),e*((t=t/i-1)*t*((o+1)*t+o)+1)},inOutBack:function(t,e,i,o){return o===void 0&&(o=1.70158),1>(t/=i/2)?e/2*t*t*(((o*=1.525)+1)*t-o):e/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)},outInBack:function(t,e,i,o){return i/2>t?this.outBack(t*2,e/2,i,o):this.inBack(t*2-i,e/2,e/2,i,o)},inBounce:function(t,e,i){return e-this.outBounce(i-t,0,e,i)},outBounce:function(t,e,i){return 1/2.75>(t/=i)?e*7.5625*t*t:2/2.75>t?e*(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?e*(7.5625*(t-=2.25/2.75)*t+.9375):e*(7.5625*(t-=2.625/2.75)*t+.984375)},inOutBounce:function(t,e,i){return i/2>t?this.inBounce(t*2,0,e,i)*.5:this.outBounce(t*2-i,0,e,i)*.5+e*.5},outInBounce:function(t,e,i){return i/2>t?this.outBounce(t*2,e/2,i):this.inBounce(t*2-i,e/2,e/2,i)}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_12);var $i_14=$i_3.extend({classId:"$i_14",componentId:"input",init:function(){this._eventQueue=[],this._eventControl={_cancelled:!1,stopPropagation:function(){this._cancelled=!0}},this.tick(),this.mouse={dblClick:-302,down:-301,up:-300,move:-259,wheel:-258,wheelUp:-257,wheelDown:-256,x:-255,y:-254,button1:-253,button2:-252,button3:-251},this.pad1={button1:-250,button2:-249,button3:-248,button4:-247,button5:-246,button6:-245,button7:-244,button8:-243,button9:-242,button10:-241,button11:-240,button12:-239,button13:-238,button14:-237,button15:-236,button16:-235,button17:-234,button18:-233,button19:-232,button20:-231,stick1:-230,stick2:-229,stick1Up:-228,stick1Down:-227,stick1Left:-226,stick1Right:-225,stick2Up:-224,stick2Down:-223,stick2Left:-222,stick2Right:-221},this.pad2={button1:-220,button2:-219,button3:-218,button4:-217,button5:-216,button6:-215,button7:-214,button8:-213,button9:-212,button10:-211,button11:-210,button12:-209,button13:-208,button14:-207,button15:-206,button16:-205,button17:-204,button18:-203,button19:-202,button20:-201,stick1:-200,stick2:-199,stick1Up:-198,stick1Down:-197,stick1Left:-196,stick1Right:-195,stick2Up:-194,stick2Down:-193,stick2Left:-192,stick2Right:-191},this.key={shift:-3,ctrl:-2,alt:-1,backspace:8,tab:9,enter:13,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90},this._controlMap=[],this._state=[],this._state[this.mouse.x]=0,this._state[this.mouse.y]=0},debug:function(t){return t!==void 0?(this._debug=t,this):this._debug},setupListeners:function(t){this.log("Setting up input event listeners..."),this._canvas=t;var e=this;this._evRef={mousedown:function(t){t.igeType="mouse",e._rationalise(t),e._mouseDown(t)},mouseup:function(t){t.igeType="mouse",e._rationalise(t),e._mouseUp(t)},mousemove:function(t){t.igeType="mouse",e._rationalise(t),e._mouseMove(t)},mousewheel:function(t){t.igeType="mouse",e._rationalise(t),e._mouseWheel(t)},touchmove:function(t){t.igeType="touch",e._rationalise(t,!0),e._mouseMove(t)},touchstart:function(t){t.igeType="touch",e._rationalise(t,!0),e._mouseDown(t)},touchend:function(t){t.igeType="touch",e._rationalise(t,!0),e._mouseUp(t)},contextmenu:function(t){t.preventDefault(),t.igeType="mouse",e._rationalise(t),e._contextMenu(t)},keydown:function(t){t.igeType="key",e._rationalise(t),e._keyDown(t)},keyup:function(t){t.igeType="key",e._rationalise(t),e._keyUp(t)}},t.addEventListener("mousedown",this._evRef.mousedown,!1),t.addEventListener("mouseup",this._evRef.mouseup,!1),t.addEventListener("mousemove",this._evRef.mousemove,!1),t.addEventListener("mousewheel",this._evRef.mousewheel,!1),t.addEventListener("touchmove",this._evRef.touchmove,!1),t.addEventListener("touchstart",this._evRef.touchstart,!1),t.addEventListener("touchend",this._evRef.touchend,!1),t.addEventListener("contextmenu",this._evRef.contextmenu,!1),window.addEventListener("keydown",this._evRef.keydown,!1),window.addEventListener("keyup",this._evRef.keyup,!1)},destroyListeners:function(){this.log("Removing input event listeners...");var t=this._canvas;t.removeEventListener("mousedown",this._evRef.mousedown,!1),t.removeEventListener("mouseup",this._evRef.mouseup,!1),t.removeEventListener("mousemove",this._evRef.mousemove,!1),t.removeEventListener("mousewheel",this._evRef.mousewheel,!1),t.removeEventListener("touchmove",this._evRef.touchmove,!1),t.removeEventListener("touchstart",this._evRef.touchstart,!1),t.removeEventListener("touchend",this._evRef.touchend,!1),t.removeEventListener("contextmenu",this._evRef.contextmenu,!1),window.removeEventListener("keydown",this._evRef.keydown,!1),window.removeEventListener("keyup",this._evRef.keyup,!1)},fireManualEvent:function(t,e){t&&e?this._evRef[t]?this._evRef[t](e):this.log('Cannot fire manual event "'+t+'" because no listener exists in the engine for this event type!',"warning"):this.log("Cannot fire manual event because both eventName and eventObj params are required.","warning")},_rationalise:function(t,e){if(t.igeType==="key"&&t.keyCode===8){var i=t.srcElement||t.target;i.tagName.toLowerCase()==="body"&&t.preventDefault()}t.igeType==="touch"&&t.preventDefault(),e?(t.button=0,t.changedTouches&&t.changedTouches.length&&(t.igePageX=t.changedTouches[0].pageX,t.igePageY=t.changedTouches[0].pageY)):(t.igePageX=t.pageX,t.igePageY=t.pageY),t.igeX=t.igePageX-ige._canvasPosition().left,t.igeY=t.igePageY-ige._canvasPosition().top,this.emit("inputEvent",t)},_mouseDown:function(t){this._debug&&console.log("Mouse Down",t),this._updateMouseData(t);var e=t.igeX-ige._bounds2d.x2,i=t.igeY-ige._bounds2d.y2,o=this;t.button===0&&(this._state[this.mouse.button1]=!0),t.button===1&&(this._state[this.mouse.button2]=!0),t.button===2&&(this._state[this.mouse.button3]=!0),this.mouseDown=t,o.emit("preMouseDown",[t,e,i,t.button+1])||this.queueEvent(this,function(){o.emit("mouseDown",[t,e,i,t.button+1])})},_mouseUp:function(t){this._debug&&console.log("Mouse Up",t),this._updateMouseData(t);var e=t.igeX-ige._bounds2d.x2,i=t.igeY-ige._bounds2d.y2,o=this;t.button===0&&(this._state[this.mouse.button1]=!1),t.button===1&&(this._state[this.mouse.button2]=!1),t.button===2&&(this._state[this.mouse.button3]=!1),this.mouseUp=t,o.emit("preMouseUp",[t,e,i,t.button+1])||this.queueEvent(this,function(){o.emit("mouseUp",[t,e,i,t.button+1])})},_contextMenu:function(t){this._debug&&console.log("Context Menu",t),this._updateMouseData(t);var e=t.igeX-ige._bounds2d.x2,i=t.igeY-ige._bounds2d.y2,o=this;t.button===0&&(this._state[this.mouse.button1]=!1),t.button===1&&(this._state[this.mouse.button2]=!1),this.contextMenu=t,o.emit("preContextMenu",[t,e,i,t.button+1])||this.queueEvent(this,function(){o.emit("contextMenu",[t,e,i,t.button+1])})},_mouseMove:function(t){ige._mouseOverVp=this._updateMouseData(t);var e=t.igeX-ige._bounds2d.x2,i=t.igeY-ige._bounds2d.y2,o=this;this._state[this.mouse.x]=e,this._state[this.mouse.y]=i,this.mouseMove=t,o.emit("preMouseMove",[t,e,i,t.button+1])||this.queueEvent(this,function(){o.emit("mouseMove",[t,e,i,t.button+1])})},_mouseWheel:function(t){this._updateMouseData(t);var e=t.igeX-ige._bounds2d.x2,i=t.igeY-ige._bounds2d.y2,o=this;this._state[this.mouse.wheel]=t.wheelDelta,t.wheelDelta>0?this._state[this.mouse.wheelUp]=!0:this._state[this.mouse.wheelDown]=!0,this.mouseWheel=t,o.emit("preMouseWheel",[t,e,i,t.button+1])||this.queueEvent(this,function(){o.emit("mouseWheel",[t,e,i,t.button+1])})},_keyDown:function(t){var e=this;this._state[t.keyCode]=!0,this._debug&&console.log("Key Down",t),e.emit("preKeyDown",[t,t.keyCode])||this.queueEvent(this,function(){e.emit("keyDown",[t,t.keyCode])})},_keyUp:function(t){var e=this;this._state[t.keyCode]=!1,this._debug&&console.log("Key Up",t),e.emit("preKeyUp",[t,t.keyCode])||this.queueEvent(this,function(){e.emit("keyUp",[t,t.keyCode])})},_updateMouseData:function(t){var e,i,o=ige._children,n=o.length,s=t.igeX-ige._bounds2d.x2-ige._translate.x,r=t.igeY-ige._bounds2d.y2-ige._translate.y;ige._mousePos.x=s,ige._mousePos.y=r;while(n--)if(e=o[o.length-(n+1)],s>e._translate.x-e._bounds2d.x/2&&e._translate.x+e._bounds2d.x/2>s&&r>e._translate.y-e._bounds2d.y/2&&e._translate.y+e._bounds2d.y/2>r){e._mousePos=new $i_5(Math.floor((s-e._translate.x)/e.camera._scale.x+e.camera._translate.x),Math.floor((r-e._translate.y)/e.camera._scale.y+e.camera._translate.y),0),i=e,t.igeViewport=e;break}return i},mapAction:function(t,e){this._controlMap[t]=e},actionVal:function(t){return this._state[this._controlMap[t]]},actionState:function(t){var e=this._state[this._controlMap[t]];return!!e},val:function(t){return this._state[t]},state:function(t){return!!this._state[t]},stopPropagation:function(){return this._eventControl._cancelled=!0,this},queueEvent:function(t,e,i){return e!==void 0&&this._eventQueue.push([t,e,i]),this},tick:function(){var t=this._eventQueue,e=t.length,i=this._eventControl;while(e--)if(t[e][1].apply(t[e][0],[i,t[e][2]]),i._cancelled)break;this._eventQueue=[],this._eventControl._cancelled=!1,this.dblClick=!1,this.mouseMove=!1,this.mouseDown=!1,this.mouseUp=!1,this.mouseWheel=!1},emit:function(t,e){if(this._eventListeners&&this._eventListeners[t]){var i,o,n,s,r,a,h=this._eventListeners[t].length,l=this._eventListeners[t].length-1,c=this._eventControl;if(h){if(i=[],typeof e=="object"&&e!==null&&e[0]!==null)for(o in e)e.hasOwnProperty(o)&&(i[o]=e[o]);else i=[e];n=!1,this._eventListeners._processing=!0;while(h--){if(c._cancelled)break;s=l-h,r=this._eventListeners[t][s],r.sendEventName&&(i=[t]),a=r.call.apply(r.context||this,i),(a===!0||c._cancelled===!0)&&(n=!0),r.oneShot&&this.off(t,r)}if(this._eventListeners._processing=!1,this._processRemovals(),n)return 1}}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_14);var $i_18=$i_2.extend({classId:"$i_18",componentId:"tiled",init:function(t,e){this._entity=t,this._options=e},loadJson:function(t,e){var i,o=this;typeof t=="string"?ige.isClient?(i=document.createElement("script"),i.src=t,i.onload=function(){o.log("Tiled data loaded, processing..."),o._processData(tiled,e)},document.getElementsByTagName("head")[0].appendChild(i)):this.log("URL-based Tiled data is only available client-side. If you want to load Tiled map data on the server please include the map file in your ServerConfig.js file and then specify the map's data object instead of the URL.","error"):o._processData(t,e)},_processData:function(t,e){var i,o,n,s,r,a,h,l,c,m,_,u,d,p,y,x=ige.isServer===!0?$i_67:$i_54Map,f=t.width,g=t.height,v=t.layers,b=v.length,C=[],w={},D=t.tilesets,S=D.length,B=S,I=0,A=[],M=[];if(m=function(){for(_=0;b>_;_++){if(i=v[_],o=i.type,o==="tilelayer"){if(n=i.data,C[_]=(new x).id(i.name).tileWidth(t.tilewidth).tileHeight(t.tilewidth).depth(_),C[_].type=o,t.orientation==="isometric"&&C[_].isometricMounts(!0),w[i.name]=C[_],S=D.length,ige.isClient)for(u=0;S>u;u++)C[_].addTexture(M[u]);for(s=n.length,p=0;g>p;p++)for(d=0;f>d;d++)y=d+p*f,n[y]>0&&n[y]!==2147483712&&(ige.isClient?(a=A[n[y]],a&&(h=n[y]-(a._tiledStartingId-1),C[_].paintTile(d,p,C[_]._textureList.indexOf(a),h))):C[_].occupyTile(d,p,1,1,n[y]))}o==="objectgroup"&&(C[_]=i,w[i.name]=C[_])}e(C,w)},ige.isClient){l=function(t,e,i){return function(){var e,o;new $i_55(ige.client.mapUrl+"/"+i.image,this.width/i.tilewidth,this.height/i.tileheight).id(i.name).on("loaded",function(){for(o=this.cellCount(),this._tiledStartingId=i.firstgid,e=0;o>e;e++)A[this._tiledStartingId+e]=this;t.push(this),I++,I===B&&m()})}};while(S--)c=new Image,r=D[S],c.onload=l(M,S,r),c.src=ige.client.mapUrl+"/"+r.image}else m()}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_18);var $i_19=$i_2.extend({classId:"$i_19",componentId:"ui",init:function(t,e){var i=this;this._entity=t,this._options=e,this._focus=null,this._caret=null,this._register=[],this._styles={},this._elementsByStyle={},ige.input.on("keyDown",function(t){i._keyDown(t)})},style:function(t,e){return t!==void 0?e!==void 0?(this._styles[t]=e,this):this._styles[t]:this},registerElement:function(t){this._register.push(t)},unRegisterElement:function(t){this._register.pull(t),delete this._styles["#"+t._id],delete this._styles["#"+t._id+":active"],delete this._styles["#"+t._id+":focus"],delete this._styles["#"+t._id+":hover"]},registerElementStyle:function(t){t&&t._styleClass&&(this._elementsByStyle[t._styleClass]=this._elementsByStyle[t._styleClass]||[],this._elementsByStyle[t._styleClass].push(t))},unRegisterElementStyle:function(t){t&&t._styleClass&&(this._elementsByStyle[t._styleClass]=this._elementsByStyle[t._styleClass]||[],this._elementsByStyle[t._styleClass].push(t))},canFocus:function(t){return t._allowFocus},focus:function(t){if(t!==void 0){if(t===this._focus)return!0;var e=this._focus;if(!(e&&e.emit("blur",t)||(e&&(e._focused=!1,e.blur()),t.emit("focus",e))))return this._focus=t,t._focused=!0,!0}return!1},blur:function(t){return t===void 0||t!==this._focus||t.emit("blur")?!1:(this._focus=null,t._focused=!1,t._updateStyle(),!0)},_keyUp:function(t){this._focus&&(this._focus.emit("keyUp",t),ige.input.stopPropagation())},_keyDown:function(t){this._focus&&(this._focus.emit("keyDown",t),ige.input.stopPropagation())}}),$i_23={};(function(t,e){function i(){}!(Object.defineProperty instanceof Function)&&Object.__defineGetter__ instanceof Function&&Object.__defineSetter__ instanceof Function&&(Object.defineProperty=function(t,e,i){i.get instanceof Function&&t.__defineGetter__(e,i.get),i.set instanceof Function&&t.__defineSetter__(e,i.set)}),t.inherit=function(t,e){var o=t;i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=o},t.generateCallback=function(t,e){return function(){e.apply(t,arguments)}},t.NVector=function(t){t===e&&(t=0);for(var i=Array(t||0),o=0;t>o;++o)i[o]=0;return i},t.is=function(t,i){return t===null?!1:i instanceof Function&&t instanceof i?!0:t.constructor.__implements!=e&&t.constructor.__implements[i]?!0:!1},t.parseUInt=function(t){return Math.abs(parseInt(t))}})($i_23);var Vector=Array,Vector_a2j_Number=$i_23.NVector;$i_23===void 0&&($i_23={}),$i_23.Collision===void 0&&($i_23.Collision={}),$i_23.Collision.Shapes===void 0&&($i_23.Collision.Shapes={}),$i_23.Common===void 0&&($i_23.Common={}),$i_23.Common.Math===void 0&&($i_23.Common.Math={}),$i_23.Dynamics===void 0&&($i_23.Dynamics={}),$i_23.Dynamics.Contacts===void 0&&($i_23.Dynamics.Contacts={}),$i_23.Dynamics.Controllers===void 0&&($i_23.Dynamics.Controllers={}),$i_23.Dynamics.Joints===void 0&&($i_23.Dynamics.Joints={}),function(){function t(){t.b2AABB.apply(this,arguments)}function e(){e.b2Bound.apply(this,arguments)}function i(){i.b2BoundValues.apply(this,arguments),this.constructor===i&&this.b2BoundValues.apply(this,arguments)}function o(){o.b2Collision.apply(this,arguments)}function n(){n.b2ContactID.apply(this,arguments),this.constructor===n&&this.b2ContactID.apply(this,arguments)}function s(){s.b2ContactPoint.apply(this,arguments)}function r(){r.b2Distance.apply(this,arguments)}function a(){a.b2DistanceInput.apply(this,arguments)}function h(){h.b2DistanceOutput.apply(this,arguments)}function l(){l.b2DistanceProxy.apply(this,arguments)}function c(){c.b2DynamicTree.apply(this,arguments),this.constructor===c&&this.b2DynamicTree.apply(this,arguments)}function m(){m.b2DynamicTreeBroadPhase.apply(this,arguments)}function _(){_.b2DynamicTreeNode.apply(this,arguments)}function u(){u.b2DynamicTreePair.apply(this,arguments)}function d(){d.b2Manifold.apply(this,arguments),this.constructor===d&&this.b2Manifold.apply(this,arguments)}function p(){p.b2ManifoldPoint.apply(this,arguments),this.constructor===p&&this.b2ManifoldPoint.apply(this,arguments)}function y(){y.b2Point.apply(this,arguments)}function x(){x.b2RayCastInput.apply(this,arguments),this.constructor===x&&this.b2RayCastInput.apply(this,arguments)}function f(){f.b2RayCastOutput.apply(this,arguments)}function g(){g.b2Segment.apply(this,arguments)}function v(){v.b2SeparationFunction.apply(this,arguments)}function b(){b.b2Simplex.apply(this,arguments),this.constructor===b&&this.b2Simplex.apply(this,arguments)}function C(){C.b2SimplexCache.apply(this,arguments)}function w(){w.b2SimplexVertex.apply(this,arguments)}function D(){D.b2TimeOfImpact.apply(this,arguments)}function S(){S.b2TOIInput.apply(this,arguments)}function B(){B.b2WorldManifold.apply(this,arguments),this.constructor===B&&this.b2WorldManifold.apply(this,arguments)}function I(){I.ClipVertex.apply(this,arguments)}function A(){A.Features.apply(this,arguments)}function M(){M.b2CircleShape.apply(this,arguments),this.constructor===M&&this.b2CircleShape.apply(this,arguments)}function T(){T.b2EdgeChainDef.apply(this,arguments),this.constructor===T&&this.b2EdgeChainDef.apply(this,arguments)}function P(){P.b2EdgeShape.apply(this,arguments),this.constructor===P&&this.b2EdgeShape.apply(this,arguments)}function k(){k.b2MassData.apply(this,arguments)}function V(){V.b2PolygonShape.apply(this,arguments),this.constructor===V&&this.b2PolygonShape.apply(this,arguments)}function R(){R.b2Shape.apply(this,arguments),this.constructor===R&&this.b2Shape.apply(this,arguments)}function L(){L.b2Color.apply(this,arguments),this.constructor===L&&this.b2Color.apply(this,arguments)}function F(){F.b2Settings.apply(this,arguments)}function E(){E.b2Mat22.apply(this,arguments),this.constructor===E&&this.b2Mat22.apply(this,arguments)}function G(){G.b2Mat33.apply(this,arguments),this.constructor===G&&this.b2Mat33.apply(this,arguments)}function z(){z.b2Math.apply(this,arguments)}function J(){J.b2Sweep.apply(this,arguments)}function O(){O.b2Transform.apply(this,arguments),this.constructor===O&&this.b2Transform.apply(this,arguments)}function N(){N.b2Vec2.apply(this,arguments),this.constructor===N&&this.b2Vec2.apply(this,arguments)}function U(){U.b2Vec3.apply(this,arguments),this.constructor===U&&this.b2Vec3.apply(this,arguments)}function j(){j.b2Body.apply(this,arguments),this.constructor===j&&this.b2Body.apply(this,arguments)}function W(){W.b2BodyDef.apply(this,arguments),this.constructor===W&&this.b2BodyDef.apply(this,arguments)}function q(){q.b2ContactFilter.apply(this,arguments)}function $(){$.b2ContactImpulse.apply(this,arguments)}function X(){X.b2ContactListener.apply(this,arguments)}function H(){H.b2ContactManager.apply(this,arguments),this.constructor===H&&this.b2ContactManager.apply(this,arguments)}function K(){K.b2DebugDraw.apply(this,arguments),this.constructor===K&&this.b2DebugDraw.apply(this,arguments)}function Y(){Y.b2DestructionListener.apply(this,arguments)}function Z(){Z.b2FilterData.apply(this,arguments)}function Q(){Q.b2Fixture.apply(this,arguments),this.constructor===Q&&this.b2Fixture.apply(this,arguments)}function te(){te.b2FixtureDef.apply(this,arguments),this.constructor===te&&this.b2FixtureDef.apply(this,arguments)}function ee(){ee.b2Island.apply(this,arguments),this.constructor===ee&&this.b2Island.apply(this,arguments)}function ie(){ie.b2TimeStep.apply(this,arguments)}function oe(){oe.b2World.apply(this,arguments),this.constructor===oe&&this.b2World.apply(this,arguments)}function ne(){ne.b2CircleContact.apply(this,arguments)}function se(){se.b2Contact.apply(this,arguments),this.constructor===se&&this.b2Contact.apply(this,arguments)}function re(){re.b2ContactConstraint.apply(this,arguments),this.constructor===re&&this.b2ContactConstraint.apply(this,arguments)}function ae(){ae.b2ContactConstraintPoint.apply(this,arguments)}function he(){he.b2ContactEdge.apply(this,arguments)}function le(){le.b2ContactFactory.apply(this,arguments),this.constructor===le&&this.b2ContactFactory.apply(this,arguments)}function ce(){ce.b2ContactRegister.apply(this,arguments)}function me(){me.b2ContactResult.apply(this,arguments)}function _e(){_e.b2ContactSolver.apply(this,arguments),this.constructor===_e&&this.b2ContactSolver.apply(this,arguments)}function ue(){ue.b2EdgeAndCircleContact.apply(this,arguments)}function de(){de.b2NullContact.apply(this,arguments),this.constructor===de&&this.b2NullContact.apply(this,arguments)}function pe(){pe.b2PolyAndCircleContact.apply(this,arguments)}function ye(){ye.b2PolyAndEdgeContact.apply(this,arguments)}function xe(){xe.b2PolygonContact.apply(this,arguments)}function fe(){fe.b2PositionSolverManifold.apply(this,arguments),this.constructor===fe&&this.b2PositionSolverManifold.apply(this,arguments)}function ge(){ge.b2BuoyancyController.apply(this,arguments)}function ve(){ve.b2ConstantAccelController.apply(this,arguments)}function be(){be.b2ConstantForceController.apply(this,arguments)}function Ce(){Ce.b2Controller.apply(this,arguments)}function we(){we.b2ControllerEdge.apply(this,arguments)}function De(){De.b2GravityController.apply(this,arguments)}function Se(){Se.b2TensorDampingController.apply(this,arguments)}function Be(){Be.b2DistanceJoint.apply(this,arguments),this.constructor===Be&&this.b2DistanceJoint.apply(this,arguments)}function Ie(){Ie.b2DistanceJointDef.apply(this,arguments),this.constructor===Ie&&this.b2DistanceJointDef.apply(this,arguments)}function Ae(){Ae.b2FrictionJoint.apply(this,arguments),this.constructor===Ae&&this.b2FrictionJoint.apply(this,arguments)}function Me(){Me.b2FrictionJointDef.apply(this,arguments),this.constructor===Me&&this.b2FrictionJointDef.apply(this,arguments)}function Te(){Te.b2GearJoint.apply(this,arguments),this.constructor===Te&&this.b2GearJoint.apply(this,arguments)}function Pe(){Pe.b2GearJointDef.apply(this,arguments),this.constructor===Pe&&this.b2GearJointDef.apply(this,arguments)}function ke(){ke.b2Jacobian.apply(this,arguments)}function Ve(){Ve.b2Joint.apply(this,arguments),this.constructor===Ve&&this.b2Joint.apply(this,arguments)}function Re(){Re.b2JointDef.apply(this,arguments),this.constructor===Re&&this.b2JointDef.apply(this,arguments)}function Le(){Le.b2JointEdge.apply(this,arguments)}function Fe(){Fe.b2LineJoint.apply(this,arguments),this.constructor===Fe&&this.b2LineJoint.apply(this,arguments)}function Ee(){Ee.b2LineJointDef.apply(this,arguments),this.constructor===Ee&&this.b2LineJointDef.apply(this,arguments)}function Ge(){Ge.b2MouseJoint.apply(this,arguments),this.constructor===Ge&&this.b2MouseJoint.apply(this,arguments)}function ze(){ze.b2MouseJointDef.apply(this,arguments),this.constructor===ze&&this.b2MouseJointDef.apply(this,arguments)}function Je(){Je.b2PrismaticJoint.apply(this,arguments),this.constructor===Je&&this.b2PrismaticJoint.apply(this,arguments)}function Oe(){Oe.b2PrismaticJointDef.apply(this,arguments),this.constructor===Oe&&this.b2PrismaticJointDef.apply(this,arguments)}function Ne(){Ne.b2PulleyJoint.apply(this,arguments),this.constructor===Ne&&this.b2PulleyJoint.apply(this,arguments)}function Ue(){Ue.b2PulleyJointDef.apply(this,arguments),this.constructor===Ue&&this.b2PulleyJointDef.apply(this,arguments)}function je(){je.b2RevoluteJoint.apply(this,arguments),this.constructor===je&&this.b2RevoluteJoint.apply(this,arguments)}function We(){We.b2RevoluteJointDef.apply(this,arguments),this.constructor===We&&this.b2RevoluteJointDef.apply(this,arguments)}function qe(){qe.b2WeldJoint.apply(this,arguments),this.constructor===qe&&this.b2WeldJoint.apply(this,arguments)}function $e(){$e.b2WeldJointDef.apply(this,arguments),this.constructor===$e&&this.b2WeldJointDef.apply(this,arguments)}$i_23.Collision.IBroadPhase="$i_23.Collision.IBroadPhase",$i_23.Collision.b2AABB=t,$i_23.Collision.b2Bound=e,$i_23.Collision.b2BoundValues=i,$i_23.Collision.b2Collision=o,$i_23.Collision.b2ContactID=n,$i_23.Collision.b2ContactPoint=s,$i_23.Collision.b2Distance=r,$i_23.Collision.b2DistanceInput=a,$i_23.Collision.b2DistanceOutput=h,$i_23.Collision.b2DistanceProxy=l,$i_23.Collision.b2DynamicTree=c,$i_23.Collision.b2DynamicTreeBroadPhase=m,$i_23.Collision.b2DynamicTreeNode=_,$i_23.Collision.b2DynamicTreePair=u,$i_23.Collision.b2Manifold=d,$i_23.Collision.b2ManifoldPoint=p,$i_23.Collision.b2Point=y,$i_23.Collision.b2RayCastInput=x,$i_23.Collision.b2RayCastOutput=f,$i_23.Collision.b2Segment=g,$i_23.Collision.b2SeparationFunction=v,$i_23.Collision.b2Simplex=b,$i_23.Collision.b2SimplexCache=C,$i_23.Collision.b2SimplexVertex=w,$i_23.Collision.b2TimeOfImpact=D,$i_23.Collision.b2TOIInput=S,$i_23.Collision.b2WorldManifold=B,$i_23.Collision.ClipVertex=I,$i_23.Collision.Features=A,$i_23.Collision.Shapes.b2CircleShape=M,$i_23.Collision.Shapes.b2EdgeChainDef=T,$i_23.Collision.Shapes.b2EdgeShape=P,$i_23.Collision.Shapes.b2MassData=k,$i_23.Collision.Shapes.b2PolygonShape=V,$i_23.Collision.Shapes.b2Shape=R,$i_23.Common.b2internal="$i_23.Common.b2internal",$i_23.Common.b2Color=L,$i_23.Common.b2Settings=F,$i_23.Common.Math.b2Mat22=E,$i_23.Common.Math.b2Mat33=G,$i_23.Common.Math.b2Math=z,$i_23.Common.Math.b2Sweep=J,$i_23.Common.Math.b2Transform=O,$i_23.Common.Math.b2Vec2=N,$i_23.Common.Math.b2Vec3=U,$i_23.Dynamics.b2Body=j,$i_23.Dynamics.b2BodyDef=W,$i_23.Dynamics.b2ContactFilter=q,$i_23.Dynamics.b2ContactImpulse=$,$i_23.Dynamics.b2ContactListener=X,$i_23.Dynamics.b2ContactManager=H,$i_23.Dynamics.b2DebugDraw=K,$i_23.Dynamics.b2DestructionListener=Y,$i_23.Dynamics.b2FilterData=Z,$i_23.Dynamics.b2Fixture=Q,$i_23.Dynamics.b2FixtureDef=te,$i_23.Dynamics.b2Island=ee,$i_23.Dynamics.b2TimeStep=ie,$i_23.Dynamics.b2World=oe,$i_23.Dynamics.Contacts.b2CircleContact=ne,$i_23.Dynamics.Contacts.b2Contact=se,$i_23.Dynamics.Contacts.b2ContactConstraint=re,$i_23.Dynamics.Contacts.b2ContactConstraintPoint=ae,$i_23.Dynamics.Contacts.b2ContactEdge=he,$i_23.Dynamics.Contacts.b2ContactFactory=le,$i_23.Dynamics.Contacts.b2ContactRegister=ce,$i_23.Dynamics.Contacts.b2ContactResult=me,$i_23.Dynamics.Contacts.b2ContactSolver=_e,$i_23.Dynamics.Contacts.b2EdgeAndCircleContact=ue,$i_23.Dynamics.Contacts.b2NullContact=de,$i_23.Dynamics.Contacts.b2PolyAndCircleContact=pe,$i_23.Dynamics.Contacts.b2PolyAndEdgeContact=ye,$i_23.Dynamics.Contacts.b2PolygonContact=xe,$i_23.Dynamics.Contacts.b2PositionSolverManifold=fe,$i_23.Dynamics.Controllers.b2BuoyancyController=ge,$i_23.Dynamics.Controllers.b2ConstantAccelController=ve,$i_23.Dynamics.Controllers.b2ConstantForceController=be,$i_23.Dynamics.Controllers.b2Controller=Ce,$i_23.Dynamics.Controllers.b2ControllerEdge=we,$i_23.Dynamics.Controllers.b2GravityController=De,$i_23.Dynamics.Controllers.b2TensorDampingController=Se,$i_23.Dynamics.Joints.b2DistanceJoint=Be,$i_23.Dynamics.Joints.b2DistanceJointDef=Ie,$i_23.Dynamics.Joints.b2FrictionJoint=Ae,$i_23.Dynamics.Joints.b2FrictionJointDef=Me,$i_23.Dynamics.Joints.b2GearJoint=Te,$i_23.Dynamics.Joints.b2GearJointDef=Pe,$i_23.Dynamics.Joints.b2Jacobian=ke,$i_23.Dynamics.Joints.b2Joint=Ve,$i_23.Dynamics.Joints.b2JointDef=Re,$i_23.Dynamics.Joints.b2JointEdge=Le,$i_23.Dynamics.Joints.b2LineJoint=Fe,$i_23.Dynamics.Joints.b2LineJointDef=Ee,$i_23.Dynamics.Joints.b2MouseJoint=Ge,$i_23.Dynamics.Joints.b2MouseJointDef=ze,$i_23.Dynamics.Joints.b2PrismaticJoint=Je,$i_23.Dynamics.Joints.b2PrismaticJointDef=Oe,$i_23.Dynamics.Joints.b2PulleyJoint=Ne,$i_23.Dynamics.Joints.b2PulleyJointDef=Ue,$i_23.Dynamics.Joints.b2RevoluteJoint=je,$i_23.Dynamics.Joints.b2RevoluteJointDef=We,$i_23.Dynamics.Joints.b2WeldJoint=qe,$i_23.Dynamics.Joints.b2WeldJointDef=$e
}(),$i_23.postDefs=[],function(){var t=$i_23.Collision.Shapes.b2CircleShape,e=($i_23.Collision.Shapes.b2EdgeChainDef,$i_23.Collision.Shapes.b2EdgeShape,$i_23.Collision.Shapes.b2MassData,$i_23.Collision.Shapes.b2PolygonShape),i=$i_23.Collision.Shapes.b2Shape,o=($i_23.Common.b2Color,$i_23.Common.b2internal,$i_23.Common.b2Settings),n=($i_23.Common.Math.b2Mat22,$i_23.Common.Math.b2Mat33,$i_23.Common.Math.b2Math),s=$i_23.Common.Math.b2Sweep,r=$i_23.Common.Math.b2Transform,a=$i_23.Common.Math.b2Vec2,h=($i_23.Common.Math.b2Vec3,$i_23.Collision.b2AABB),l=$i_23.Collision.b2Bound,c=$i_23.Collision.b2BoundValues,m=$i_23.Collision.b2Collision,_=$i_23.Collision.b2ContactID,u=$i_23.Collision.b2ContactPoint,d=$i_23.Collision.b2Distance,p=$i_23.Collision.b2DistanceInput,y=$i_23.Collision.b2DistanceOutput,x=$i_23.Collision.b2DistanceProxy,f=$i_23.Collision.b2DynamicTree,g=$i_23.Collision.b2DynamicTreeBroadPhase,v=$i_23.Collision.b2DynamicTreeNode,b=$i_23.Collision.b2DynamicTreePair,C=$i_23.Collision.b2Manifold,w=$i_23.Collision.b2ManifoldPoint,D=$i_23.Collision.b2Point,S=$i_23.Collision.b2RayCastInput,B=$i_23.Collision.b2RayCastOutput,I=$i_23.Collision.b2Segment,A=$i_23.Collision.b2SeparationFunction,M=$i_23.Collision.b2Simplex,T=$i_23.Collision.b2SimplexCache,P=$i_23.Collision.b2SimplexVertex,k=$i_23.Collision.b2TimeOfImpact,V=$i_23.Collision.b2TOIInput,R=$i_23.Collision.b2WorldManifold,L=$i_23.Collision.ClipVertex,F=$i_23.Collision.Features,E=$i_23.Collision.IBroadPhase;h.b2AABB=function(){this.lowerBound=new a,this.upperBound=new a},h.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y,i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},h.prototype.GetCenter=function(){return new a((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},h.prototype.GetExtents=function(){return new a((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},h.prototype.Contains=function(t){var e=!0;return e=e&&t.lowerBound.x>=this.lowerBound.x,e=e&&t.lowerBound.y>=this.lowerBound.y,e=e&&this.upperBound.x>=t.upperBound.x,e=e&&this.upperBound.y>=t.upperBound.y},h.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE,o=Number.MAX_VALUE,n=e.p1.x,s=e.p1.y,r=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,h=Math.abs(r),l=Math.abs(a),c=t.normal,m=0,_=0,u=0,d=0,p=0;if(Number.MIN_VALUE>h){if(this.lowerBound.x>n||n>this.upperBound.x)return!1}else if(m=1/r,_=(this.lowerBound.x-n)*m,u=(this.upperBound.x-n)*m,p=-1,_>u&&(d=_,_=u,u=d,p=1),_>i&&(c.x=p,c.y=0,i=_),o=Math.min(o,u),i>o)return!1;if(Number.MIN_VALUE>l){if(this.lowerBound.y>s||s>this.upperBound.y)return!1}else if(m=1/a,_=(this.lowerBound.y-s)*m,u=(this.upperBound.y-s)*m,p=-1,_>u&&(d=_,_=u,u=d,p=1),_>i&&(c.y=p,c.x=0,i=_),o=Math.min(o,u),i>o)return!1;return t.fraction=i,!0},h.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,o=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return(t.lowerBound.z||this.lowerBound.z)&&console.log(e,i," ",o,n),e>0||i>0?!1:o>0||n>0?!1:!0},h.Combine=function(t,e){var i=new h;return i.Combine(t,e),i},h.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)},l.b2Bound=function(){},l.prototype.IsLower=function(){return(this.value&1)==0},l.prototype.IsUpper=function(){return(this.value&1)==1},l.prototype.Swap=function(t){var e=this.value,i=this.proxy,o=this.stabbingCount;this.value=t.value,this.proxy=t.proxy,this.stabbingCount=t.stabbingCount,t.value=e,t.proxy=i,t.stabbingCount=o},c.b2BoundValues=function(){},c.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},m.b2Collision=function(){},m.ClipSegmentToLine=function(t,e,i,o){o===void 0&&(o=0);var n,s=0;n=e[0];var r=n.v;n=e[1];var a=n.v,h=i.x*r.x+i.y*r.y-o,l=i.x*a.x+i.y*a.y-o;if(h>0||t[s++].Set(e[0]),l>0||t[s++].Set(e[1]),0>h*l){var c=h/(h-l);n=t[s];var m=n.v;m.x=r.x+c*(a.x-r.x),m.y=r.y+c*(a.y-r.y),n=t[s];var _;h>0?(_=e[0],n.id=_.id):(_=e[1],n.id=_.id),++s}return s},m.EdgeSeparation=function(t,e,i,o,n){i===void 0&&(i=0),parseInt(t.m_vertexCount);var s,r,a=t.m_vertices,h=t.m_normals,l=parseInt(o.m_vertexCount),c=o.m_vertices;s=e.R,r=h[i];var m=s.col1.x*r.x+s.col2.x*r.y,_=s.col1.y*r.x+s.col2.y*r.y;s=n.R;for(var u=s.col1.x*m+s.col1.y*_,d=s.col2.x*m+s.col2.y*_,p=0,y=Number.MAX_VALUE,x=0;l>x;++x){r=c[x];var f=r.x*u+r.y*d;y>f&&(y=f,p=x)}r=a[i],s=e.R;var g=e.position.x+(s.col1.x*r.x+s.col2.x*r.y),v=e.position.y+(s.col1.y*r.x+s.col2.y*r.y);r=c[p],s=n.R;var b=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),C=n.position.y+(s.col1.y*r.x+s.col2.y*r.y);b-=g,C-=v;var w=b*m+C*_;return w},m.FindMaxSeparation=function(t,e,i,o,n){var s,r,a=parseInt(e.m_vertexCount),h=e.m_normals;r=n.R,s=o.m_centroid;var l=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),c=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);r=i.R,s=e.m_centroid,l-=i.position.x+(r.col1.x*s.x+r.col2.x*s.y),c-=i.position.y+(r.col1.y*s.x+r.col2.y*s.y);for(var _=l*i.R.col1.x+c*i.R.col1.y,u=l*i.R.col2.x+c*i.R.col2.y,d=0,p=-Number.MAX_VALUE,y=0;a>y;++y){s=h[y];var x=s.x*_+s.y*u;x>p&&(p=x,d=y)}var f=m.EdgeSeparation(e,i,d,o,n),g=parseInt(0>d-1?a-1:d-1),v=m.EdgeSeparation(e,i,g,o,n),b=parseInt(a>d+1?d+1:0),C=m.EdgeSeparation(e,i,b,o,n),w=0,D=0,S=0;if(v>f&&v>C)S=-1,w=g,D=v;else{if(f>=C)return t[0]=d,f;S=1,w=b,D=C}for(;;){if(d=S==-1?0>w-1?a-1:w-1:a>w+1?w+1:0,f=m.EdgeSeparation(e,i,d,o,n),D>=f)break;w=d,D=f}return t[0]=w,D},m.FindIncidentEdge=function(t,e,i,o,n,s){o===void 0&&(o=0),parseInt(e.m_vertexCount);var r,a,h=e.m_normals,l=parseInt(n.m_vertexCount),c=n.m_vertices,m=n.m_normals;r=i.R,a=h[o];var _=r.col1.x*a.x+r.col2.x*a.y,u=r.col1.y*a.x+r.col2.y*a.y;r=s.R;var d=r.col1.x*_+r.col1.y*u;u=r.col2.x*_+r.col2.y*u,_=d;for(var p=0,y=Number.MAX_VALUE,x=0;l>x;++x){a=m[x];var f=_*a.x+u*a.y;y>f&&(y=f,p=x)}var g,v=parseInt(p),b=parseInt(l>v+1?v+1:0);g=t[0],a=c[v],r=s.R,g.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y),g.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y),g.id.features.referenceEdge=o,g.id.features.incidentEdge=v,g.id.features.incidentVertex=0,g=t[1],a=c[b],r=s.R,g.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y),g.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y),g.id.features.referenceEdge=o,g.id.features.incidentEdge=b,g.id.features.incidentVertex=1},m.MakeClipPointVector=function(){var t=new Vector(2);return t[0]=new L,t[1]=new L,t},m.CollidePolygons=function(t,e,i,n,s){var r;t.m_pointCount=0;var a=e.m_radius+n.m_radius,h=0;m.s_edgeAO[0]=h;var l=m.FindMaxSeparation(m.s_edgeAO,e,i,n,s);if(h=m.s_edgeAO[0],a>=l){var c=0;m.s_edgeBO[0]=c;var _=m.FindMaxSeparation(m.s_edgeBO,n,s,e,i);if(c=m.s_edgeBO[0],a>=_){var u,d,p,y,x,f=0,g=0,v=.98,b=.001;_>v*l+b?(u=n,d=e,p=s,y=i,f=c,t.m_type=C.e_faceB,g=1):(u=e,d=n,p=i,y=s,f=h,t.m_type=C.e_faceA,g=0);var w=m.s_incidentEdge;m.FindIncidentEdge(w,u,p,f,d,y);var D,S=parseInt(u.m_vertexCount),B=u.m_vertices,I=B[f];D=S>f+1?B[parseInt(f+1)]:B[0];var A=m.s_localTangent;A.Set(D.x-I.x,D.y-I.y),A.Normalize();var M=m.s_localNormal;M.x=A.y,M.y=-A.x;var T=m.s_planePoint;T.Set(.5*(I.x+D.x),.5*(I.y+D.y));var P=m.s_tangent;x=p.R,P.x=x.col1.x*A.x+x.col2.x*A.y,P.y=x.col1.y*A.x+x.col2.y*A.y;var k=m.s_tangent2;k.x=-P.x,k.y=-P.y;var V=m.s_normal;V.x=P.y,V.y=-P.x;var R=m.s_v11,L=m.s_v12;R.x=p.position.x+(x.col1.x*I.x+x.col2.x*I.y),R.y=p.position.y+(x.col1.y*I.x+x.col2.y*I.y),L.x=p.position.x+(x.col1.x*D.x+x.col2.x*D.y),L.y=p.position.y+(x.col1.y*D.x+x.col2.y*D.y);var F=V.x*R.x+V.y*R.y,E=-P.x*R.x-P.y*R.y+a,G=P.x*L.x+P.y*L.y+a,z=m.s_clipPoints1,J=m.s_clipPoints2,O=0;if(O=m.ClipSegmentToLine(z,w,k,E),O>=2&&(O=m.ClipSegmentToLine(J,z,P,G),O>=2)){t.m_localPlaneNormal.SetV(M),t.m_localPoint.SetV(T);for(var N=0,U=0;o.b2_maxManifoldPoints>U;++U){r=J[U];var j=V.x*r.v.x+V.y*r.v.y-F;if(a>=j){var W=t.m_points[N];x=y.R;var q=r.v.x-y.position.x,$=r.v.y-y.position.y;W.m_localPoint.x=q*x.col1.x+$*x.col1.y,W.m_localPoint.y=q*x.col2.x+$*x.col2.y,W.m_id.Set(r.id),W.m_id.features.flip=g,++N}}t.m_pointCount=N}}}},m.CollideCircles=function(t,e,i,o,n){t.m_pointCount=0;var s,r;s=i.R,r=e.m_p;var a=i.position.x+(s.col1.x*r.x+s.col2.x*r.y),h=i.position.y+(s.col1.y*r.x+s.col2.y*r.y);s=n.R,r=o.m_p;var l=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),c=n.position.y+(s.col1.y*r.x+s.col2.y*r.y),m=l-a,_=c-h,u=m*m+_*_,d=e.m_radius+o.m_radius;u>d*d||(t.m_type=C.e_circles,t.m_localPoint.SetV(e.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0)},m.CollidePolygonAndCircle=function(t,e,i,o,n){t.m_pointCount=0;var s,r,a=0,h=0;r=n.R,s=o.m_p;var l=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),c=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);a=l-i.position.x,h=c-i.position.y,r=i.R;for(var m=a*r.col1.x+h*r.col1.y,_=a*r.col2.x+h*r.col2.y,u=0,d=-Number.MAX_VALUE,p=e.m_radius+o.m_radius,y=parseInt(e.m_vertexCount),x=e.m_vertices,f=e.m_normals,g=0;y>g;++g){s=x[g],a=m-s.x,h=_-s.y,s=f[g];var v=s.x*a+s.y*h;if(v>p)return;v>d&&(d=v,u=g)}var b=parseInt(u),w=parseInt(y>b+1?b+1:0),D=x[b],S=x[w];if(Number.MIN_VALUE>d)return t.m_pointCount=1,t.m_type=C.e_faceA,t.m_localPlaneNormal.SetV(f[u]),t.m_localPoint.x=.5*(D.x+S.x),t.m_localPoint.y=.5*(D.y+S.y),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0,void 0;var B=(m-D.x)*(S.x-D.x)+(_-D.y)*(S.y-D.y),I=(m-S.x)*(D.x-S.x)+(_-S.y)*(D.y-S.y);if(0<B)if(0<I){var A=.5*(D.x+S.x),M=.5*(D.y+S.y);if(d=(m-A)*f[b].x+(_-M)*f[b].y,d>p)return;t.m_pointCount=1,t.m_type=C.e_faceA,t.m_localPlaneNormal.x=f[b].x,t.m_localPlaneNormal.y=f[b].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(A,M),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0}else{if((m-S.x)*(m-S.x)+(_-S.y)*(_-S.y)>p*p)return;t.m_pointCount=1,t.m_type=C.e_faceA,t.m_localPlaneNormal.x=m-S.x,t.m_localPlaneNormal.y=_-S.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(S),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0}else{if((m-D.x)*(m-D.x)+(_-D.y)*(_-D.y)>p*p)return;t.m_pointCount=1,t.m_type=C.e_faceA,t.m_localPlaneNormal.x=m-D.x,t.m_localPlaneNormal.y=_-D.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(D),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0}},m.TestOverlap=function(t,e){var i=e.lowerBound,o=t.upperBound,n=i.x-o.x,s=i.y-o.y;i=t.lowerBound,o=e.upperBound;var r=i.x-o.x,a=i.y-o.y;return n>0||s>0?!1:r>0||a>0?!1:!0},$i_23.postDefs.push(function(){$i_23.Collision.b2Collision.s_incidentEdge=m.MakeClipPointVector(),$i_23.Collision.b2Collision.s_clipPoints1=m.MakeClipPointVector(),$i_23.Collision.b2Collision.s_clipPoints2=m.MakeClipPointVector(),$i_23.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),$i_23.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),$i_23.Collision.b2Collision.s_localTangent=new a,$i_23.Collision.b2Collision.s_localNormal=new a,$i_23.Collision.b2Collision.s_planePoint=new a,$i_23.Collision.b2Collision.s_normal=new a,$i_23.Collision.b2Collision.s_tangent=new a,$i_23.Collision.b2Collision.s_tangent2=new a,$i_23.Collision.b2Collision.s_v11=new a,$i_23.Collision.b2Collision.s_v12=new a,$i_23.Collision.b2Collision.b2CollidePolyTempVec=new a,$i_23.Collision.b2Collision.b2_nullFeature=255}),_.b2ContactID=function(){this.features=new F},_.prototype.b2ContactID=function(){this.features._m_id=this},_.prototype.Set=function(t){this.key=t._key},_.prototype.Copy=function(){var t=new _;return t.key=this.key,t},Object.defineProperty(_.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(_.prototype,"key",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._key=t,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}}),u.b2ContactPoint=function(){this.position=new a,this.velocity=new a,this.normal=new a,this.id=new _},d.b2Distance=function(){},d.Distance=function(t,e,i){++d.b2_gjkCalls;var s=i.proxyA,r=i.proxyB,h=i.transformA,l=i.transformB,c=d.s_simplex;c.ReadCache(e,s,h,r,l);var m,_=c.m_vertices,u=20,p=d.s_saveA,y=d.s_saveB,x=0,f=c.GetClosestPoint(),g=f.LengthSquared(),v=g,b=0,C=0;while(u>C){for(x=c.m_count,b=0;x>b;b++)p[b]=_[b].indexA,y[b]=_[b].indexB;switch(c.m_count){case 1:break;case 2:c.Solve2();break;case 3:c.Solve3();break;default:o.b2Assert(!1)}if(c.m_count==3)break;m=c.GetClosestPoint(),v=m.LengthSquared(),g=v;var w=c.GetSearchDirection();if(Number.MIN_VALUE*Number.MIN_VALUE>w.LengthSquared())break;var D=_[c.m_count];D.indexA=s.GetSupport(n.MulTMV(h.R,w.GetNegative())),D.wA=n.MulX(h,s.GetVertex(D.indexA)),D.indexB=r.GetSupport(n.MulTMV(l.R,w)),D.wB=n.MulX(l,r.GetVertex(D.indexB)),D.w=n.SubtractVV(D.wB,D.wA),++C,++d.b2_gjkIters;var S=!1;for(b=0;x>b;b++)if(D.indexA==p[b]&&D.indexB==y[b]){S=!0;break}if(S)break;++c.m_count}if(d.b2_gjkMaxIters=n.Max(d.b2_gjkMaxIters,C),c.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.SubtractVV(t.pointA,t.pointB).Length(),t.iterations=C,c.WriteCache(e),i.useRadii){var B=s.m_radius,I=r.m_radius;if(t.distance>B+I&&t.distance>Number.MIN_VALUE){t.distance-=B+I;var A=n.SubtractVV(t.pointB,t.pointA);A.Normalize(),t.pointA.x+=B*A.x,t.pointA.y+=B*A.y,t.pointB.x-=I*A.x,t.pointB.y-=I*A.y}else m=new a,m.x=.5*(t.pointA.x+t.pointB.x),m.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=m.x,t.pointA.y=t.pointB.y=m.y,t.distance=0}},$i_23.postDefs.push(function(){$i_23.Collision.b2Distance.s_simplex=new M,$i_23.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),$i_23.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),p.b2DistanceInput=function(){},y.b2DistanceOutput=function(){this.pointA=new a,this.pointB=new a},x.b2DistanceProxy=function(){},x.prototype.Set=function(n){switch(n.GetType()){case i.e_circleShape:var s=n instanceof t?n:null;this.m_vertices=new Vector(1,!0),this.m_vertices[0]=s.m_p,this.m_count=1,this.m_radius=s.m_radius;break;case i.e_polygonShape:var r=n instanceof e?n:null;this.m_vertices=r.m_vertices,this.m_count=r.m_vertexCount,this.m_radius=r.m_radius;break;default:o.b2Assert(!1)}},x.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;this.m_count>o;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>i&&(e=o,i=n)}return e},x.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;this.m_count>o;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>i&&(e=o,i=n)}return this.m_vertices[e]},x.prototype.GetVertexCount=function(){return this.m_count},x.prototype.GetVertex=function(t){return t===void 0&&(t=0),o.b2Assert(t>=0&&this.m_count>t),this.m_vertices[t]},f.b2DynamicTree=function(){},f.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},f.prototype.CreateProxy=function(t,e){var i=this.AllocateNode(),n=o.b2_aabbExtension,s=o.b2_aabbExtension;return i.aabb.lowerBound.x=t.lowerBound.x-n,i.aabb.lowerBound.y=t.lowerBound.y-s,i.aabb.upperBound.x=t.upperBound.x+n,i.aabb.upperBound.y=t.upperBound.y+s,i.userData=e,this.InsertLeaf(i),i},f.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},f.prototype.MoveProxy=function(t,e,i){if(o.b2Assert(t.IsLeaf()),t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var n=o.b2_aabbExtension+o.b2_aabbMultiplier*(i.x>0?i.x:-i.x),s=o.b2_aabbExtension+o.b2_aabbMultiplier*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-n,t.aabb.lowerBound.y=e.lowerBound.y-s,t.aabb.upperBound.x=e.upperBound.x+n,t.aabb.upperBound.y=e.upperBound.y+s,this.InsertLeaf(t),!0},f.prototype.Rebalance=function(t){if(t===void 0&&(t=0),this.m_root!=null)for(var e=0;t>e;e++){var i=this.m_root,o=0;while(i.IsLeaf()==0)i=this.m_path>>o&1?i.child2:i.child1,o=o+1&31;++this.m_path,this.RemoveLeaf(i),this.InsertLeaf(i)}},f.prototype.GetFatAABB=function(t){return t.aabb},f.prototype.GetUserData=function(t){return t.userData},f.prototype.Query=function(t,e){if(this.m_root!=null){var i=new Vector,o=0;i[o++]=this.m_root;while(o>0){var n=i[--o];if(n.aabb.TestOverlap(e))if(n.IsLeaf()){var s=t(n);if(!s)return}else i[o++]=n.child1,i[o++]=n.child2}}},f.prototype.RayCast=function(t,e){if(this.m_root!=null){var i=e.p1,o=e.p2,s=n.SubtractVV(i,o);s.Normalize();var r=n.CrossFV(1,s),a=n.AbsV(r),l=e.maxFraction,c=new h,m=0,_=0;m=i.x+l*(o.x-i.x),_=i.y+l*(o.y-i.y),c.lowerBound.x=Math.min(i.x,m),c.lowerBound.y=Math.min(i.y,_),c.upperBound.x=Math.max(i.x,m),c.upperBound.y=Math.max(i.y,_);var u=new Vector,d=0;u[d++]=this.m_root;while(d>0){var p=u[--d];if(p.aabb.TestOverlap(c)!=0){var y=p.aabb.GetCenter(),x=p.aabb.GetExtents(),f=Math.abs(r.x*(i.x-y.x)+r.y*(i.y-y.y))-a.x*x.x-a.y*x.y;if(0>=f)if(p.IsLeaf()){var g=new S;g.p1=e.p1,g.p2=e.p2,g.maxFraction=l;var v=t(g,p);if(v==0)return;v>0&&(l=v,m=i.x+l*(o.x-i.x),_=i.y+l*(o.y-i.y),c.lowerBound.x=Math.min(i.x,m),c.lowerBound.y=Math.min(i.y,_),c.upperBound.x=Math.max(i.x,m),c.upperBound.y=Math.max(i.y,_))}else u[d++]=p.child1,u[d++]=p.child2}}}},f.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t}return new v},f.prototype.FreeNode=function(t){t.parent=this.m_freeList,this.m_freeList=t},f.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,this.m_root==null)return this.m_root=t,this.m_root.parent=null,void 0;var e=t.aabb.GetCenter(),i=this.m_root;if(i.IsLeaf()==0)do{var o=i.child1,n=i.child2,s=Math.abs((o.aabb.lowerBound.x+o.aabb.upperBound.x)/2-e.x)+Math.abs((o.aabb.lowerBound.y+o.aabb.upperBound.y)/2-e.y),r=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y);i=r>s?o:n}while(i.IsLeaf()==0);var a=i.parent,h=this.AllocateNode();if(h.parent=a,h.userData=null,h.aabb.Combine(t.aabb,i.aabb),a){i.parent.child1==i?a.child1=h:a.child2=h,h.child1=i,h.child2=t,i.parent=h,t.parent=h;do{if(a.aabb.Contains(h.aabb))break;a.aabb.Combine(a.child1.aabb,a.child2.aabb),h=a,a=a.parent}while(a)}else h.child1=i,h.child2=t,i.parent=h,t.parent=h,this.m_root=h},f.prototype.RemoveLeaf=function(t){if(t==this.m_root)return this.m_root=null,void 0;var e,i=t.parent,o=i.parent;if(e=i.child1==t?i.child2:i.child1,o){o.child1==i?o.child1=e:o.child2=e,e.parent=o,this.FreeNode(i);while(o){var n=o.aabb;if(o.aabb=h.Combine(o.child1.aabb,o.child2.aabb),n.Contains(o.aabb))break;o=o.parent}}else this.m_root=e,e.parent=null,this.FreeNode(i)},g.b2DynamicTreeBroadPhase=function(){this.m_tree=new f,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},g.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i},g.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},g.prototype.MoveProxy=function(t,e,i){var o=this.m_tree.MoveProxy(t,e,i);o&&this.BufferMove(t)},g.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t),o=this.m_tree.GetFatAABB(e);return i.TestOverlap(o)},g.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},g.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},g.prototype.GetProxyCount=function(){return this.m_proxyCount},g.prototype.UpdatePairs=function(t){function e(t){if(t==o)return!0;i.m_pairCount==i.m_pairBuffer.length&&(i.m_pairBuffer[i.m_pairCount]=new b);var e=i.m_pairBuffer[i.m_pairCount];return e.proxyA=o>t?t:o,e.proxyB=o>t?o:t,++i.m_pairCount,!0}var i=this;i.m_pairCount=0;var o,n=0;for(n=0;i.m_moveBuffer.length>n;++n){o=i.m_moveBuffer[n];var s=i.m_tree.GetFatAABB(o);i.m_tree.Query(e,s)}i.m_moveBuffer.length=0;for(var n=0;i.m_pairCount>n;){var r=i.m_pairBuffer[n],a=i.m_tree.GetUserData(r.proxyA),h=i.m_tree.GetUserData(r.proxyB);t(a,h),++n;while(i.m_pairCount>n){var l=i.m_pairBuffer[n];if(l.proxyA!=r.proxyA||l.proxyB!=r.proxyB)break;++n}}},g.prototype.Query=function(t,e){this.m_tree.Query(t,e)},g.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},g.prototype.Validate=function(){},g.prototype.Rebalance=function(t){t===void 0&&(t=0),this.m_tree.Rebalance(t)},g.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t},g.prototype.UnBufferMove=function(t){var e=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(e,1)},g.prototype.ComparePairs=function(){return 0},g.__implements={},g.__implements[E]=!0,v.b2DynamicTreeNode=function(){this.aabb=new h},v.prototype.IsLeaf=function(){return this.child1==null},b.b2DynamicTreePair=function(){},C.b2Manifold=function(){this.m_pointCount=0},C.prototype.b2Manifold=function(){this.m_points=new Vector(o.b2_maxManifoldPoints);for(var t=0;o.b2_maxManifoldPoints>t;t++)this.m_points[t]=new w;this.m_localPlaneNormal=new a,this.m_localPoint=new a},C.prototype.Reset=function(){for(var t=0;o.b2_maxManifoldPoints>t;t++)(this.m_points[t]instanceof w?this.m_points[t]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},C.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;o.b2_maxManifoldPoints>e;e++)(this.m_points[e]instanceof w?this.m_points[e]:null).Set(t.m_points[e]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},C.prototype.Copy=function(){var t=new C;return t.Set(this),t},$i_23.postDefs.push(function(){$i_23.Collision.b2Manifold.e_circles=1,$i_23.Collision.b2Manifold.e_faceA=2,$i_23.Collision.b2Manifold.e_faceB=4}),w.b2ManifoldPoint=function(){this.m_localPoint=new a,this.m_id=new _},w.prototype.b2ManifoldPoint=function(){this.Reset()},w.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},w.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},D.b2Point=function(){this.p=new a},D.prototype.Support=function(t,e,i){return e===void 0&&(e=0),i===void 0&&(i=0),this.p},D.prototype.GetFirstVertex=function(){return this.p},S.b2RayCastInput=function(){this.p1=new a,this.p2=new a},S.prototype.b2RayCastInput=function(t,e,i){t===void 0&&(t=null),e===void 0&&(e=null),i===void 0&&(i=1),t&&this.p1.SetV(t),e&&this.p2.SetV(e),this.maxFraction=i},B.b2RayCastOutput=function(){this.normal=new a},I.b2Segment=function(){this.p1=new a,this.p2=new a},I.prototype.TestSegment=function(t,e,i,o){o===void 0&&(o=0);var n=i.p1,s=i.p2.x-n.x,r=i.p2.y-n.y,a=this.p2.x-this.p1.x,h=this.p2.y-this.p1.y,l=h,c=-a,m=100*Number.MIN_VALUE,_=-(s*l+r*c);if(_>m){var u=n.x-this.p1.x,d=n.y-this.p1.y,p=u*l+d*c;if(p>=0&&o*_>=p){var y=-s*d+r*u;if(y>=-m*_&&_*(1+m)>=y){p/=_;var x=Math.sqrt(l*l+c*c);return l/=x,c/=x,t[0]=p,e.Set(l,c),!0}}}return!1},I.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},I.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,o=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:0>e?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p1.y)/i:0>i?(t.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*o,this.p2.y=this.p1.y+i*o},I.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x,i=-this.p2.y+this.p1.y,o=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:0>e?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p2.y)/i:0>i?(t.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*o,this.p1.y=this.p2.y+i*o},A.b2SeparationFunction=function(){this.m_localPoint=new a,this.m_axis=new a},A.prototype.Initialize=function(t,e,i,s,r){this.m_proxyA=e,this.m_proxyB=s;var h=parseInt(t.count);o.b2Assert(h>0&&3>h);var l,c,m,_,u,d,p,y,x=0,f=0,g=0,v=0,b=0,C=0,w=0,D=0;if(h==1)this.m_type=A.e_points,l=this.m_proxyA.GetVertex(t.indexA[0]),_=this.m_proxyB.GetVertex(t.indexB[0]),y=l,p=i.R,x=i.position.x+(p.col1.x*y.x+p.col2.x*y.y),f=i.position.y+(p.col1.y*y.x+p.col2.y*y.y),y=_,p=r.R,g=r.position.x+(p.col1.x*y.x+p.col2.x*y.y),v=r.position.y+(p.col1.y*y.x+p.col2.y*y.y),this.m_axis.x=g-x,this.m_axis.y=v-f,this.m_axis.Normalize();else if(t.indexB[0]==t.indexB[1])this.m_type=A.e_faceA,c=this.m_proxyA.GetVertex(t.indexA[0]),m=this.m_proxyA.GetVertex(t.indexA[1]),_=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(c.x+m.x),this.m_localPoint.y=.5*(c.y+m.y),this.m_axis=n.CrossVF(n.SubtractVV(m,c),1),this.m_axis.Normalize(),y=this.m_axis,p=i.R,b=p.col1.x*y.x+p.col2.x*y.y,C=p.col1.y*y.x+p.col2.y*y.y,y=this.m_localPoint,p=i.R,x=i.position.x+(p.col1.x*y.x+p.col2.x*y.y),f=i.position.y+(p.col1.y*y.x+p.col2.y*y.y),y=_,p=r.R,g=r.position.x+(p.col1.x*y.x+p.col2.x*y.y),v=r.position.y+(p.col1.y*y.x+p.col2.y*y.y),w=(g-x)*b+(v-f)*C,0>w&&this.m_axis.NegativeSelf();else if(t.indexA[0]==t.indexA[0])this.m_type=A.e_faceB,u=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]),l=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(u.x+d.x),this.m_localPoint.y=.5*(u.y+d.y),this.m_axis=n.CrossVF(n.SubtractVV(d,u),1),this.m_axis.Normalize(),y=this.m_axis,p=r.R,b=p.col1.x*y.x+p.col2.x*y.y,C=p.col1.y*y.x+p.col2.y*y.y,y=this.m_localPoint,p=r.R,g=r.position.x+(p.col1.x*y.x+p.col2.x*y.y),v=r.position.y+(p.col1.y*y.x+p.col2.y*y.y),y=l,p=i.R,x=i.position.x+(p.col1.x*y.x+p.col2.x*y.y),f=i.position.y+(p.col1.y*y.x+p.col2.y*y.y),w=(x-g)*b+(f-v)*C,0>w&&this.m_axis.NegativeSelf();else{c=this.m_proxyA.GetVertex(t.indexA[0]),m=this.m_proxyA.GetVertex(t.indexA[1]),u=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]),n.MulX(i,l);var S=n.MulMV(i.R,n.SubtractVV(m,c));n.MulX(r,_);var B=n.MulMV(r.R,n.SubtractVV(d,u)),I=S.x*S.x+S.y*S.y,M=B.x*B.x+B.y*B.y,T=n.SubtractVV(B,S),P=S.x*T.x+S.y*T.y,k=B.x*T.x+B.y*T.y,V=S.x*B.x+S.y*B.y,R=I*M-V*V;w=0,R!=0&&(w=n.Clamp((V*k-P*M)/R,0,1));var L=(V*w+k)/M;0>L&&(L=0,w=n.Clamp((V-P)/I,0,1)),l=new a,l.x=c.x+w*(m.x-c.x),l.y=c.y+w*(m.y-c.y),_=new a,_.x=u.x+w*(d.x-u.x),_.y=u.y+w*(d.y-u.y),w==0||w==1?(this.m_type=A.e_faceB,this.m_axis=n.CrossVF(n.SubtractVV(d,u),1),this.m_axis.Normalize(),this.m_localPoint=_,y=this.m_axis,p=r.R,b=p.col1.x*y.x+p.col2.x*y.y,C=p.col1.y*y.x+p.col2.y*y.y,y=this.m_localPoint,p=r.R,g=r.position.x+(p.col1.x*y.x+p.col2.x*y.y),v=r.position.y+(p.col1.y*y.x+p.col2.y*y.y),y=l,p=i.R,x=i.position.x+(p.col1.x*y.x+p.col2.x*y.y),f=i.position.y+(p.col1.y*y.x+p.col2.y*y.y),D=(x-g)*b+(f-v)*C,0>w&&this.m_axis.NegativeSelf()):(this.m_type=A.e_faceA,this.m_axis=n.CrossVF(n.SubtractVV(m,c),1),this.m_localPoint=l,y=this.m_axis,p=i.R,b=p.col1.x*y.x+p.col2.x*y.y,C=p.col1.y*y.x+p.col2.y*y.y,y=this.m_localPoint,p=i.R,x=i.position.x+(p.col1.x*y.x+p.col2.x*y.y),f=i.position.y+(p.col1.y*y.x+p.col2.y*y.y),y=_,p=r.R,g=r.position.x+(p.col1.x*y.x+p.col2.x*y.y),v=r.position.y+(p.col1.y*y.x+p.col2.y*y.y),D=(g-x)*b+(v-f)*C,0>w&&this.m_axis.NegativeSelf())}},A.prototype.Evaluate=function(t,e){var i,s,r,a,h,l,c,m=0;switch(this.m_type){case A.e_points:return i=n.MulTMV(t.R,this.m_axis),s=n.MulTMV(e.R,this.m_axis.GetNegative()),r=this.m_proxyA.GetSupportVertex(i),a=this.m_proxyB.GetSupportVertex(s),h=n.MulX(t,r),l=n.MulX(e,a),m=(l.x-h.x)*this.m_axis.x+(l.y-h.y)*this.m_axis.y;case A.e_faceA:return c=n.MulMV(t.R,this.m_axis),h=n.MulX(t,this.m_localPoint),s=n.MulTMV(e.R,c.GetNegative()),a=this.m_proxyB.GetSupportVertex(s),l=n.MulX(e,a),m=(l.x-h.x)*c.x+(l.y-h.y)*c.y;case A.e_faceB:return c=n.MulMV(e.R,this.m_axis),l=n.MulX(e,this.m_localPoint),i=n.MulTMV(t.R,c.GetNegative()),r=this.m_proxyA.GetSupportVertex(i),h=n.MulX(t,r),m=(h.x-l.x)*c.x+(h.y-l.y)*c.y;default:return o.b2Assert(!1),0}},$i_23.postDefs.push(function(){$i_23.Collision.b2SeparationFunction.e_points=1,$i_23.Collision.b2SeparationFunction.e_faceA=2,$i_23.Collision.b2SeparationFunction.e_faceB=4}),M.b2Simplex=function(){this.m_v1=new P,this.m_v2=new P,this.m_v3=new P,this.m_vertices=new Vector(3)},M.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},M.prototype.ReadCache=function(t,e,i,s,r){o.b2Assert(t.count>=0&&3>=t.count);var a,h;this.m_count=t.count;for(var l=this.m_vertices,c=0;this.m_count>c;c++){var m=l[c];m.indexA=t.indexA[c],m.indexB=t.indexB[c],a=e.GetVertex(m.indexA),h=s.GetVertex(m.indexB),m.wA=n.MulX(i,a),m.wB=n.MulX(r,h),m.w=n.SubtractVV(m.wB,m.wA),m.a=0}if(this.m_count>1){var _=t.metric,u=this.GetMetric();(.5*_>u||u>2*_||Number.MIN_VALUE>u)&&(this.m_count=0)}this.m_count==0&&(m=l[0],m.indexA=0,m.indexB=0,a=e.GetVertex(0),h=s.GetVertex(0),m.wA=n.MulX(i,a),m.wB=n.MulX(r,h),m.w=n.SubtractVV(m.wB,m.wA),this.m_count=1)},M.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=$i_23.parseUInt(this.m_count);for(var e=this.m_vertices,i=0;this.m_count>i;i++)t.indexA[i]=$i_23.parseUInt(e[i].indexA),t.indexB[i]=$i_23.parseUInt(e[i].indexB)},M.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=n.SubtractVV(this.m_v2.w,this.m_v1.w),e=n.CrossVV(t,this.m_v1.w.GetNegative());return e>0?n.CrossFV(1,t):n.CrossVF(t,1);default:return o.b2Assert(!1),new a}},M.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return o.b2Assert(!1),new a;case 1:return this.m_v1.w;case 2:return new a(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return o.b2Assert(!1),new a}},M.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:o.b2Assert(!1);break;case 1:t.SetV(this.m_v1.wA),e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:o.b2Assert(!1)}},M.prototype.GetMetric=function(){switch(this.m_count){case 0:return o.b2Assert(!1),0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w));default:return o.b2Assert(!1),0}},M.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=n.SubtractVV(e,t),o=-(t.x*i.x+t.y*i.y);if(0>=o)return this.m_v1.a=1,this.m_count=1,void 0;var s=e.x*i.x+e.y*i.y;if(0>=s)return this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2),void 0;var r=1/(s+o);this.m_v1.a=s*r,this.m_v2.a=o*r,this.m_count=2},M.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,o=n.SubtractVV(e,t),s=n.Dot(t,o),r=n.Dot(e,o),a=r,h=-s,l=n.SubtractVV(i,t),c=n.Dot(t,l),m=n.Dot(i,l),_=m,u=-c,d=n.SubtractVV(i,e),p=n.Dot(e,d),y=n.Dot(i,d),x=y,f=-p,g=n.CrossVV(o,l),v=g*n.CrossVV(e,i),b=g*n.CrossVV(i,t),C=g*n.CrossVV(t,e);if(0>=h&&0>=u)return this.m_v1.a=1,this.m_count=1,void 0;if(a>0&&h>0&&0>=C){var w=1/(a+h);return this.m_v1.a=a*w,this.m_v2.a=h*w,this.m_count=2,void 0}if(_>0&&u>0&&0>=b){var D=1/(_+u);return this.m_v1.a=_*D,this.m_v3.a=u*D,this.m_count=2,this.m_v2.Set(this.m_v3),void 0}if(0>=a&&0>=f)return this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2),void 0;if(0>=_&&0>=x)return this.m_v3.a=1,this.m_count=1,this.m_v1.Set(this.m_v3),void 0;if(x>0&&f>0&&0>=v){var S=1/(x+f);return this.m_v2.a=x*S,this.m_v3.a=f*S,this.m_count=2,this.m_v1.Set(this.m_v3),void 0}var B=1/(v+b+C);this.m_v1.a=v*B,this.m_v2.a=b*B,this.m_v3.a=C*B,this.m_count=3},T.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},P.b2SimplexVertex=function(){},P.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB
},k.b2TimeOfImpact=function(){},k.TimeOfImpact=function(t){++k.b2_toiCalls;var e=t.proxyA,i=t.proxyB,s=t.sweepA,r=t.sweepB;o.b2Assert(s.t0==r.t0),o.b2Assert(1-s.t0>Number.MIN_VALUE);var a=e.m_radius+i.m_radius,h=t.tolerance,l=0,c=1e3,m=0,_=0;for(k.s_cache.count=0,k.s_distanceInput.useRadii=!1;;){if(s.GetTransform(k.s_xfA,l),r.GetTransform(k.s_xfB,l),k.s_distanceInput.proxyA=e,k.s_distanceInput.proxyB=i,k.s_distanceInput.transformA=k.s_xfA,k.s_distanceInput.transformB=k.s_xfB,d.Distance(k.s_distanceOutput,k.s_cache,k.s_distanceInput),0>=k.s_distanceOutput.distance){l=1;break}k.s_fcn.Initialize(k.s_cache,e,k.s_xfA,i,k.s_xfB);var u=k.s_fcn.Evaluate(k.s_xfA,k.s_xfB);if(0>=u){l=1;break}if(m==0&&(_=u>a?n.Max(a-h,.75*a):n.Max(u-h,.02*a)),.5*h>u-_){if(m==0){l=1;break}break}var p=l,y=l,x=1,f=u;s.GetTransform(k.s_xfA,x),r.GetTransform(k.s_xfB,x);var g=k.s_fcn.Evaluate(k.s_xfA,k.s_xfB);if(g>=_){l=1;break}for(var v=0;;){var b=0;b=v&1?y+(_-f)*(x-y)/(g-f):.5*(y+x),s.GetTransform(k.s_xfA,b),r.GetTransform(k.s_xfB,b);var C=k.s_fcn.Evaluate(k.s_xfA,k.s_xfB);if(.025*h>n.Abs(C-_)){p=b;break}if(C>_?(y=b,f=C):(x=b,g=C),++v,++k.b2_toiRootIters,v==50)break}if(k.b2_toiMaxRootIters=n.Max(k.b2_toiMaxRootIters,v),(1+100*Number.MIN_VALUE)*l>p)break;if(l=p,m++,++k.b2_toiIters,m==c)break}return k.b2_toiMaxIters=n.Max(k.b2_toiMaxIters,m),l},$i_23.postDefs.push(function(){$i_23.Collision.b2TimeOfImpact.b2_toiCalls=0,$i_23.Collision.b2TimeOfImpact.b2_toiIters=0,$i_23.Collision.b2TimeOfImpact.b2_toiMaxIters=0,$i_23.Collision.b2TimeOfImpact.b2_toiRootIters=0,$i_23.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,$i_23.Collision.b2TimeOfImpact.s_cache=new T,$i_23.Collision.b2TimeOfImpact.s_distanceInput=new p,$i_23.Collision.b2TimeOfImpact.s_xfA=new r,$i_23.Collision.b2TimeOfImpact.s_xfB=new r,$i_23.Collision.b2TimeOfImpact.s_fcn=new A,$i_23.Collision.b2TimeOfImpact.s_distanceOutput=new y}),V.b2TOIInput=function(){this.proxyA=new x,this.proxyB=new x,this.sweepA=new s,this.sweepB=new s},R.b2WorldManifold=function(){this.m_normal=new a},R.prototype.b2WorldManifold=function(){this.m_points=new Vector(o.b2_maxManifoldPoints);for(var t=0;o.b2_maxManifoldPoints>t;t++)this.m_points[t]=new a},R.prototype.Initialize=function(t,e,i,o,n){if(i===void 0&&(i=0),n===void 0&&(n=0),t.m_pointCount!=0){var s,r,a=0,h=0,l=0,c=0,m=0,_=0,u=0;switch(t.m_type){case C.e_circles:r=e.R,s=t.m_localPoint;var d=e.position.x+r.col1.x*s.x+r.col2.x*s.y,p=e.position.y+r.col1.y*s.x+r.col2.y*s.y;r=o.R,s=t.m_points[0].m_localPoint;var y=o.position.x+r.col1.x*s.x+r.col2.x*s.y,x=o.position.y+r.col1.y*s.x+r.col2.y*s.y,f=y-d,g=x-p,v=f*f+g*g;if(v>Number.MIN_VALUE*Number.MIN_VALUE){var b=Math.sqrt(v);this.m_normal.x=f/b,this.m_normal.y=g/b}else this.m_normal.x=1,this.m_normal.y=0;var w=d+i*this.m_normal.x,D=p+i*this.m_normal.y,S=y-n*this.m_normal.x,B=x-n*this.m_normal.y;this.m_points[0].x=.5*(w+S),this.m_points[0].y=.5*(D+B);break;case C.e_faceA:for(r=e.R,s=t.m_localPlaneNormal,h=r.col1.x*s.x+r.col2.x*s.y,l=r.col1.y*s.x+r.col2.y*s.y,r=e.R,s=t.m_localPoint,c=e.position.x+r.col1.x*s.x+r.col2.x*s.y,m=e.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_normal.x=h,this.m_normal.y=l,a=0;t.m_pointCount>a;a++)r=o.R,s=t.m_points[a].m_localPoint,_=o.position.x+r.col1.x*s.x+r.col2.x*s.y,u=o.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_points[a].x=_+.5*(i-(_-c)*h-(u-m)*l-n)*h,this.m_points[a].y=u+.5*(i-(_-c)*h-(u-m)*l-n)*l;break;case C.e_faceB:for(r=o.R,s=t.m_localPlaneNormal,h=r.col1.x*s.x+r.col2.x*s.y,l=r.col1.y*s.x+r.col2.y*s.y,r=o.R,s=t.m_localPoint,c=o.position.x+r.col1.x*s.x+r.col2.x*s.y,m=o.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_normal.x=-h,this.m_normal.y=-l,a=0;t.m_pointCount>a;a++)r=e.R,s=t.m_points[a].m_localPoint,_=e.position.x+r.col1.x*s.x+r.col2.x*s.y,u=e.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_points[a].x=_+.5*(n-(_-c)*h-(u-m)*l-i)*h,this.m_points[a].y=u+.5*(n-(_-c)*h-(u-m)*l-i)*l}}},L.ClipVertex=function(){this.v=new a,this.id=new _},L.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},F.Features=function(){},Object.defineProperty(F.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(F.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._referenceEdge=t,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}}),Object.defineProperty(F.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(F.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._incidentEdge=t,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}}),Object.defineProperty(F.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(F.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._incidentVertex=t,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}}),Object.defineProperty(F.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(F.prototype,"flip",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._flip=t,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})}(),function(){var t=($i_23.Common.b2Color,$i_23.Common.b2internal,$i_23.Common.b2Settings),e=$i_23.Collision.Shapes.b2CircleShape,i=$i_23.Collision.Shapes.b2EdgeChainDef,o=$i_23.Collision.Shapes.b2EdgeShape,n=$i_23.Collision.Shapes.b2MassData,s=$i_23.Collision.Shapes.b2PolygonShape,r=$i_23.Collision.Shapes.b2Shape,a=$i_23.Common.Math.b2Mat22,h=($i_23.Common.Math.b2Mat33,$i_23.Common.Math.b2Math),l=($i_23.Common.Math.b2Sweep,$i_23.Common.Math.b2Transform),c=$i_23.Common.Math.b2Vec2,m=($i_23.Common.Math.b2Vec3,$i_23.Dynamics.b2Body,$i_23.Dynamics.b2BodyDef,$i_23.Dynamics.b2ContactFilter,$i_23.Dynamics.b2ContactImpulse,$i_23.Dynamics.b2ContactListener,$i_23.Dynamics.b2ContactManager,$i_23.Dynamics.b2DebugDraw,$i_23.Dynamics.b2DestructionListener,$i_23.Dynamics.b2FilterData,$i_23.Dynamics.b2Fixture,$i_23.Dynamics.b2FixtureDef,$i_23.Dynamics.b2Island,$i_23.Dynamics.b2TimeStep,$i_23.Dynamics.b2World,$i_23.Collision.b2AABB,$i_23.Collision.b2Bound,$i_23.Collision.b2BoundValues,$i_23.Collision.b2Collision,$i_23.Collision.b2ContactID,$i_23.Collision.b2ContactPoint,$i_23.Collision.b2Distance),_=$i_23.Collision.b2DistanceInput,u=$i_23.Collision.b2DistanceOutput,d=$i_23.Collision.b2DistanceProxy,p=($i_23.Collision.b2DynamicTree,$i_23.Collision.b2DynamicTreeBroadPhase,$i_23.Collision.b2DynamicTreeNode,$i_23.Collision.b2DynamicTreePair,$i_23.Collision.b2Manifold,$i_23.Collision.b2ManifoldPoint,$i_23.Collision.b2Point,$i_23.Collision.b2RayCastInput,$i_23.Collision.b2RayCastOutput,$i_23.Collision.b2Segment,$i_23.Collision.b2SeparationFunction,$i_23.Collision.b2Simplex,$i_23.Collision.b2SimplexCache);$i_23.Collision.b2SimplexVertex,$i_23.Collision.b2TimeOfImpact,$i_23.Collision.b2TOIInput,$i_23.Collision.b2WorldManifold,$i_23.Collision.ClipVertex,$i_23.Collision.Features,$i_23.Collision.IBroadPhase,$i_23.inherit(e,$i_23.Collision.Shapes.b2Shape),e.prototype.__super=$i_23.Collision.Shapes.b2Shape.prototype,e.b2CircleShape=function(){$i_23.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new c},e.prototype.Copy=function(){var t=new e;return t.Set(this),t},e.prototype.Set=function(t){if(this.__super.Set.call(this,t),$i_23.is(t,e)){var i=t instanceof e?t:null;this.m_p.SetV(i.m_p)}},e.prototype.TestPoint=function(t,e){var i=t.R,o=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),n=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);return o=e.x-o,n=e.y-n,this.m_radius*this.m_radius>=o*o+n*n},e.prototype.RayCast=function(t,e,i){var o=i.R,n=i.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),s=i.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y),r=e.p1.x-n,a=e.p1.y-s,h=r*r+a*a-this.m_radius*this.m_radius,l=e.p2.x-e.p1.x,c=e.p2.y-e.p1.y,m=r*l+a*c,_=l*l+c*c,u=m*m-_*h;if(0>u||Number.MIN_VALUE>_)return!1;var d=-(m+Math.sqrt(u));return 0>d||d>e.maxFraction*_?!1:(d/=_,t.fraction=d,t.normal.x=r+d*l,t.normal.y=a+d*c,t.normal.Normalize(),!0)},e.prototype.ComputeAABB=function(t,e){var i=e.R,o=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),n=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.Set(o-this.m_radius,n-this.m_radius),t.upperBound.Set(o+this.m_radius,n+this.m_radius)},e.prototype.ComputeMass=function(e,i){i===void 0&&(i=0),e.mass=i*t.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},e.prototype.ComputeSubmergedArea=function(t,e,i,o){e===void 0&&(e=0);var n=h.MulX(i,this.m_p),s=-(h.Dot(t,n)-e);if(-this.m_radius+Number.MIN_VALUE>s)return 0;if(s>this.m_radius)return o.SetV(n),Math.PI*this.m_radius*this.m_radius;var r=this.m_radius*this.m_radius,a=s*s,l=r*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(r-a),c=-2/3*Math.pow(r-a,1.5)/l;return o.x=n.x+t.x*c,o.y=n.y+t.y*c,l},e.prototype.GetLocalPosition=function(){return this.m_p},e.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},e.prototype.GetRadius=function(){return this.m_radius},e.prototype.SetRadius=function(t){t===void 0&&(t=0),this.m_radius=t},e.prototype.b2CircleShape=function(t){t===void 0&&(t=0),this.__super.b2Shape.call(this),this.m_type=r.e_circleShape,this.m_radius=t},i.b2EdgeChainDef=function(){},i.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},$i_23.inherit(o,$i_23.Collision.Shapes.b2Shape),o.prototype.__super=$i_23.Collision.Shapes.b2Shape.prototype,o.b2EdgeShape=function(){$i_23.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new c,this.m_v1=new c,this.m_v2=new c,this.m_coreV1=new c,this.m_coreV2=new c,this.m_normal=new c,this.m_direction=new c,this.m_cornerDir1=new c,this.m_cornerDir2=new c},o.prototype.TestPoint=function(){return!1},o.prototype.RayCast=function(t,e,i){var o,n=e.p2.x-e.p1.x,s=e.p2.y-e.p1.y;o=i.R;var r=i.position.x+(o.col1.x*this.m_v1.x+o.col2.x*this.m_v1.y),a=i.position.y+(o.col1.y*this.m_v1.x+o.col2.y*this.m_v1.y),h=i.position.y+(o.col1.y*this.m_v2.x+o.col2.y*this.m_v2.y)-a,l=-(i.position.x+(o.col1.x*this.m_v2.x+o.col2.x*this.m_v2.y)-r),c=100*Number.MIN_VALUE,m=-(n*h+s*l);if(m>c){var _=e.p1.x-r,u=e.p1.y-a,d=_*h+u*l;if(d>=0&&e.maxFraction*m>=d){var p=-n*u+s*_;if(p>=-c*m&&m*(1+c)>=p){d/=m,t.fraction=d;var y=Math.sqrt(h*h+l*l);return t.normal.x=h/y,t.normal.y=l/y,!0}}}return!1},o.prototype.ComputeAABB=function(t,e){var i=e.R,o=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),n=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),s=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y),r=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);s>o?(t.lowerBound.x=o,t.upperBound.x=s):(t.lowerBound.x=s,t.upperBound.x=o),r>n?(t.lowerBound.y=n,t.upperBound.y=r):(t.lowerBound.y=r,t.upperBound.y=n)},o.prototype.ComputeMass=function(t,e){e===void 0&&(e=0),t.mass=0,t.center.SetV(this.m_v1),t.I=0},o.prototype.ComputeSubmergedArea=function(t,e,i,o){e===void 0&&(e=0);var n=new c(t.x*e,t.y*e),s=h.MulX(i,this.m_v1),r=h.MulX(i,this.m_v2),a=h.Dot(t,s)-e,l=h.Dot(t,r)-e;if(a>0){if(l>0)return 0;s.x=-l/(a-l)*s.x+a/(a-l)*r.x,s.y=-l/(a-l)*s.y+a/(a-l)*r.y}else l>0&&(r.x=-l/(a-l)*s.x+a/(a-l)*r.x,r.y=-l/(a-l)*s.y+a/(a-l)*r.y);return o.x=(n.x+s.x+r.x)/3,o.y=(n.y+s.y+r.y)/3,.5*((s.x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x))},o.prototype.GetLength=function(){return this.m_length},o.prototype.GetVertex1=function(){return this.m_v1},o.prototype.GetVertex2=function(){return this.m_v2},o.prototype.GetCoreVertex1=function(){return this.m_coreV1},o.prototype.GetCoreVertex2=function(){return this.m_coreV2},o.prototype.GetNormalVector=function(){return this.m_normal},o.prototype.GetDirectionVector=function(){return this.m_direction},o.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},o.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},o.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},o.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},o.prototype.GetFirstVertex=function(t){var e=t.R;return new c(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))},o.prototype.GetNextEdge=function(){return this.m_nextEdge},o.prototype.GetPrevEdge=function(){return this.m_prevEdge},o.prototype.Support=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=0);var o=t.R,n=t.position.x+(o.col1.x*this.m_coreV1.x+o.col2.x*this.m_coreV1.y),s=t.position.y+(o.col1.y*this.m_coreV1.x+o.col2.y*this.m_coreV1.y),r=t.position.x+(o.col1.x*this.m_coreV2.x+o.col2.x*this.m_coreV2.y),a=t.position.y+(o.col1.y*this.m_coreV2.x+o.col2.y*this.m_coreV2.y);return n*e+s*i>r*e+a*i?(this.s_supportVec.x=n,this.s_supportVec.y=s):(this.s_supportVec.x=r,this.s_supportVec.y=a),this.s_supportVec},o.prototype.b2EdgeShape=function(e,i){this.__super.b2Shape.call(this),this.m_type=r.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=e,this.m_v2=i,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-t.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-t.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-t.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-t.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},o.prototype.SetPrevEdge=function(t,e,i,o){this.m_prevEdge=t,this.m_coreV1=e,this.m_cornerDir1=i,this.m_cornerConvex1=o},o.prototype.SetNextEdge=function(t,e,i,o){this.m_nextEdge=t,this.m_coreV2=e,this.m_cornerDir2=i,this.m_cornerConvex2=o},n.b2MassData=function(){this.mass=0,this.center=new c(0,0),this.I=0},$i_23.inherit(s,$i_23.Collision.Shapes.b2Shape),s.prototype.__super=$i_23.Collision.Shapes.b2Shape.prototype,s.b2PolygonShape=function(){$i_23.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},s.prototype.Copy=function(){var t=new s;return t.Set(this),t},s.prototype.Set=function(t){if(this.__super.Set.call(this,t),$i_23.is(t,s)){var e=t instanceof s?t:null;this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var i=0;this.m_vertexCount>i;i++)this.m_vertices[i].SetV(e.m_vertices[i]),this.m_normals[i].SetV(e.m_normals[i])}},s.prototype.SetAsArray=function(t,e){e===void 0&&(e=0);var i,o=new Vector,n=0;for(n=0;t.length>n;++n)i=t[n],o.push(i);this.SetAsVector(o,e)},s.AsArray=function(t,e){e===void 0&&(e=0);var i=new s;return i.SetAsArray(t,e),i},s.prototype.SetAsVector=function(e,i){i===void 0&&(i=0),i==0&&(i=e.length),t.b2Assert(i>=2),this.m_vertexCount=i,this.Reserve(i);var o=0;for(o=0;this.m_vertexCount>o;o++)this.m_vertices[o].SetV(e[o]);for(o=0;this.m_vertexCount>o;++o){var n=parseInt(o),r=parseInt(this.m_vertexCount>o+1?o+1:0),a=h.SubtractVV(this.m_vertices[r],this.m_vertices[n]);t.b2Assert(a.LengthSquared()>Number.MIN_VALUE),this.m_normals[o].SetV(h.CrossVF(a,1)),this.m_normals[o].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)},s.AsVector=function(t,e){e===void 0&&(e=0);var i=new s;return i.SetAsVector(t,e),i},s.prototype.SetAsBox=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},s.AsBox=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0);var i=new s;return i.SetAsBox(t,e),i},s.prototype.SetAsOrientedBox=function(t,e,i,o){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=null),o===void 0&&(o=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=i;var n=new l;n.position=i,n.R.Set(o);for(var s=0;this.m_vertexCount>s;++s)this.m_vertices[s]=h.MulX(n,this.m_vertices[s]),this.m_normals[s]=h.MulMV(n.R,this.m_normals[s])},s.AsOrientedBox=function(t,e,i,o){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=null),o===void 0&&(o=0);var n=new s;return n.SetAsOrientedBox(t,e,i,o),n},s.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(e),this.m_centroid.x=.5*(t.x+e.x),this.m_centroid.y=.5*(t.y+e.y),this.m_normals[0]=h.CrossVF(h.SubtractVV(e,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},s.AsEdge=function(t,e){var i=new s;return i.SetAsEdge(t,e),i},s.prototype.TestPoint=function(t,e){for(var i,o=t.R,n=e.x-t.position.x,s=e.y-t.position.y,r=n*o.col1.x+s*o.col1.y,a=n*o.col2.x+s*o.col2.y,h=0;this.m_vertexCount>h;++h){i=this.m_vertices[h],n=r-i.x,s=a-i.y,i=this.m_normals[h];var l=i.x*n+i.y*s;if(l>0)return!1}return!0},s.prototype.RayCast=function(t,e,i){var o,n,s=0,r=e.maxFraction,a=0,h=0;a=e.p1.x-i.position.x,h=e.p1.y-i.position.y,o=i.R;var l=a*o.col1.x+h*o.col1.y,c=a*o.col2.x+h*o.col2.y;a=e.p2.x-i.position.x,h=e.p2.y-i.position.y,o=i.R;for(var m=a*o.col1.x+h*o.col1.y,_=a*o.col2.x+h*o.col2.y,u=m-l,d=_-c,p=parseInt(-1),y=0;this.m_vertexCount>y;++y){n=this.m_vertices[y],a=n.x-l,h=n.y-c,n=this.m_normals[y];var x=n.x*a+n.y*h,f=n.x*u+n.y*d;if(f==0){if(0>x)return!1}else 0>f&&s*f>x?(s=x/f,p=y):f>0&&r*f>x&&(r=x/f);if(s-1.1920929e-7>r)return!1}return 0>p?!1:(t.fraction=s,o=i.R,n=this.m_normals[p],t.normal.x=o.col1.x*n.x+o.col2.x*n.y,t.normal.y=o.col1.y*n.x+o.col2.y*n.y,!0)},s.prototype.ComputeAABB=function(t,e){for(var i=e.R,o=this.m_vertices[0],n=e.position.x+(i.col1.x*o.x+i.col2.x*o.y),s=e.position.y+(i.col1.y*o.x+i.col2.y*o.y),r=n,a=s,h=1;this.m_vertexCount>h;++h){o=this.m_vertices[h];var l=e.position.x+(i.col1.x*o.x+i.col2.x*o.y),c=e.position.y+(i.col1.y*o.x+i.col2.y*o.y);n=l>n?n:l,s=c>s?s:c,r=r>l?r:l,a=a>c?a:c}t.lowerBound.x=n-this.m_radius,t.lowerBound.y=s-this.m_radius,t.upperBound.x=r+this.m_radius,t.upperBound.y=a+this.m_radius},s.prototype.ComputeMass=function(t,e){if(e===void 0&&(e=0),this.m_vertexCount==2)return t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,t.I=0,void 0;for(var i=0,o=0,n=0,s=0,r=0,a=0,h=1/3,l=0;this.m_vertexCount>l;++l){var c=this.m_vertices[l],m=this.m_vertexCount>l+1?this.m_vertices[parseInt(l+1)]:this.m_vertices[0],_=c.x-r,u=c.y-a,d=m.x-r,p=m.y-a,y=_*p-u*d,x=.5*y;n+=x,i+=x*h*(r+c.x+m.x),o+=x*h*(a+c.y+m.y);var f=r,g=a,v=_,b=u,C=d,w=p,D=h*(.25*(v*v+C*v+C*C)+(f*v+f*C))+.5*f*f,S=h*(.25*(b*b+w*b+w*w)+(g*b+g*w))+.5*g*g;s+=y*(D+S)}t.mass=e*n,i*=1/n,o*=1/n,t.center.Set(i,o),t.I=e*s},s.prototype.ComputeSubmergedArea=function(t,e,i,o){e===void 0&&(e=0);var s=h.MulTMV(i.R,t),r=e-h.Dot(t,i.position),a=new Vector_a2j_Number,l=0,m=parseInt(-1),_=parseInt(-1),u=!1,d=0;for(d=0;this.m_vertexCount>d;++d){a[d]=h.Dot(s,this.m_vertices[d])-r;var p=-Number.MIN_VALUE>a[d];d>0&&(p?u||(m=d-1,l++):u&&(_=d-1,l++)),u=p}switch(l){case 0:if(u){var y=new n;return this.ComputeMass(y,1),o.SetV(h.MulX(i,y.center)),y.mass}return 0;case 1:m==-1?m=this.m_vertexCount-1:_=this.m_vertexCount-1}var x,f=parseInt((m+1)%this.m_vertexCount),g=parseInt((_+1)%this.m_vertexCount),v=(0-a[m])/(a[f]-a[m]),b=(0-a[_])/(a[g]-a[_]),C=new c(this.m_vertices[m].x*(1-v)+this.m_vertices[f].x*v,this.m_vertices[m].y*(1-v)+this.m_vertices[f].y*v),w=new c(this.m_vertices[_].x*(1-b)+this.m_vertices[g].x*b,this.m_vertices[_].y*(1-b)+this.m_vertices[g].y*b),D=0,S=new c,B=this.m_vertices[f];d=f;while(d!=g){d=(d+1)%this.m_vertexCount,x=d==g?w:this.m_vertices[d];var I=.5*((B.x-C.x)*(x.y-C.y)-(B.y-C.y)*(x.x-C.x));D+=I,S.x+=I*(C.x+B.x+x.x)/3,S.y+=I*(C.y+B.y+x.y)/3,B=x}return S.Multiply(1/D),o.SetV(h.MulX(i,S)),D},s.prototype.GetVertexCount=function(){return this.m_vertexCount},s.prototype.GetVertices=function(){return this.m_vertices},s.prototype.GetNormals=function(){return this.m_normals},s.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;this.m_vertexCount>o;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>i&&(e=o,i=n)}return e},s.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;this.m_vertexCount>o;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>i&&(e=o,i=n)}return this.m_vertices[e]},s.prototype.Validate=function(){return!1},s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=r.e_polygonShape,this.m_centroid=new c,this.m_vertices=new Vector,this.m_normals=new Vector},s.prototype.Reserve=function(t){t===void 0&&(t=0);for(var e=parseInt(this.m_vertices.length);t>e;e++)this.m_vertices[e]=new c,this.m_normals[e]=new c},s.ComputeCentroid=function(t,e){e===void 0&&(e=0);for(var i=new c,o=0,n=0,s=0,r=1/3,a=0;e>a;++a){var h=t[a],l=e>a+1?t[parseInt(a+1)]:t[0],m=h.x-n,_=h.y-s,u=l.x-n,d=l.y-s,p=m*d-_*u,y=.5*p;o+=y,i.x+=y*r*(n+h.x+l.x),i.y+=y*r*(s+h.y+l.y)}return i.x*=1/o,i.y*=1/o,i},s.ComputeOBB=function(t,e,i){i===void 0&&(i=0);var o=0,n=new Vector(i+1);for(o=0;i>o;++o)n[o]=e[o];n[i]=n[0];var s=Number.MAX_VALUE;for(o=1;i>=o;++o){var r=n[parseInt(o-1)],a=n[o].x-r.x,h=n[o].y-r.y,l=Math.sqrt(a*a+h*h);a/=l,h/=l;for(var c=-h,m=a,_=Number.MAX_VALUE,u=Number.MAX_VALUE,d=-Number.MAX_VALUE,p=-Number.MAX_VALUE,y=0;i>y;++y){var x=n[y].x-r.x,f=n[y].y-r.y,g=a*x+h*f,v=c*x+m*f;_>g&&(_=g),u>v&&(u=v),g>d&&(d=g),v>p&&(p=v)}var b=(d-_)*(p-u);if(.95*s>b){s=b,t.R.col1.x=a,t.R.col1.y=h,t.R.col2.x=c,t.R.col2.y=m;var C=.5*(_+d),w=.5*(u+p),D=t.R;t.center.x=r.x+(D.col1.x*C+D.col2.x*w),t.center.y=r.y+(D.col1.y*C+D.col2.y*w),t.extents.x=.5*(d-_),t.extents.y=.5*(p-u)}}},$i_23.postDefs.push(function(){$i_23.Collision.Shapes.b2PolygonShape.s_mat=new a}),r.b2Shape=function(){},r.prototype.Copy=function(){return null},r.prototype.Set=function(t){this.m_radius=t.m_radius},r.prototype.GetType=function(){return this.m_type},r.prototype.TestPoint=function(){return!1},r.prototype.RayCast=function(){return!1},r.prototype.ComputeAABB=function(){},r.prototype.ComputeMass=function(t,e){e===void 0&&(e=0)},r.prototype.ComputeSubmergedArea=function(t,e){return e===void 0&&(e=0),0},r.TestOverlap=function(t,e,i,o){var n=new _;n.proxyA=new d,n.proxyA.Set(t),n.proxyB=new d,n.proxyB.Set(i),n.transformA=e,n.transformB=o,n.useRadii=!0;var s=new p;s.count=0;var r=new u;return m.Distance(r,s,n),10*Number.MIN_VALUE>r.distance},r.prototype.b2Shape=function(){this.m_type=r.e_unknownShape,this.m_radius=t.b2_linearSlop},$i_23.postDefs.push(function(){$i_23.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),$i_23.Collision.Shapes.b2Shape.e_circleShape=0,$i_23.Collision.Shapes.b2Shape.e_polygonShape=1,$i_23.Collision.Shapes.b2Shape.e_edgeShape=2,$i_23.Collision.Shapes.b2Shape.e_shapeTypeCount=3,$i_23.Collision.Shapes.b2Shape.e_hitCollide=1,$i_23.Collision.Shapes.b2Shape.e_missCollide=0,$i_23.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var t=$i_23.Common.b2Color,e=($i_23.Common.b2internal,$i_23.Common.b2Settings),i=($i_23.Common.Math.b2Mat22,$i_23.Common.Math.b2Mat33,$i_23.Common.Math.b2Math);$i_23.Common.Math.b2Sweep,$i_23.Common.Math.b2Transform,$i_23.Common.Math.b2Vec2,$i_23.Common.Math.b2Vec3,t.b2Color=function(){this._r=0,this._g=0,this._b=0},t.prototype.b2Color=function(t,e,o){t===void 0&&(t=0),e===void 0&&(e=0),o===void 0&&(o=0),this._r=$i_23.parseUInt(255*i.Clamp(t,0,1)),this._g=$i_23.parseUInt(255*i.Clamp(e,0,1)),this._b=$i_23.parseUInt(255*i.Clamp(o,0,1))},t.prototype.Set=function(t,e,o){t===void 0&&(t=0),e===void 0&&(e=0),o===void 0&&(o=0),this._r=$i_23.parseUInt(255*i.Clamp(t,0,1)),this._g=$i_23.parseUInt(255*i.Clamp(e,0,1)),this._b=$i_23.parseUInt(255*i.Clamp(o,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._r=$i_23.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._g=$i_23.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){t===void 0&&(t=0),this._b=$i_23.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),e.b2Settings=function(){},e.b2MixFriction=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=0),Math.sqrt(t*e)},e.b2MixRestitution=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=0),t>e?t:e},e.b2Assert=function(t){if(!t)throw"Assertion Failed"},$i_23.postDefs.push(function(){$i_23.Common.b2Settings.VERSION="2.1alpha",$i_23.Common.b2Settings.USHRT_MAX=65535,$i_23.Common.b2Settings.b2_pi=Math.PI,$i_23.Common.b2Settings.b2_maxManifoldPoints=2,$i_23.Common.b2Settings.b2_aabbExtension=.1,$i_23.Common.b2Settings.b2_aabbMultiplier=2,$i_23.Common.b2Settings.b2_polygonRadius=2*e.b2_linearSlop,$i_23.Common.b2Settings.b2_linearSlop=.005,$i_23.Common.b2Settings.b2_angularSlop=2/180*e.b2_pi,$i_23.Common.b2Settings.b2_toiSlop=8*e.b2_linearSlop,$i_23.Common.b2Settings.b2_maxTOIContactsPerIsland=32,$i_23.Common.b2Settings.b2_maxTOIJointsPerIsland=32,$i_23.Common.b2Settings.b2_velocityThreshold=1,$i_23.Common.b2Settings.b2_maxLinearCorrection=.2,$i_23.Common.b2Settings.b2_maxAngularCorrection=8/180*e.b2_pi,$i_23.Common.b2Settings.b2_maxTranslation=2,$i_23.Common.b2Settings.b2_maxTranslationSquared=e.b2_maxTranslation*e.b2_maxTranslation,$i_23.Common.b2Settings.b2_maxRotation=.5*e.b2_pi,$i_23.Common.b2Settings.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation,$i_23.Common.b2Settings.b2_contactBaumgarte=.2,$i_23.Common.b2Settings.b2_timeToSleep=.5,$i_23.Common.b2Settings.b2_linearSleepTolerance=.01,$i_23.Common.b2Settings.b2_angularSleepTolerance=2/180*e.b2_pi})}(),function(){var t=($i_23.Collision.b2AABB,$i_23.Common.b2Color,$i_23.Common.b2internal,$i_23.Common.b2Settings,$i_23.Common.Math.b2Mat22),e=$i_23.Common.Math.b2Mat33,i=$i_23.Common.Math.b2Math,o=$i_23.Common.Math.b2Sweep,n=$i_23.Common.Math.b2Transform,s=$i_23.Common.Math.b2Vec2,r=$i_23.Common.Math.b2Vec3;t.b2Mat22=function(){this.col1=new s,this.col2=new s},t.prototype.b2Mat22=function(){this.SetIdentity()},t.FromAngle=function(e){e===void 0&&(e=0);var i=new t;return i.Set(e),i},t.FromVV=function(e,i){var o=new t;return o.SetVV(e,i),o},t.prototype.Set=function(t){t===void 0&&(t=0);var e=Math.cos(t),i=Math.sin(t);this.col1.x=e,this.col2.x=-i,this.col1.y=i,this.col2.y=e},t.prototype.SetVV=function(t,e){this.col1.SetV(t),this.col2.SetV(e)},t.prototype.Copy=function(){var e=new t;return e.SetM(this),e},t.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},t.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},t.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},t.prototype.GetInverse=function(t){var e=this.col1.x,i=this.col2.x,o=this.col1.y,n=this.col2.y,s=e*n-i*o;return s!=0&&(s=1/s),t.col1.x=s*n,t.col2.x=-s*i,t.col1.y=-s*o,t.col2.y=s*e,t},t.prototype.Solve=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=0);var o=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=o*r-n*s;return a!=0&&(a=1/a),t.x=a*(r*e-n*i),t.y=a*(o*i-s*e),t},t.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},e.b2Mat33=function(){this.col1=new r,this.col2=new r,this.col3=new r},e.prototype.b2Mat33=function(t,e,i){t===void 0&&(t=null),e===void 0&&(e=null),i===void 0&&(i=null),t||e||i?(this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},e.prototype.SetVVV=function(t,e,i){this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)},e.prototype.Copy=function(){return new e(this.col1,this.col2,this.col3)},e.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},e.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},e.prototype.Solve22=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=0);var o=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=o*r-n*s;return a!=0&&(a=1/a),t.x=a*(r*e-n*i),t.y=a*(o*i-s*e),t},e.prototype.Solve33=function(t,e,i,o){e===void 0&&(e=0),i===void 0&&(i=0),o===void 0&&(o=0);var n=this.col1.x,s=this.col1.y,r=this.col1.z,a=this.col2.x,h=this.col2.y,l=this.col2.z,c=this.col3.x,m=this.col3.y,_=this.col3.z,u=n*(h*_-l*m)+s*(l*c-a*_)+r*(a*m-h*c);return u!=0&&(u=1/u),t.x=u*(e*(h*_-l*m)+i*(l*c-a*_)+o*(a*m-h*c)),t.y=u*(n*(i*_-o*m)+s*(o*c-e*_)+r*(e*m-i*c)),t.z=u*(n*(h*o-l*i)+s*(l*e-a*o)+r*(a*i-h*e)),t},i.b2Math=function(){},i.IsValid=function(t){return t===void 0&&(t=0),isFinite(t)},i.Dot=function(t,e){return t.x*e.x+t.y*e.y},i.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},i.CrossVF=function(t,e){e===void 0&&(e=0);var i=new s(e*t.y,-e*t.x);return i},i.CrossFV=function(t,e){t===void 0&&(t=0);var i=new s(-t*e.y,t*e.x);return i},i.MulMV=function(t,e){var i=new s(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return i},i.MulTMV=function(t,e){var o=new s(i.Dot(e,t.col1),i.Dot(e,t.col2));return o},i.MulX=function(t,e){var o=i.MulMV(t.R,e);return o.x+=t.position.x,o.y+=t.position.y,o},i.MulXT=function(t,e){var o=i.SubtractVV(e,t.position),n=o.x*t.R.col1.x+o.y*t.R.col1.y;return o.y=o.x*t.R.col2.x+o.y*t.R.col2.y,o.x=n,o},i.AddVV=function(t,e){var i=new s(t.x+e.x,t.y+e.y);return i},i.SubtractVV=function(t,e){var i=new s(t.x-e.x,t.y-e.y);return i},i.Distance=function(t,e){var i=t.x-e.x,o=t.y-e.y;return Math.sqrt(i*i+o*o)},i.DistanceSquared=function(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o},i.MulFV=function(t,e){t===void 0&&(t=0);var i=new s(t*e.x,t*e.y);return i},i.AddMM=function(e,o){var n=t.FromVV(i.AddVV(e.col1,o.col1),i.AddVV(e.col2,o.col2));return n},i.MulMM=function(e,o){var n=t.FromVV(i.MulMV(e,o.col1),i.MulMV(e,o.col2));return n},i.MulTMM=function(e,o){var n=new s(i.Dot(e.col1,o.col1),i.Dot(e.col2,o.col1)),r=new s(i.Dot(e.col1,o.col2),i.Dot(e.col2,o.col2)),a=t.FromVV(n,r);return a},i.Abs=function(t){return t===void 0&&(t=0),t>0?t:-t},i.AbsV=function(t){var e=new s(i.Abs(t.x),i.Abs(t.y));return e},i.AbsM=function(e){var o=t.FromVV(i.AbsV(e.col1),i.AbsV(e.col2));return o},i.Min=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=0),e>t?t:e},i.MinV=function(t,e){var o=new s(i.Min(t.x,e.x),i.Min(t.y,e.y));return o},i.Max=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=0),t>e?t:e},i.MaxV=function(t,e){var o=new s(i.Max(t.x,e.x),i.Max(t.y,e.y));return o},i.Clamp=function(t,e,i){return t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),e>t?e:t>i?i:t},i.ClampV=function(t,e,o){return i.MaxV(e,i.MinV(t,o))},i.Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},i.Random=function(){return Math.random()*2-1},i.RandomRange=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0);var i=Math.random();return i=(e-t)*i+t},i.NextPowerOfTwo=function(t){return t===void 0&&(t=0),t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,t|=t>>16&65535,t+1
},i.IsPowerOfTwo=function(t){t===void 0&&(t=0);var e=t>0&&(t&t-1)==0;return e},$i_23.postDefs.push(function(){$i_23.Common.Math.b2Math.b2Vec2_zero=new s(0,0),$i_23.Common.Math.b2Math.b2Mat22_identity=t.FromVV(new s(1,0),new s(0,1)),$i_23.Common.Math.b2Math.b2Transform_identity=new n(i.b2Vec2_zero,i.b2Mat22_identity)}),o.b2Sweep=function(){this.localCenter=new s,this.c0=new s,this.c=new s},o.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},o.prototype.Copy=function(){var t=new o;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},o.prototype.GetTransform=function(t,e){e===void 0&&(e=0),t.position.x=(1-e)*this.c0.x+e*this.c.x,t.position.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.R.Set(i);var o=t.R;t.position.x-=o.col1.x*this.localCenter.x+o.col2.x*this.localCenter.y,t.position.y-=o.col1.y*this.localCenter.x+o.col2.y*this.localCenter.y},o.prototype.Advance=function(t){if(t===void 0&&(t=0),t>this.t0&&1-this.t0>Number.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x,this.c0.y=(1-e)*this.c0.y+e*this.c.y,this.a0=(1-e)*this.a0+e*this.a,this.t0=t}},n.b2Transform=function(){this.position=new s,this.R=new t},n.prototype.b2Transform=function(t,e){t===void 0&&(t=null),e===void 0&&(e=null),t&&(this.position.SetV(t),this.R.SetM(e))},n.prototype.Initialize=function(t,e){this.position.SetV(t),this.R.SetM(e)},n.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},n.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},n.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},s.b2Vec2=function(){},s.prototype.b2Vec2=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=t,this.y=e},s.prototype.SetZero=function(){this.x=0,this.y=0},s.prototype.Set=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=t,this.y=e},s.prototype.SetV=function(t){this.x=t.x,this.y=t.y},s.prototype.GetNegative=function(){return new s(-this.x,-this.y)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},s.Make=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=0),new s(t,e)},s.prototype.Copy=function(){return new s(this.x,this.y)},s.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},s.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},s.prototype.Multiply=function(t){t===void 0&&(t=0),this.x*=t,this.y*=t},s.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},s.prototype.MulTM=function(t){var e=i.Dot(this,t.col1);this.y=i.Dot(this,t.col2),this.x=e},s.prototype.CrossVF=function(t){t===void 0&&(t=0);var e=this.x;this.x=t*this.y,this.y=-t*e},s.prototype.CrossFV=function(t){t===void 0&&(t=0);var e=this.x;this.x=-t*this.y,this.y=t*e},s.prototype.MinV=function(t){this.x=t.x>this.x?this.x:t.x,this.y=t.y>this.y?this.y:t.y},s.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x,this.y=this.y>t.y?this.y:t.y},s.prototype.Abs=function(){0>this.x&&(this.x=-this.x),0>this.y&&(this.y=-this.y)},s.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},s.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(Number.MIN_VALUE>t)return 0;var e=1/t;return this.x*=e,this.y*=e,t},s.prototype.IsValid=function(){return i.IsValid(this.x)&&i.IsValid(this.y)},r.b2Vec3=function(){},r.prototype.b2Vec3=function(t,e,i){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),this.x=t,this.y=e,this.z=i},r.prototype.SetZero=function(){this.x=this.y=this.z=0},r.prototype.Set=function(t,e,i){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),this.x=t,this.y=e,this.z=i},r.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},r.prototype.GetNegative=function(){return new r(-this.x,-this.y,-this.z)},r.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},r.prototype.Copy=function(){return new r(this.x,this.y,this.z)},r.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},r.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},r.prototype.Multiply=function(t){t===void 0&&(t=0),this.x*=t,this.y*=t,this.z*=t}}(),function(){var t=($i_23.Dynamics.Controllers.b2ControllerEdge,$i_23.Common.Math.b2Mat22,$i_23.Common.Math.b2Mat33,$i_23.Common.Math.b2Math),e=$i_23.Common.Math.b2Sweep,i=$i_23.Common.Math.b2Transform,o=$i_23.Common.Math.b2Vec2,n=($i_23.Common.Math.b2Vec3,$i_23.Common.b2Color),s=($i_23.Common.b2internal,$i_23.Common.b2Settings),r=$i_23.Collision.b2AABB,a=($i_23.Collision.b2Bound,$i_23.Collision.b2BoundValues,$i_23.Collision.b2Collision,$i_23.Collision.b2ContactID,$i_23.Collision.b2ContactPoint),h=($i_23.Collision.b2Distance,$i_23.Collision.b2DistanceInput,$i_23.Collision.b2DistanceOutput,$i_23.Collision.b2DistanceProxy,$i_23.Collision.b2DynamicTree,$i_23.Collision.b2DynamicTreeBroadPhase),l=($i_23.Collision.b2DynamicTreeNode,$i_23.Collision.b2DynamicTreePair,$i_23.Collision.b2Manifold,$i_23.Collision.b2ManifoldPoint,$i_23.Collision.b2Point,$i_23.Collision.b2RayCastInput),c=$i_23.Collision.b2RayCastOutput,m=($i_23.Collision.b2Segment,$i_23.Collision.b2SeparationFunction,$i_23.Collision.b2Simplex,$i_23.Collision.b2SimplexCache,$i_23.Collision.b2SimplexVertex,$i_23.Collision.b2TimeOfImpact,$i_23.Collision.b2TOIInput,$i_23.Collision.b2WorldManifold,$i_23.Collision.ClipVertex,$i_23.Collision.Features,$i_23.Collision.IBroadPhase,$i_23.Collision.Shapes.b2CircleShape),_=($i_23.Collision.Shapes.b2EdgeChainDef,$i_23.Collision.Shapes.b2EdgeShape),u=$i_23.Collision.Shapes.b2MassData,d=$i_23.Collision.Shapes.b2PolygonShape,p=$i_23.Collision.Shapes.b2Shape,y=$i_23.Dynamics.b2Body,x=$i_23.Dynamics.b2BodyDef,f=$i_23.Dynamics.b2ContactFilter,g=$i_23.Dynamics.b2ContactImpulse,v=$i_23.Dynamics.b2ContactListener,b=$i_23.Dynamics.b2ContactManager,C=$i_23.Dynamics.b2DebugDraw,w=$i_23.Dynamics.b2DestructionListener,D=$i_23.Dynamics.b2FilterData,S=$i_23.Dynamics.b2Fixture,B=$i_23.Dynamics.b2FixtureDef,I=$i_23.Dynamics.b2Island,A=$i_23.Dynamics.b2TimeStep,M=$i_23.Dynamics.b2World,T=($i_23.Dynamics.Contacts.b2CircleContact,$i_23.Dynamics.Contacts.b2Contact),P=($i_23.Dynamics.Contacts.b2ContactConstraint,$i_23.Dynamics.Contacts.b2ContactConstraintPoint,$i_23.Dynamics.Contacts.b2ContactEdge,$i_23.Dynamics.Contacts.b2ContactFactory),k=($i_23.Dynamics.Contacts.b2ContactRegister,$i_23.Dynamics.Contacts.b2ContactResult,$i_23.Dynamics.Contacts.b2ContactSolver),V=($i_23.Dynamics.Contacts.b2EdgeAndCircleContact,$i_23.Dynamics.Contacts.b2NullContact,$i_23.Dynamics.Contacts.b2PolyAndCircleContact,$i_23.Dynamics.Contacts.b2PolyAndEdgeContact,$i_23.Dynamics.Contacts.b2PolygonContact,$i_23.Dynamics.Contacts.b2PositionSolverManifold,$i_23.Dynamics.Controllers.b2Controller,$i_23.Dynamics.Joints.b2DistanceJoint,$i_23.Dynamics.Joints.b2DistanceJointDef,$i_23.Dynamics.Joints.b2FrictionJoint,$i_23.Dynamics.Joints.b2FrictionJointDef,$i_23.Dynamics.Joints.b2GearJoint,$i_23.Dynamics.Joints.b2GearJointDef,$i_23.Dynamics.Joints.b2Jacobian,$i_23.Dynamics.Joints.b2Joint),R=($i_23.Dynamics.Joints.b2JointDef,$i_23.Dynamics.Joints.b2JointEdge,$i_23.Dynamics.Joints.b2LineJoint,$i_23.Dynamics.Joints.b2LineJointDef,$i_23.Dynamics.Joints.b2MouseJoint,$i_23.Dynamics.Joints.b2MouseJointDef,$i_23.Dynamics.Joints.b2PrismaticJoint,$i_23.Dynamics.Joints.b2PrismaticJointDef,$i_23.Dynamics.Joints.b2PulleyJoint);$i_23.Dynamics.Joints.b2PulleyJointDef,$i_23.Dynamics.Joints.b2RevoluteJoint,$i_23.Dynamics.Joints.b2RevoluteJointDef,$i_23.Dynamics.Joints.b2WeldJoint,$i_23.Dynamics.Joints.b2WeldJointDef,y.b2Body=function(){this.m_xf=new i,this.m_sweep=new e,this.m_linearVelocity=new o,this.m_force=new o},y.prototype.connectEdges=function(e,i,o){o===void 0&&(o=0);var n=Math.atan2(i.GetDirectionVector().y,i.GetDirectionVector().x),r=Math.tan((n-o)*.5),a=t.MulFV(r,i.GetDirectionVector());a=t.SubtractVV(a,i.GetNormalVector()),a=t.MulFV(s.b2_toiSlop,a),a=t.AddVV(a,i.GetVertex1());var h=t.AddVV(e.GetDirectionVector(),i.GetDirectionVector());h.Normalize();var l=t.Dot(e.GetDirectionVector(),i.GetNormalVector())>0;return e.SetNextEdge(i,a,h,l),i.SetPrevEdge(e,a,h,l),n},y.prototype.CreateFixture=function(t){if(this.m_world.IsLocked()==1)return null;var e=new S;if(e.Create(this,this.m_xf,t),this.m_flags&y.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxy(i,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_body=this,e.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=M.e_newFixture,e},y.prototype.CreateFixture2=function(t,e){e===void 0&&(e=0);var i=new B;return i.shape=t,i.density=e,this.CreateFixture(i)},y.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked()!=1){var e=this.m_fixtureList,i=null,o=!1;while(e!=null){if(e==t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next,o=!0;break}i=e,e=e.m_next}var n=this.m_contactList;while(n){var s=n.contact;n=n.next;var r=s.GetFixtureA(),a=s.GetFixtureB();(t==r||t==a)&&this.m_world.m_contactManager.Destroy(s)}if(this.m_flags&y.e_activeFlag){var h=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(h)}t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},y.prototype.SetPositionAndAngle=function(t,e){e===void 0&&(e=0);var i;if(this.m_world.IsLocked()!=1){this.m_xf.R.Set(e),this.m_xf.position.SetV(t);var o=this.m_xf.R,n=this.m_sweep.localCenter;this.m_sweep.c.x=o.col1.x*n.x+o.col2.x*n.y,this.m_sweep.c.y=o.col1.y*n.x+o.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=e;var s=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},y.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},y.prototype.GetTransform=function(){return this.m_xf},y.prototype.GetPosition=function(){return this.m_xf.position},y.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},y.prototype.GetAngle=function(){return this.m_sweep.a},y.prototype.SetAngle=function(t){t===void 0&&(t=0),this.SetPositionAndAngle(this.GetPosition(),t)},y.prototype.GetWorldCenter=function(){return this.m_sweep.c},y.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},y.prototype.SetLinearVelocity=function(t){this.m_type!=y.b2_staticBody&&this.m_linearVelocity.SetV(t)},y.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},y.prototype.SetAngularVelocity=function(t){t===void 0&&(t=0),this.m_type!=y.b2_staticBody&&(this.m_angularVelocity=t)},y.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},y.prototype.GetDefinition=function(){var t=new x;return t.type=this.GetType(),t.allowSleep=(this.m_flags&y.e_allowSleepFlag)==y.e_allowSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&y.e_fixedRotationFlag)==y.e_fixedRotationFlag,t.bullet=(this.m_flags&y.e_bulletFlag)==y.e_bulletFlag,t.awake=(this.m_flags&y.e_awakeFlag)==y.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t.userData=this.GetUserData(),t},y.prototype.ApplyForce=function(t,e){this.m_type==y.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)},y.prototype.ApplyTorque=function(t){t===void 0&&(t=0),this.m_type==y.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=t)},y.prototype.ApplyImpulse=function(t,e){this.m_type==y.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},y.prototype.Split=function(e){for(var i,o=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),s=this.GetWorldCenter(),r=this,a=this.m_world.CreateBody(this.GetDefinition()),h=r.m_fixtureList;h;)if(e(h)){var l=h.m_next;i?i.m_next=l:r.m_fixtureList=l,r.m_fixtureCount--,h.m_next=a.m_fixtureList,a.m_fixtureList=h,a.m_fixtureCount++,h.m_body=a,h=l}else i=h,h=h.m_next;r.ResetMassData(),a.ResetMassData();var c=r.GetWorldCenter(),m=a.GetWorldCenter(),_=t.AddVV(o,t.CrossFV(n,t.SubtractVV(c,s))),u=t.AddVV(o,t.CrossFV(n,t.SubtractVV(m,s)));return r.SetLinearVelocity(_),a.SetLinearVelocity(u),r.SetAngularVelocity(n),a.SetAngularVelocity(n),r.SynchronizeFixtures(),a.SynchronizeFixtures(),a},y.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var i=e.m_next;t.m_fixtureCount--,e.m_next=this.m_fixtureList,this.m_fixtureList=e,this.m_fixtureCount++,e.m_body=n,e=i}o.m_fixtureCount=0;var o=this,n=t;o.GetWorldCenter(),n.GetWorldCenter(),o.GetLinearVelocity().Copy(),n.GetLinearVelocity().Copy(),o.GetAngularVelocity(),n.GetAngularVelocity(),o.ResetMassData(),this.SynchronizeFixtures()},y.prototype.GetMass=function(){return this.m_mass},y.prototype.GetInertia=function(){return this.m_I},y.prototype.GetMassData=function(t){t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter)},y.prototype.SetMassData=function(e){if(s.b2Assert(this.m_world.IsLocked()==0),this.m_world.IsLocked()!=1&&this.m_type==y.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass>0||(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&(this.m_flags&y.e_fixedRotationFlag)==0&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)}},y.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=y.b2_staticBody&&this.m_type!=y.b2_kinematicBody){for(var e=o.Make(0,0),i=this.m_fixtureList;i;i=i.m_next)if(i.m_density!=0){var n=i.GetMassData();this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&(this.m_flags&y.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,s.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)}},y.prototype.GetWorldPoint=function(t){var e=this.m_xf.R,i=new o(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,i},y.prototype.GetWorldVector=function(e){return t.MulMV(this.m_xf.R,e)},y.prototype.GetLocalPoint=function(e){return t.MulXT(this.m_xf,e)},y.prototype.GetLocalVector=function(e){return t.MulTMV(this.m_xf.R,e)},y.prototype.GetLinearVelocityFromWorldPoint=function(t){return new o(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},y.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R,i=new o(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,new o(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))},y.prototype.GetLinearDamping=function(){return this.m_linearDamping},y.prototype.SetLinearDamping=function(t){t===void 0&&(t=0),this.m_linearDamping=t},y.prototype.GetAngularDamping=function(){return this.m_angularDamping},y.prototype.SetAngularDamping=function(t){t===void 0&&(t=0),this.m_angularDamping=t},y.prototype.SetType=function(t){if(t===void 0&&(t=0),this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==y.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()}},y.prototype.GetType=function(){return this.m_type},y.prototype.SetBullet=function(t){t?this.m_flags|=y.e_bulletFlag:this.m_flags&=~y.e_bulletFlag},y.prototype.IsBullet=function(){return(this.m_flags&y.e_bulletFlag)==y.e_bulletFlag},y.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=y.e_allowSleepFlag:(this.m_flags&=~y.e_allowSleepFlag,this.SetAwake(!0))},y.prototype.SetAwake=function(t){t?(this.m_flags|=y.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~y.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},y.prototype.IsAwake=function(){return(this.m_flags&y.e_awakeFlag)==y.e_awakeFlag},y.prototype.SetFixedRotation=function(t){t?this.m_flags|=y.e_fixedRotationFlag:this.m_flags&=~y.e_fixedRotationFlag,this.ResetMassData()},y.prototype.IsFixedRotation=function(){return(this.m_flags&y.e_fixedRotationFlag)==y.e_fixedRotationFlag},y.prototype.SetActive=function(t){if(t!=this.IsActive()){var e,i;if(t)for(this.m_flags|=y.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.CreateProxy(e,this.m_xf);else{for(this.m_flags&=~y.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxy(e);var o=this.m_contactList;while(o){var n=o;o=o.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}},y.prototype.IsActive=function(){return(this.m_flags&y.e_activeFlag)==y.e_activeFlag},y.prototype.IsSleepingAllowed=function(){return(this.m_flags&y.e_allowSleepFlag)==y.e_allowSleepFlag},y.prototype.GetFixtureList=function(){return this.m_fixtureList},y.prototype.GetJointList=function(){return this.m_jointList},y.prototype.GetControllerList=function(){return this.m_controllerList},y.prototype.GetContactList=function(){return this.m_contactList},y.prototype.GetNext=function(){return this.m_next},y.prototype.GetUserData=function(){return this.m_userData},y.prototype.SetUserData=function(t){this.m_userData=t},y.prototype.GetWorld=function(){return this.m_world},y.prototype.b2Body=function(t,e){this.m_flags=0,t.bullet&&(this.m_flags|=y.e_bulletFlag),t.fixedRotation&&(this.m_flags|=y.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=y.e_allowSleepFlag),t.awake&&(this.m_flags|=y.e_awakeFlag),t.active&&(this.m_flags|=y.e_activeFlag),this.m_world=e,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R,o=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*o.x+i.col2.x*o.y,this.m_sweep.c.y=i.col1.y*o.x+i.col2.y*o.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,this.m_type==y.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=t.inertiaScale,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0},y.prototype.SynchronizeFixtures=function(){var t=y.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R,i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y),t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y);var o,n=this.m_world.m_contactManager.m_broadPhase;for(o=this.m_fixtureList;o;o=o.m_next)o.Synchronize(n,t,this.m_xf)},y.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)},y.prototype.ShouldCollide=function(t){if(this.m_type!=y.b2_dynamicBody&&t.m_type!=y.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&e.joint.m_collideConnected==0)return!1;return!0},y.prototype.Advance=function(t){t===void 0&&(t=0),this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},$i_23.postDefs.push(function(){$i_23.Dynamics.b2Body.s_xf1=new i,$i_23.Dynamics.b2Body.e_islandFlag=1,$i_23.Dynamics.b2Body.e_awakeFlag=2,$i_23.Dynamics.b2Body.e_allowSleepFlag=4,$i_23.Dynamics.b2Body.e_bulletFlag=8,$i_23.Dynamics.b2Body.e_fixedRotationFlag=16,$i_23.Dynamics.b2Body.e_activeFlag=32,$i_23.Dynamics.b2Body.b2_staticBody=0,$i_23.Dynamics.b2Body.b2_kinematicBody=1,$i_23.Dynamics.b2Body.b2_dynamicBody=2}),x.b2BodyDef=function(){this.position=new o,this.linearVelocity=new o},x.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=y.b2_staticBody,this.active=!0,this.inertiaScale=1},f.b2ContactFilter=function(){},f.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData(),o=e.GetFilterData();if(i.groupIndex==o.groupIndex&&i.groupIndex!=0)return i.groupIndex>0;var n=(i.maskBits&o.categoryBits)!=0&&(i.categoryBits&o.maskBits)!=0;return n},f.prototype.RayCollide=function(t,e){return t?this.ShouldCollide(t instanceof S?t:null,e):!0},$i_23.postDefs.push(function(){$i_23.Dynamics.b2ContactFilter.b2_defaultFilter=new f}),g.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints)},v.b2ContactListener=function(){},v.prototype.BeginContact=function(){},v.prototype.EndContact=function(){},v.prototype.PreSolve=function(){},v.prototype.PostSolve=function(){},$i_23.postDefs.push(function(){$i_23.Dynamics.b2ContactListener.b2_defaultListener=new v}),b.b2ContactManager=function(){},b.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=f.b2_defaultFilter,this.m_contactListener=v.b2_defaultListener,this.m_contactFactory=new P(this.m_allocator),this.m_broadPhase=new h},b.prototype.AddPair=function(t,e){var i=t instanceof S?t:null,o=e instanceof S?e:null,n=i.GetBody(),s=o.GetBody();if(n!=s){var r=s.GetContactList();while(r){if(r.other==n){var a=r.contact.GetFixtureA(),h=r.contact.GetFixtureB();if(a==i&&h==o)return;if(a==o&&h==i)return}r=r.next}if(s.ShouldCollide(n)!=0&&this.m_contactFilter.ShouldCollide(i,o)!=0){var l=this.m_contactFactory.Create(i,o);i=l.GetFixtureA(),o=l.GetFixtureB(),n=i.m_body,s=o.m_body,l.m_prev=null,l.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=l),this.m_world.m_contactList=l,l.m_nodeA.contact=l,l.m_nodeA.other=s,l.m_nodeA.prev=null,l.m_nodeA.next=n.m_contactList,n.m_contactList!=null&&(n.m_contactList.prev=l.m_nodeA),n.m_contactList=l.m_nodeA,l.m_nodeB.contact=l,l.m_nodeB.other=n,l.m_nodeB.prev=null,l.m_nodeB.next=s.m_contactList,s.m_contactList!=null&&(s.m_contactList.prev=l.m_nodeB),s.m_contactList=l.m_nodeB,++this.m_world.m_contactCount}}},b.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs($i_23.generateCallback(this,this.AddPair))},b.prototype.Destroy=function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),o=e.GetBody(),n=i.GetBody();t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},b.prototype.Collide=function(){var t=this.m_world.m_contactList;while(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),o=e.GetBody(),n=i.GetBody();if(o.IsAwake()!=0||n.IsAwake()!=0){if(t.m_flags&T.e_filterFlag){if(n.ShouldCollide(o)==0){var s=t;t=s.GetNext(),this.Destroy(s);continue}if(this.m_contactFilter.ShouldCollide(e,i)==0){s=t,t=s.GetNext(),this.Destroy(s);continue}t.m_flags&=~T.e_filterFlag}var r=e.m_proxy,a=i.m_proxy;if(r&&a){var h=this.m_broadPhase.TestOverlap(r,a);if(h==0){s=t,t=s.GetNext(),this.Destroy(s);continue}}t.Update(this.m_contactListener),t=t.GetNext()}else t=t.GetNext()}},$i_23.postDefs.push(function(){$i_23.Dynamics.b2ContactManager.s_evalCP=new a}),C.b2DebugDraw=function(){},C.prototype.b2DebugDraw=function(){},C.prototype.SetFlags=function(t){t===void 0&&(t=0)},C.prototype.GetFlags=function(){},C.prototype.AppendFlags=function(t){t===void 0&&(t=0)},C.prototype.ClearFlags=function(t){t===void 0&&(t=0)},C.prototype.SetSprite=function(){},C.prototype.GetSprite=function(){},C.prototype.SetDrawScale=function(t){t===void 0&&(t=0)},C.prototype.GetDrawScale=function(){},C.prototype.SetLineThickness=function(t){t===void 0&&(t=0)},C.prototype.GetLineThickness=function(){},C.prototype.SetAlpha=function(t){t===void 0&&(t=0)},C.prototype.GetAlpha=function(){},C.prototype.SetFillAlpha=function(t){t===void 0&&(t=0)},C.prototype.GetFillAlpha=function(){},C.prototype.SetXFormScale=function(t){t===void 0&&(t=0)},C.prototype.GetXFormScale=function(){},C.prototype.DrawPolygon=function(t,e){e===void 0&&(e=0)},C.prototype.DrawSolidPolygon=function(t,e){e===void 0&&(e=0)},C.prototype.DrawCircle=function(t,e){e===void 0&&(e=0)},C.prototype.DrawSolidCircle=function(t,e){e===void 0&&(e=0)},C.prototype.DrawSegment=function(){},C.prototype.DrawTransform=function(){},$i_23.postDefs.push(function(){$i_23.Dynamics.b2DebugDraw.e_shapeBit=1,$i_23.Dynamics.b2DebugDraw.e_jointBit=2,$i_23.Dynamics.b2DebugDraw.e_aabbBit=4,$i_23.Dynamics.b2DebugDraw.e_pairBit=8,$i_23.Dynamics.b2DebugDraw.e_centerOfMassBit=16,$i_23.Dynamics.b2DebugDraw.e_controllerBit=32}),w.b2DestructionListener=function(){},w.prototype.SayGoodbyeJoint=function(){},w.prototype.SayGoodbyeFixture=function(){},D.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},D.prototype.Copy=function(){var t=new D;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},S.b2Fixture=function(){this.m_filter=new D},S.prototype.GetType=function(){return this.m_shape.GetType()},S.prototype.GetShape=function(){return this.m_shape},S.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,this.m_body!=null)){var e=this.m_body.GetContactList();while(e){var i=e.contact,o=i.GetFixtureA(),n=i.GetFixtureB();(o==this||n==this)&&i.SetSensor(o.IsSensor()||n.IsSensor()),e=e.next}}},S.prototype.IsSensor=function(){return this.m_isSensor},S.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),!this.m_body){var e=this.m_body.GetContactList();while(e){var i=e.contact,o=i.GetFixtureA(),n=i.GetFixtureB();(o==this||n==this)&&i.FlagForFiltering(),e=e.next}}},S.prototype.GetFilterData=function(){return this.m_filter.Copy()},S.prototype.GetBody=function(){return this.m_body},S.prototype.GetNext=function(){return this.m_next},S.prototype.GetUserData=function(){return this.m_userData},S.prototype.SetUserData=function(t){this.m_userData=t},S.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},S.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())},S.prototype.GetMassData=function(t){return t===void 0&&(t=null),t==null&&(t=new u),this.m_shape.ComputeMass(t,this.m_density),t},S.prototype.SetDensity=function(t){t===void 0&&(t=0),this.m_density=t},S.prototype.GetDensity=function(){return this.m_density},S.prototype.GetFriction=function(){return this.m_friction},S.prototype.SetFriction=function(t){t===void 0&&(t=0),this.m_friction=t},S.prototype.GetRestitution=function(){return this.m_restitution},S.prototype.SetRestitution=function(t){t===void 0&&(t=0),this.m_restitution=t},S.prototype.GetAABB=function(){return this.m_aabb},S.prototype.b2Fixture=function(){this.m_aabb=new r,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},S.prototype.Create=function(t,e,i){this.m_userData=i.userData,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_body=t,this.m_next=null,this.m_filter=i.filter.Copy(),this.m_isSensor=i.isSensor,this.m_shape=i.shape.Copy(),this.m_density=i.density},S.prototype.Destroy=function(){this.m_shape=null},S.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e),this.m_proxy=t.CreateProxy(this.m_aabb,this)},S.prototype.DestroyProxy=function(t){this.m_proxy!=null&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},S.prototype.Synchronize=function(e,i,o){if(this.m_proxy){var n=new r,s=new r;this.m_shape.ComputeAABB(n,i),this.m_shape.ComputeAABB(s,o),this.m_aabb.Combine(n,s);var a=t.SubtractVV(o.position,i.position);e.MoveProxy(this.m_proxy,this.m_aabb,a)}},B.b2FixtureDef=function(){this.filter=new D},B.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},I.b2Island=function(){},I.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},I.prototype.Initialize=function(t,e,i,o,n,s){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0);var r=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=o,this.m_listener=n,this.m_contactSolver=s,r=this.m_bodies.length;t>r;r++)this.m_bodies[r]=null;for(r=this.m_contacts.length;e>r;r++)this.m_contacts[r]=null;for(r=this.m_joints.length;i>r;r++)this.m_joints[r]=null},I.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},I.prototype.Solve=function(e,i,o){var n,r,a=0,h=0,l=i.x,c=i.y;for(a=0;this.m_bodyCount>a;++a)n=this.m_bodies[a],n.GetType()==y.b2_dynamicBody&&(n.m_nonGravitic?(n.m_linearVelocity.x+=e.dt*n.m_invMass*n.m_force.x,n.m_linearVelocity.y+=e.dt*n.m_invMass*n.m_force.y):(n.m_linearVelocity.x+=e.dt*(l+n.m_invMass*n.m_force.x),n.m_linearVelocity.y+=e.dt*(c+n.m_invMass*n.m_force.y)),n.m_angularVelocity+=e.dt*n.m_invI*n.m_torque,n.m_linearVelocity.Multiply(t.Clamp(1-e.dt*n.m_linearDamping,0,1)),n.m_angularVelocity*=t.Clamp(1-e.dt*n.m_angularDamping,0,1));this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var m=this.m_contactSolver;for(m.InitVelocityConstraints(e),a=0;this.m_jointCount>a;++a)r=this.m_joints[a],r.InitVelocityConstraints(e);for(a=0;e.velocityIterations>a;++a){for(h=0;this.m_jointCount>h;++h)r=this.m_joints[h],r.SolveVelocityConstraints(e);m.SolveVelocityConstraints()}for(a=0;this.m_jointCount>a;++a)r=this.m_joints[a],r.FinalizeVelocityConstraints();for(m.FinalizeVelocityConstraints(),a=0;this.m_bodyCount>a;++a)if(n=this.m_bodies[a],n.GetType()!=y.b2_staticBody){var _=e.dt*n.m_linearVelocity.x,u=e.dt*n.m_linearVelocity.y;
_*_+u*u>s.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=s.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=s.b2_maxTranslation*e.inv_dt);var d=e.dt*n.m_angularVelocity;d*d>s.b2_maxRotationSquared&&(n.m_angularVelocity=0>n.m_angularVelocity?-s.b2_maxRotation*e.inv_dt:s.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}for(a=0;e.positionIterations>a;++a){var p=m.SolvePositionConstraints(s.b2_contactBaumgarte),x=!0;for(h=0;this.m_jointCount>h;++h){r=this.m_joints[h];var f=r.SolvePositionConstraints(s.b2_contactBaumgarte);x=x&&f}if(p&&x)break}if(this.Report(m.m_constraints),o){var g=Number.MAX_VALUE,v=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,b=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance;for(a=0;this.m_bodyCount>a;++a)n=this.m_bodies[a],n.GetType()!=y.b2_staticBody&&((n.m_flags&y.e_allowSleepFlag)==0&&(n.m_sleepTime=0,g=0),(n.m_flags&y.e_allowSleepFlag)==0||n.m_angularVelocity*n.m_angularVelocity>b||t.Dot(n.m_linearVelocity,n.m_linearVelocity)>v?(n.m_sleepTime=0,g=0):(n.m_sleepTime+=e.dt,g=t.Min(g,n.m_sleepTime)));if(g>=s.b2_timeToSleep)for(a=0;this.m_bodyCount>a;++a)n=this.m_bodies[a],n.SetAwake(!1)}},I.prototype.SolveTOI=function(t){var e=0,i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var o=this.m_contactSolver;for(e=0;this.m_jointCount>e;++e)this.m_joints[e].InitVelocityConstraints(t);for(e=0;t.velocityIterations>e;++e)for(o.SolveVelocityConstraints(),i=0;this.m_jointCount>i;++i)this.m_joints[i].SolveVelocityConstraints(t);for(e=0;this.m_bodyCount>e;++e){var n=this.m_bodies[e];if(n.GetType()!=y.b2_staticBody){var r=t.dt*n.m_linearVelocity.x,a=t.dt*n.m_linearVelocity.y;r*r+a*a>s.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=s.b2_maxTranslation*t.inv_dt,n.m_linearVelocity.y*=s.b2_maxTranslation*t.inv_dt);var h=t.dt*n.m_angularVelocity;h*h>s.b2_maxRotationSquared&&(n.m_angularVelocity=0>n.m_angularVelocity?-s.b2_maxRotation*t.inv_dt:s.b2_maxRotation*t.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=t.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=t.dt*n.m_linearVelocity.y,n.m_sweep.a+=t.dt*n.m_angularVelocity,n.SynchronizeTransform()}}var l=.75;for(e=0;t.positionIterations>e;++e){var c=o.SolvePositionConstraints(l),m=!0;for(i=0;this.m_jointCount>i;++i){var _=this.m_joints[i].SolvePositionConstraints(s.b2_contactBaumgarte);m=m&&_}if(c&&m)break}this.Report(o.m_constraints)},I.prototype.Report=function(t){if(this.m_listener!=null)for(var e=0;this.m_contactCount>e;++e){for(var i=this.m_contacts[e],o=t[e],n=0;o.pointCount>n;++n)I.s_impulse.normalImpulses[n]=o.points[n].normalImpulse,I.s_impulse.tangentImpulses[n]=o.points[n].tangentImpulse;this.m_listener.PostSolve(i,I.s_impulse)}},I.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},I.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},I.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},$i_23.postDefs.push(function(){$i_23.Dynamics.b2Island.s_impulse=new g}),A.b2TimeStep=function(){},A.prototype.Set=function(t){this.dt=t.dt,this.inv_dt=t.inv_dt,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting},M.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new b,this.m_contactSolver=new k,this.m_island=new I},M.prototype.b2World=function(t,e){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,M.m_warmStarting=!0,M.m_continuousPhysics=!0,this.m_allowSleep=e,this.m_gravity=t,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var i=new x;this.m_groundBody=this.CreateBody(i)},M.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},M.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},M.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},M.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},M.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;i;i=i.m_next)for(var o=i.m_fixtureList;o;o=o.m_next)o.m_proxy=t.CreateProxy(e.GetFatAABB(o.m_proxy),o)},M.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},M.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},M.prototype.CreateBody=function(t){if(this.IsLocked()==1)return null;var e=new y(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},M.prototype.DestroyBody=function(t){if(this.IsLocked()!=1){var e=t.m_jointList;while(e){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint)}var o=t.m_controllerList;while(o){var n=o;o=o.nextController,n.controller.RemoveBody(t)}var s=t.m_contactList;while(s){var r=s;s=s.next,this.m_contactManager.Destroy(r.contact)}t.m_contactList=null;var a=t.m_fixtureList;while(a){var h=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(h),h.DestroyProxy(this.m_contactManager.m_broadPhase),h.Destroy()}return t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount,!0}},M.prototype.CreateJoint=function(t){var e=V.Create(t,null);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.joint=e,e.m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.joint=e,e.m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA,o=t.bodyB;if(t.collideConnected==0){var n=o.GetContactList();while(n)n.other==i&&n.contact.FlagForFiltering(),n=n.next}return e},M.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,o=t.m_bodyB;if(i.SetAwake(!0),o.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==o.m_jointList&&(o.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,V.Destroy(t,null),--this.m_jointCount,e==0){var n=o.GetContactList();while(n)n.other==i&&n.contact.FlagForFiltering(),n=n.next}},M.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList=t,t.m_world=this,this.m_controllerCount++,t},M.prototype.RemoveController=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),this.m_controllerCount--},M.prototype.CreateController=function(t){if(t.m_world!=this)throw Error("Controller can only be a member of one world");return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t.m_world=this,t},M.prototype.DestroyController=function(t){t.Clear(),t.m_next&&(t.m_next.m_prev=t.m_prev),t.m_prev&&(t.m_prev.m_next=t.m_next),t==this.m_controllerList&&(this.m_controllerList=t.m_next),--this.m_controllerCount},M.prototype.SetWarmStarting=function(t){M.m_warmStarting=t},M.prototype.SetContinuousPhysics=function(t){M.m_continuousPhysics=t},M.prototype.GetBodyCount=function(){return this.m_bodyCount},M.prototype.GetJointCount=function(){return this.m_jointCount},M.prototype.GetContactCount=function(){return this.m_contactCount},M.prototype.SetGravity=function(t){this.m_gravity=t},M.prototype.GetGravity=function(){return this.m_gravity},M.prototype.GetGroundBody=function(){return this.m_groundBody},M.prototype.Step=function(t,e,i){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),this.m_flags&M.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~M.e_newFixture),this.m_flags|=M.e_locked;var o=M.s_timestep2;o.dt=t,o.velocityIterations=e,o.positionIterations=i,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=M.m_warmStarting,this.m_contactManager.Collide(),o.dt>0&&this.Solve(o),M.m_continuousPhysics&&o.dt>0&&this.SolveTOI(o),o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_flags&=~M.e_locked},M.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},M.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var t,e,i,s,a,h=this.m_debugDraw.GetFlags();new o,new o,new o;var l;new r,new r;var c=[new o,new o,new o,new o],m=new n(0,0,0);if(h&C.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next)if(!t._entity||!t._entity._box2dNoDebug)for(l=t.m_xf,e=t.GetFixtureList();e;e=e.m_next)i=e.GetShape(),t.IsActive()==0?(m.Set(.5,.5,.3),this.DrawShape(i,l,m)):t.GetType()==y.b2_staticBody?(m.Set(.5,.9,.5),this.DrawShape(i,l,m)):t.GetType()==y.b2_kinematicBody?(m.Set(.5,.5,.9),this.DrawShape(i,l,m)):t.IsAwake()==0?(m.Set(.6,.6,.6),this.DrawShape(i,l,m)):(m.Set(.9,.7,.7),this.DrawShape(i,l,m));if(h&C.e_jointBit)for(s=this.m_jointList;s;s=s.m_next)this.DrawJoint(s);if(h&C.e_controllerBit)for(var _=this.m_controllerList;_;_=_.m_next)_.Draw(this.m_debugDraw);if(h&C.e_pairBit){m.Set(.3,.9,.9);for(var u=this.m_contactManager.m_contactList;u;u=u.GetNext()){var d=u.GetFixtureA(),p=u.GetFixtureB(),x=d.GetAABB().GetCenter(),f=p.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(x,f,m)}}if(h&C.e_aabbBit)for(a=this.m_contactManager.m_broadPhase,c=[new o,new o,new o,new o],t=this.m_bodyList;t;t=t.GetNext())if(t.IsActive()!=0)for(e=t.GetFixtureList();e;e=e.GetNext()){var g=a.GetFatAABB(e.m_proxy);c[0].Set(g.lowerBound.x,g.lowerBound.y),c[1].Set(g.upperBound.x,g.lowerBound.y),c[2].Set(g.upperBound.x,g.upperBound.y),c[3].Set(g.lowerBound.x,g.upperBound.y),this.m_debugDraw.DrawPolygon(c,4,m)}if(h&C.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)l=M.s_xf,l.R=t.m_xf.R,l.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(l)}},M.prototype.QueryAABB=function(t,e){function i(e){return t(n.GetUserData(e))}var o=this,n=o.m_contactManager.m_broadPhase;n.Query(i,e)},M.prototype.QueryShape=function(t,e,o){function n(i){var n=a.GetUserData(i)instanceof S?a.GetUserData(i):null;return p.TestOverlap(e,o,n.GetShape(),n.GetBody().GetTransform())?t(n):!0}var s=this;o===void 0&&(o=null),o==null&&(o=new i,o.SetIdentity());var a=s.m_contactManager.m_broadPhase,h=new r;e.ComputeAABB(h,o),a.Query(n,h)},M.prototype.QueryPoint=function(t,e){function i(i){var o=n.GetUserData(i)instanceof S?n.GetUserData(i):null;return o.TestPoint(e)?t(o):!0}var o=this,n=o.m_contactManager.m_broadPhase,a=new r;a.lowerBound.Set(e.x-s.b2_linearSlop,e.y-s.b2_linearSlop),a.upperBound.Set(e.x+s.b2_linearSlop,e.y+s.b2_linearSlop),n.Query(i,a)},M.prototype.RayCast=function(t,e,i){function n(n,s){var h=r.GetUserData(s),l=h instanceof S?h:null,c=l.RayCast(a,n);if(c){var m=a.fraction,_=new o((1-m)*e.x+m*i.x,(1-m)*e.y+m*i.y);return t.ReportFixture(l,_,a.normal,m)}return n.maxFraction}var s=this,r=s.m_contactManager.m_broadPhase,a=new c,h=new l(e,i);r.RayCast(n,h)},M.prototype.RayCastOne=function(t,e){function i(t,e,i,n){return n===void 0&&(n=0),o=t,n}var o,n=this;return n.RayCast(i,t,e),o},M.prototype.RayCastAll=function(t,e){function i(t,e,i,o){return o===void 0&&(o=0),n[n.length]=t,1}var o=this,n=new Vector;return o.RayCast(i,t,e),n},M.prototype.GetBodyList=function(){return this.m_bodyList},M.prototype.GetJointList=function(){return this.m_jointList},M.prototype.GetContactList=function(){return this.m_contactList},M.prototype.IsLocked=function(){return(this.m_flags&M.e_locked)>0},M.prototype.Solve=function(t){for(var e,i=this.m_controllerList;i;i=i.m_next)i.Step(t);var o=this.m_island;for(o.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~y.e_islandFlag;for(var n=this.m_contactList;n;n=n.m_next)n.m_flags&=~T.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var r=this.s_stack,a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&y.e_islandFlag)&&a.IsAwake()!=0&&a.IsActive()!=0&&a.GetType()!=y.b2_staticBody){o.Clear();var h=0;r[h++]=a,a.m_flags|=y.e_islandFlag;while(h>0)if(e=r[--h],o.AddBody(e),e.IsAwake()==0&&e.SetAwake(!0),e.GetType()!=y.b2_staticBody){for(var l,c=e.m_contactList;c;c=c.next)c.contact.m_flags&T.e_islandFlag||c.contact.IsSensor()!=1&&c.contact.IsEnabled()!=0&&c.contact.IsTouching()!=0&&(o.AddContact(c.contact),c.contact.m_flags|=T.e_islandFlag,l=c.other,l.m_flags&y.e_islandFlag||(r[h++]=l,l.m_flags|=y.e_islandFlag));for(var m=e.m_jointList;m;m=m.next)m.joint.m_islandFlag!=1&&(l=m.other,l.IsActive()!=0&&(o.AddJoint(m.joint),m.joint.m_islandFlag=!0,l.m_flags&y.e_islandFlag||(r[h++]=l,l.m_flags|=y.e_islandFlag)))}o.Solve(t,this.m_gravity,this.m_allowSleep);for(var _=0;o.m_bodyCount>_;++_)e=o.m_bodies[_],e.GetType()==y.b2_staticBody&&(e.m_flags&=~y.e_islandFlag)}for(_=0;r.length>_;++_){if(!r[_])break;r[_]=null}for(e=this.m_bodyList;e;e=e.m_next)e.IsAwake()!=0&&e.IsActive()!=0&&e.GetType()!=y.b2_staticBody&&e.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},M.prototype.SolveTOI=function(t){var e,i,o,n,r,a,h,l=this.m_island;l.Initialize(this.m_bodyCount,s.b2_maxTOIContactsPerIsland,s.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var c=M.s_queue;for(e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~y.e_islandFlag,e.m_sweep.t0=0;var m;for(m=this.m_contactList;m;m=m.m_next)m.m_flags&=~(T.e_toiFlag|T.e_islandFlag);for(h=this.m_jointList;h;h=h.m_next)h.m_islandFlag=!1;for(var _=0;10>_;_++){var u=null,d=1;for(m=this.m_contactList;m;m=m.m_next)if(m.IsSensor()!=1&&m.IsEnabled()!=0&&m.IsContinuous()!=0){var p=1;if(m.m_flags&T.e_toiFlag)p=m.m_toi;else{if(i=m.m_fixtureA,o=m.m_fixtureB,n=i.m_body,r=o.m_body,!(n.GetType()==y.b2_dynamicBody&&n.IsAwake()!=0||r.GetType()==y.b2_dynamicBody&&r.IsAwake()!=0))continue;var x=n.m_sweep.t0;r.m_sweep.t0>n.m_sweep.t0?(x=r.m_sweep.t0,n.m_sweep.Advance(x)):n.m_sweep.t0>r.m_sweep.t0&&(x=n.m_sweep.t0,r.m_sweep.Advance(x)),p=m.ComputeTOI(n.m_sweep,r.m_sweep),s.b2Assert(p>=0&&1>=p),p>0&&1>p&&(p=(1-p)*x+p,p>1&&(p=1)),m.m_toi=p,m.m_flags|=T.e_toiFlag}p>Number.MIN_VALUE&&d>p&&(u=m,d=p)}if(u==null||d>1-100*Number.MIN_VALUE)break;if(i=u.m_fixtureA,o=u.m_fixtureB,n=i.m_body,r=o.m_body,M.s_backupA.Set(n.m_sweep),M.s_backupB.Set(r.m_sweep),n.Advance(d),r.Advance(d),u.Update(this.m_contactManager.m_contactListener),u.m_flags&=~T.e_toiFlag,u.IsSensor()!=1&&u.IsEnabled()!=0){if(u.IsTouching()!=0){var f=n;f.GetType()!=y.b2_dynamicBody&&(f=r),l.Clear();var g=0,v=0;c[g+v++]=f,f.m_flags|=y.e_islandFlag;while(v>0)if(e=c[g++],--v,l.AddBody(e),e.IsAwake()==0&&e.SetAwake(!0),e.GetType()==y.b2_dynamicBody){for(a=e.m_contactList;a;a=a.next){if(l.m_contactCount==l.m_contactCapacity)break;if(!(a.contact.m_flags&T.e_islandFlag)&&a.contact.IsSensor()!=1&&a.contact.IsEnabled()!=0&&a.contact.IsTouching()!=0){l.AddContact(a.contact),a.contact.m_flags|=T.e_islandFlag;var b=a.other;b.m_flags&y.e_islandFlag||(b.GetType()!=y.b2_staticBody&&(b.Advance(d),b.SetAwake(!0)),c[g+v]=b,++v,b.m_flags|=y.e_islandFlag)}}for(var C=e.m_jointList;C;C=C.next)l.m_jointCount!=l.m_jointCapacity&&C.joint.m_islandFlag!=1&&(b=C.other,b.IsActive()!=0&&(l.AddJoint(C.joint),C.joint.m_islandFlag=!0,b.m_flags&y.e_islandFlag||(b.GetType()!=y.b2_staticBody&&(b.Advance(d),b.SetAwake(!0)),c[g+v]=b,++v,b.m_flags|=y.e_islandFlag)))}var w=M.s_timestep;w.warmStarting=!1,w.dt=(1-d)*t.dt,w.inv_dt=1/w.dt,w.dtRatio=0,w.velocityIterations=t.velocityIterations,w.positionIterations=t.positionIterations,l.SolveTOI(w);var _=0;for(_=0;l.m_bodyCount>_;++_)if(e=l.m_bodies[_],e.m_flags&=~y.e_islandFlag,e.IsAwake()!=0&&e.GetType()==y.b2_dynamicBody)for(e.SynchronizeFixtures(),a=e.m_contactList;a;a=a.next)a.contact.m_flags&=~T.e_toiFlag;for(_=0;l.m_contactCount>_;++_)m=l.m_contacts[_],m.m_flags&=~(T.e_toiFlag|T.e_islandFlag);for(_=0;l.m_jointCount>_;++_)h=l.m_joints[_],h.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else n.m_sweep.Set(M.s_backupA),r.m_sweep.Set(M.s_backupB),n.SynchronizeTransform(),r.SynchronizeTransform()}},M.prototype.DrawJoint=function(t){var e=t.GetBodyA(),i=t.GetBodyB(),o=e.m_xf,n=i.m_xf,s=o.position,r=n.position,a=t.GetAnchorA(),h=t.GetAnchorB(),l=M.s_jointColor;switch(t.m_type){case V.e_distanceJoint:this.m_debugDraw.DrawSegment(a,h,l);break;case V.e_pulleyJoint:var c=t instanceof R?t:null,m=c.GetGroundAnchorA(),_=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(m,a,l),this.m_debugDraw.DrawSegment(_,h,l),this.m_debugDraw.DrawSegment(m,_,l);break;case V.e_mouseJoint:this.m_debugDraw.DrawSegment(a,h,l);break;default:e!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,a,l),this.m_debugDraw.DrawSegment(a,h,l),i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,h,l)}},M.prototype.DrawShape=function(e,i,o){switch(e.m_type){case p.e_circleShape:var n=e instanceof m?e:null,s=t.MulX(i,n.m_p),r=n.m_radius,a=i.R.col1;this.m_debugDraw.DrawSolidCircle(s,r,a,o);break;case p.e_polygonShape:var h=0,l=e instanceof d?e:null,c=parseInt(l.GetVertexCount()),u=l.GetVertices(),y=new Vector(c);for(h=0;c>h;++h)y[h]=t.MulX(i,u[h]);this.m_debugDraw.DrawSolidPolygon(y,c,o);break;case p.e_edgeShape:var x=e instanceof _?e:null;this.m_debugDraw.DrawSegment(t.MulX(i,x.GetVertex1()),t.MulX(i,x.GetVertex2()),o)}},$i_23.postDefs.push(function(){$i_23.Dynamics.b2World.s_timestep2=new A,$i_23.Dynamics.b2World.s_xf=new i,$i_23.Dynamics.b2World.s_backupA=new e,$i_23.Dynamics.b2World.s_backupB=new e,$i_23.Dynamics.b2World.s_timestep=new A,$i_23.Dynamics.b2World.s_queue=new Vector,$i_23.Dynamics.b2World.s_jointColor=new n(.5,.8,.8),$i_23.Dynamics.b2World.e_newFixture=1,$i_23.Dynamics.b2World.e_locked=2})}(),function(){var t=$i_23.Collision.Shapes.b2CircleShape,e=($i_23.Collision.Shapes.b2EdgeChainDef,$i_23.Collision.Shapes.b2EdgeShape),i=($i_23.Collision.Shapes.b2MassData,$i_23.Collision.Shapes.b2PolygonShape),o=$i_23.Collision.Shapes.b2Shape,n=$i_23.Dynamics.Contacts.b2CircleContact,s=$i_23.Dynamics.Contacts.b2Contact,r=$i_23.Dynamics.Contacts.b2ContactConstraint,a=$i_23.Dynamics.Contacts.b2ContactConstraintPoint,h=$i_23.Dynamics.Contacts.b2ContactEdge,l=$i_23.Dynamics.Contacts.b2ContactFactory,c=$i_23.Dynamics.Contacts.b2ContactRegister,m=$i_23.Dynamics.Contacts.b2ContactResult,_=$i_23.Dynamics.Contacts.b2ContactSolver,u=$i_23.Dynamics.Contacts.b2EdgeAndCircleContact,d=$i_23.Dynamics.Contacts.b2NullContact,p=$i_23.Dynamics.Contacts.b2PolyAndCircleContact,y=$i_23.Dynamics.Contacts.b2PolyAndEdgeContact,x=$i_23.Dynamics.Contacts.b2PolygonContact,f=$i_23.Dynamics.Contacts.b2PositionSolverManifold,g=$i_23.Dynamics.b2Body,v=($i_23.Dynamics.b2BodyDef,$i_23.Dynamics.b2ContactFilter,$i_23.Dynamics.b2ContactImpulse,$i_23.Dynamics.b2ContactListener,$i_23.Dynamics.b2ContactManager,$i_23.Dynamics.b2DebugDraw,$i_23.Dynamics.b2DestructionListener,$i_23.Dynamics.b2FilterData,$i_23.Dynamics.b2Fixture,$i_23.Dynamics.b2FixtureDef,$i_23.Dynamics.b2Island,$i_23.Dynamics.b2TimeStep),b=($i_23.Dynamics.b2World,$i_23.Common.b2Color,$i_23.Common.b2internal,$i_23.Common.b2Settings),C=$i_23.Common.Math.b2Mat22,w=($i_23.Common.Math.b2Mat33,$i_23.Common.Math.b2Math),D=($i_23.Common.Math.b2Sweep,$i_23.Common.Math.b2Transform,$i_23.Common.Math.b2Vec2),S=($i_23.Common.Math.b2Vec3,$i_23.Collision.b2AABB,$i_23.Collision.b2Bound,$i_23.Collision.b2BoundValues,$i_23.Collision.b2Collision),B=$i_23.Collision.b2ContactID,I=($i_23.Collision.b2ContactPoint,$i_23.Collision.b2Distance,$i_23.Collision.b2DistanceInput,$i_23.Collision.b2DistanceOutput,$i_23.Collision.b2DistanceProxy,$i_23.Collision.b2DynamicTree,$i_23.Collision.b2DynamicTreeBroadPhase,$i_23.Collision.b2DynamicTreeNode,$i_23.Collision.b2DynamicTreePair,$i_23.Collision.b2Manifold),A=($i_23.Collision.b2ManifoldPoint,$i_23.Collision.b2Point,$i_23.Collision.b2RayCastInput,$i_23.Collision.b2RayCastOutput,$i_23.Collision.b2Segment,$i_23.Collision.b2SeparationFunction,$i_23.Collision.b2Simplex,$i_23.Collision.b2SimplexCache,$i_23.Collision.b2SimplexVertex,$i_23.Collision.b2TimeOfImpact),M=$i_23.Collision.b2TOIInput,T=$i_23.Collision.b2WorldManifold;$i_23.Collision.ClipVertex,$i_23.Collision.Features,$i_23.Collision.IBroadPhase,$i_23.inherit(n,$i_23.Dynamics.Contacts.b2Contact),n.prototype.__super=$i_23.Dynamics.Contacts.b2Contact.prototype,n.b2CircleContact=function(){$i_23.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},n.Create=function(){return new n},n.Destroy=function(){},n.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},n.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();S.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)},s.b2Contact=function(){this.m_nodeA=new h,this.m_nodeB=new h,this.m_manifold=new I,this.m_oldManifold=new I},s.prototype.GetManifold=function(){return this.m_manifold},s.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),o.m_radius,i.GetTransform(),n.m_radius)},s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag},s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag},s.prototype.SetSensor=function(t){t?this.m_flags|=s.e_sensorFlag:this.m_flags&=~s.e_sensorFlag},s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag},s.prototype.SetEnabled=function(t){t?this.m_flags|=s.e_enabledFlag:this.m_flags&=~s.e_enabledFlag},s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag},s.prototype.GetNext=function(){return this.m_next},s.prototype.GetFixtureA=function(){return this.m_fixtureA},s.prototype.GetFixtureB=function(){return this.m_fixtureB},s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag},s.prototype.b2Contact=function(){},s.prototype.Reset=function(t,e){if(t===void 0&&(t=null),e===void 0&&(e=null),this.m_flags=s.e_enabledFlag,!t||!e)return this.m_fixtureA=null,this.m_fixtureB=null,void 0;(t.IsSensor()||e.IsSensor())&&(this.m_flags|=s.e_sensorFlag);var i=t.GetBody(),o=e.GetBody();(i.GetType()!=g.b2_dynamicBody||i.IsBullet()||o.GetType()!=g.b2_dynamicBody||o.IsBullet())&&(this.m_flags|=s.e_continuousFlag),this.m_fixtureA=t,this.m_fixtureB=e,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},s.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_flags|=s.e_enabledFlag;var i=!1,n=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag,r=this.m_fixtureA.m_body,a=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag){if(h){var l=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape(),m=r.GetTransform(),_=a.GetTransform();i=o.TestOverlap(l,m,c,_)}this.m_manifold.m_pointCount=0}else{if(r.GetType()!=g.b2_dynamicBody||r.IsBullet()||a.GetType()!=g.b2_dynamicBody||a.IsBullet()?this.m_flags|=s.e_continuousFlag:this.m_flags&=~s.e_continuousFlag,h){this.Evaluate(),i=this.m_manifold.m_pointCount>0;for(var u=0;this.m_manifold.m_pointCount>u;++u){var d=this.m_manifold.m_points[u];d.m_normalImpulse=0,d.m_tangentImpulse=0;for(var p=d.m_id,y=0;this.m_oldManifold.m_pointCount>y;++y){var x=this.m_oldManifold.m_points[y];if(x.m_id.key==p.key){d.m_normalImpulse=x.m_normalImpulse,d.m_tangentImpulse=x.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;i!=n&&(r.SetAwake(!0),a.SetAwake(!0))}i?this.m_flags|=s.e_touchingFlag:this.m_flags&=~s.e_touchingFlag,n==0&&i==1&&t.BeginContact(this),n==1&&i==0&&t.EndContact(this),(this.m_flags&s.e_sensorFlag)==0&&t.PreSolve(this,this.m_oldManifold)},s.prototype.Evaluate=function(){},s.prototype.ComputeTOI=function(t,e){return s.s_input.proxyA.Set(this.m_fixtureA.GetShape()),s.s_input.proxyB.Set(this.m_fixtureB.GetShape()),s.s_input.sweepA=t,s.s_input.sweepB=e,s.s_input.tolerance=b.b2_linearSlop,A.TimeOfImpact(s.s_input)},$i_23.postDefs.push(function(){$i_23.Dynamics.Contacts.b2Contact.e_sensorFlag=1,$i_23.Dynamics.Contacts.b2Contact.e_continuousFlag=2,$i_23.Dynamics.Contacts.b2Contact.e_islandFlag=4,$i_23.Dynamics.Contacts.b2Contact.e_toiFlag=8,$i_23.Dynamics.Contacts.b2Contact.e_touchingFlag=16,$i_23.Dynamics.Contacts.b2Contact.e_enabledFlag=32,$i_23.Dynamics.Contacts.b2Contact.e_filterFlag=64,$i_23.Dynamics.Contacts.b2Contact.s_input=new M}),r.b2ContactConstraint=function(){this.localPlaneNormal=new D,this.localPoint=new D,this.normal=new D,this.normalMass=new C,this.K=new C},r.prototype.b2ContactConstraint=function(){this.points=new Vector(b.b2_maxManifoldPoints);for(var t=0;b.b2_maxManifoldPoints>t;t++)this.points[t]=new a},a.b2ContactConstraintPoint=function(){this.localPoint=new D,this.rA=new D,this.rB=new D},h.b2ContactEdge=function(){},l.b2ContactFactory=function(){},l.prototype.b2ContactFactory=function(t){this.m_allocator=t,this.InitializeRegisters()},l.prototype.AddType=function(t,e,i,o){i===void 0&&(i=0),o===void 0&&(o=0),this.m_registers[i][o].createFcn=t,this.m_registers[i][o].destroyFcn=e,this.m_registers[i][o].primary=!0,i!=o&&(this.m_registers[o][i].createFcn=t,this.m_registers[o][i].destroyFcn=e,this.m_registers[o][i].primary=!1)},l.prototype.InitializeRegisters=function(){this.m_registers=new Vector(o.e_shapeTypeCount);for(var t=0;o.e_shapeTypeCount>t;t++){this.m_registers[t]=new Vector(o.e_shapeTypeCount);for(var e=0;o.e_shapeTypeCount>e;e++)this.m_registers[t][e]=new c}this.AddType(n.Create,n.Destroy,o.e_circleShape,o.e_circleShape),this.AddType(p.Create,p.Destroy,o.e_polygonShape,o.e_circleShape),this.AddType(x.Create,x.Destroy,o.e_polygonShape,o.e_polygonShape),this.AddType(u.Create,u.Destroy,o.e_edgeShape,o.e_circleShape),this.AddType(y.Create,y.Destroy,o.e_polygonShape,o.e_edgeShape)},l.prototype.Create=function(t,e){var i,o=parseInt(t.GetType()),n=parseInt(e.GetType()),s=this.m_registers[o][n];if(s.pool)return i=s.pool,s.pool=i.m_next,s.poolCount--,i.Reset(t,e),i;var r=s.createFcn;return r!=null?s.primary?(i=r(this.m_allocator),i.Reset(t,e),i):(i=r(this.m_allocator),i.Reset(e,t),i):null},l.prototype.Destroy=function(t){t.m_manifold.m_pointCount>0&&(t.m_fixtureA.m_body.SetAwake(!0),t.m_fixtureB.m_body.SetAwake(!0));var e=parseInt(t.m_fixtureA.GetType()),i=parseInt(t.m_fixtureB.GetType()),o=this.m_registers[e][i];o.poolCount++,t.m_next=o.pool,o.pool=t;var n=o.destroyFcn;n(t,this.m_allocator)},c.b2ContactRegister=function(){},m.b2ContactResult=function(){this.position=new D,this.normal=new D,this.id=new B},_.b2ContactSolver=function(){this.m_step=new v,this.m_constraints=new Vector},_.prototype.b2ContactSolver=function(){},_.prototype.Initialize=function(t,e,i,o){i===void 0&&(i=0);var n;this.m_step.Set(t),this.m_allocator=o;var s=0;this.m_constraintCount=i;while(this.m_constraintCount>this.m_constraints.length)this.m_constraints[this.m_constraints.length]=new r;for(s=0;i>s;++s){n=e[s];var a=n.m_fixtureA,h=n.m_fixtureB,l=a.m_shape,c=h.m_shape,m=l.m_radius,u=c.m_radius,d=a.m_body,p=h.m_body,y=n.GetManifold(),x=b.b2MixFriction(a.GetFriction(),h.GetFriction()),f=b.b2MixRestitution(a.GetRestitution(),h.GetRestitution()),g=d.m_linearVelocity.x,v=d.m_linearVelocity.y,C=p.m_linearVelocity.x,w=p.m_linearVelocity.y,D=d.m_angularVelocity,S=p.m_angularVelocity;b.b2Assert(y.m_pointCount>0),_.s_worldManifold.Initialize(y,d.m_xf,m,p.m_xf,u);var B=_.s_worldManifold.m_normal.x,I=_.s_worldManifold.m_normal.y,A=this.m_constraints[s];A.bodyA=d,A.bodyB=p,A.manifold=y,A.normal.x=B,A.normal.y=I,A.pointCount=y.m_pointCount,A.friction=x,A.restitution=f,A.localPlaneNormal.x=y.m_localPlaneNormal.x,A.localPlaneNormal.y=y.m_localPlaneNormal.y,A.localPoint.x=y.m_localPoint.x,A.localPoint.y=y.m_localPoint.y,A.radius=m+u,A.type=y.m_type;for(var M=0;A.pointCount>M;++M){var T=y.m_points[M],P=A.points[M];P.normalImpulse=T.m_normalImpulse,P.tangentImpulse=T.m_tangentImpulse,P.localPoint.SetV(T.m_localPoint);var k=P.rA.x=_.s_worldManifold.m_points[M].x-d.m_sweep.c.x,V=P.rA.y=_.s_worldManifold.m_points[M].y-d.m_sweep.c.y,R=P.rB.x=_.s_worldManifold.m_points[M].x-p.m_sweep.c.x,L=P.rB.y=_.s_worldManifold.m_points[M].y-p.m_sweep.c.y,F=k*I-V*B,E=R*I-L*B;F*=F,E*=E;var G=d.m_invMass+p.m_invMass+d.m_invI*F+p.m_invI*E;P.normalMass=1/G;var z=d.m_mass*d.m_invMass+p.m_mass*p.m_invMass;z+=d.m_mass*d.m_invI*F+p.m_mass*p.m_invI*E,P.equalizedMass=1/z;var J=I,O=-B,N=k*O-V*J,U=R*O-L*J;N*=N,U*=U;var j=d.m_invMass+p.m_invMass+d.m_invI*N+p.m_invI*U;P.tangentMass=1/j,P.velocityBias=0;var W=C+-S*L-g- -D*V,q=w+S*R-v-D*k,$=A.normal.x*W+A.normal.y*q;-b.b2_velocityThreshold>$&&(P.velocityBias+=-A.restitution*$)}if(A.pointCount==2){var X=A.points[0],H=A.points[1],K=d.m_invMass,Y=d.m_invI,Z=p.m_invMass,Q=p.m_invI,te=X.rA.x*I-X.rA.y*B,ee=X.rB.x*I-X.rB.y*B,ie=H.rA.x*I-H.rA.y*B,oe=H.rB.x*I-H.rB.y*B,ne=K+Z+Y*te*te+Q*ee*ee,se=K+Z+Y*ie*ie+Q*oe*oe,re=K+Z+Y*te*ie+Q*ee*oe,ae=100;ae*(ne*se-re*re)>ne*ne?(A.K.col1.Set(ne,re),A.K.col2.Set(re,se),A.K.GetInverse(A.normalMass)):A.pointCount=1}}},_.prototype.InitVelocityConstraints=function(t){for(var e=0;this.m_constraintCount>e;++e){var i=this.m_constraints[e],o=i.bodyA,n=i.bodyB,s=o.m_invMass,r=o.m_invI,a=n.m_invMass,h=n.m_invI,l=i.normal.x,c=i.normal.y,m=c,_=-l,u=0,d=0;if(t.warmStarting)for(d=i.pointCount,u=0;d>u;++u){var p=i.points[u];p.normalImpulse*=t.dtRatio,p.tangentImpulse*=t.dtRatio;var y=p.normalImpulse*l+p.tangentImpulse*m,x=p.normalImpulse*c+p.tangentImpulse*_;o.m_angularVelocity-=r*(p.rA.x*x-p.rA.y*y),o.m_linearVelocity.x-=s*y,o.m_linearVelocity.y-=s*x,n.m_angularVelocity+=h*(p.rB.x*x-p.rB.y*y),n.m_linearVelocity.x+=a*y,n.m_linearVelocity.y+=a*x}else for(d=i.pointCount,u=0;d>u;++u){var f=i.points[u];f.normalImpulse=0,f.tangentImpulse=0}}},_.prototype.SolveVelocityConstraints=function(){for(var t,e,i=0,o=0,n=0,s=0,r=0,a=0,h=0,l=0,c=0,m=0,_=0,u=0,d=0,p=0,y=0,x=0,f=0;this.m_constraintCount>f;++f){var g=this.m_constraints[f],v=g.bodyA,b=g.bodyB,C=v.m_angularVelocity,D=b.m_angularVelocity,S=v.m_linearVelocity,B=b.m_linearVelocity,I=v.m_invMass,A=v.m_invI,M=b.m_invMass,T=b.m_invI,P=g.normal.x,k=g.normal.y,V=k,R=-P,L=g.friction;for(i=0;g.pointCount>i;i++)t=g.points[i],o=B.x-D*t.rB.y-S.x+C*t.rA.y,n=B.y+D*t.rB.x-S.y-C*t.rA.x,r=o*V+n*R,a=t.tangentMass*-r,h=L*t.normalImpulse,l=w.Clamp(t.tangentImpulse+a,-h,h),a=l-t.tangentImpulse,c=a*V,m=a*R,S.x-=I*c,S.y-=I*m,C-=A*(t.rA.x*m-t.rA.y*c),B.x+=M*c,B.y+=M*m,D+=T*(t.rB.x*m-t.rB.y*c),t.tangentImpulse=l;if(parseInt(g.pointCount),g.pointCount==1)t=g.points[0],o=B.x+-D*t.rB.y-S.x- -C*t.rA.y,n=B.y+D*t.rB.x-S.y-C*t.rA.x,s=o*P+n*k,a=-t.normalMass*(s-t.velocityBias),l=t.normalImpulse+a,l=l>0?l:0,a=l-t.normalImpulse,c=a*P,m=a*k,S.x-=I*c,S.y-=I*m,C-=A*(t.rA.x*m-t.rA.y*c),B.x+=M*c,B.y+=M*m,D+=T*(t.rB.x*m-t.rB.y*c),t.normalImpulse=l;
else{var F=g.points[0],E=g.points[1],G=F.normalImpulse,z=E.normalImpulse,J=B.x-D*F.rB.y-S.x+C*F.rA.y,O=B.y+D*F.rB.x-S.y-C*F.rA.x,N=B.x-D*E.rB.y-S.x+C*E.rA.y,U=B.y+D*E.rB.x-S.y-C*E.rA.x,j=J*P+O*k,W=N*P+U*k,q=j-F.velocityBias,$=W-E.velocityBias;for(e=g.K,q-=e.col1.x*G+e.col2.x*z,$-=e.col1.y*G+e.col2.y*z;;){e=g.normalMass;var X=-(e.col1.x*q+e.col2.x*$),H=-(e.col1.y*q+e.col2.y*$);if(X>=0&&H>=0){_=X-G,u=H-z,d=_*P,p=_*k,y=u*P,x=u*k,S.x-=I*(d+y),S.y-=I*(p+x),C-=A*(F.rA.x*p-F.rA.y*d+E.rA.x*x-E.rA.y*y),B.x+=M*(d+y),B.y+=M*(p+x),D+=T*(F.rB.x*p-F.rB.y*d+E.rB.x*x-E.rB.y*y),F.normalImpulse=X,E.normalImpulse=H;break}if(X=-F.normalMass*q,H=0,j=0,W=g.K.col1.y*X+$,X>=0&&W>=0){_=X-G,u=H-z,d=_*P,p=_*k,y=u*P,x=u*k,S.x-=I*(d+y),S.y-=I*(p+x),C-=A*(F.rA.x*p-F.rA.y*d+E.rA.x*x-E.rA.y*y),B.x+=M*(d+y),B.y+=M*(p+x),D+=T*(F.rB.x*p-F.rB.y*d+E.rB.x*x-E.rB.y*y),F.normalImpulse=X,E.normalImpulse=H;break}if(X=0,H=-E.normalMass*$,j=g.K.col2.x*H+q,W=0,H>=0&&j>=0){_=X-G,u=H-z,d=_*P,p=_*k,y=u*P,x=u*k,S.x-=I*(d+y),S.y-=I*(p+x),C-=A*(F.rA.x*p-F.rA.y*d+E.rA.x*x-E.rA.y*y),B.x+=M*(d+y),B.y+=M*(p+x),D+=T*(F.rB.x*p-F.rB.y*d+E.rB.x*x-E.rB.y*y),F.normalImpulse=X,E.normalImpulse=H;break}if(X=0,H=0,j=q,W=$,j>=0&&W>=0){_=X-G,u=H-z,d=_*P,p=_*k,y=u*P,x=u*k,S.x-=I*(d+y),S.y-=I*(p+x),C-=A*(F.rA.x*p-F.rA.y*d+E.rA.x*x-E.rA.y*y),B.x+=M*(d+y),B.y+=M*(p+x),D+=T*(F.rB.x*p-F.rB.y*d+E.rB.x*x-E.rB.y*y),F.normalImpulse=X,E.normalImpulse=H;break}break}}v.m_angularVelocity=C,b.m_angularVelocity=D}},_.prototype.FinalizeVelocityConstraints=function(){for(var t=0;this.m_constraintCount>t;++t)for(var e=this.m_constraints[t],i=e.manifold,o=0;e.pointCount>o;++o){var n=i.m_points[o],s=e.points[o];n.m_normalImpulse=s.normalImpulse,n.m_tangentImpulse=s.tangentImpulse}},_.prototype.SolvePositionConstraints=function(t){t===void 0&&(t=0);for(var e=0,i=0;this.m_constraintCount>i;i++){var o=this.m_constraints[i],n=o.bodyA,s=o.bodyB,r=n.m_mass*n.m_invMass,a=n.m_mass*n.m_invI,h=s.m_mass*s.m_invMass,l=s.m_mass*s.m_invI;_.s_psm.Initialize(o);for(var c=_.s_psm.m_normal,m=0;o.pointCount>m;m++){var u=o.points[m],d=_.s_psm.m_points[m],p=_.s_psm.m_separations[m],y=d.x-n.m_sweep.c.x,x=d.y-n.m_sweep.c.y,f=d.x-s.m_sweep.c.x,g=d.y-s.m_sweep.c.y;e=p>e?e:p;var v=w.Clamp(t*(p+b.b2_linearSlop),-b.b2_maxLinearCorrection,0),C=-u.equalizedMass*v,D=C*c.x,S=C*c.y;n.m_sweep.c.x-=r*D,n.m_sweep.c.y-=r*S,n.m_sweep.a-=a*(y*S-x*D),n.SynchronizeTransform(),s.m_sweep.c.x+=h*D,s.m_sweep.c.y+=h*S,s.m_sweep.a+=l*(f*S-g*D),s.SynchronizeTransform()}}return e>-1.5*b.b2_linearSlop},$i_23.postDefs.push(function(){$i_23.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new T,$i_23.Dynamics.Contacts.b2ContactSolver.s_psm=new f}),$i_23.inherit(u,$i_23.Dynamics.Contacts.b2Contact),u.prototype.__super=$i_23.Dynamics.Contacts.b2Contact.prototype,u.b2EdgeAndCircleContact=function(){$i_23.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},u.Create=function(){return new u},u.Destroy=function(){},u.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},u.prototype.Evaluate=function(){var i=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,o.m_xf)},u.prototype.b2CollideEdgeAndCircle=function(){},$i_23.inherit(d,$i_23.Dynamics.Contacts.b2Contact),d.prototype.__super=$i_23.Dynamics.Contacts.b2Contact.prototype,d.b2NullContact=function(){$i_23.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},d.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},d.prototype.Evaluate=function(){},$i_23.inherit(p,$i_23.Dynamics.Contacts.b2Contact),p.prototype.__super=$i_23.Dynamics.Contacts.b2Contact.prototype,p.b2PolyAndCircleContact=function(){$i_23.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.Create=function(){return new p},p.Destroy=function(){},p.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),b.b2Assert(t.GetType()==o.e_polygonShape),b.b2Assert(e.GetType()==o.e_circleShape)},p.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body;S.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,o.m_xf)},$i_23.inherit(y,$i_23.Dynamics.Contacts.b2Contact),y.prototype.__super=$i_23.Dynamics.Contacts.b2Contact.prototype,y.b2PolyAndEdgeContact=function(){$i_23.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(){return new y},y.Destroy=function(){},y.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),b.b2Assert(t.GetType()==o.e_polygonShape),b.b2Assert(e.GetType()==o.e_edgeShape)},y.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,o.m_xf)},y.prototype.b2CollidePolyAndEdge=function(){},$i_23.inherit(x,$i_23.Dynamics.Contacts.b2Contact),x.prototype.__super=$i_23.Dynamics.Contacts.b2Contact.prototype,x.b2PolygonContact=function(){$i_23.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},x.Create=function(){return new x},x.Destroy=function(){},x.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},x.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();S.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)},f.b2PositionSolverManifold=function(){},f.prototype.b2PositionSolverManifold=function(){this.m_normal=new D,this.m_separations=new Vector_a2j_Number(b.b2_maxManifoldPoints),this.m_points=new Vector(b.b2_maxManifoldPoints);for(var t=0;b.b2_maxManifoldPoints>t;t++)this.m_points[t]=new D},f.prototype.Initialize=function(t){b.b2Assert(t.pointCount>0);var e,i,o=0,n=0,s=0,r=0,a=0;switch(t.type){case I.e_circles:e=t.bodyA.m_xf.R,i=t.localPoint;var h=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),l=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y);e=t.bodyB.m_xf.R,i=t.points[0].localPoint;var c=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),m=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),_=c-h,u=m-l,d=_*_+u*u;if(d>Number.MIN_VALUE*Number.MIN_VALUE){var p=Math.sqrt(d);this.m_normal.x=_/p,this.m_normal.y=u/p}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(h+c),this.m_points[0].y=.5*(l+m),this.m_separations[0]=_*this.m_normal.x+u*this.m_normal.y-t.radius;break;case I.e_faceA:for(e=t.bodyA.m_xf.R,i=t.localPlaneNormal,this.m_normal.x=e.col1.x*i.x+e.col2.x*i.y,this.m_normal.y=e.col1.y*i.x+e.col2.y*i.y,e=t.bodyA.m_xf.R,i=t.localPoint,r=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),a=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),e=t.bodyB.m_xf.R,o=0;t.pointCount>o;++o)i=t.points[o].localPoint,n=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),s=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),this.m_separations[o]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius,this.m_points[o].x=n,this.m_points[o].y=s;break;case I.e_faceB:for(e=t.bodyB.m_xf.R,i=t.localPlaneNormal,this.m_normal.x=e.col1.x*i.x+e.col2.x*i.y,this.m_normal.y=e.col1.y*i.x+e.col2.y*i.y,e=t.bodyB.m_xf.R,i=t.localPoint,r=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),a=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),e=t.bodyA.m_xf.R,o=0;t.pointCount>o;++o)i=t.points[o].localPoint,n=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),s=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),this.m_separations[o]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius,this.m_points[o].Set(n,s);this.m_normal.x*=-1,this.m_normal.y*=-1}},$i_23.postDefs.push(function(){$i_23.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new D,$i_23.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new D})}(),function(){var t=($i_23.Dynamics.b2Body,$i_23.Dynamics.b2BodyDef,$i_23.Dynamics.b2ContactFilter,$i_23.Dynamics.b2ContactImpulse,$i_23.Dynamics.b2ContactListener,$i_23.Dynamics.b2ContactManager,$i_23.Dynamics.b2DebugDraw,$i_23.Dynamics.b2DestructionListener,$i_23.Dynamics.b2FilterData,$i_23.Dynamics.b2Fixture,$i_23.Dynamics.b2FixtureDef,$i_23.Dynamics.b2Island,$i_23.Dynamics.b2TimeStep,$i_23.Dynamics.b2World,$i_23.Common.Math.b2Mat22),e=($i_23.Common.Math.b2Mat33,$i_23.Common.Math.b2Math),i=($i_23.Common.Math.b2Sweep,$i_23.Common.Math.b2Transform,$i_23.Common.Math.b2Vec2),o=($i_23.Common.Math.b2Vec3,$i_23.Common.b2Color),n=($i_23.Common.b2internal,$i_23.Common.b2Settings,$i_23.Collision.Shapes.b2CircleShape,$i_23.Collision.Shapes.b2EdgeChainDef,$i_23.Collision.Shapes.b2EdgeShape,$i_23.Collision.Shapes.b2MassData,$i_23.Collision.Shapes.b2PolygonShape,$i_23.Collision.Shapes.b2Shape,$i_23.Dynamics.Controllers.b2BuoyancyController),s=$i_23.Dynamics.Controllers.b2ConstantAccelController,r=$i_23.Dynamics.Controllers.b2ConstantForceController,a=$i_23.Dynamics.Controllers.b2Controller,h=$i_23.Dynamics.Controllers.b2ControllerEdge,l=$i_23.Dynamics.Controllers.b2GravityController,c=$i_23.Dynamics.Controllers.b2TensorDampingController;$i_23.inherit(n,$i_23.Dynamics.Controllers.b2Controller),n.prototype.__super=$i_23.Dynamics.Controllers.b2Controller.prototype,n.b2BuoyancyController=function(){$i_23.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new i(0,-1),this.offset=0,this.density=0,this.velocity=new i(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},n.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(e.IsAwake()!=0){for(var o=new i,n=new i,s=0,r=0,a=e.GetFixtureList();a;a=a.GetNext()){var h=new i,l=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),h);s+=l,o.x+=l*h.x,o.y+=l*h.y;var c=0;c=this.useDensity?1:1,r+=l*c,n.x+=l*h.x*c,n.y+=l*h.y*c}if(o.x/=s,o.y/=s,n.x/=r,n.y/=r,s>=Number.MIN_VALUE){var m=this.gravity.GetNegative();m.Multiply(this.density*s),e.ApplyForce(m,n);var _=e.GetLinearVelocityFromWorldPoint(o);_.Subtract(this.velocity),_.Multiply(-this.linearDrag*s),e.ApplyForce(_,o),e.ApplyTorque(-e.GetInertia()/e.GetMass()*s*e.GetAngularVelocity()*this.angularDrag)}}}}},n.prototype.Draw=function(t){var e=1e3,n=new i,s=new i;n.x=this.normal.x*this.offset+this.normal.y*e,n.y=this.normal.y*this.offset-this.normal.x*e,s.x=this.normal.x*this.offset-this.normal.y*e,s.y=this.normal.y*this.offset+this.normal.x*e;var r=new o(0,0,1);t.DrawSegment(n,s,r)},$i_23.inherit(s,$i_23.Dynamics.Controllers.b2Controller),s.prototype.__super=$i_23.Dynamics.Controllers.b2Controller.prototype,s.b2ConstantAccelController=function(){$i_23.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new i(0,0)},s.prototype.Step=function(t){for(var e=new i(this.A.x*t.dt,this.A.y*t.dt),o=this.m_bodyList;o;o=o.nextBody){var n=o.body;n.IsAwake()&&n.SetLinearVelocity(new i(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}},$i_23.inherit(r,$i_23.Dynamics.Controllers.b2Controller),r.prototype.__super=$i_23.Dynamics.Controllers.b2Controller.prototype,r.b2ConstantForceController=function(){$i_23.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new i(0,0)},r.prototype.Step=function(){for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}},a.b2Controller=function(){},a.prototype.Step=function(){},a.prototype.Draw=function(){},a.prototype.AddBody=function(t){var e=new h;e.controller=this,e.body=t,e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList=e,e.nextBody&&(e.nextBody.prevBody=e),this.m_bodyCount++,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList=e,e.nextController&&(e.nextController.prevController=e),t.m_controllerCount++},a.prototype.RemoveBody=function(t){var e=t.m_controllerList;while(e&&e.controller!=this)e=e.nextController;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),this.m_bodyList==e&&(this.m_bodyList=e.nextBody),t.m_controllerList==e&&(t.m_controllerList=e.nextController),t.m_controllerCount--,this.m_bodyCount--},a.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)},a.prototype.GetNext=function(){return this.m_next},a.prototype.GetWorld=function(){return this.m_world},a.prototype.GetBodyList=function(){return this.m_bodyList},h.b2ControllerEdge=function(){},$i_23.inherit(l,$i_23.Dynamics.Controllers.b2Controller),l.prototype.__super=$i_23.Dynamics.Controllers.b2Controller.prototype,l.b2GravityController=function(){$i_23.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},l.prototype.Step=function(){var t=null,e=null,o=null,n=0,s=null,r=null,a=null,h=0,l=0,c=0,m=null;if(this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody)for(e=t.body,o=e.GetWorldCenter(),n=e.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody)r=s.body,a=r.GetWorldCenter(),h=a.x-o.x,l=a.y-o.y,c=h*h+l*l,Number.MIN_VALUE>c||(m=new i(h,l),m.Multiply(this.G/c/Math.sqrt(c)*n*r.GetMass()),e.IsAwake()&&e.ApplyForce(m,o),m.Multiply(-1),r.IsAwake()&&r.ApplyForce(m,a));else for(t=this.m_bodyList;t;t=t.nextBody)for(e=t.body,o=e.GetWorldCenter(),n=e.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody)r=s.body,a=r.GetWorldCenter(),h=a.x-o.x,l=a.y-o.y,c=h*h+l*l,Number.MIN_VALUE>c||(m=new i(h,l),m.Multiply(this.G/c*n*r.GetMass()),e.IsAwake()&&e.ApplyForce(m,o),m.Multiply(-1),r.IsAwake()&&r.ApplyForce(m,a))},$i_23.inherit(c,$i_23.Dynamics.Controllers.b2Controller),c.prototype.__super=$i_23.Dynamics.Controllers.b2Controller.prototype,c.b2TensorDampingController=function(){$i_23.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new t,this.maxTimestep=0},c.prototype.SetAxisAligned=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-e,this.maxTimestep=t>0||e>0?1/Math.max(t,e):0},c.prototype.Step=function(t){var o=t.dt;if(o>Number.MIN_VALUE){o>this.maxTimestep&&this.maxTimestep>0&&(o=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var s=n.body;if(s.IsAwake()){var r=s.GetWorldVector(e.MulMV(this.T,s.GetLocalVector(s.GetLinearVelocity())));s.SetLinearVelocity(new i(s.GetLinearVelocity().x+r.x*o,s.GetLinearVelocity().y+r.y*o))}}}}}(),function(){var t=($i_23.Common.b2Color,$i_23.Common.b2internal,$i_23.Common.b2Settings),e=$i_23.Common.Math.b2Mat22,i=$i_23.Common.Math.b2Mat33,o=$i_23.Common.Math.b2Math,n=($i_23.Common.Math.b2Sweep,$i_23.Common.Math.b2Transform,$i_23.Common.Math.b2Vec2),s=$i_23.Common.Math.b2Vec3,r=$i_23.Dynamics.Joints.b2DistanceJoint,a=$i_23.Dynamics.Joints.b2DistanceJointDef,h=$i_23.Dynamics.Joints.b2FrictionJoint,l=$i_23.Dynamics.Joints.b2FrictionJointDef,c=$i_23.Dynamics.Joints.b2GearJoint,m=$i_23.Dynamics.Joints.b2GearJointDef,_=$i_23.Dynamics.Joints.b2Jacobian,u=$i_23.Dynamics.Joints.b2Joint,d=$i_23.Dynamics.Joints.b2JointDef,p=$i_23.Dynamics.Joints.b2JointEdge,y=$i_23.Dynamics.Joints.b2LineJoint,x=$i_23.Dynamics.Joints.b2LineJointDef,f=$i_23.Dynamics.Joints.b2MouseJoint,g=$i_23.Dynamics.Joints.b2MouseJointDef,v=$i_23.Dynamics.Joints.b2PrismaticJoint,b=$i_23.Dynamics.Joints.b2PrismaticJointDef,C=$i_23.Dynamics.Joints.b2PulleyJoint,w=$i_23.Dynamics.Joints.b2PulleyJointDef,D=$i_23.Dynamics.Joints.b2RevoluteJoint,S=$i_23.Dynamics.Joints.b2RevoluteJointDef,B=$i_23.Dynamics.Joints.b2WeldJoint,I=$i_23.Dynamics.Joints.b2WeldJointDef;$i_23.Dynamics.b2Body,$i_23.Dynamics.b2BodyDef,$i_23.Dynamics.b2ContactFilter,$i_23.Dynamics.b2ContactImpulse,$i_23.Dynamics.b2ContactListener,$i_23.Dynamics.b2ContactManager,$i_23.Dynamics.b2DebugDraw,$i_23.Dynamics.b2DestructionListener,$i_23.Dynamics.b2FilterData,$i_23.Dynamics.b2Fixture,$i_23.Dynamics.b2FixtureDef,$i_23.Dynamics.b2Island,$i_23.Dynamics.b2TimeStep,$i_23.Dynamics.b2World,$i_23.inherit(r,$i_23.Dynamics.Joints.b2Joint),r.prototype.__super=$i_23.Dynamics.Joints.b2Joint.prototype,r.b2DistanceJoint=function(){$i_23.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u=new n},r.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},r.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},r.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},r.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),0},r.prototype.GetLength=function(){return this.m_length},r.prototype.SetLength=function(t){t===void 0&&(t=0),this.m_length=t},r.prototype.GetFrequency=function(){return this.m_frequencyHz},r.prototype.SetFrequency=function(t){t===void 0&&(t=0),this.m_frequencyHz=t},r.prototype.GetDampingRatio=function(){return this.m_dampingRatio},r.prototype.SetDampingRatio=function(t){t===void 0&&(t=0),this.m_dampingRatio=t},r.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},r.prototype.InitVelocityConstraints=function(e){var i,o=0,n=this.m_bodyA,s=this.m_bodyB;i=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;o=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,r=o,i=s.m_xf.R;var h=this.m_localAnchor2.x-s.m_sweep.localCenter.x,l=this.m_localAnchor2.y-s.m_sweep.localCenter.y;o=i.col1.x*h+i.col2.x*l,l=i.col1.y*h+i.col2.y*l,h=o,this.m_u.x=s.m_sweep.c.x+h-n.m_sweep.c.x-r,this.m_u.y=s.m_sweep.c.y+l-n.m_sweep.c.y-a;var c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);c>t.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero();var m=r*this.m_u.y-a*this.m_u.x,_=h*this.m_u.y-l*this.m_u.x,u=n.m_invMass+n.m_invI*m*m+s.m_invMass+s.m_invI*_*_;if(this.m_mass=u!=0?1/u:0,this.m_frequencyHz>0){var d=c-this.m_length,p=2*Math.PI*this.m_frequencyHz,y=2*this.m_mass*this.m_dampingRatio*p,x=this.m_mass*p*p;this.m_gamma=e.dt*(y+e.dt*x),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=d*e.dt*x*this.m_gamma,this.m_mass=u+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(e.warmStarting){this.m_impulse*=e.dtRatio;var f=this.m_impulse*this.m_u.x,g=this.m_impulse*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*f,n.m_linearVelocity.y-=n.m_invMass*g,n.m_angularVelocity-=n.m_invI*(r*g-a*f),s.m_linearVelocity.x+=s.m_invMass*f,s.m_linearVelocity.y+=s.m_invMass*g,s.m_angularVelocity+=s.m_invI*(h*g-l*f)}else this.m_impulse=0},r.prototype.SolveVelocityConstraints=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*n;n=t.col1.y*o+t.col2.y*n,o=s,t=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var h=e.m_linearVelocity.x+-e.m_angularVelocity*n,l=e.m_linearVelocity.y+e.m_angularVelocity*o,c=i.m_linearVelocity.x+-i.m_angularVelocity*a,m=i.m_linearVelocity.y+i.m_angularVelocity*r,_=this.m_u.x*(c-h)+this.m_u.y*(m-l),u=-this.m_mass*(_+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var d=u*this.m_u.x,p=u*this.m_u.y;e.m_linearVelocity.x-=e.m_invMass*d,e.m_linearVelocity.y-=e.m_invMass*p,e.m_angularVelocity-=e.m_invI*(o*p-n*d),i.m_linearVelocity.x+=i.m_invMass*d,i.m_linearVelocity.y+=i.m_invMass*p,i.m_angularVelocity+=i.m_invI*(r*p-a*d)},r.prototype.SolvePositionConstraints=function(e){e===void 0&&(e=0);var i;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,s=this.m_bodyB;i=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y,h=i.col1.x*r+i.col2.x*a;a=i.col1.y*r+i.col2.y*a,r=h,i=s.m_xf.R;var l=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;h=i.col1.x*l+i.col2.x*c,c=i.col1.y*l+i.col2.y*c,l=h;var m=s.m_sweep.c.x+l-n.m_sweep.c.x-r,_=s.m_sweep.c.y+c-n.m_sweep.c.y-a,u=Math.sqrt(m*m+_*_);m/=u,_/=u;var d=u-this.m_length;d=o.Clamp(d,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var p=-this.m_mass*d;this.m_u.Set(m,_);var y=p*this.m_u.x,x=p*this.m_u.y;return n.m_sweep.c.x-=n.m_invMass*y,n.m_sweep.c.y-=n.m_invMass*x,n.m_sweep.a-=n.m_invI*(r*x-a*y),s.m_sweep.c.x+=s.m_invMass*y,s.m_sweep.c.y+=s.m_invMass*x,s.m_sweep.a+=s.m_invI*(l*x-c*y),n.SynchronizeTransform(),s.SynchronizeTransform(),t.b2_linearSlop>o.Abs(d)},$i_23.inherit(a,$i_23.Dynamics.Joints.b2JointDef),a.prototype.__super=$i_23.Dynamics.Joints.b2JointDef.prototype,a.b2DistanceJointDef=function(){$i_23.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},a.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},a.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o));var n=o.x-i.x,s=o.y-i.y;this.length=Math.sqrt(n*n+s*s),this.frequencyHz=0,this.dampingRatio=0},$i_23.inherit(h,$i_23.Dynamics.Joints.b2Joint),h.prototype.__super=$i_23.Dynamics.Joints.b2Joint.prototype,h.b2FrictionJoint=function(){$i_23.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_linearMass=new e,this.m_linearImpulse=new n},h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},h.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},h.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_angularImpulse},h.prototype.SetMaxForce=function(t){t===void 0&&(t=0),this.m_maxForce=t},h.prototype.GetMaxForce=function(){return this.m_maxForce},h.prototype.SetMaxTorque=function(t){t===void 0&&(t=0),this.m_maxTorque=t},h.prototype.GetMaxTorque=function(){return this.m_maxTorque},h.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},h.prototype.InitVelocityConstraints=function(t){var i,o=0,n=this.m_bodyA,s=this.m_bodyB;i=n.m_xf.R;var r=this.m_localAnchorA.x-n.m_sweep.localCenter.x,a=this.m_localAnchorA.y-n.m_sweep.localCenter.y;o=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,r=o,i=s.m_xf.R;var h=this.m_localAnchorB.x-s.m_sweep.localCenter.x,l=this.m_localAnchorB.y-s.m_sweep.localCenter.y;o=i.col1.x*h+i.col2.x*l,l=i.col1.y*h+i.col2.y*l,h=o;var c=n.m_invMass,m=s.m_invMass,_=n.m_invI,u=s.m_invI,d=new e;if(d.col1.x=c+m,d.col2.x=0,d.col1.y=0,d.col2.y=c+m,d.col1.x+=_*a*a,d.col2.x+=-_*r*a,d.col1.y+=-_*r*a,d.col2.y+=_*r*r,d.col1.x+=u*l*l,d.col2.x+=-u*h*l,d.col1.y+=-u*h*l,d.col2.y+=u*h*h,d.GetInverse(this.m_linearMass),this.m_angularMass=_+u,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio;var p=this.m_linearImpulse;n.m_linearVelocity.x-=c*p.x,n.m_linearVelocity.y-=c*p.y,n.m_angularVelocity-=_*(r*p.y-a*p.x+this.m_angularImpulse),s.m_linearVelocity.x+=m*p.x,s.m_linearVelocity.y+=m*p.y,s.m_angularVelocity+=u*(h*p.y-l*p.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},h.prototype.SolveVelocityConstraints=function(t){var e,i=0,s=this.m_bodyA,r=this.m_bodyB,a=s.m_linearVelocity,h=s.m_angularVelocity,l=r.m_linearVelocity,c=r.m_angularVelocity,m=s.m_invMass,_=r.m_invMass,u=s.m_invI,d=r.m_invI;e=s.m_xf.R;var p=this.m_localAnchorA.x-s.m_sweep.localCenter.x,y=this.m_localAnchorA.y-s.m_sweep.localCenter.y;i=e.col1.x*p+e.col2.x*y,y=e.col1.y*p+e.col2.y*y,p=i,e=r.m_xf.R;var x=this.m_localAnchorB.x-r.m_sweep.localCenter.x,f=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*x+e.col2.x*f,f=e.col1.y*x+e.col2.y*f,x=i;var g=0,v=c-h,b=-this.m_angularMass*v,C=this.m_angularImpulse;g=t.dt*this.m_maxTorque,this.m_angularImpulse=o.Clamp(this.m_angularImpulse+b,-g,g),b=this.m_angularImpulse-C,h-=u*b,c+=d*b;var w=l.x-c*f-a.x+h*y,D=l.y+c*x-a.y-h*p,S=o.MulMV(this.m_linearMass,new n(-w,-D)),B=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(S),g=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>g*g&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(g)),S=o.SubtractVV(this.m_linearImpulse,B),a.x-=m*S.x,a.y-=m*S.y,h-=u*(p*S.y-y*S.x),l.x+=_*S.x,l.y+=_*S.y,c+=d*(x*S.y-f*S.x),s.m_angularVelocity=h,r.m_angularVelocity=c},h.prototype.SolvePositionConstraints=function(t){return t===void 0&&(t=0),!0},$i_23.inherit(l,$i_23.Dynamics.Joints.b2JointDef),l.prototype.__super=$i_23.Dynamics.Joints.b2JointDef.prototype,l.b2FrictionJointDef=function(){$i_23.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},l.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_frictionJoint,this.maxForce=0,this.maxTorque=0},l.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))},$i_23.inherit(c,$i_23.Dynamics.Joints.b2Joint),c.prototype.__super=$i_23.Dynamics.Joints.b2Joint.prototype,c.b2GearJoint=function(){$i_23.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_J=new _},c.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},c.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},c.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},c.prototype.GetReactionTorque=function(t){t===void 0&&(t=0);var e=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,o=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=e.col1.x*i+e.col2.x*o;o=e.col1.y*i+e.col2.y*o,i=n;var s=this.m_impulse*this.m_J.linearB.x,r=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*r+o*s)},c.prototype.GetRatio=function(){return this.m_ratio},c.prototype.SetRatio=function(t){t===void 0&&(t=0),this.m_ratio=t},c.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type),i=parseInt(t.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var o=0,n=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),e==u.e_revoluteJoint?(this.m_revolute1=t.joint1 instanceof D?t.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),o=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1 instanceof v?t.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),o=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),i==u.e_revoluteJoint?(this.m_revolute2=t.joint2 instanceof D?t.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),n=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2 instanceof v?t.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),n=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=o+this.m_ratio*n,this.m_impulse=0},c.prototype.InitVelocityConstraints=function(t){var e,i,o=this.m_ground1,n=this.m_ground2,s=this.m_bodyA,r=this.m_bodyB,a=0,h=0,l=0,c=0,m=0,_=0,u=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,u+=s.m_invI):(e=o.m_xf.R,i=this.m_prismatic1.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,h=e.col1.y*i.x+e.col2.y*i.y,e=s.m_xf.R,l=this.m_localAnchor1.x-s.m_sweep.localCenter.x,c=this.m_localAnchor1.y-s.m_sweep.localCenter.y,_=e.col1.x*l+e.col2.x*c,c=e.col1.y*l+e.col2.y*c,l=_,m=l*h-c*a,this.m_J.linearA.Set(-a,-h),this.m_J.angularA=-m,u+=s.m_invMass+s.m_invI*m*m),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,u+=this.m_ratio*this.m_ratio*r.m_invI):(e=n.m_xf.R,i=this.m_prismatic2.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,h=e.col1.y*i.x+e.col2.y*i.y,e=r.m_xf.R,l=this.m_localAnchor2.x-r.m_sweep.localCenter.x,c=this.m_localAnchor2.y-r.m_sweep.localCenter.y,_=e.col1.x*l+e.col2.x*c,c=e.col1.y*l+e.col2.y*c,l=_,m=l*h-c*a,this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*h),this.m_J.angularB=-this.m_ratio*m,u+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*m*m)),this.m_mass=u>0?1/u:0,t.warmStarting?(s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearA.x,s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearA.y,s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},c.prototype.SolveVelocityConstraints=function(){var t=this.m_bodyA,e=this.m_bodyB,i=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,e.m_linearVelocity,e.m_angularVelocity),o=-this.m_mass*i;this.m_impulse+=o,t.m_linearVelocity.x+=t.m_invMass*o*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*o*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*o*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*o*this.m_J.linearB.x,e.m_linearVelocity.y+=e.m_invMass*o*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*o*this.m_J.angularB},c.prototype.SolvePositionConstraints=function(e){e===void 0&&(e=0);var i=0,o=this.m_bodyA,n=this.m_bodyB,s=0,r=0;s=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),r=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var a=this.m_constant-(s+this.m_ratio*r),h=-this.m_mass*a;return o.m_sweep.c.x+=o.m_invMass*h*this.m_J.linearA.x,o.m_sweep.c.y+=o.m_invMass*h*this.m_J.linearA.y,o.m_sweep.a+=o.m_invI*h*this.m_J.angularA,n.m_sweep.c.x+=n.m_invMass*h*this.m_J.linearB.x,n.m_sweep.c.y+=n.m_invMass*h*this.m_J.linearB.y,n.m_sweep.a+=n.m_invI*h*this.m_J.angularB,o.SynchronizeTransform(),n.SynchronizeTransform(),t.b2_linearSlop>i},$i_23.inherit(m,$i_23.Dynamics.Joints.b2JointDef),m.prototype.__super=$i_23.Dynamics.Joints.b2JointDef.prototype,m.b2GearJointDef=function(){$i_23.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},m.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},_.b2Jacobian=function(){this.linearA=new n,this.linearB=new n},_.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},_.prototype.Set=function(t,e,i,o){e===void 0&&(e=0),o===void 0&&(o=0),this.linearA.SetV(t),this.angularA=e,this.linearB.SetV(i),this.angularB=o},_.prototype.Compute=function(t,e,i,o){return e===void 0&&(e=0),o===void 0&&(o=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*o
},u.b2Joint=function(){this.m_edgeA=new p,this.m_edgeB=new p,this.m_localCenterA=new n,this.m_localCenterB=new n},u.prototype.GetType=function(){return this.m_type},u.prototype.GetAnchorA=function(){return null},u.prototype.GetAnchorB=function(){return null},u.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),null},u.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),0},u.prototype.GetBodyA=function(){return this.m_bodyA},u.prototype.GetBodyB=function(){return this.m_bodyB},u.prototype.GetNext=function(){return this.m_next},u.prototype.GetUserData=function(){return this.m_userData},u.prototype.SetUserData=function(t){this.m_userData=t},u.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},u.Create=function(t){var e=null;switch(t.type){case u.e_distanceJoint:e=new r(t instanceof a?t:null);break;case u.e_mouseJoint:e=new f(t instanceof g?t:null);break;case u.e_prismaticJoint:e=new v(t instanceof b?t:null);break;case u.e_revoluteJoint:e=new D(t instanceof S?t:null);break;case u.e_pulleyJoint:e=new C(t instanceof w?t:null);break;case u.e_gearJoint:e=new c(t instanceof m?t:null);break;case u.e_lineJoint:e=new y(t instanceof x?t:null);break;case u.e_weldJoint:e=new B(t instanceof I?t:null);break;case u.e_frictionJoint:e=new h(t instanceof l?t:null);break;default:}return e},u.Destroy=function(){},u.prototype.b2Joint=function(e){t.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_prev=null,this.m_next=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},u.prototype.InitVelocityConstraints=function(){},u.prototype.SolveVelocityConstraints=function(){},u.prototype.FinalizeVelocityConstraints=function(){},u.prototype.SolvePositionConstraints=function(t){return t===void 0&&(t=0),!1},$i_23.postDefs.push(function(){$i_23.Dynamics.Joints.b2Joint.e_unknownJoint=0,$i_23.Dynamics.Joints.b2Joint.e_revoluteJoint=1,$i_23.Dynamics.Joints.b2Joint.e_prismaticJoint=2,$i_23.Dynamics.Joints.b2Joint.e_distanceJoint=3,$i_23.Dynamics.Joints.b2Joint.e_pulleyJoint=4,$i_23.Dynamics.Joints.b2Joint.e_mouseJoint=5,$i_23.Dynamics.Joints.b2Joint.e_gearJoint=6,$i_23.Dynamics.Joints.b2Joint.e_lineJoint=7,$i_23.Dynamics.Joints.b2Joint.e_weldJoint=8,$i_23.Dynamics.Joints.b2Joint.e_frictionJoint=9,$i_23.Dynamics.Joints.b2Joint.e_inactiveLimit=0,$i_23.Dynamics.Joints.b2Joint.e_atLowerLimit=1,$i_23.Dynamics.Joints.b2Joint.e_atUpperLimit=2,$i_23.Dynamics.Joints.b2Joint.e_equalLimits=3}),d.b2JointDef=function(){},d.prototype.b2JointDef=function(){this.type=u.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},p.b2JointEdge=function(){},$i_23.inherit(y,$i_23.Dynamics.Joints.b2Joint),y.prototype.__super=$i_23.Dynamics.Joints.b2Joint.prototype,y.b2LineJoint=function(){$i_23.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new e,this.m_impulse=new n},y.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},y.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},y.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_impulse.y},y.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),o=e.GetWorldPoint(this.m_localAnchor2),n=o.x-i.x,s=o.y-i.y,r=t.GetWorldVector(this.m_localXAxis1),a=r.x*n+r.y*s;return a},y.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*n;n=t.col1.y*o+t.col2.y*n,o=s,t=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var h=e.m_sweep.c.x+o,l=e.m_sweep.c.y+n,c=i.m_sweep.c.x+r,m=i.m_sweep.c.y+a,_=c-h,u=m-l,d=e.GetWorldVector(this.m_localXAxis1),p=e.m_linearVelocity,y=i.m_linearVelocity,x=e.m_angularVelocity,f=i.m_angularVelocity,g=_*-x*d.y+u*x*d.x+(d.x*(y.x+-f*a-p.x- -x*n)+d.y*(y.y+f*r-p.y-x*o));return g},y.prototype.IsLimitEnabled=function(){return this.m_enableLimit},y.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},y.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},y.prototype.GetUpperLimit=function(){return this.m_upperTranslation},y.prototype.SetLimits=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},y.prototype.IsMotorEnabled=function(){return this.m_enableMotor},y.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},y.prototype.SetMotorSpeed=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},y.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},y.prototype.SetMaxMotorForce=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},y.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},y.prototype.GetMotorForce=function(){return this.m_motorImpulse},y.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=u.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},y.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(s.GetLocalCenter());var a=n.GetTransform();s.GetTransform(),i=n.m_xf.R;var h=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y;r=i.col1.x*h+i.col2.x*l,l=i.col1.y*h+i.col2.y*l,h=r,i=s.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y;r=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=r;var _=s.m_sweep.c.x+c-n.m_sweep.c.x-h,d=s.m_sweep.c.y+m-n.m_sweep.c.y-l;this.m_invMassA=n.m_invMass,this.m_invMassB=s.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=s.m_invI,this.m_axis.SetV(o.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(_+h)*this.m_axis.y-(d+l)*this.m_axis.x,this.m_a2=c*this.m_axis.y-m*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(o.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(_+h)*this.m_perp.y-(d+l)*this.m_perp.x,this.m_s2=c*this.m_perp.y-m*this.m_perp.x;var p=this.m_invMassA,y=this.m_invMassB,x=this.m_invIA,f=this.m_invIB;if(this.m_K.col1.x=p+y+x*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=x*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+y+x*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit){var g=this.m_axis.x*_+this.m_axis.y*d;2*t.b2_linearSlop>o.Abs(this.m_upperTranslation-this.m_lowerTranslation)?this.m_limitState=u.e_equalLimits:g>this.m_lowerTranslation?this.m_upperTranslation>g?(this.m_limitState=u.e_inactiveLimit,this.m_impulse.y=0):this.m_limitState!=u.e_atUpperLimit&&(this.m_limitState=u.e_atUpperLimit,this.m_impulse.y=0):this.m_limitState!=u.e_atLowerLimit&&(this.m_limitState=u.e_atLowerLimit,this.m_impulse.y=0)}else this.m_limitState=u.e_inactiveLimit;if(this.m_enableMotor==0&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,C=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,w=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*v,n.m_linearVelocity.y-=this.m_invMassA*b,n.m_angularVelocity-=this.m_invIA*C,s.m_linearVelocity.x+=this.m_invMassB*v,s.m_linearVelocity.y+=this.m_invMassB*b,s.m_angularVelocity+=this.m_invIB*w}else this.m_impulse.SetZero(),this.m_motorImpulse=0},y.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,s=e.m_linearVelocity,r=e.m_angularVelocity,a=i.m_linearVelocity,h=i.m_angularVelocity,l=0,c=0,m=0,_=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var d=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*h-this.m_a1*r,p=this.m_motorMass*(this.m_motorSpeed-d),y=this.m_motorImpulse,x=t.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+p,-x,x),p=this.m_motorImpulse-y,l=p*this.m_axis.x,c=p*this.m_axis.y,m=p*this.m_a1,_=p*this.m_a2,s.x-=this.m_invMassA*l,s.y-=this.m_invMassA*c,r-=this.m_invIA*m,a.x+=this.m_invMassB*l,a.y+=this.m_invMassB*c,h+=this.m_invIB*_}var f=this.m_perp.x*(a.x-s.x)+this.m_perp.y*(a.y-s.y)+this.m_s2*h-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var g=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*h-this.m_a1*r,v=this.m_impulse.Copy(),b=this.m_K.Solve(new n,-f,-g);this.m_impulse.Add(b),this.m_limitState==u.e_atLowerLimit?this.m_impulse.y=o.Max(this.m_impulse.y,0):this.m_limitState==u.e_atUpperLimit&&(this.m_impulse.y=o.Min(this.m_impulse.y,0));var C=-f-(this.m_impulse.y-v.y)*this.m_K.col2.x,w=0;w=this.m_K.col1.x!=0?C/this.m_K.col1.x+v.x:v.x,this.m_impulse.x=w,b.x=this.m_impulse.x-v.x,b.y=this.m_impulse.y-v.y,l=b.x*this.m_perp.x+b.y*this.m_axis.x,c=b.x*this.m_perp.y+b.y*this.m_axis.y,m=b.x*this.m_s1+b.y*this.m_a1,_=b.x*this.m_s2+b.y*this.m_a2,s.x-=this.m_invMassA*l,s.y-=this.m_invMassA*c,r-=this.m_invIA*m,a.x+=this.m_invMassB*l,a.y+=this.m_invMassB*c,h+=this.m_invIB*_}else{var D=0;D=this.m_K.col1.x!=0?-f/this.m_K.col1.x:0,this.m_impulse.x+=D,l=D*this.m_perp.x,c=D*this.m_perp.y,m=D*this.m_s1,_=D*this.m_s2,s.x-=this.m_invMassA*l,s.y-=this.m_invMassA*c,r-=this.m_invIA*m,a.x+=this.m_invMassB*l,a.y+=this.m_invMassB*c,h+=this.m_invIB*_}e.m_linearVelocity.SetV(s),e.m_angularVelocity=r,i.m_linearVelocity.SetV(a),i.m_angularVelocity=h},y.prototype.SolvePositionConstraints=function(i){i===void 0&&(i=0);var s,r=this.m_bodyA,a=this.m_bodyB,h=r.m_sweep.c,l=r.m_sweep.a,c=a.m_sweep.c,m=a.m_sweep.a,_=0,u=0,d=0,p=0,y=0,x=0,f=0,g=!1,v=0,b=e.FromAngle(l),C=e.FromAngle(m);s=b;var w=this.m_localAnchor1.x-this.m_localCenterA.x,D=this.m_localAnchor1.y-this.m_localCenterA.y;_=s.col1.x*w+s.col2.x*D,D=s.col1.y*w+s.col2.y*D,w=_,s=C;var S=this.m_localAnchor2.x-this.m_localCenterB.x,B=this.m_localAnchor2.y-this.m_localCenterB.y;_=s.col1.x*S+s.col2.x*B,B=s.col1.y*S+s.col2.y*B,S=_;var I=c.x+S-h.x-w,A=c.y+B-h.y-D;if(this.m_enableLimit){this.m_axis=o.MulMV(b,this.m_localXAxis1),this.m_a1=(I+w)*this.m_axis.y-(A+D)*this.m_axis.x,this.m_a2=S*this.m_axis.y-B*this.m_axis.x;var M=this.m_axis.x*I+this.m_axis.y*A;2*t.b2_linearSlop>o.Abs(this.m_upperTranslation-this.m_lowerTranslation)?(v=o.Clamp(M,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),x=o.Abs(M),g=!0):M>this.m_lowerTranslation?this.m_upperTranslation>M||(v=o.Clamp(M-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),x=M-this.m_upperTranslation,g=!0):(v=o.Clamp(M-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),x=this.m_lowerTranslation-M,g=!0)}this.m_perp=o.MulMV(b,this.m_localYAxis1),this.m_s1=(I+w)*this.m_perp.y-(A+D)*this.m_perp.x,this.m_s2=S*this.m_perp.y-B*this.m_perp.x;var T=new n,P=this.m_perp.x*I+this.m_perp.y*A;if(x=o.Max(x,o.Abs(P)),f=0,g)u=this.m_invMassA,d=this.m_invMassB,p=this.m_invIA,y=this.m_invIB,this.m_K.col1.x=u+d+p*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,this.m_K.col1.y=p*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+d+p*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,this.m_K.Solve(T,-P,-v);else{u=this.m_invMassA,d=this.m_invMassB,p=this.m_invIA,y=this.m_invIB;var k=u+d+p*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,V=0;V=k!=0?-P/k:0,T.x=V,T.y=0}var R=T.x*this.m_perp.x+T.y*this.m_axis.x,L=T.x*this.m_perp.y+T.y*this.m_axis.y,F=T.x*this.m_s1+T.y*this.m_a1,E=T.x*this.m_s2+T.y*this.m_a2;return h.x-=this.m_invMassA*R,h.y-=this.m_invMassA*L,l-=this.m_invIA*F,c.x+=this.m_invMassB*R,c.y+=this.m_invMassB*L,m+=this.m_invIB*E,r.m_sweep.a=l,a.m_sweep.a=m,r.SynchronizeTransform(),a.SynchronizeTransform(),t.b2_linearSlop>=x&&t.b2_angularSlop>=f},$i_23.inherit(x,$i_23.Dynamics.Joints.b2JointDef),x.prototype.__super=$i_23.Dynamics.Joints.b2JointDef.prototype,x.b2LineJointDef=function(){$i_23.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},x.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},x.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(o)},$i_23.inherit(f,$i_23.Dynamics.Joints.b2Joint),f.prototype.__super=$i_23.Dynamics.Joints.b2Joint.prototype,f.b2MouseJoint=function(){$i_23.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.m_localAnchor=new n,this.m_target=new n,this.m_impulse=new n,this.m_mass=new e,this.m_C=new n},f.prototype.GetAnchorA=function(){return this.m_target},f.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},f.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},f.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),0},f.prototype.GetTarget=function(){return this.m_target},f.prototype.SetTarget=function(t){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_target=t},f.prototype.GetMaxForce=function(){return this.m_maxForce},f.prototype.SetMaxForce=function(t){t===void 0&&(t=0),this.m_maxForce=t},f.prototype.GetFrequency=function(){return this.m_frequencyHz},f.prototype.SetFrequency=function(t){t===void 0&&(t=0),this.m_frequencyHz=t},f.prototype.GetDampingRatio=function(){return this.m_dampingRatio},f.prototype.SetDampingRatio=function(t){t===void 0&&(t=0),this.m_dampingRatio=t},f.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t),this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x,i=this.m_target.y-this.m_bodyB.m_xf.position.y,o=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*o.col1.x+i*o.col1.y,this.m_localAnchor.y=e*o.col2.x+i*o.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0},f.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB,i=e.GetMass(),o=2*Math.PI*this.m_frequencyHz,n=2*i*this.m_dampingRatio*o,s=i*o*o;this.m_gamma=t.dt*(n+t.dt*s),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=t.dt*s*this.m_gamma;var r;r=e.m_xf.R;var a=this.m_localAnchor.x-e.m_sweep.localCenter.x,h=this.m_localAnchor.y-e.m_sweep.localCenter.y,l=r.col1.x*a+r.col2.x*h;h=r.col1.y*a+r.col2.y*h,a=l;var c=e.m_invMass,m=e.m_invI;this.K1.col1.x=c,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=c,this.K2.col1.x=m*h*h,this.K2.col2.x=-m*a*h,this.K2.col1.y=-m*a*h,this.K2.col2.y=m*a*a,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=e.m_sweep.c.x+a-this.m_target.x,this.m_C.y=e.m_sweep.c.y+h-this.m_target.y,e.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,e.m_linearVelocity.x+=c*this.m_impulse.x,e.m_linearVelocity.y+=c*this.m_impulse.y,e.m_angularVelocity+=m*(a*this.m_impulse.y-h*this.m_impulse.x)},f.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyB,o=0,n=0;e=i.m_xf.R;var s=this.m_localAnchor.x-i.m_sweep.localCenter.x,r=this.m_localAnchor.y-i.m_sweep.localCenter.y;o=e.col1.x*s+e.col2.x*r,r=e.col1.y*s+e.col2.y*r,s=o;var a=i.m_linearVelocity.x+-i.m_angularVelocity*r,h=i.m_linearVelocity.y+i.m_angularVelocity*s;e=this.m_mass,o=a+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,n=h+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var l=-(e.col1.x*o+e.col2.x*n),c=-(e.col1.y*o+e.col2.y*n),m=this.m_impulse.x,_=this.m_impulse.y;this.m_impulse.x+=l,this.m_impulse.y+=c;var u=t.dt*this.m_maxForce;this.m_impulse.LengthSquared()>u*u&&this.m_impulse.Multiply(u/this.m_impulse.Length()),l=this.m_impulse.x-m,c=this.m_impulse.y-_,i.m_linearVelocity.x+=i.m_invMass*l,i.m_linearVelocity.y+=i.m_invMass*c,i.m_angularVelocity+=i.m_invI*(s*c-r*l)},f.prototype.SolvePositionConstraints=function(t){return t===void 0&&(t=0),!0},$i_23.inherit(g,$i_23.Dynamics.Joints.b2JointDef),g.prototype.__super=$i_23.Dynamics.Joints.b2JointDef.prototype,g.b2MouseJointDef=function(){$i_23.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new n},g.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},$i_23.inherit(v,$i_23.Dynamics.Joints.b2Joint),v.prototype.__super=$i_23.Dynamics.Joints.b2Joint.prototype,v.b2PrismaticJoint=function(){$i_23.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new i,this.m_impulse=new s},v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},v.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},v.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_impulse.y},v.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),o=e.GetWorldPoint(this.m_localAnchor2),n=o.x-i.x,s=o.y-i.y,r=t.GetWorldVector(this.m_localXAxis1),a=r.x*n+r.y*s;return a},v.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*n;n=t.col1.y*o+t.col2.y*n,o=s,t=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var h=e.m_sweep.c.x+o,l=e.m_sweep.c.y+n,c=i.m_sweep.c.x+r,m=i.m_sweep.c.y+a,_=c-h,u=m-l,d=e.GetWorldVector(this.m_localXAxis1),p=e.m_linearVelocity,y=i.m_linearVelocity,x=e.m_angularVelocity,f=i.m_angularVelocity,g=_*-x*d.y+u*x*d.x+(d.x*(y.x+-f*a-p.x- -x*n)+d.y*(y.y+f*r-p.y-x*o));return g},v.prototype.IsLimitEnabled=function(){return this.m_enableLimit},v.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},v.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},v.prototype.GetUpperLimit=function(){return this.m_upperTranslation},v.prototype.SetLimits=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},v.prototype.IsMotorEnabled=function(){return this.m_enableMotor},v.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},v.prototype.SetMotorSpeed=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},v.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},v.prototype.SetMaxMotorForce=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},v.prototype.GetMotorForce=function(){return this.m_motorImpulse},v.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=u.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},v.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(s.GetLocalCenter());var a=n.GetTransform();s.GetTransform(),i=n.m_xf.R;var h=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y;r=i.col1.x*h+i.col2.x*l,l=i.col1.y*h+i.col2.y*l,h=r,i=s.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y;r=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=r;var _=s.m_sweep.c.x+c-n.m_sweep.c.x-h,d=s.m_sweep.c.y+m-n.m_sweep.c.y-l;this.m_invMassA=n.m_invMass,this.m_invMassB=s.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=s.m_invI,this.m_axis.SetV(o.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(_+h)*this.m_axis.y-(d+l)*this.m_axis.x,this.m_a2=c*this.m_axis.y-m*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(o.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(_+h)*this.m_perp.y-(d+l)*this.m_perp.x,this.m_s2=c*this.m_perp.y-m*this.m_perp.x;var p=this.m_invMassA,y=this.m_invMassB,x=this.m_invIA,f=this.m_invIB;if(this.m_K.col1.x=p+y+x*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=x*this.m_s1+f*this.m_s2,this.m_K.col1.z=x*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=x+f,this.m_K.col2.z=x*this.m_a1+f*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=p+y+x*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit){var g=this.m_axis.x*_+this.m_axis.y*d;2*t.b2_linearSlop>o.Abs(this.m_upperTranslation-this.m_lowerTranslation)?this.m_limitState=u.e_equalLimits:g>this.m_lowerTranslation?this.m_upperTranslation>g?(this.m_limitState=u.e_inactiveLimit,this.m_impulse.z=0):this.m_limitState!=u.e_atUpperLimit&&(this.m_limitState=u.e_atUpperLimit,this.m_impulse.z=0):this.m_limitState!=u.e_atLowerLimit&&(this.m_limitState=u.e_atLowerLimit,this.m_impulse.z=0)}else this.m_limitState=u.e_inactiveLimit;if(this.m_enableMotor==0&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,w=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*v,n.m_linearVelocity.y-=this.m_invMassA*b,n.m_angularVelocity-=this.m_invIA*C,s.m_linearVelocity.x+=this.m_invMassB*v,s.m_linearVelocity.y+=this.m_invMassB*b,s.m_angularVelocity+=this.m_invIB*w}else this.m_impulse.SetZero(),this.m_motorImpulse=0},v.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,r=e.m_linearVelocity,a=e.m_angularVelocity,h=i.m_linearVelocity,l=i.m_angularVelocity,c=0,m=0,_=0,d=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var p=this.m_axis.x*(h.x-r.x)+this.m_axis.y*(h.y-r.y)+this.m_a2*l-this.m_a1*a,y=this.m_motorMass*(this.m_motorSpeed-p),x=this.m_motorImpulse,f=t.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+y,-f,f),y=this.m_motorImpulse-x,c=y*this.m_axis.x,m=y*this.m_axis.y,_=y*this.m_a1,d=y*this.m_a2,r.x-=this.m_invMassA*c,r.y-=this.m_invMassA*m,a-=this.m_invIA*_,h.x+=this.m_invMassB*c,h.y+=this.m_invMassB*m,l+=this.m_invIB*d}var g=this.m_perp.x*(h.x-r.x)+this.m_perp.y*(h.y-r.y)+this.m_s2*l-this.m_s1*a,v=l-a;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var b=this.m_axis.x*(h.x-r.x)+this.m_axis.y*(h.y-r.y)+this.m_a2*l-this.m_a1*a,C=this.m_impulse.Copy(),w=this.m_K.Solve33(new s,-g,-v,-b);this.m_impulse.Add(w),this.m_limitState==u.e_atLowerLimit?this.m_impulse.z=o.Max(this.m_impulse.z,0):this.m_limitState==u.e_atUpperLimit&&(this.m_impulse.z=o.Min(this.m_impulse.z,0));var D=-g-(this.m_impulse.z-C.z)*this.m_K.col3.x,S=-v-(this.m_impulse.z-C.z)*this.m_K.col3.y,B=this.m_K.Solve22(new n,D,S);B.x+=C.x,B.y+=C.y,this.m_impulse.x=B.x,this.m_impulse.y=B.y,w.x=this.m_impulse.x-C.x,w.y=this.m_impulse.y-C.y,w.z=this.m_impulse.z-C.z,c=w.x*this.m_perp.x+w.z*this.m_axis.x,m=w.x*this.m_perp.y+w.z*this.m_axis.y,_=w.x*this.m_s1+w.y+w.z*this.m_a1,d=w.x*this.m_s2+w.y+w.z*this.m_a2,r.x-=this.m_invMassA*c,r.y-=this.m_invMassA*m,a-=this.m_invIA*_,h.x+=this.m_invMassB*c,h.y+=this.m_invMassB*m,l+=this.m_invIB*d}else{var I=this.m_K.Solve22(new n,-g,-v);this.m_impulse.x+=I.x,this.m_impulse.y+=I.y,c=I.x*this.m_perp.x,m=I.x*this.m_perp.y,_=I.x*this.m_s1+I.y,d=I.x*this.m_s2+I.y,r.x-=this.m_invMassA*c,r.y-=this.m_invMassA*m,a-=this.m_invIA*_,h.x+=this.m_invMassB*c,h.y+=this.m_invMassB*m,l+=this.m_invIB*d}e.m_linearVelocity.SetV(r),e.m_angularVelocity=a,i.m_linearVelocity.SetV(h),i.m_angularVelocity=l},v.prototype.SolvePositionConstraints=function(i){i===void 0&&(i=0);var r,a=this.m_bodyA,h=this.m_bodyB,l=a.m_sweep.c,c=a.m_sweep.a,m=h.m_sweep.c,_=h.m_sweep.a,u=0,d=0,p=0,y=0,x=0,f=0,g=0,v=!1,b=0,C=e.FromAngle(c),w=e.FromAngle(_);r=C;var D=this.m_localAnchor1.x-this.m_localCenterA.x,S=this.m_localAnchor1.y-this.m_localCenterA.y;u=r.col1.x*D+r.col2.x*S,S=r.col1.y*D+r.col2.y*S,D=u,r=w;var B=this.m_localAnchor2.x-this.m_localCenterB.x,I=this.m_localAnchor2.y-this.m_localCenterB.y;u=r.col1.x*B+r.col2.x*I,I=r.col1.y*B+r.col2.y*I,B=u;var A=m.x+B-l.x-D,M=m.y+I-l.y-S;if(this.m_enableLimit){this.m_axis=o.MulMV(C,this.m_localXAxis1),this.m_a1=(A+D)*this.m_axis.y-(M+S)*this.m_axis.x,this.m_a2=B*this.m_axis.y-I*this.m_axis.x;var T=this.m_axis.x*A+this.m_axis.y*M;2*t.b2_linearSlop>o.Abs(this.m_upperTranslation-this.m_lowerTranslation)?(b=o.Clamp(T,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),f=o.Abs(T),v=!0):T>this.m_lowerTranslation?this.m_upperTranslation>T||(b=o.Clamp(T-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),f=T-this.m_upperTranslation,v=!0):(b=o.Clamp(T-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),f=this.m_lowerTranslation-T,v=!0)}this.m_perp=o.MulMV(C,this.m_localYAxis1),this.m_s1=(A+D)*this.m_perp.y-(M+S)*this.m_perp.x,this.m_s2=B*this.m_perp.y-I*this.m_perp.x;var P=new s,k=this.m_perp.x*A+this.m_perp.y*M,V=_-c-this.m_refAngle;if(f=o.Max(f,o.Abs(k)),g=o.Abs(V),v)d=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,x=this.m_invIB,this.m_K.col1.x=d+p+y*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1+x*this.m_s2,this.m_K.col1.z=y*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=y+x,this.m_K.col2.z=y*this.m_a1+x*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=d+p+y*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_K.Solve33(P,-k,-V,-b);else{d=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,x=this.m_invIB;var R=d+p+y*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,L=y*this.m_s1+x*this.m_s2,F=y+x;this.m_K.col1.Set(R,L,0),this.m_K.col2.Set(L,F,0);var E=this.m_K.Solve22(new n,-k,-V);P.x=E.x,P.y=E.y,P.z=0}var G=P.x*this.m_perp.x+P.z*this.m_axis.x,z=P.x*this.m_perp.y+P.z*this.m_axis.y,J=P.x*this.m_s1+P.y+P.z*this.m_a1,O=P.x*this.m_s2+P.y+P.z*this.m_a2;return l.x-=this.m_invMassA*G,l.y-=this.m_invMassA*z,c-=this.m_invIA*J,m.x+=this.m_invMassB*G,m.y+=this.m_invMassB*z,_+=this.m_invIB*O,a.m_sweep.a=c,h.m_sweep.a=_,a.SynchronizeTransform(),h.SynchronizeTransform(),t.b2_linearSlop>=f&&t.b2_angularSlop>=g},$i_23.inherit(b,$i_23.Dynamics.Joints.b2JointDef),b.prototype.__super=$i_23.Dynamics.Joints.b2JointDef.prototype,b.b2PrismaticJointDef=function(){$i_23.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},b.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},b.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(o),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},$i_23.inherit(C,$i_23.Dynamics.Joints.b2Joint),C.prototype.__super=$i_23.Dynamics.Joints.b2Joint.prototype,C.b2PulleyJoint=function(){$i_23.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u1=new n,this.m_u2=new n},C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},C.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},C.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),0},C.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},C.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},C.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,o=t.x-e,n=t.y-i;return Math.sqrt(o*o+n*n)},C.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,o=t.x-e,n=t.y-i;return Math.sqrt(o*o+n*n)},C.prototype.GetRatio=function(){return this.m_ratio},C.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=o.Min(t.maxLengthA,this.m_constant-this.m_ratio*C.b2_minPulleyLength),this.m_maxLength2=o.Min(t.maxLengthB,(this.m_constant-C.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0
},C.prototype.InitVelocityConstraints=function(e){var i,o=this.m_bodyA,n=this.m_bodyB;i=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,r=this.m_localAnchor1.y-o.m_sweep.localCenter.y,a=i.col1.x*s+i.col2.x*r;r=i.col1.y*s+i.col2.y*r,s=a,i=n.m_xf.R;var h=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=i.col1.x*h+i.col2.x*l,l=i.col1.y*h+i.col2.y*l,h=a;var c=o.m_sweep.c.x+s,m=o.m_sweep.c.y+r,_=n.m_sweep.c.x+h,d=n.m_sweep.c.y+l,p=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,y=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,x=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c-p,m-y),this.m_u2.Set(_-x,d-f);var g=this.m_u1.Length(),v=this.m_u2.Length();g>t.b2_linearSlop?this.m_u1.Multiply(1/g):this.m_u1.SetZero(),v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero();var b=this.m_constant-g-this.m_ratio*v;b>0?(this.m_state=u.e_inactiveLimit,this.m_impulse=0):this.m_state=u.e_atUpperLimit,this.m_maxLength1>g?(this.m_limitState1=u.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=u.e_atUpperLimit,this.m_maxLength2>v?(this.m_limitState2=u.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=u.e_atUpperLimit;var C=s*this.m_u1.y-r*this.m_u1.x,w=h*this.m_u2.y-l*this.m_u2.x;if(this.m_limitMass1=o.m_invMass+o.m_invI*C*C,this.m_limitMass2=n.m_invMass+n.m_invI*w*w,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,e.warmStarting){this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio;var D=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,S=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,B=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,I=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;o.m_linearVelocity.x+=o.m_invMass*D,o.m_linearVelocity.y+=o.m_invMass*S,o.m_angularVelocity+=o.m_invI*(s*S-r*D),n.m_linearVelocity.x+=n.m_invMass*B,n.m_linearVelocity.y+=n.m_invMass*I,n.m_angularVelocity+=n.m_invI*(h*I-l*B)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},C.prototype.SolveVelocityConstraints=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=t.col1.x*n+t.col2.x*s;s=t.col1.y*n+t.col2.y*s,n=r,t=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,h=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=t.col1.x*a+t.col2.x*h,h=t.col1.y*a+t.col2.y*h,a=r;var l=0,c=0,m=0,_=0,d=0,p=0,y=0,x=0,f=0,g=0,v=0;this.m_state==u.e_atUpperLimit&&(l=e.m_linearVelocity.x+-e.m_angularVelocity*s,c=e.m_linearVelocity.y+e.m_angularVelocity*n,m=i.m_linearVelocity.x+-i.m_angularVelocity*h,_=i.m_linearVelocity.y+i.m_angularVelocity*a,f=-(this.m_u1.x*l+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*m+this.m_u2.y*_),g=this.m_pulleyMass*-f,v=this.m_impulse,this.m_impulse=o.Max(0,this.m_impulse+g),g=this.m_impulse-v,d=-g*this.m_u1.x,p=-g*this.m_u1.y,y=-this.m_ratio*g*this.m_u2.x,x=-this.m_ratio*g*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*d,e.m_linearVelocity.y+=e.m_invMass*p,e.m_angularVelocity+=e.m_invI*(n*p-s*d),i.m_linearVelocity.x+=i.m_invMass*y,i.m_linearVelocity.y+=i.m_invMass*x,i.m_angularVelocity+=i.m_invI*(a*x-h*y)),this.m_limitState1==u.e_atUpperLimit&&(l=e.m_linearVelocity.x+-e.m_angularVelocity*s,c=e.m_linearVelocity.y+e.m_angularVelocity*n,f=-(this.m_u1.x*l+this.m_u1.y*c),g=-this.m_limitMass1*f,v=this.m_limitImpulse1,this.m_limitImpulse1=o.Max(0,this.m_limitImpulse1+g),g=this.m_limitImpulse1-v,d=-g*this.m_u1.x,p=-g*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*d,e.m_linearVelocity.y+=e.m_invMass*p,e.m_angularVelocity+=e.m_invI*(n*p-s*d)),this.m_limitState2==u.e_atUpperLimit&&(m=i.m_linearVelocity.x+-i.m_angularVelocity*h,_=i.m_linearVelocity.y+i.m_angularVelocity*a,f=-(this.m_u2.x*m+this.m_u2.y*_),g=-this.m_limitMass2*f,v=this.m_limitImpulse2,this.m_limitImpulse2=o.Max(0,this.m_limitImpulse2+g),g=this.m_limitImpulse2-v,y=-g*this.m_u2.x,x=-g*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*y,i.m_linearVelocity.y+=i.m_invMass*x,i.m_angularVelocity+=i.m_invI*(a*x-h*y))},C.prototype.SolvePositionConstraints=function(e){e===void 0&&(e=0);var i,n=this.m_bodyA,s=this.m_bodyB,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,h=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,c=0,m=0,_=0,d=0,p=0,y=0,x=0,f=0,g=0,v=0,b=0,C=0,w=0,D=0;return this.m_state==u.e_atUpperLimit&&(i=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,m=this.m_localAnchor1.y-n.m_sweep.localCenter.y,w=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=w,i=s.m_xf.R,_=this.m_localAnchor2.x-s.m_sweep.localCenter.x,d=this.m_localAnchor2.y-s.m_sweep.localCenter.y,w=i.col1.x*_+i.col2.x*d,d=i.col1.y*_+i.col2.y*d,_=w,p=n.m_sweep.c.x+c,y=n.m_sweep.c.y+m,x=s.m_sweep.c.x+_,f=s.m_sweep.c.y+d,this.m_u1.Set(p-r,y-a),this.m_u2.Set(x-h,f-l),g=this.m_u1.Length(),v=this.m_u2.Length(),g>t.b2_linearSlop?this.m_u1.Multiply(1/g):this.m_u1.SetZero(),v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero(),b=this.m_constant-g-this.m_ratio*v,D=o.Max(D,-b),b=o.Clamp(b+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),C=-this.m_pulleyMass*b,p=-C*this.m_u1.x,y=-C*this.m_u1.y,x=-this.m_ratio*C*this.m_u2.x,f=-this.m_ratio*C*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*p,n.m_sweep.c.y+=n.m_invMass*y,n.m_sweep.a+=n.m_invI*(c*y-m*p),s.m_sweep.c.x+=s.m_invMass*x,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(_*f-d*x),n.SynchronizeTransform(),s.SynchronizeTransform()),this.m_limitState1==u.e_atUpperLimit&&(i=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,m=this.m_localAnchor1.y-n.m_sweep.localCenter.y,w=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=w,p=n.m_sweep.c.x+c,y=n.m_sweep.c.y+m,this.m_u1.Set(p-r,y-a),g=this.m_u1.Length(),g>t.b2_linearSlop?(this.m_u1.x*=1/g,this.m_u1.y*=1/g):this.m_u1.SetZero(),b=this.m_maxLength1-g,D=o.Max(D,-b),b=o.Clamp(b+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),C=-this.m_limitMass1*b,p=-C*this.m_u1.x,y=-C*this.m_u1.y,n.m_sweep.c.x+=n.m_invMass*p,n.m_sweep.c.y+=n.m_invMass*y,n.m_sweep.a+=n.m_invI*(c*y-m*p),n.SynchronizeTransform()),this.m_limitState2==u.e_atUpperLimit&&(i=s.m_xf.R,_=this.m_localAnchor2.x-s.m_sweep.localCenter.x,d=this.m_localAnchor2.y-s.m_sweep.localCenter.y,w=i.col1.x*_+i.col2.x*d,d=i.col1.y*_+i.col2.y*d,_=w,x=s.m_sweep.c.x+_,f=s.m_sweep.c.y+d,this.m_u2.Set(x-h,f-l),v=this.m_u2.Length(),v>t.b2_linearSlop?(this.m_u2.x*=1/v,this.m_u2.y*=1/v):this.m_u2.SetZero(),b=this.m_maxLength2-v,D=o.Max(D,-b),b=o.Clamp(b+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),C=-this.m_limitMass2*b,x=-C*this.m_u2.x,f=-C*this.m_u2.y,s.m_sweep.c.x+=s.m_invMass*x,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(_*f-d*x),s.SynchronizeTransform()),t.b2_linearSlop>D},$i_23.postDefs.push(function(){$i_23.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),$i_23.inherit(w,$i_23.Dynamics.Joints.b2JointDef),w.prototype.__super=$i_23.Dynamics.Joints.b2JointDef.prototype,w.b2PulleyJointDef=function(){$i_23.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new n,this.groundAnchorB=new n,this.localAnchorA=new n,this.localAnchorB=new n},w.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},w.prototype.Initialize=function(t,e,i,o,n,s,r){r===void 0&&(r=0),this.bodyA=t,this.bodyB=e,this.groundAnchorA.SetV(i),this.groundAnchorB.SetV(o),this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(s);var a=n.x-i.x,h=n.y-i.y;this.lengthA=Math.sqrt(a*a+h*h);var l=s.x-o.x,c=s.y-o.y;this.lengthB=Math.sqrt(l*l+c*c),this.ratio=r;var m=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=m-this.ratio*C.b2_minPulleyLength,this.maxLengthB=(m-C.b2_minPulleyLength)/this.ratio},$i_23.inherit(D,$i_23.Dynamics.Joints.b2Joint),D.prototype.__super=$i_23.Dynamics.Joints.b2Joint.prototype,D.b2RevoluteJoint=function(){$i_23.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.K3=new e,this.impulse3=new s,this.impulse2=new n,this.reduced=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_impulse=new s,this.m_mass=new i},D.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},D.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},D.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},D.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_impulse.z},D.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},D.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},D.prototype.IsLimitEnabled=function(){return this.m_enableLimit},D.prototype.EnableLimit=function(t){this.m_enableLimit=t},D.prototype.GetLowerLimit=function(){return this.m_lowerAngle},D.prototype.GetUpperLimit=function(){return this.m_upperAngle},D.prototype.SetLimits=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.m_lowerAngle=t,this.m_upperAngle=e},D.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},D.prototype.EnableMotor=function(t){this.m_enableMotor=t},D.prototype.SetMotorSpeed=function(t){t===void 0&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},D.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},D.prototype.SetMaxMotorTorque=function(t){t===void 0&&(t=0),this.m_maxMotorTorque=t},D.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},D.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=u.e_inactiveLimit},D.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_enableMotor||this.m_enableLimit,i=n.m_xf.R;var a=this.m_localAnchor1.x-n.m_sweep.localCenter.x,h=this.m_localAnchor1.y-n.m_sweep.localCenter.y;r=i.col1.x*a+i.col2.x*h,h=i.col1.y*a+i.col2.y*h,a=r,i=s.m_xf.R;var l=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=i.col1.x*l+i.col2.x*c,c=i.col1.y*l+i.col2.y*c,l=r;var m=n.m_invMass,_=s.m_invMass,d=n.m_invI,p=s.m_invI;if(this.m_mass.col1.x=m+_+h*h*d+c*c*p,this.m_mass.col2.x=-h*a*d-c*l*p,this.m_mass.col3.x=-h*d-c*p,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=m+_+a*a*d+l*l*p,this.m_mass.col3.y=a*d+l*p,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=d+p,this.m_motorMass=1/(d+p),this.m_enableMotor==0&&(this.m_motorImpulse=0),this.m_enableLimit){var y=s.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;2*t.b2_angularSlop>o.Abs(this.m_upperAngle-this.m_lowerAngle)?this.m_limitState=u.e_equalLimits:y>this.m_lowerAngle?this.m_upperAngle>y?(this.m_limitState=u.e_inactiveLimit,this.m_impulse.z=0):(this.m_limitState!=u.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=u.e_atUpperLimit):(this.m_limitState!=u.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=u.e_atLowerLimit)}else this.m_limitState=u.e_inactiveLimit;if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var x=this.m_impulse.x,f=this.m_impulse.y;n.m_linearVelocity.x-=m*x,n.m_linearVelocity.y-=m*f,n.m_angularVelocity-=d*(a*f-h*x+this.m_motorImpulse+this.m_impulse.z),s.m_linearVelocity.x+=_*x,s.m_linearVelocity.y+=_*f,s.m_angularVelocity+=p*(l*f-c*x+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},D.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyA,n=this.m_bodyB,s=0,r=0,a=0,h=0,l=0,c=0,m=i.m_linearVelocity,_=i.m_angularVelocity,d=n.m_linearVelocity,p=n.m_angularVelocity,y=i.m_invMass,x=n.m_invMass,f=i.m_invI,g=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var v=p-_-this.m_motorSpeed,b=this.m_motorMass*-v,C=this.m_motorImpulse,w=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+b,-w,w),b=this.m_motorImpulse-C,_-=f*b,p+=g*b}if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){e=i.m_xf.R,a=this.m_localAnchor1.x-i.m_sweep.localCenter.x,h=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=s,e=n.m_xf.R,l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y,s=e.col1.x*l+e.col2.x*c,c=e.col1.y*l+e.col2.y*c,l=s;var D=d.x+-p*c-m.x- -_*h,S=d.y+p*l-m.y-_*a,B=p-_;this.m_mass.Solve33(this.impulse3,-D,-S,-B),this.m_limitState==u.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==u.e_atLowerLimit?(r=this.m_impulse.z+this.impulse3.z,0>r&&(this.m_mass.Solve22(this.reduced,-D,-S),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==u.e_atUpperLimit&&(r=this.m_impulse.z+this.impulse3.z,r>0&&(this.m_mass.Solve22(this.reduced,-D,-S),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),m.x-=y*this.impulse3.x,m.y-=y*this.impulse3.y,_-=f*(a*this.impulse3.y-h*this.impulse3.x+this.impulse3.z),d.x+=x*this.impulse3.x,d.y+=x*this.impulse3.y,p+=g*(l*this.impulse3.y-c*this.impulse3.x+this.impulse3.z)}else{e=i.m_xf.R,a=this.m_localAnchor1.x-i.m_sweep.localCenter.x,h=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=s,e=n.m_xf.R,l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y,s=e.col1.x*l+e.col2.x*c,c=e.col1.y*l+e.col2.y*c,l=s;var I=d.x+-p*c-m.x- -_*h,A=d.y+p*l-m.y-_*a;this.m_mass.Solve22(this.impulse2,-I,-A),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,m.x-=y*this.impulse2.x,m.y-=y*this.impulse2.y,_-=f*(a*this.impulse2.y-h*this.impulse2.x),d.x+=x*this.impulse2.x,d.y+=x*this.impulse2.y,p+=g*(l*this.impulse2.y-c*this.impulse2.x)}i.m_linearVelocity.SetV(m),i.m_angularVelocity=_,n.m_linearVelocity.SetV(d),n.m_angularVelocity=p},D.prototype.SolvePositionConstraints=function(e){e===void 0&&(e=0);var i,n=0,s=this.m_bodyA,r=this.m_bodyB,a=0,h=0,l=0,c=0,m=0;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var _=r.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,d=0;this.m_limitState==u.e_equalLimits?(n=o.Clamp(_-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection),d=-this.m_motorMass*n,a=o.Abs(n)):this.m_limitState==u.e_atLowerLimit?(n=_-this.m_lowerAngle,a=-n,n=o.Clamp(n+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),d=-this.m_motorMass*n):this.m_limitState==u.e_atUpperLimit&&(n=_-this.m_upperAngle,a=n,n=o.Clamp(n-t.b2_angularSlop,0,t.b2_maxAngularCorrection),d=-this.m_motorMass*n),s.m_sweep.a-=s.m_invI*d,r.m_sweep.a+=r.m_invI*d,s.SynchronizeTransform(),r.SynchronizeTransform()}i=s.m_xf.R;var p=this.m_localAnchor1.x-s.m_sweep.localCenter.x,y=this.m_localAnchor1.y-s.m_sweep.localCenter.y;l=i.col1.x*p+i.col2.x*y,y=i.col1.y*p+i.col2.y*y,p=l,i=r.m_xf.R;var x=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;l=i.col1.x*x+i.col2.x*f,f=i.col1.y*x+i.col2.y*f,x=l;var g=r.m_sweep.c.x+x-s.m_sweep.c.x-p,v=r.m_sweep.c.y+f-s.m_sweep.c.y-y,b=g*g+v*v,C=Math.sqrt(b);h=C;var w=s.m_invMass,S=r.m_invMass,B=s.m_invI,I=r.m_invI,A=10*t.b2_linearSlop;if(b>A*A){var M=w+S,T=1/M;c=T*-g,m=T*-v;var P=.5;s.m_sweep.c.x-=P*w*c,s.m_sweep.c.y-=P*w*m,r.m_sweep.c.x+=P*S*c,r.m_sweep.c.y+=P*S*m,g=r.m_sweep.c.x+x-s.m_sweep.c.x-p,v=r.m_sweep.c.y+f-s.m_sweep.c.y-y}return this.K1.col1.x=w+S,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=w+S,this.K2.col1.x=B*y*y,this.K2.col2.x=-B*p*y,this.K2.col1.y=-B*p*y,this.K2.col2.y=B*p*p,this.K3.col1.x=I*f*f,this.K3.col2.x=-I*x*f,this.K3.col1.y=-I*x*f,this.K3.col2.y=I*x*x,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(D.tImpulse,-g,-v),c=D.tImpulse.x,m=D.tImpulse.y,s.m_sweep.c.x-=s.m_invMass*c,s.m_sweep.c.y-=s.m_invMass*m,s.m_sweep.a-=s.m_invI*(p*m-y*c),r.m_sweep.c.x+=r.m_invMass*c,r.m_sweep.c.y+=r.m_invMass*m,r.m_sweep.a+=r.m_invI*(x*m-f*c),s.SynchronizeTransform(),r.SynchronizeTransform(),t.b2_linearSlop>=h&&t.b2_angularSlop>=a},$i_23.postDefs.push(function(){$i_23.Dynamics.Joints.b2RevoluteJoint.tImpulse=new n}),$i_23.inherit(S,$i_23.Dynamics.Joints.b2JointDef),S.prototype.__super=$i_23.Dynamics.Joints.b2JointDef.prototype,S.b2RevoluteJointDef=function(){$i_23.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},S.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},S.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},$i_23.inherit(B,$i_23.Dynamics.Joints.b2Joint),B.prototype.__super=$i_23.Dynamics.Joints.b2Joint.prototype,B.b2WeldJoint=function(){$i_23.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_impulse=new s,this.m_mass=new i},B.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},B.prototype.GetReactionForce=function(t){return t===void 0&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},B.prototype.GetReactionTorque=function(t){return t===void 0&&(t=0),t*this.m_impulse.z},B.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new i},B.prototype.InitVelocityConstraints=function(t){var e,i=0,o=this.m_bodyA,n=this.m_bodyB;e=o.m_xf.R;var s=this.m_localAnchorA.x-o.m_sweep.localCenter.x,r=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*s+e.col2.x*r,r=e.col1.y*s+e.col2.y*r,s=i,e=n.m_xf.R;var a=this.m_localAnchorB.x-n.m_sweep.localCenter.x,h=this.m_localAnchorB.y-n.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=i;var l=o.m_invMass,c=n.m_invMass,m=o.m_invI,_=n.m_invI;this.m_mass.col1.x=l+c+r*r*m+h*h*_,this.m_mass.col2.x=-r*s*m-h*a*_,this.m_mass.col3.x=-r*m-h*_,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=l+c+s*s*m+a*a*_,this.m_mass.col3.y=s*m+a*_,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=m+_,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,o.m_linearVelocity.x-=l*this.m_impulse.x,o.m_linearVelocity.y-=l*this.m_impulse.y,o.m_angularVelocity-=m*(s*this.m_impulse.y-r*this.m_impulse.x+this.m_impulse.z),n.m_linearVelocity.x+=c*this.m_impulse.x,n.m_linearVelocity.y+=c*this.m_impulse.y,n.m_angularVelocity+=_*(a*this.m_impulse.y-h*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},B.prototype.SolveVelocityConstraints=function(){var t,e=0,i=this.m_bodyA,o=this.m_bodyB,n=i.m_linearVelocity,r=i.m_angularVelocity,a=o.m_linearVelocity,h=o.m_angularVelocity,l=i.m_invMass,c=o.m_invMass,m=i.m_invI,_=o.m_invI;t=i.m_xf.R;var u=this.m_localAnchorA.x-i.m_sweep.localCenter.x,d=this.m_localAnchorA.y-i.m_sweep.localCenter.y;e=t.col1.x*u+t.col2.x*d,d=t.col1.y*u+t.col2.y*d,u=e,t=o.m_xf.R;var p=this.m_localAnchorB.x-o.m_sweep.localCenter.x,y=this.m_localAnchorB.y-o.m_sweep.localCenter.y;e=t.col1.x*p+t.col2.x*y,y=t.col1.y*p+t.col2.y*y,p=e;var x=a.x-h*y-n.x+r*d,f=a.y+h*p-n.y-r*u,g=h-r,v=new s;this.m_mass.Solve33(v,-x,-f,-g),this.m_impulse.Add(v),n.x-=l*v.x,n.y-=l*v.y,r-=m*(u*v.y-d*v.x+v.z),a.x+=c*v.x,a.y+=c*v.y,h+=_*(p*v.y-y*v.x+v.z),i.m_angularVelocity=r,o.m_angularVelocity=h},B.prototype.SolvePositionConstraints=function(e){e===void 0&&(e=0);var i,n=0,r=this.m_bodyA,a=this.m_bodyB;i=r.m_xf.R;var h=this.m_localAnchorA.x-r.m_sweep.localCenter.x,l=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=i.col1.x*h+i.col2.x*l,l=i.col1.y*h+i.col2.y*l,h=n,i=a.m_xf.R;var c=this.m_localAnchorB.x-a.m_sweep.localCenter.x,m=this.m_localAnchorB.y-a.m_sweep.localCenter.y;n=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=n;var _=r.m_invMass,u=a.m_invMass,d=r.m_invI,p=a.m_invI,y=a.m_sweep.c.x+c-r.m_sweep.c.x-h,x=a.m_sweep.c.y+m-r.m_sweep.c.y-l,f=a.m_sweep.a-r.m_sweep.a-this.m_referenceAngle,g=10*t.b2_linearSlop,v=Math.sqrt(y*y+x*x),b=o.Abs(f);v>g&&(d*=1,p*=1),this.m_mass.col1.x=_+u+l*l*d+m*m*p,this.m_mass.col2.x=-l*h*d-m*c*p,this.m_mass.col3.x=-l*d-m*p,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=_+u+h*h*d+c*c*p,this.m_mass.col3.y=h*d+c*p,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=d+p;var C=new s;return this.m_mass.Solve33(C,-y,-x,-f),r.m_sweep.c.x-=_*C.x,r.m_sweep.c.y-=_*C.y,r.m_sweep.a-=d*(h*C.y-l*C.x+C.z),a.m_sweep.c.x+=u*C.x,a.m_sweep.c.y+=u*C.y,a.m_sweep.a+=p*(c*C.y-m*C.x+C.z),r.SynchronizeTransform(),a.SynchronizeTransform(),t.b2_linearSlop>=v&&t.b2_angularSlop>=b},$i_23.inherit(I,$i_23.Dynamics.Joints.b2JointDef),I.prototype.__super=$i_23.Dynamics.Joints.b2JointDef.prototype,I.b2WeldJointDef=function(){$i_23.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},I.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_weldJoint,this.referenceAngle=0},I.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var t=$i_23.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){},setTranslation:function(e,i){t.m_ctx.translate(e,i)}}}},t.prototype._color=function(t,e){return"rgba("+((t&16711680)>>16)+","+((t&65280)>>8)+","+(t&255)+","+e+")"},t.prototype.b2DebugDraw=function(){this.m_drawFlags=0},t.prototype.SetFlags=function(t){t===void 0&&(t=0),this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){t===void 0&&(t=0),this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){t===void 0&&(t=0),this.m_drawFlags&=~t},t.prototype.SetSprite=function(t){this.m_ctx=t},t.prototype.GetSprite=function(){return this.m_ctx},t.prototype.SetDrawScale=function(t){t===void 0&&(t=0),this.m_drawScale=t},t.prototype.GetDrawScale=function(){return this.m_drawScale},t.prototype.SetLineThickness=function(t){t===void 0&&(t=0),this.m_lineThickness=t,this.m_ctx.strokeWidth=t},t.prototype.GetLineThickness=function(){return this.m_lineThickness},t.prototype.SetAlpha=function(t){t===void 0&&(t=0),this.m_alpha=t},t.prototype.GetAlpha=function(){return this.m_alpha},t.prototype.SetFillAlpha=function(t){t===void 0&&(t=0),this.m_fillAlpha=t},t.prototype.GetFillAlpha=function(){return this.m_fillAlpha},t.prototype.SetXFormScale=function(t){t===void 0&&(t=0),this.m_xformScale=t},t.prototype.GetXFormScale=function(){return this.m_xformScale},t.prototype.DrawPolygon=function(t,e,i){if(e){var o=this.m_ctx,n=this.m_drawScale;o.beginPath(),o.strokeStyle=this._color(i.color,this.m_alpha),o.moveTo(t[0].x*n,t[0].y*n);for(var s=1;e>s;s++)o.lineTo(t[s].x*n,t[s].y*n);o.lineTo(t[0].x*n,t[0].y*n),o.closePath(),o.stroke()}},t.prototype.DrawSolidPolygon=function(t,e,i){if(e){var o=this.m_ctx,n=this.m_drawScale;o.beginPath(),o.strokeStyle=this._color(i.color,this.m_alpha),o.fillStyle=this._color(i.color,this.m_fillAlpha),o.moveTo(t[0].x*n,t[0].y*n);for(var s=1;e>s;s++)o.lineTo(t[s].x*n,t[s].y*n);o.lineTo(t[0].x*n,t[0].y*n),o.closePath(),o.fill(),o.stroke()}},t.prototype.DrawCircle=function(t,e,i){if(e){var o=this.m_ctx,n=this.m_drawScale;o.beginPath(),o.strokeStyle=this._color(i.color,this.m_alpha),o.arc(t.x*n,t.y*n,e*n,0,Math.PI*2,!0),o.closePath(),o.stroke()}},t.prototype.DrawSolidCircle=function(t,e,i,o){if(e){var n=this.m_ctx,s=this.m_drawScale,r=t.x*s,a=t.y*s;n.moveTo(0,0),n.beginPath(),n.strokeStyle=this._color(o.color,this.m_alpha),n.fillStyle=this._color(o.color,this.m_fillAlpha),n.arc(r,a,e*s,0,Math.PI*2,!0),n.moveTo(r,a),n.lineTo((t.x+i.x*e)*s,(t.y+i.y*e)*s),n.closePath(),n.fill(),n.stroke()}},t.prototype.DrawSegment=function(t,e,i){var o=this.m_ctx,n=this.m_drawScale;o.strokeStyle=this._color(i.color,this.m_alpha),o.beginPath(),o.moveTo(t.x*n,t.y*n),o.lineTo(e.x*n,e.y*n),o.closePath(),o.stroke()},t.prototype.DrawTransform=function(t){var e=this.m_ctx,i=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(16711680,this.m_alpha),e.moveTo(t.position.x*i,t.position.y*i),e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*i,(t.position.y+this.m_xformScale*t.R.col1.y)*i),e.strokeStyle=this._color(65280,this.m_alpha),e.moveTo(t.position.x*i,t.position.y*i),e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*i,(t.position.y+this.m_xformScale*t.R.col2.y)*i),e.closePath(),e.stroke()}}();var i;for(i=0;$i_23.postDefs.length>i;++i)$i_23.postDefs[i]();delete $i_23.postDefs,typeof window=="undefined"&&(exports.$i_23=$i_23);var $i_26={timeSyncInterval:function(t){return t!==void 0?(this._timeSyncInterval=t,this._entity):this._timeSyncInterval},_sendTimeSync:function(t,e){t||(t=ige._currentTime),this.send("_igeNetTimeSync",t,e)},timeToServerTime:function(t){return t!==void 0?t+this._latency:this._latency},_onTimeSync:function(t){var e,i=Math.floor(ige._currentTime);ige.isClient&&(e=parseInt(t,10),this._latency=i-e,this._sendTimeSync([t,i]))}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_26);var $i_27=$i_3.extend({classId:"$i_27",componentId:"stream",init:function(t,e){this._entity=t,this._options=e;var i=this;this._sectionDesignator="",ige.isClient&&(this._entity.define("_igeStreamCreate",function(){i._onStreamCreate.apply(i,arguments)}),this._entity.define("_igeStreamDestroy",function(){i._onStreamDestroy.apply(i,arguments)}),this._entity.define("_igeStreamData",function(){i._onStreamData.apply(i,arguments)}),this._entity.define("_igeStreamTime",function(){i._onStreamTime.apply(i,arguments)}),this._entity.define("_alexBatch",function(){i._onAlexBatch.apply(i,arguments)})),this._renderLatency=400,this._streamInterval=350},renderLatency:function(t){return t!==void 0?(this._renderLatency=t,this._entity):this._renderLatency},_onStreamTime:function(t){this._streamDataTime=t},_onStreamCreate:function(t){var e,i,o=t[0],n=t[1],s=t[2],r=t[3],a=t[4],h=ige.$(s);h?ige.$(n)||(e=igeClassStore[o],e?(i=new e(a).id(n).mount(h),i.streamSectionData("transform",r,!0),i._streamJustCreated=!0,i._streamEmitCreated&&i.emit("streamCreated"),this.emit("entityCreated",i)):(ige.network.stop(),ige.stop(),this.log("Network stream cannot create entity with class "+o+" because the class has not been defined! The engine will now stop.","error"))):this.log("Cannot properly handle network streamed entity with id "+n+" because it's parent with id "+s+" does not exist on the scenegraph!","warning")},_onStreamDestroy:function(t){var e=ige.$(t[1]),i=this;if(e){var o=ige.network.stream._renderLatency+(ige._currentTime-t[0]);o>0?e.lifeSpan(o,function(){i.emit("entityDestroyed",e)}):(i.emit("entityDestroyed",e),e.destroy())}},_onAlexBatch:function(t){console.log("ALEX BATCH",t)},_onStreamData:function(t){var e,i,o,n,s,r=t.split(ige.network.stream._sectionDesignator),a=r.length;if(e=r.shift(),i=ige.$(e)){for(s=i._streamJustCreated,o=i._streamSections,n=0;a>n;n++)i.streamSectionData(o[n],r[n],s);delete i._streamJustCreated}else this.log("+++ Stream: Data received for unknown entity ("+e+")")}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_27);var $i_32={};$i_32._debug={_enabled:!0,_node:typeof module!="undefined"&&module.exports!==void 0,_level:["log","warning","error"],_stacks:!1,_throwErrors:!0,_trace:{setup:!1,enabled:!1,match:""},enabled:function(t){return t!==void 0?(this._enabled=t,this):this._enabled}},$i_32.Class=$i_2,$i_32.EventingClass=$i_3,$i_32.Client=$i_32.EventingClass.extend({classId:"$i_32.Client",init:function(t,e){this.log("Net.io client starting..."),this._options=e||{},this._socket=null,this._state=0,this._debug=!1,this._connectionAttempts=0,this._options.connectionRetry===void 0&&(this._options.connectionRetry=!0),this._options.connectionRetryMax===void 0&&(this._options.connectionRetryMax=10),this._options.reconnect===void 0&&(this._options.reconnect=!0),t!==void 0&&this.connect(t)},debug:function(t){return t!==void 0?(this._debug=t,this):this._debug},connect:function(t){this.log("Connecting to server at "+t);var e=this;this._state=1,t=t.replace("http://","ws://"),this._socket=new WebSocket(t,"netio1"),this._socket.onopen=function(){e._onOpen.apply(e,arguments)},this._socket.onmessage=function(){e._onData.apply(e,arguments)},this._socket.onclose=function(){e._onClose.apply(e,arguments)},this._socket.onerror=function(){e._onError.apply(e,arguments)}},disconnect:function(t){this._socket.close(1e3,t),this.emit("_igeStreamDestroy"),$("#disconnected-modal").modal("show"),console.log("disconnected")},send:function(t){this._socket.readyState==1?this._socket.send(this._encode(t)):this.disconnect()},_onOpen:function(){this._state=2},_onData:function(t){var e=this._decode(t.data);if(this._debug&&console.log("Incoming data (event, decoded data):",t,e),e._netioCmd)switch(e._netioCmd){case"id":this.id=e.data,this._state=3,this.emit("connect",this.id);break;case"close":this._disconnectReason=e.data}else this.emit("message",[e])},_onClose:function(t,e,i){this._state===3&&(this._state=0,this.emit("disconnect",{reason:this._disconnectReason,wasClean:i,code:t})),this._state===2&&(this._state=0,this.emit("disconnect",{reason:this._disconnectReason,wasClean:i,code:t})),this._state===1&&(this._state=0,this.emit("error",{reason:"Cannot establish connection, is server running?"})),delete this._disconnectReason},_onError:function(){this.log("An error occurred with the net.io socket!","error",arguments),this.emit("error",arguments)},_encode:function(t){return JSON.stringify(t)},_decode:function(t){return JSON.parse(t)}});var Ige$i_32Client={version:"1.0.0",_initDone:!1,_idCounter:0,_requests:{},_state:0,id:function(){return this._id||""},start:function(t,e){if(this._state===3)typeof e=="function"&&e();else{var i=this;i._startCallback=e,t!==void 0&&(this._url=t),this.log('Connecting to net.io server at "'+this._url+'"...'),typeof WebSocket!="undefined"&&(this._io=new $i_32.Client(t),i._state=1,this._io.on("connect",function(t){i._state=2,i._id=t,i._onConnectToServer.apply(i,arguments)}),this._io.on("message",function(t){if(i._initDone)i._onMessageFromServer.apply(i,arguments);
else{var e,o=0;if(t.cmd==="init"){i._initDone=!0,i._state=3,i._networkCommandsLookup=t.ncmds;for(e in i._networkCommandsLookup)i._networkCommandsLookup.hasOwnProperty(e)&&(i._networkCommandsIndex[i._networkCommandsLookup[e]]=e,o++);i.define("_igeRequest",function(){i._onRequest.apply(i,arguments)}),i.define("_igeResponse",function(){i._onResponse.apply(i,arguments)}),i.define("_igeNetTimeSync",function(){i._onTimeSync.apply(i,arguments)}),i.log("Received network command list with count: "+o),ige.timeScale(parseFloat(t.ts)),ige._currentTime=parseInt(t.ct),typeof i._startCallback=="function"&&(i._startCallback(),delete i._startCallback)}}}),this._io.on("disconnect",function(){i._state=0,i._onDisconnectFromServer.apply(i,arguments)}),this._io.on("error",function(){i._onError.apply(i,arguments)}))}},stop:function(){self._state===3&&this._io.disconnect("Client requested disconnect")},define:function(t,e){return t!==void 0&&e!==void 0?(this._networkCommandsLookup[t]!==void 0?this._networkCommands[t]=e:this.log('Cannot define network command "'+t+'" because it does not exist on the server. Please edit your server code and define the network command there before trying to define it on the client!',"error"),this._entity):(this.log("Cannot define network command either the commandName or callback parameters were undefined!","error"),void 0)},send:function(t,e){var i,o=this._networkCommandsLookup[t];o!==void 0?(this.debug()&&(console.log('Sending "'+t+'" (index '+o+") with data:",e),this._debugCounter++),i=String.fromCharCode(o),this._io.send([i,e])):this.log('Cannot send network packet with command "'+t+'" because the command has not been defined!',"error")},request:function(t,e,i){var o={id:this.newIdHex(),cmd:t,data:e,callback:i,timestamp:(new Date).getTime()};this._requests[o.id]=o,this.send("_igeRequest",{id:o.id,cmd:t,data:o.data})},response:function(t,e){var i=this._requests[t];i&&(this.send("_igeResponse",{id:t,cmd:i.commandName,data:e}),delete this._requests[t])},newIdHex:function(){return this._idCounter++,(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16)},_onRequest:function(t){this._requests[t.id]=t,this.debug()&&(console.log("onRequest",t),this._debugCounter++),this._networkCommands[t.cmd]&&this._networkCommands[t.cmd](t.id,t.data),this.emit(t.cmd,[t.id,t.data])},_onResponse:function(t){var e,i;e=t.id,i=this._requests[e],this.debug()&&(console.log("onResponse",t),this._debugCounter++),i&&(i.callback(i.cmd,t.data),delete this._requests[e])},_onConnectToServer:function(){this.log("Connected to server!"),this.emit("connected")},_onMessageFromServer:function(t){var e=t[0].charCodeAt(0),i=this._networkCommandsIndex[e];if(i==="_alexBatch")for(var o=0;t[1].length>o;o++){var n=t[1][o],e=n[0].charCodeAt(0),i=this._networkCommandsIndex[e];this._networkCommands[i]&&(this.debug()&&(console.log('Received #BATCHED "'+i+'" (index '+e+") with data:",n[1]),this._debugCounter++),this._networkCommands[i](n[1])),this.emit(i,n[1])}else this._networkCommands[i]&&(this.debug()&&(console.log('Received "'+i+'" (index '+e+") with data:",t[1]),this._debugCounter++),this._networkCommands[i](t[1])),this.emit(i,t[1])},_onDisconnectFromServer:function(t){t==="booted"?this.log("Server rejected our connection because it is not accepting connections at this time!","warning"):this.log("Disconnected from server!"),this.emit("disconnected")},_onError:function(t){this.log("Error with connection: "+t.reason,"error")}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Ige$i_32Client);var Ige$i_32Server={_idCounter:0,_requests:{},snapshot:[],start:function(t,e){var i=this;return this._socketById={},this._socketsByRoomId={},t!==void 0&&(this._port=t),this.log("Starting net.io listener on port "+this._port),this._io=new this._netio(this._port,e),this._io.on("connection",function(){i._onClientConnect.apply(i,arguments)}),this.define("_igeRequest",function(){i._onRequest.apply(i,arguments)}),this.define("_igeResponse",function(){i._onResponse.apply(i,arguments)}),this.define("_igeNetTimeSync",function(){i._onTimeSync.apply(i,arguments)}),this.define("_alexBatch",function(){i._alexBatch(i,arguments)}),this.timeSyncStart(),this._entity},define:function(t,e){if(t!==void 0){this._networkCommands[t]=e;var i=this._networkCommandsIndex.length;return this._networkCommandsIndex[i]=t,this._networkCommandsLookup[t]=i,this._entity}this.log("Cannot define a network command without a commandName parameter!","error")},clientJoinRoom:function(t,e){return t!==void 0?e!==void 0?(this._clientRooms[t]=this._clientRooms[t]||[],this._clientRooms[t].push(e),this._socketsByRoomId[e]=this._socketsByRoomId[e]||{},this._socketsByRoomId[e][t]=this._socketById[t],this.debug(),this._entity):(this.log("Cannot add client to room because no roomId was provided!","warning"),this._entity):(this.log("Cannot add client to room because no clientId was provided!","warning"),this._entity)},clientLeaveRoom:function(t,e){return t!==void 0?e!==void 0?(console.log("removing client "+t+" from a room "+e),this._clientRooms[t]&&(this._clientRooms[t].pull(e),delete this._socketsByRoomId[e][t]),this._entity):(this.log("Cannot remove client from room because no roomId was provided!","warning"),this._entity):(this.log("Cannot remove client from room because no clientId was provided!","warning"),this._entity)},clientLeaveAllRooms:function(t){if(t!=void 0){var e=this._clientRooms[t];if(e!=void 0){for(var i=e.length-1;i>=0;i--)console.log("client "+t+" is leaving the room "+e[i]+"("+i+")"),this.clientLeaveRoom(t,e[i]);return delete this._clientRooms[t],this._entity}}else this.log("Cannot remove client from room because no clientId was provided!","warning");return this._entity},clientRooms:function(t){return t!==void 0?this._clientRooms[t]||[]:(this.log("Cannot get/set the clientRoom id because no clientId was provided!","warning"),[])},clients:function(t){return t!==void 0?this._socketsByRoomId[t]:this._socketById},socket:function(t){return this._socketById[t]},acceptConnections:function(t){return t!==void 0?(this._acceptConnections=t,t?this.log("Server now accepting connections!"):this.log("Server no longer accepting connections!"),this._entity):this._acceptConnections},send:function(t,e,i){var o,n=this._networkCommandsLookup[t];n!==void 0?(o=String.fromCharCode(n),this._io.send([o,e],i)):this.log('Cannot send network packet with command "'+t+'" because the command has not been defined!',"error")},begin:function(){},add:function(t,e){var i,o=this._networkCommandsLookup[t];o!==void 0?(i=String.fromCharCode(o),this.snapshot.push([i,e])):this.log('Cannot send network packet with command "'+t+'" because the command has not been defined!',"error")},flush:function(t){var e,i=this._networkCommandsLookup._alexBatch;i!==void 0?(e=String.fromCharCode(i),this._io.send([e,this.snapshot],t),this.snapshot=[]):this.log("_alexBatch error @ flush")},request:function(t,e,i){var o={id:this.newIdHex(),cmd:t,data:e,callback:i,timestamp:(new Date).getTime()};this._requests[o.id]=o,this.send("_igeRequest",{id:o.id,cmd:t,data:o.data})},response:function(t,e){var i=this._requests[t];i&&(this.send("_igeResponse",{id:t,cmd:i.commandName,data:e},i.clientId),delete this._requests[t])},newIdHex:function(){return this._idCounter++,(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16)},_originIsAllowed:function(){return!0},_onClientConnect:function(t){var e=this,i=t._socket.remoteAddress,o=ige.server.bannedIps,n="",s=!1;for(index in o)o[i]!=void 0&&(console.log("banned player detected! IP "+i),s=!0,n+=" player is banned.");var r=!1,a=!1,h=Object.keys(ige.server.units).length;ige.server.maxPlayersAllowed>h||(r=!0,n+=" server is full.");var i=t._socket.remoteAddress;if(ige.server.duplicateIpCount[i]!=void 0)if(ige.server.duplicateIpCount[i]<ige.server.maxDuplicateIpsAllowed)ige.server.duplicateIpCount[i]++;else{var a=!0;n+=" too many duplicate IPs detected."}else ige.server.duplicateIpCount[i]=1;!this._acceptConnections||s||r||a?(this.log("Rejecting connection with id "+t.id+" "+n),ige.network.send("playerDisconnect",{reason:n,clientId:clientId}),t.close()):this.emit("connect",t)?t.close():(this.log("Accepted connection with socket id "+t.id+" ip "+i),this._socketById[t.id]=t,this._clientRooms[t.id]=this._clientRooms[t.id]||[],t.on("message",function(i){e._onClientMessage.apply(e,[i,t.id])}),t.on("disconnect",function(i){e._onClientDisconnect.apply(e,[i,t])}),t.send({cmd:"init",ncmds:this._networkCommandsLookup,ts:ige._timeScale,ct:ige._currentTime}),this._sendTimeSync(void 0,t.id))},_onClientMessage:function(t,e){if(t[0]!=void 0&&t[0].charCodeAt(0)!=void 0){var i=t[0].charCodeAt(0),o=this._networkCommandsIndex[i];this._networkCommands[o]&&this._networkCommands[o](t[1],e),this.emit(o,[t[1],e])}},_onRequest:function(t,e){t.clientId=e,this._requests[t.id]=t,this.debug()&&(console.log("onRequest",t),console.log("emitting",t.cmd,[t.id,t.data]),this._debugCounter++),this._networkCommands[t.cmd]&&this._networkCommands[t.cmd](t.data,e,t.id),this.emit(t.cmd,[t.id,t.data,e])},_onResponse:function(t,e){id=t.id,req=this._requests[id],this.debug()&&(console.log("onResponse",t),this._debugCounter++),req&&(req.callback(req.cmd,[t.data,e]),delete this._requests[id])},_onClientDisconnect:function(t,e){this.log("Client disconnected with id "+e.id),this.emit("disconnect",e.id),this.clientLeaveAllRooms(e.id),delete this._socketById[e.id]}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Ige$i_32Server);var Ige$i_32Component=$i_3.extend([{extension:$i_26,overwrite:!1}],{classId:"Ige$i_32Component",componentId:"network",init:function(t,e){this._entity=t,this._options=e,this._networkCommands={},this._networkCommandsIndex=[],this._networkCommandsLookup={},this._port=8e3,this._debug=!1,this._debugCounter=0,this._debugMax=0,this._clientRooms={},this._timeSyncInterval=1e4,this._timeSyncLog={},this._latency=0,ige.isClient&&(this._netio=Ige$i_32Client,this.implement(Ige$i_32Client)),this.log("Network component initiated with Net.IO version: "+this._netio.version)},debug:function(t){return t!==void 0?(this._debug=t,this._entity):(this._debugMax>0&&this._debugCounter>=this._debugMax&&(this._debug=!1,this._debugCounter=0),this._debug)},debugMax:function(t){return t!==void 0?(this._debugMax=t,this._entity):this._debugMax}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Ige$i_32Component);var $i_36={joinRoom:function(t){ige.network.send("igeChatJoinRoom",t)},sendToRoom:function(t,e,i){t!==void 0&&e!==void 0&&(msg={roomId:t,text:e,to:i},ige.network.send("igeChatMsg",msg))},_onMessageFromServer:function(t){var e=ige.chat;!e.emit("messageFromServer",[t])},_onJoinedRoom:function(t){var e=ige.chat;e.emit("joinedRoom",[t])||t.joined===!0},_onLeftRoom:function(t){var e=ige.chat;e.emit("leftRoom",[t])||console.log("We have left room:",t)},_onServerSentRoomList:function(t){var e=ige.chat;e.emit("roomList",[t])||console.log("Server sent room list:",t)},_onServerSentRoomUserList:function(t){var e=ige.chat;e.emit("roomUserList",[t])||console.log("Server sent room user list:",t)},_onRoomCreated:function(t){var e=ige.chat;e.emit("roomCreated",[t])||console.log("Server told us room was created:",t)},_onRoomRemoved:function(t){var e=ige.chat;e.emit("roomRemoved",[t])||console.log("Server told us room was removed:",t)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_36);var $i_37={createRoom:function(t,e,i){var o=ige.chat,n=i||ige.newIdHex();return o._rooms[i]={id:n,name:t,options:e,users:[]},o._entity.network.send("igeChatRoomCreated",i),i},removeRoom:function(t){var e=ige.chat;return e._rooms[t]?(e._entity.network.send("igeChatRoomRemoved",t),delete e._rooms[t],!0):!1},sendToRoom:function(t,e,i,o){var n=ige.chat;if(!this.isSpamming(o,e))if(n._rooms[t]){var s,r=n._rooms[t];e!==void 0?(s={roomId:t,text:e,from:o,to:i},i?r.users.indexOf(i)>-1?n._entity.network.send("igeChatMsg",s,i):n.log("Cannot send to user because specified user is not in room: "+i):n._entity.network.send("igeChatMsg",s,r.users)):n.log("Cannot send message to room with blank message!")}else n.log('Cannot send message to room with id "'+t+'" because it does not exist!')},isSpamming:function(t,e){if(now=new Date,this.lastMessageSentAt[t]==void 0)return this.lastMessageSentAt[t]=now,this.sentMessages[t]=[],!1;if(now-this.lastMessageSentAt[t]>1e3){if(this.lastMessageSentAt[t]=now,this.sentMessages[t].push({time:new Date,message:e}),this.sentMessages[t].length>2){timeElapsed=0,charCount=0;for(i in this.sentMessages[t])timeElapsed+=now-this.sentMessages[t][i].time,charCount+=this.sentMessages[t][i].message.length;if(charCount>80&&5e3>timeElapsed)return console.log("Spam detected from the user"+t+" sending "+charCount+" characters in last "+timeElapsed/1e3+" seconds"),this.lastMessageSentAt[t]=new Date(now.getTime()+12e4),!0;this.sentMessages[t].shift()}return!1}return!0},_onMessageFromClient:function(t,e){var i,o=ige.chat;if(require("sanitizer"),t.text=t.text.replace(/</g,"&lt;").replace(/>/g,"&gt;"),!o.emit("messageFromClient",[t,e]))if(t.roomId)if(i=o._rooms[t.roomId])if(i.users.indexOf(e)>-1){var n=t.text;n&&o.sendToRoom(t.roomId,t.text,t.to,e)}else console.log("User tried to send message to room they are not joined in!",t);else console.log("User tried to send message to room that doesn't exist!",t);else console.log("User tried to send message to room but didn't specify room id!",t)},_onJoinRoomRequestFromClient:function(t,e){var i=ige.chat;if(!i.emit("clientJoinRoomRequest",[t,e])){var o=i._rooms[t];i.log("Client wants to join room: ("+e+")",t),o&&(o.users[e]||(o.users.push(e),ige.network.send("igeChatJoinRoom",{roomId:t,joined:!0},e)))}},_onLeaveRoomRequestFromClient:function(t,e){self.emit("clientLeaveRoomRequest",[t,e])||console.log("Client wants to leave room: ("+e+")",t)},_onClientWantsRoomList:function(t,e){self.emit("clientRoomListRequest",[t,e])||console.log("Client wants the room list: ("+e+")",t)},_onClientWantsRoomUserList:function(t,e){self.emit("clientRoomUserListRequest",[t,e])||console.log("Client wants the room user list: ("+e+")",t)}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_37);var $i_38=$i_3.extend({classId:"$i_38",componentId:"chat",init:function(t,e){this._entity=t,this._options=e,this._rooms={},this.lastMessageSentAt=[],this.sentMessages=[],ige.isClient&&(this.implement($i_36),this._entity.network.define("igeChatMsg",this._onMessageFromServer).network.define("igeChatJoinRoom",this._onJoinedRoom).network.define("igeChatLeaveRoom",this._onLeftRoom).network.define("igeChatRoomList",this._onServerSentRoomList).network.define("igeChatRoomUserList",this._onServerSentRoomUserList).network.define("igeChatRoomCreated",this._onRoomCreated).network.define("igeChatRoomRemoved",this._onRoomRemoved)),this.log("Chat component initiated!")}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_38);var $i_43=$i_3.extend({classId:"$i_43",componentId:"cocoonJs",init:function(){this.detected=typeof ext!="undefined"&&ext.IDTK_APP!==void 0,this.detected&&this.log("CocoonJS support enabled!")},showInputDialog:function(t,e,i,o,n,s){this.detected?(t=t||"",e=e||"",i=i||"",o=o||"text",n=n||"Cancel",s=s||"OK",ext.IDTK_APP.makeCall("showTextDialog",t,e,i,o,n,s)):this.log("Cannot open CocoonJS input dialog! CocoonJS is not detected!","error")},showWebView:function(t){this.detected&&(ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('loadPath', '"+t+"')"),ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('show');"))},hideWebView:function(){this.detected&&ext.IDTK_APP.makeCall("forward","ext.IDTK_APP.makeCall('hide');")}}),$i_44={left:function(t,e){if(t!==void 0){if(t===null)delete this._uiLeft,delete this._uiLeftPercent;else if(delete this._uiCenter,delete this._uiCenterPercent,typeof t=="string"){this._uiLeftPercent=t;var i,o,n=parseInt(t,10);i=this._parent?this._parent._bounds2d.x:ige._bounds2d.x,o=i/100*n|0,this._uiLeft=o}else this._uiLeft=t,delete this._uiLeftPercent;return e||this._updateUiPosition(),this}return this._uiLeft},right:function(t,e){if(t!==void 0){if(t===null)delete this._uiRight,delete this._uiRightPercent;else if(delete this._uiCenter,delete this._uiCenterPercent,typeof t=="string"){this._uiRightPercent=t;var i,o,n=parseInt(t,10);i=this._parent?this._parent._bounds2d.x:ige._bounds2d.x,o=i/100*n|0,this._uiRight=o}else this._uiRight=t,delete this._uiRightPercent;return e||this._updateUiPosition(),this}return this._uiRight},center:function(t,e){if(t!==void 0){if(t===null)delete this._uiCenter,delete this._uiCenterPercent;else if(delete this._uiLeft,delete this._uiLeftPercent,delete this._uiRight,delete this._uiRightPercent,typeof t=="string"){this._uiCenterPercent=t;var i,o,n=parseInt(t,10);i=this._parent?this._parent._bounds2d.x2:ige._bounds2d.x2,o=i/100*n|0,this._uiCenter=o}else this._uiCenter=t,delete this._uiCenterPercent;return e||this._updateUiPosition(),this}return this._uiCenter},top:function(t,e){if(t!==void 0){if(t===null)delete this._uiTop,delete this._uiTopPercent;else if(delete this._uiMiddle,delete this._uiMiddlePercent,typeof t=="string"){this._uiTopPercent=t;var i,o,n=parseInt(t,10);i=this._parent?this._parent._bounds2d.y:ige._bounds2d.y,o=i/100*n|0,this._uiTop=o}else this._uiTop=t,delete this._uiTopPercent;return e||this._updateUiPosition(),this}return this._uiTop},bottom:function(t,e){if(t!==void 0){if(t===null)delete this._uiBottom,delete this._uiBottomPercent;else if(delete this._uiMiddle,delete this._uiMiddlePercent,typeof t=="string"){this._uiBottomPercent=t;var i,o,n=parseInt(t,10);i=this._parent?this._parent._bounds2d.y:ige._bounds2d.y,o=i/100*n|0,this._uiBottom=o}else this._uiBottom=t,delete this._uiBottomPercent;return e||this._updateUiPosition(),this}return this._uiBottom},middle:function(t,e){if(t!==void 0){if(t===null)delete this._uiMiddle,delete this._uiMiddlePercent;else if(delete this._uiTop,delete this._uiTopPercent,delete this._uiBottom,delete this._uiBottomPercent,typeof t=="string"){this._uiMiddlePercent=t;var i,o,n=parseInt(t,10);i=this._parent?this._parent._bounds2d.y2:ige._bounds2d.y2,o=i/100*n|0,this._uiMiddle=o}else this._uiMiddle=t,delete this._uiMiddlePercent;return e||this._updateUiPosition(),this}return this._uiMiddle},width:function(t,e,i,o){if(t!==void 0){if(t===null)delete this._uiWidth,this._bounds2d.x=0,this._bounds2d.x2=0;else if(this._uiWidth=t,this._widthModifier=i!==void 0?i:0,typeof t=="string")if(this._parent){var n,s,r=this._parent._bounds2d.x,a=parseInt(t,10);n=r/100*a+this._widthModifier|0,e&&(s=n/this._bounds2d.x,this.height(this._bounds2d.y/s,!1,0,o)),this._bounds2d.x=n,this._bounds2d.x2=Math.floor(this._bounds2d.x/2)}else{var r=ige._bounds2d.x,a=parseInt(t,10);this._bounds2d.x=r/100*a+this._widthModifier|0,this._bounds2d.x2=Math.floor(this._bounds2d.x/2)}else{if(e){var s=t/this._bounds2d.x;this.height(this._bounds2d.y*s,!1,0,o)}this._bounds2d.x=t,this._bounds2d.x2=Math.floor(this._bounds2d.x/2)}return o||this._updateUiPosition(),this}return this._bounds2d.x},height:function(t,e,i,o){if(t!==void 0){if(t===null)delete this._uiHeight,this._bounds2d.y=0,this._bounds2d.y2=0;else if(this._uiHeight=t,this._heightModifier=i!==void 0?i:0,typeof t=="string")if(this._parent){var n,s,r=this._parent._bounds2d.y,a=parseInt(t,10);n=r/100*a+this._heightModifier|0,e&&(s=n/this._bounds2d.y,this.width(this._bounds2d.x/s,!1,0,o)),this._bounds2d.y=n,this._bounds2d.y2=Math.floor(this._bounds2d.y/2)}else{var r=ige._bounds2d.y,a=parseInt(t,10);this._bounds2d.y=r/100*a+this._heightModifier|0,this._bounds2d.y2=Math.floor(this._bounds2d.y/2)}else{if(e){var s=t/this._bounds2d.y;this.width(this._bounds2d.x*s,!1,0,o)}this._bounds2d.y=t,this._bounds2d.y2=Math.floor(this._bounds2d.y/2)}return o||this._updateUiPosition(),this}return this._bounds2d.y},autoScaleX:function(t,e){return t!==void 0?(this._autoScaleX=t,this._autoScaleLockAspect=e,this._updateUiPosition(),this):this._autoScaleX},autoScaleY:function(t,e){return t!==void 0?(this._autoScaleY=t,this._autoScaleLockAspect=e,this._updateUiPosition(),this):this._autoScaleY},updateUiChildren:function(){var t,e,i=this._children;if(i){t=i.length;while(t--)e=i[t],e._updateUiPosition&&e._updateUiPosition(),typeof e.updateUiChildren=="function"&&e.updateUiChildren()}return this},_updateUiPosition:function(){if(this._parent){var t,e,i,o=this._parent._bounds2d,n=this._bounds2d.multiplyPoint(this._scale);this._autoScaleX&&(t=parseInt(this._autoScaleX,10),e=o.x/100*t,i=e/this._bounds2d.x,this._scale.x=i,this._autoScaleLockAspect&&(this._scale.y=i)),this._autoScaleY&&(t=parseInt(this._autoScaleY,10),e=o.y/100*t,i=e/this._bounds2d.y,this._scale.y=i,this._autoScaleLockAspect&&(this._scale.x=i)),this._uiWidth&&this.width(this._uiWidth,!1,this._widthModifier,!0),this._uiHeight&&this.height(this._uiHeight,!1,this._heightModifier,!0),this._uiCenterPercent&&this.center(this._uiCenterPercent,!0),this._uiMiddlePercent&&this.middle(this._uiMiddlePercent,!0),this._uiLeftPercent&&this.left(this._uiLeftPercent,!0),this._uiRightPercent&&this.right(this._uiRightPercent,!0),this._uiTopPercent&&this.top(this._uiTopPercent,!0),this._uiBottomPercent&&this.bottom(this._uiBottomPercent,!0),this._uiCenter!==void 0?this._translate.x=Math.floor(this._uiCenter):this._uiLeft!==void 0&&this._uiRight!==void 0?(this.width(o.x-this._uiLeft-this._uiRight,!1,0,!0),this._translate.x=Math.floor(this._uiLeft+n.x2-o.x2)):(this._uiLeft!==void 0&&(this._translate.x=Math.floor(this._uiLeft+n.x2-o.x2)),this._uiRight!==void 0&&(this._translate.x=Math.floor(o.x2-n.x2-this._uiRight))),this._uiMiddle!==void 0?this._translate.y=Math.floor(this._uiMiddle):this._uiTop!==void 0&&this._uiBottom!==void 0?(this.height(o.y-this._uiTop-this._uiBottom,!1,0,!0),this._translate.y=Math.floor(this._uiTop+n.y2-o.y2)):(this._uiTop!==void 0&&(this._translate.y=Math.floor(this._uiTop+n.y2-o.y2)),this._uiBottom!==void 0&&(this._translate.y=Math.floor(o.y2-n.y2-this._uiBottom))),this.emit("uiUpdate"),this.cacheDirty(!0)}}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_44);var $i_45={color:function(t){return t!==void 0?(this._color=t,this.cacheDirty(!0),this):this._color},backgroundImage:function(t,e){if(t&&t.image){if(e||(e="no-repeat"),this._patternRepeat=e,this._patternTexture=t,this._backgroundSize?(t.resize(this._backgroundSize.x,this._backgroundSize.y),this._patternWidth=this._backgroundSize.x,this._patternHeight=this._backgroundSize.y):(this._patternWidth=t.image.width,this._patternHeight=t.image.height),this._cell>1){var i=document.createElement("canvas"),o=i.getContext("2d"),n=t._cells[this._cell];i.width=n[2],i.height=n[3],o.drawImage(t.image,n[0],n[1],n[2],n[3],0,0,n[2],n[3]),this._patternFill=ige._ctx.createPattern(i,e)}else this._patternFill=ige._ctx.createPattern(t.image,e);return t.restoreOriginal(),this.cacheDirty(!0),this}return this._patternFill},backgroundSize:function(t,e){return t!==void 0&&e!==void 0?(typeof t=="string"&&t!=="auto"&&(t=this._bounds2d.x/100*parseInt(t,10)),typeof e=="string"&&e!=="auto"&&(e=this._bounds2d.y/100*parseInt(e,10)),t==="auto"&&e==="auto"?(this.log("Cannot set background x and y both to auto!","error"),this):(t==="auto"?t=this._patternTexture&&this._patternTexture.image?this._patternTexture.image.width*(e/this._patternTexture.image.height):this._bounds2d.x*(e/this._bounds2d.y):e==="auto"&&(e=this._patternTexture&&this._patternTexture.image?this._patternTexture.image.height*(t/this._patternTexture.image.width):this._bounds2d.y*(t/this._bounds2d.x)),t!==0&&e!==0?(this._backgroundSize={x:t,y:e},this._patternTexture&&this._patternRepeat&&this.backgroundImage(this._patternTexture,this._patternRepeat),this.cacheDirty(!0)):this.log("Cannot set background to zero-sized x or y!","error"),this)):this._backgroundSize},backgroundColor:function(t){return t!==void 0?(this._backgroundColor=t,this.cacheDirty(!0),this):this._backgroundColor},backgroundPosition:function(t,e){return t!==void 0&&e!==void 0?(this._backgroundPosition={x:t,y:e},this.cacheDirty(!0),this):this._backgroundPosition},borderColor:function(t){return t!==void 0?(this._borderColor=t,this._borderLeftColor=t,this._borderTopColor=t,this._borderRightColor=t,this._borderBottomColor=t,this.cacheDirty(!0),this):this._borderColor},borderLeftColor:function(t){return t!==void 0?(this._borderLeftColor=t,this.cacheDirty(!0),this):this._borderLeftColor},borderTopColor:function(t){return t!==void 0?(this._borderTopColor=t,this.cacheDirty(!0),this):this._borderTopColor},borderRightColor:function(t){return t!==void 0?(this._borderRightColor=t,this.cacheDirty(!0),this):this._borderRightColor},borderBottomColor:function(t){return t!==void 0?(this._borderBottomColor=t,this.cacheDirty(!0),this):this._borderBottomColor},borderWidth:function(t){return t!==void 0?(this._borderWidth=t,this._borderLeftWidth=t,this._borderTopWidth=t,this._borderRightWidth=t,this._borderBottomWidth=t,this.cacheDirty(!0),this):this._borderWidth},borderLeftWidth:function(t){return t!==void 0?(this._borderLeftWidth=t,this.cacheDirty(!0),this):this._borderLeftWidth},borderTopWidth:function(t){return t!==void 0?(this._borderTopWidth=t,this.cacheDirty(!0),this):this._borderTopWidth},borderRightWidth:function(t){return t!==void 0?(this._borderRightWidth=t,this.cacheDirty(!0),this):this._borderRightWidth},borderBottomWidth:function(t){return t!==void 0?(this._borderBottomWidth=t,this.cacheDirty(!0),this):this._borderBottomWidth},borderRadius:function(t){return t!==void 0?(this._borderRadius=t,this._borderTopLeftRadius=t,this._borderTopRightRadius=t,this._borderBottomRightRadius=t,this._borderBottomLeftRadius=t,this.cacheDirty(!0),this):this._borderRadius},padding:function(t,e,i,o){return this._paddingLeft=t,this._paddingTop=e,this._paddingRight=i,this._paddingBottom=o,this.cacheDirty(!0),this},paddingLeft:function(t){return t!==void 0?(this._paddingLeft=t,this.cacheDirty(!0),this):this._paddingLeft},paddingTop:function(t){return t!==void 0?(this._paddingTop=t,this.cacheDirty(!0),this):this._paddingTop},paddingRight:function(t){return t!==void 0?(this._paddingRight=t,this.cacheDirty(!0),this):this._paddingRight},paddingBottom:function(t){return t!==void 0?(this._paddingBottom=t,this.cacheDirty(!0),this):this._paddingBottom}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_45);var nullMethod=function(){},$i_49=function(){this.dummy=!0,this.width=0,this.height=0};$i_49.prototype.getContext=function(){return $i_50},typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_49);var nullMethod=function(){},$i_50={dummy:!0,save:nullMethod,restore:nullMethod,translate:nullMethod,rotate:nullMethod,scale:nullMethod,drawImage:nullMethod,fillRect:nullMethod,strokeRect:nullMethod,stroke:nullMethod,fill:nullMethod,rect:nullMethod,moveTo:nullMethod,lineTo:nullMethod,arc:nullMethod,clearRect:nullMethod,beginPath:nullMethod,clip:nullMethod,transform:nullMethod,setTransform:nullMethod,fillText:nullMethod};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_50);var $i_53=$i_2.extend({classId:"$i_53",init:function(t,e,i,o){this._targetObj=t,this._steps=[],this._currentStep=-1,e!==void 0&&this.stepTo(e),this._durationMs=i!==void 0?i:0,this._started=!1,this._stepDirection=!1,o&&o.easing?this.easing(o.easing):this.easing("none"),o&&o.startTime!==void 0&&this.startTime(o.startTime),o&&o.beforeTween!==void 0&&this.beforeTween(o.beforeTween),o&&o.afterTween!==void 0&&this.afterTween(o.afterTween)},targetObj:function(t){return t!==void 0&&(this._targetObj=t),this},properties:function(t){return t!==void 0&&(this._steps=[],this._currentStep=-1,this.stepTo(t)),this},repeatMode:function(t,e){return t!==void 0?(this._repeatMode=t,this.repeatCount(e),this):this._repeatMode},repeatCount:function(t){return t!==void 0?(this._repeatCount=t,this._repeatedCount=0,this):this._repeatCount},step:function(t,e,i){return this.log("The step method has been renamed to stepTo(). Please update your code as the step() method will soon be removed.","warning"),this.stepTo(t,e,i),this},stepTo:function(t,e,i,o){return t!==void 0&&this._steps.push({props:t,durationMs:e,easing:i,isDelta:o}),this},stepBy:function(t,e,i){return this.stepTo(t,e,i,!0),this},duration:function(t){return t!==void 0&&(this._durationMs=t),this},beforeTween:function(t){return t!==void 0&&(this._beforeTween=t),this},afterTween:function(t){return t!==void 0&&(this._afterTween=t),this},beforeStep:function(t){return t!==void 0&&(this._beforeStep=t),this},afterStep:function(t){return t!==void 0&&(this._afterStep=t),this},afterChange:function(t){return t!==void 0&&(this._afterChange=t),this},targetObject:function(){return this._targetObj},easing:function(t){return t!==void 0&&(ige.tween.easing[t]?this._easing=t:this.log("The easing method you have selected does not exist, please use a valid easing method. For a list of easing methods please inspect ige.tween.easing from your console.","error",ige.tween.easing)),this},startTime:function(t){return t!==void 0&&(this._startTime=t),this},start:function(t){return t!==void 0&&this.startTime(t+ige._currentTime),ige.tween.start(this),this._targetObj._tweenArr=this._targetObj._tweenArr||[],this._targetObj._tweenArr.push(this),this},stop:function(){return ige.tween.stop(this),this._targetObj._tweenArr&&this._targetObj._tweenArr.pull(this),this},startAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(t){t.start()}),this},stopAll:function(){return this._targetObj._tweenArr&&this._targetObj._tweenArr.eachReverse(function(t){t.stop()}),this}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_53);var $i_54=$i_3.extend({classId:"$i_54",$i_54:!0,init:function(t){this._loaded=!1,this._cells=[],this._smoothing=ige._globalSmoothing,this._applyFilters=[],this._applyFiltersData=[],this._preFilters=[],this._preFiltersData=[];var e=typeof t;e==="string"&&t&&this.url(t),e==="object"&&this.assignSmartTextureImage(t)},id:function(t){if(t!==void 0){if(!ige._register[t])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=t,ige.register(this),this;if(ige._register[t]===this)return this;this.log('Cannot set ID of object to "'+t+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=this._url?ige.newIdFromString(this._url):ige.newIdHex(),ige.register(this)),this._id},url:function(t){return t!==void 0?(this._url=t,t.substr(t.length-2,2)==="js"?this._loadScript(t):this._loadImage(t),this):this._url},_loadImage:function(t){var e,i=this;ige.isClient&&(ige.textureLoadStart(t,this),ige._textureImageStore[t]?(e=this.image=this._originalImage=ige._textureImageStore[t],e._igeTextures.push(this),e._loaded&&(i._mode=0,i.sizeX(e.width),i.sizeY(e.height),e.width%2&&this.log("This texture's width is not divisible by 2 which will cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: "+this._url,"warning"),e.height%2&&this.log("This texture's height is not divisible by 2 which will cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: "+this._url,"warning"),i._cells[1]=[0,0,i._sizeX,i._sizeY],i._textureLoaded())):(e=ige._textureImageStore[t]=this.image=this._originalImage=new Image,e._igeTextures=e._igeTextures||[],e._igeTextures.push(this),e.onload=function(){e._loaded=!0,ige.log("Texture image ("+t+") loaded successfully");
var i,o,n=e._igeTextures,s=n.length;for(i=0;s>i;i++)o=n[i],o._mode=0,o.sizeX(e.width),o.sizeY(e.height),o._cells[1]=[0,0,o._sizeX,o._sizeY],o._textureLoaded()},e.src=t))},_textureLoaded:function(){var t=this;setTimeout(function(){t._loaded=!0,t.emit("loaded"),ige.textureLoadEnd(t.image.src,t)},5)},_loadScript:function(scriptUrl){var textures=ige.textures,rs_sandboxContext,self=this,scriptElem;ige.textureLoadStart(scriptUrl,this),ige.isClient&&(scriptElem=document.createElement("script"),scriptElem.onload=function(data){self.log('Texture script "'+scriptUrl+'" loaded successfully'),eval(data),self._mode=1,self.script=image,typeof image.init=="function"&&image.init.apply(image,[self]),self._loaded=!0,self.emit("loaded"),ige.textureLoadEnd(scriptUrl,self)},scriptElem.addEventListener("error",function(){self.log("Error loading smart texture script file: "+scriptUrl,"error")},!0),scriptElem.src=scriptUrl,document.getElementsByTagName("head")[0].appendChild(scriptElem))},assignSmartTextureImage:function(t){var e=(ige.textures,this);typeof t.render=="function"?(e._mode=1,e.script=t,typeof t.init=="function"&&t.init.apply(t,[e]),e._loaded=!0,e.emit("loaded")):this.log("Cannot assign smart texture because it doesn't have a render() method!","error")},_setImage:function(t){var e;ige.isClient&&(e=this.image=this._originalImage=t,e._igeTextures=e._igeTextures||[],e._loaded=!0,this._mode=0,this.sizeX(e.width),this.sizeY(e.height),this._cells[1]=[0,0,this._sizeX,this._sizeY])},textureFromCell:function(t){var e=new $i_54,i=this;return this._loaded?this._textureFromCell(e,t):this.on("loaded",function(){i._textureFromCell(e,t)}),e},_textureFromCell:function(t,e){var i,o,n,s;i=typeof e=="string"?this.cellIdToIndex(e):e,this._cells[i]?(o=this._cells[i],n=document.createElement("canvas"),s=n.getContext("2d"),this._smoothing?(s.imageSmoothingEnabled=!0,s.mozImageSmoothingEnabled=!0):(s.imageSmoothingEnabled=!1,s.mozImageSmoothingEnabled=!1),n.width=o[2],n.height=o[3],s.drawImage(this._originalImage,o[0],o[1],o[2],o[3],0,0,o[2],o[3]),t._setImage(n),t._loaded=!0,setTimeout(function(){t.emit("loaded")},1)):this.log("Unable to create new texture from passed cell index ("+e+") because the cell does not exist!","warning")},sizeX:function(t){this._sizeX=t},sizeY:function(t){this._sizeY=t},resize:function(t,e,i){this._originalImage&&(this._loaded?(this._textureCtx||(this._textureCanvas=document.createElement("canvas")),this._textureCanvas.width=t,this._textureCanvas.height=e,this._textureCtx=this._textureCanvas.getContext("2d"),this._smoothing?(this._textureCtx.imageSmoothingEnabled=!0,this._textureCtx.webkitImageSmoothingEnabled=!0,this._textureCtx.mozImageSmoothingEnabled=!0):(this._textureCtx.imageSmoothingEnabled=!1,this._textureCtx.webkitImageSmoothingEnabled=!1,this._textureCtx.mozImageSmoothingEnabled=!1),i||this._textureCtx.drawImage(this._originalImage,0,0,this._originalImage.width,this._originalImage.height,0,0,t,e),this.image=this._textureCanvas):this.log("Cannot resize texture because the texture image ("+this._url+") has not loaded into memory yet!","error"))},resizeByPercent:function(t,e,i){this._originalImage&&(this._loaded?(t=Math.floor(this.image.width/100*t),e=Math.floor(this.image.height/100*e),this._textureCtx||(this._textureCanvas=document.createElement("canvas")),this._textureCanvas.width=t,this._textureCanvas.height=e,this._textureCtx=this._textureCanvas.getContext("2d"),this._smoothing?(this._textureCtx.imageSmoothingEnabled=!0,this._textureCtx.webkitImageSmoothingEnabled=!0,this._textureCtx.mozImageSmoothingEnabled=!0):(this._textureCtx.imageSmoothingEnabled=!1,this._textureCtx.webkitImageSmoothingEnabled=!1,this._textureCtx.mozImageSmoothingEnabled=!1),i||this._textureCtx.drawImage(this._originalImage,0,0,this._originalImage.width,this._originalImage.height,0,0,t,e),this.image=this._textureCanvas):this.log("Cannot resize texture because the texture image ("+this._url+") has not loaded into memory yet!","error"))},restoreOriginal:function(){this.image=this._originalImage,delete this._textureCtx,delete this._textureCanvas,this.removeFilters()},smoothing:function(t){return t!==void 0?(this._smoothing=t,this):this._smoothing},render:function(t,e){if(e._cell!==null){if(this._smoothing?(ige._ctx.imageSmoothingEnabled=!0,ige._ctx.mozImageSmoothingEnabled=!0):(ige._ctx.imageSmoothingEnabled=!1,ige._ctx.mozImageSmoothingEnabled=!1),this._mode===0){var i=this._cells[e._cell],o=e._bounds2d,n=e._renderPos;if(i){if(this._preFilters.length>0&&this._textureCtx){this._textureCtx.clearRect(0,0,this._textureCanvas.width,this._textureCanvas.height),this._textureCtx.drawImage(this._originalImage,0,0);var s=this;this._applyFilters.forEach(function(t,e){s._textureCtx.save(),t(s._textureCanvas,s._textureCtx,s._originalImage,s,s._applyFiltersData[e]),s._textureCtx.restore()}),this._preFilters.forEach(function(t,e){s._textureCtx.save(),t(s._textureCanvas,s._textureCtx,s._originalImage,s,s._preFiltersData[e]),s._textureCtx.restore()})}t.drawImage(this.image,i[0],i[1],i[2],i[3],n.x,n.y,o.x,o.y),ige._drawCount++}else this.log("Cannot render texture using cell "+e._cell+" because the cell does not exist in the assigned texture!","error")}this._mode===1&&(t.save(),this.script.render(t,e,this),t.restore(),ige._drawCount++)}},removeFilter:function(t){var e;while((e=this._preFilters.indexOf(t))>-1)this._preFilters[e]=void 0,this._preFiltersData[e]=void 0;while((e=this._applyFilters.indexOf(t))>-1)this._applyFilters[e]=void 0,this._applyFiltersData[e]=void 0;this._preFilters=this._preFilters.clean(),this._preFiltersData=this._preFiltersData.clean(),this._applyFilters=this._applyFilters.clean(),this._applyFiltersData=this._applyFiltersData.clean(),this._rerenderFilters()},removeFilters:function(){this._applyFilters=[],this._applyFiltersData=[],this._preFilters=[],this._preFiltersData=[],this._rerenderFilters()},_rerenderFilters:function(){if(this._textureCanvas){this.resize(this._textureCanvas.width,this._textureCanvas.height,!1);var t=this;this._applyFilters.forEach(function(e,i){t._textureCtx.save(),e(t._textureCanvas,t._textureCtx,t._originalImage,t,t._applyFiltersData[i]),t._textureCtx.restore()})}},preFilter:function(t,e){return t!==void 0?(this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d"),this._smoothing?(this._textureCtx.imageSmoothingEnabled=!0,this._textureCtx.webkitImageSmoothingEnabled=!0,this._textureCtx.mozImageSmoothingEnabled=!0):(this._textureCtx.imageSmoothingEnabled=!1,this._textureCtx.webkitImageSmoothingEnabled=!1,this._textureCtx.mozImageSmoothingEnabled=!1)),this.image=this._textureCanvas,this._preFilters[this._preFilters.length]=t,this._preFiltersData[this._preFiltersData.length]=e?e:{}),this):(this.log("Cannot use pre-filter, no filter method was passed!","warning"),this._preFilters[this._preFilters.length-1])},applyFilter:function(t,e){return this._loaded?t!==void 0?this._originalImage&&(this._textureCtx||(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this._originalImage.width,this._textureCanvas.height=this._originalImage.height,this._textureCtx=this._textureCanvas.getContext("2d"),this._textureCtx.clearRect(0,0,this._textureCanvas.width,this._textureCanvas.height),this._textureCtx.drawImage(this._originalImage,0,0),this._smoothing?(this._textureCtx.imageSmoothingEnabled=!0,this._textureCtx.webkitImageSmoothingEnabled=!0,this._textureCtx.mozImageSmoothingEnabled=!0):(this._textureCtx.imageSmoothingEnabled=!1,this._textureCtx.webkitImageSmoothingEnabled=!1,this._textureCtx.mozImageSmoothingEnabled=!1)),this.image=this._textureCanvas,this._preFilters.length>0||(this._textureCtx.save(),t(this._textureCanvas,this._textureCtx,this._originalImage,this,e),this._textureCtx.restore()),this._applyFilters[this._applyFilters.length]=t,this._applyFiltersData[this._applyFiltersData.length]=e?e:{}):this.log("Cannot apply filter, no filter method was passed!","warning"):this.log("Cannot apply filter, the texture you are trying to apply the filter to has not yet loaded!","error"),this},pixelData:function(t,e){if(this._loaded){if(this.image)return this._textureCtx?this._textureCtx=this._textureCtx:(this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=this.image.width,this._textureCanvas.height=this.image.height,this._textureCtx=this._textureCanvas.getContext("2d"),this._smoothing?(this._textureCtx.imageSmoothingEnabled=!0,this._textureCtx.webkitImageSmoothingEnabled=!0,this._textureCtx.mozImageSmoothingEnabled=!0):(this._textureCtx.imageSmoothingEnabled=!1,this._textureCtx.webkitImageSmoothingEnabled=!1,this._textureCtx.mozImageSmoothingEnabled=!1),this._textureCtx.drawImage(this.image,0,0)),this._textureCtx.getImageData(t,e,1,1).data}else this.log("Cannot read pixel data, the texture you are trying to read data from has not yet loaded!","error");return this},clone:function(){return this.textureFromCell(1)},stringify:function(){var t="new "+this.classId()+"('"+this._url+"')";return t+=this._stringify()},_stringify:function(){return""},destroy:function(){delete this._eventListeners,this.image&&this.image._igeTextures&&this.image._igeTextures.pull(this),ige._textureStore.pull(this),delete this.image,delete this.script,delete this._textureCanvas,delete this._textureCtx,this._destroyed=!0}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_54);var $i_55=$i_54.extend({classId:"$i_55",$i_56:!0,init:function(t,e,i){var o=this;o.horizontalCells(e||1),o.verticalCells(i||1),$i_54.prototype.init.call(this,t)},_textureLoaded:function(){this.image?(this._sheetImage=this.image,this._applyCells()):this.log("Cannot create cell-sheet because texture has not loaded an image!","error"),$i_54.prototype._textureLoaded.call(this)},cellCount:function(){return this.horizontalCells()*this.verticalCells()},horizontalCells:function(t){return t!==void 0?(this._cellColumns=t,this):this._cellColumns},verticalCells:function(t){return t!==void 0?(this._cellRows=t,this):this._cellRows},_applyCells:function(){var t,e,i,o,n,s,r,a,h;if(this.image&&this._cellRows&&this._cellColumns)if(t=this._sizeX,e=this._sizeY,i=this._cellRows,o=this._cellColumns,n=this._cellWidth=t/o,s=this._cellHeight=e/i,n!==parseInt(n,10)&&this.log("Cell width is a floating-point number! (Image Width "+t+" / Number of Columns "+o+" = "+n+") in file: "+this._url,"warning"),s!==parseInt(s,10)&&this.log("Cell height is a floating-point number! (Image Height "+e+" / Number of Rows "+i+" = "+s+")  in file: "+this._url,"warning"),i>1||o>1)for(r=1;i*o>=r;r++)h=Math.ceil(r/o)-1,a=r-o*h-1,this._cells[r]=[a*n,h*s,n,s];else this._cells[1]=[0,0,this._sizeX,this._sizeY]},stringify:function(){var t="new "+this.classId()+"('"+this.url()+"', "+this.horizontalCells()+", "+this.verticalCells()+")";return t}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_54);var $i_56=$i_54.extend({classId:"$i_56",$i_56:!0,init:function(t,e){this._spriteCells=e,$i_54.prototype.init.call(this,t)},_textureLoaded:function(){if(this.image){this._sheetImage=this.image;var t,e=this._spriteCells;for(e||(this.log("No cell data provided for sprite sheet, attempting to automatically detect sprite bounds..."),e=this.detectCells(this._sheetImage)),t=0;e.length>t;t++)this._cells[t+1]=e[t],this._checkModulus&&(e[t][2]%2&&this.log("This texture's cell definition defines a cell width is not divisible by 2 which can cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: "+this._url,"warning",e[t]),e[t][3]%2&&this.log("This texture's cell definition defines a cell height is not divisible by 2 which can cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: "+this._url,"warning",e[t]))}else this.log("Cannot create cell-sheet because texture has not loaded an image!","error");$i_54.prototype._textureLoaded.call(this)},detectCells:function(t){var e,i,o,n,s=document.createElement("canvas"),r=s.getContext("2d"),a=[];for(s.width=t.width,s.height=t.height,r.drawImage(t,0,0),e=r.getImageData(0,0,s.width,s.height),o=0;s.height>o;o++)for(i=0;s.width>i;i++)if(!e.isTransparent(i,o)&&!this._pixelInRects(a,i,o)){if(n=this._determineRect(e,i,o),!n)return this.log("Cannot automatically determine sprite bounds!","warning"),[];a.push(n)}return a},_pixelInRects:function(t,e,i){var o,n,s=t.length;for(o=0;s>o;o++)if(n=t[o],!(n.x>e||e>n.x+n.width||n.y>i||i>n.y+n.height))return!0;return!1},_determineRect:function(t,e,i){var o,n=[{x:e,y:i}],s={x:e,y:i,width:1,height:1};while(n.length)o=n.shift(),o.x>s.x+s.width&&(s.width=o.x-s.x+1),o.y>s.y+s.height&&(s.height=o.y-s.y+1),s.x>o.x&&(s.width+=s.x-o.x,s.x=o.x),s.y>o.y&&(s.height+=s.y-o.y,s.y=o.y),t.isTransparent(o.x-1,o.y-1)||(t.makeTransparent(o.x-1,o.y-1),n.push({x:o.x-1,y:o.y-1})),t.isTransparent(o.x,o.y-1)||(t.makeTransparent(o.x,o.y-1),n.push({x:o.x,y:o.y-1})),t.isTransparent(o.x+1,o.y-1)||(t.makeTransparent(o.x+1,o.y-1),n.push({x:o.x+1,y:o.y-1})),t.isTransparent(o.x-1,o.y)||(t.makeTransparent(o.x-1,o.y),n.push({x:o.x-1,y:o.y})),t.isTransparent(o.x+1,o.y)||(t.makeTransparent(o.x+1,o.y),n.push({x:o.x+1,y:o.y})),t.isTransparent(o.x-1,o.y+1)||(t.makeTransparent(o.x-1,o.y+1),n.push({x:o.x-1,y:o.y+1})),t.isTransparent(o.x,o.y+1)||(t.makeTransparent(o.x,o.y+1),n.push({x:o.x,y:o.y+1})),t.isTransparent(o.x+1,o.y+1)||(t.makeTransparent(o.x+1,o.y+1),n.push({x:o.x+1,y:o.y+1}));return[s.x,s.y,s.width,s.height]},cellCount:function(){return this._cells.length},cellIdToIndex:function(t){var e,i=this._cells;for(e=1;i.length>e;e++)if(i[e][4]===t)return e;return-1},stringify:function(){var t="new "+this.classId()+"('"+this.url()+"', "+(this._cells+"")+")";return t}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_56);var $i_57=$i_54.extend({classId:"$i_57",init:function(t){$i_54.prototype.init.call(this,t),arguments[1]&&this.log("Font sheets no longer accept a caching limit value. All font output is now cached by default via the actual font entity - fontEntity.cache(true);","warning"),this._noDimensions=!0,this.on("loaded",function(){if(this.image)if(this._sheetImage=this.image,this._fontData=this.decodeHeader(),this._charCodeMap=this._fontData.characters.charCodes,this._charPosMap=this._fontData.characters.charPosition,this._measuredWidthMap=this._fontData.characters.measuredWidth,this._pixelWidthMap=this._fontData.characters.pixelWidth,this._fontData){var t=this._fontData.font;this.log("Loaded font sheet for font: "+t.fontName+" @ "+t.fontSize+t.fontSizeUnit+" in "+t.fontColor)}else this.log("Could not load data header for font sheet: "+this.image.src,"error")})},decodeHeader:function(){var t=document.createElement("canvas"),e=t.getContext("2d");return t.width=this.image.width,t.height=1,e.drawImage(this.image,0,0),this._decode(t,0,0,this.image.width)},_decode:function(t,e,i,o){"use strict";var n,s=t.getContext("2d"),r=s.getImageData(e,i,o,t.height).data,a=!0,h=0,l="";while(a){if(n=r[h]+""+" "+(r[h+1]+"")+" "+(r[h+2]+""),n==="3 2 1")return a=!1,JSON.parse(l);l+=String.fromCharCode(r[h])+String.fromCharCode(r[h+1])+String.fromCharCode(r[h+2]),h+=4,h>r.length&&(a=!1,console.log("Image JSON Decode Error!"))}},lineHeightModifier:function(t){t!==void 0&&(this._lineHeightModifier=t)},measureTextWidth:function(t){if(this._loaded){var e,i,o,n,s=this._charCodeMap,r=this._measuredWidthMap,a=[],h=0;for(t.indexOf("\n")>-1?a=t.split("\n"):a.push(t),o=0;a.length>o;o++){for(n=0,e=0;a[o].length>e;e++)i=s[a[o].charCodeAt(e)],n+=r[i]||0;n>h&&(h=n)}return n}return-1},render:function(t,e){if(e._renderText&&this._loaded){var i,o,n,s,r,a=t,h=e._renderText,l=[],c=this._charCodeMap,m=this._charPosMap,_=this._measuredWidthMap,u=this._pixelWidthMap,d=0,p=0,y=0,x=0,f=0,g=0,v=[],b=this._sizeY-2,C=0,w=0;switch(h.indexOf("\n")>-1?l=h.split("\n"):l.push(h),s=b*l.length,e._textAlignY){case 0:x=-(b*l.length/2)-e._textLineSpacing*((l.length-1)/2);break;case 1:x=-(b*l.length/2)-e._textLineSpacing*((l.length-1)/2);break;case 2:x=-(b*l.length/2)-e._textLineSpacing*((l.length-1)/2)}for(o=0;l.length>o;o++){for(i=l[o],n=0;i.length>n;n++)r=c[i.charCodeAt(n)],C+=_[r]||0;v[o]=C,C>w&&(w=C),C=0}switch(e._textAlignX){case 0:y=-e._bounds2d.x2;break;case 1:y=-w/2;break;case 2:y=e._bounds2d.x2-w}for(o=0;l.length>o;o++){switch(i=l[o],p=b*o+e._textLineSpacing*o,e._textAlignX){case 0:d=-e._bounds2d.x2;break;case 1:d=-v[o]/2;break;case 2:d=e._bounds2d.x2-v[o]}for(n=0;i.length>n;n++)r=c[i.charCodeAt(n)],a.drawImage(this.image,m[r],2,u[r],this._sizeY-2,Math.floor(f+d),Math.floor(g+x+p),u[r],this._sizeY-2),e._colorOverlay&&(a.save(),a.globalCompositeOperation="source-atop",a.fillStyle=e._colorOverlay,a.fillRect(Math.floor(f+d),Math.floor(g+x+p),u[r],this._sizeY-2),a.restore()),d+=_[r]||0,ige._drawCount++;d=0}}},destroy:function(){this.image=null,this.script=null}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_57);var $i_58={measureTextWidth:function(t,e){if(e._nativeFont){var i,o,n=[],s=0,r=document.createElement("canvas"),a=r.getContext("2d");for(t.indexOf("\n")>-1?n=t.split("\n"):n.push(t),a.font=e._nativeFont,a.textBaseline="middle",e._nativeStroke&&(a.lineWidth=e._nativeStroke,a.strokeStyle=e._nativeStrokeColor?e._nativeStrokeColor:e._colorOverlay),i=0;n.length>i;i++)o=a.measureText(n[i]).width,o>s&&(s=o);return s}return-1},render:function(t,e){if(e._nativeFont&&e._renderText){var i,o,n,s,r,a=e._renderText,h=[];for(t.font=e._nativeFont,t.textBaseline="middle",e._colorOverlay&&(t.fillStyle=e._colorOverlay),e._textAlignX===0&&(t.textAlign="left",t.translate(-e._bounds2d.x2,0)),e._textAlignX===1&&(t.textAlign="center"),e._textAlignX===2&&(t.textAlign="right",t.translate(e._bounds2d.x2,0)),e._nativeStroke&&(t.lineWidth=e._nativeStroke,t.strokeStyle=e._nativeStrokeColor?e._nativeStrokeColor:e._colorOverlay),a.indexOf("\n")>-1?h=a.split("\n"):h.push(a),s=Math.floor(e._bounds2d.y/h.length),o=-((s+e._textLineSpacing)/2)*(h.length-1),r=0;h.length>r;r++)n=o+s*r+e._textLineSpacing*r,i=t.measureText(h[r]),e._nativeStroke&&t.strokeText(h[r],0,n),t.fillText(h[r],0,n)}}},$i_59=$i_3.extend({classId:"$i_59",init:function(){this._newBorn=!0,this._alive=!0,this._mode=0,this._mountMode=0,this._parent=null,this._children=[],this._layer=0,this._depth=0,this._depthSortMode=0,this._timeStream=[],this._inView=!0,this._managed=1,this._specialProp=["_id","_parent","_children"]},alive:function(t){return t!==void 0?(this._alive=t,this):this._alive},managed:function(t){return t!==void 0?(this._managed=t,this):this._managed},id:function(t){if(t!==void 0){if(t===this._id)return this;if(!ige._register[t])return this._id&&ige._register[this._id]&&ige.unRegister(this),this._id=t,ige.register(this),this;ige._register[t]!==this&&this.log('Cannot set ID of object to "'+t+'" because that ID is already in use by another object!',"error")}return this._id||(this._id=ige.newIdHex(),ige.register(this)),this._id},category:function(t){return t!==void 0?(this._category&&this._category!==t&&ige.categoryUnRegister(this),this._category=t,t&&ige.categoryRegister(this),this):this._category},group:function(){this.log("The group() method has been renamed to category(). Please update your code.","error")},addGroup:function(){var t,e,i=arguments.length;while(i--)if(t=arguments[i],t instanceof Array){e=t.length;while(e--)this._groups&&this._groups.indexOf(t[e])!==-1||(this._groups=this._groups||[],this._groups.push(t[e]),ige.groupRegister(this,t[e]))}else this._groups&&this._groups.indexOf(t)!==-1||(this._groups=this._groups||[],this._groups.push(t),ige.groupRegister(this,t));return this},inGroup:function(t,e){return t?e?this.inAllGroups(t):this.inAnyGroup(t):!1},inAllGroups:function(t){var e,i;if(!(t instanceof Array))return this._groups&&this._groups.indexOf(t)!==-1;i=t.length;while(i--)if(e=t[i],e&&(!this._groups||this._groups.indexOf(e)===-1))return!1;return!0},inAnyGroup:function(t){var e,i;if(!(t instanceof Array))return this._groups&&this._groups.indexOf(t)>-1;i=t.length;while(i--)if(e=t[i],e&&this._groups&&this._groups.indexOf(e)>-1)return!0;return!1},groups:function(){return this._groups||[]},groupCount:function(){return this._groups?this._groups.length:0},removeGroup:function(){if(this._groups){var t,e,i=arguments.length;while(i--)if(t=arguments[i],t instanceof Array){e=t.length;while(e--)this._groups.pull(t[e]),ige.groupUnRegister(this,t[e])}else this._groups.pull(t),ige.groupUnRegister(this,t)}return this},removeAllGroups:function(){if(this._groups){var t=this._groups,e=t.length;while(e--)ige.groupUnRegister(this,t[e]);delete this._groups}return this},addBehaviour:function(t,e,i){if(typeof t=="string"){if(typeof e=="function")return i?(this._tickBehaviours=this._tickBehaviours||[],this._tickBehaviours.push({id:t,method:e})):(this._updateBehaviours=this._updateBehaviours||[],this._updateBehaviours.push({id:t,method:e})),this;this.log("The behaviour you passed is not a function! The second parameter of the call must be a function!","error")}else this.log("Cannot add behaviour to object because the specified behaviour id is not a string. You must provide two parameters with the addBehaviour() call, an id:String and a behaviour:Function. Adding a behaviour with an id allows you to remove it by it's id at a later stage!","error");return!1},removeBehaviour:function(t,e){if(t!==void 0){var i,o;if(i=e?this._tickBehaviours:this._updateBehaviours){o=i.length;while(o--)if(i[o].id===t)return i.splice(o,1),this}}return!1},hasBehaviour:function(t,e){if(t!==void 0){var i,o;if(i=e?this._tickBehaviours:this._updateBehaviours){o=i.length;while(o--)if(i[o].id===t)return!0}}return!1},drawBounds:function(t){return t!==void 0?(this._drawBounds=t,this):this._drawBounds},drawBoundsData:function(t){return t!==void 0?(this._drawBoundsData=t,this):this._drawBoundsData},drawMouse:function(t){return t!==void 0?(this._drawMouse=t,this):this._drawMouse},drawMouseData:function(t){return t!==void 0?(this._drawMouseData=t,this):this._drawMouseData},$:function(t){var e=ige.$(t);if(e._parent===this)return e;var i=e.parent(this.id());return i?e:void 0},$$:function(t){var e,i=ige.$$(t),o=i.length,n=[],s=this.id();while(o--)e=i[o],(e._parent===this||e.parent(s))&&n.push(e);return n},parent:function(t){return t?this._parent?this._parent.id()===t?this._parent:this._parent.parent(t):void 0:this._parent},children:function(){return this._children},mount:function(t){if(t){if(t===this)return this.log("Cannot mount an object to itself!","error"),this;if(t._children){if(this.id(),this._parent){if(this._parent===t)return this;this.unMount()}return this._parent=t,!this._ignoreCamera&&this._parent._ignoreCamera&&(this._ignoreCamera=this._parent._ignoreCamera),this._parent._streamRoomId&&(this._streamRoomId=this._parent._streamRoomId),t._children.push(this),this._parent._childMounted(this),t.updateTransform&&(t.updateTransform(),t.aabb(!0)),t._compositeCache?this._compositeParent=!0:delete this._compositeParent,this._mounted(this._parent),this.emit("mounted",this._parent),this}return this.log("Cannot mount object because it has no _children array! If you are mounting to a custom class, ensure that you have called the prototype.init() method of your super-class during the init of your custom class.","warning"),!1}this.log("Cannot mount non-existent object!","error")},unMount:function(){if(this._parent){var t=this._parent._children,e=t.indexOf(this),i=this._parent;return e>-1?(t.splice(e,1),this._parent._childUnMounted(this),this._parent=null,this._unMounted(i),this):!1}return!1},hasParent:function(t,e){var i=!1;return!e&&this._hasParent&&this._hasParent[t]!==void 0?this._hasParent[t]:(this._parent&&(i=this._parent.id()===t?!0:this._parent.hasParent(t,e)),this._hasParent=this._hasParent||{},this._hasParent[t]=i,i)},clone:function(options){options===void 0&&(options={}),options.id===void 0&&(options.id=!1),options.mount===void 0&&(options.mount=!1),options.transform===void 0&&(options.transform=!0);var newObject=eval(this.stringify(options));return newObject},mode:function(t){return t!==void 0?(this._mode=t,this):this._mode},isometric:function(t){return t===!0?(this._mode=1,this):t===!1?(this._mode=0,this):this._mode===1},isometricMounts:function(t){return t===!0?(this._mountMode=1,this):t===!1?(this._mountMode=0,this):this._mountMode===1},indestructible:function(t){return t!==void 0?(this._indestructible=t,this):this._indestructible},layer:function(t){return t!==void 0?(this._layer=t,this):this._layer},depth:function(t){return t!==void 0?(this._depth=t,this):this._depth},destroyChildren:function(){var t,e=this._children;if(e){t=e.length;while(t--)e[t].destroy()}return this._children=[],this},destroyBehaviours:function(){delete this._updateBehaviours,delete this._tickBehaviours},destroyComponents:function(){var t,e=this._components;if(e){t=e.length;while(t--)e[t].destroy&&e[t].destroy()}return delete this._components,this},depthSortMode:function(t){return t!==void 0?(this._depthSortMode=t,this):this._depthSortMode},depthSortChildren:function(){if(this._depthSortMode!==-1){var t,e,i,o,n=this._children;if(n&&(t=n.length,t>1))if(this._mountMode===1){if(this._depthSortMode===0){for(e={adj:[],c:[],p:[],order:[],order_ind:t-1},i=0;t>i;++i)for(e.c[i]=0,e.p[i]=-1,o=i+1;t>o;++o)e.adj[i]=e.adj[i]||[],e.adj[o]=e.adj[o]||[],n[i]._inView&&n[o]._inView&&n[i]._projectionOverlap&&n[o]._projectionOverlap&&n[i]._projectionOverlap(n[o])&&(n[i].isBehind(n[o])?e.adj[o].push(i):e.adj[i].push(o));for(i=0;t>i;++i)e.c[i]===0&&this._depthSortVisit(i,e);for(i=0;e.order.length>i;i++)n[e.order[i]].depth(i);this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?e._depth-t._depth:i})}if(this._depthSortMode===1&&this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?t.isBehind(e)?-1:1:i}),this._depthSortMode===2){while(t--)e=n[t],o=e._translate,o&&(e._depth=o.x+o.y+o.z);this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?e._depth-t._depth:i})}}else this._children.sort(function(t,e){var i=e._layer-t._layer;return i===0?e._depth-t._depth:i})}},viewChecking:function(t){return t!==void 0?(this._viewChecking=t,this):this._viewChecking},viewCheckChildren:function(){if(ige._currentViewport){var t,e=this._children,i=e.length,o=ige._currentViewport.viewArea();while(i--)t=e[i],t._inView=t._alwaysInView?!0:t.aabb?o.intersects(t.aabb(!0))?!0:!1:!1}return this},update:function(t,e){if(this._alive){this._newBorn&&(this._newBorn=!1);var i,o,n,s=this._children;if(s)if(i=s.length,i&&!ige._headless&&(igeConfig.debug._timing?(ige._timeSpentLastTick[this.id()]||(ige._timeSpentLastTick[this.id()]={}),o=(new Date).getTime(),this.depthSortChildren(),n=(new Date).getTime()-o,ige._timeSpentLastTick[this.id()].depthSortChildren=n):this.depthSortChildren()),igeConfig.debug._timing)while(i--)o=(new Date).getTime(),s[i].update(t,e),n=(new Date).getTime()-o,s[i]&&(ige._timeSpentInTick[s[i].id()]||(ige._timeSpentInTick[s[i].id()]=0),ige._timeSpentLastTick[s[i].id()]||(ige._timeSpentLastTick[s[i].id()]={}),ige._timeSpentInTick[s[i].id()]+=n,ige._timeSpentLastTick[s[i].id()].tick=n);else while(i--)s[i].update(t,e)}},tick:function(t){if(this._alive){var e,i,o,n=this._children;if(this._viewChecking&&this.viewCheckChildren(),n)if(e=n.length,igeConfig.debug._timing)while(e--)n[e]?n[e]._newBorn||(t.save(),i=(new Date).getTime(),n[e].tick(t),o=(new Date).getTime()-i,n[e]&&(ige._timeSpentInTick[n[e].id()]||(ige._timeSpentInTick[n[e].id()]=0),ige._timeSpentLastTick[n[e].id()]||(ige._timeSpentLastTick[n[e].id()]={}),ige._timeSpentInTick[n[e].id()]+=o,ige._timeSpentLastTick[n[e].id()].tick=o),t.restore()):this.log("Object _children is undefined for index "+e+" and _id: "+this._id,"error");else while(e--)n[e]?n[e]._newBorn||(t.save(),n[e].tick(t),t.restore()):this.log("Object _children is undefined for index "+e+" and _id: "+this._id,"error")}},_depthSortVisit:function(t,e){var i,o,n=e.adj[t],s=n.length;for(e.c[t]=1,i=0;s>i;++i)o=n[i],e.c[o]===0&&(e.p[o]=t,this._depthSortVisit(o,e));e.c[t]=2,e.order[e.order_ind]=t,--e.order_ind},_resizeEvent:function(t){var e,i=this._children;if(i){e=i.length;while(e--)i[e]._resizeEvent(t)}},_processUpdateBehaviours:function(){var t,e=this._updateBehaviours;if(e){t=e.length;while(t--)e[t].method.apply(this,arguments)}},_processTickBehaviours:function(){var t,e=this._tickBehaviours;if(e){t=e.length;while(t--)e[t].method.apply(this,arguments)}},_childMounted:function(){this._resizeEvent(null)},_childUnMounted:function(){},_mounted:function(){},_unMounted:function(){},destroy:function(){return this.unMount(),this._children&&this.destroyChildren(),this.destroyComponents(),this.destroyBehaviours(),ige.unRegister(this),ige.categoryUnRegister(this),ige.groupUnRegister(this),this._alive=!1,delete this._eventListeners,this},objSave:function(){return{igeClass:this.classId(),data:this._objSaveReassign(this,[])}},objLoad:function(t){this._objLoadReassign(this,t.data)},saveSpecialProp:function(t,e){switch(e){case"_id":if(t._id)return{_id:t._id};break;case"_parent":if(t._parent)return{_parent:t._parent.id()};break;case"_children":if(t._children.length){var i,o,n=[];for(i=0;t._children.length>i;i++)o=t._children[i],n.push(o.objSave());return{_children:n}}}return void 0},loadSpecialProp:function(t,e){switch(e){case"_id":return{_id:t[e]};case"_parent":return{_parent:t[e]};case"_children":return{_children:t[e]}}return void 0},loadGraph:function(t){if(t.igeClass&&t.data){var e,i,o,n,s=ige.newClassInstance(t.igeClass);if(s.objLoad(t),s._parent&&(n=s._parent,delete s._parent),s._id&&(e=s._id,delete s._id,s.id(e)),s._children&&s._children.length)for(i=s._children,s._children=[],o=0;i.length>o;o++)s.loadGraph(i[o]);s.mount(this)}},_objSaveReassign:function(t,e){var i,o,n,s,r,a=this._specialProp;if(typeof t!="object"||t instanceof Array)return t;i={};for(r in t)if(t.hasOwnProperty(r))if(typeof t[r]=="object"){if(a.indexOf(r)===-1)o=e.indexOf(t[r]),o>-1?(i[r]="{ref:"+o+"}",this.log("Possible circular reference for property "+r)):(e.push(t[r]),i[r]=this._objSaveReassign(t[r],e));else if(n=this.saveSpecialProp(t,r))if(typeof n!="object"||n instanceof Array)i[r]=n;else for(s in n)n.hasOwnProperty(s)&&(i[s]=n[s])}else i[r]=t[r];return i},_objLoadReassign:function(t,e){var i,o,n,s=this._specialProp;for(n in e)if(e.hasOwnProperty(n))if(s.indexOf(n)===-1)typeof e[n]=="object"&&t[n]?this._objLoadReassign(t[n],e[n]):t[n]=e[n];else if(i=this.loadSpecialProp(e,n))if(typeof i!="object"||i instanceof Array)t[n]=i;else for(o in i)i.hasOwnProperty(o)&&(t[o]=i[o])},stringify:function(t){t===void 0&&(t={});var e="new "+this.classId()+"()";return t.id!==!1&&(e+=".id('"+this.id()+"')"),t.mount!==!1&&this.parent()&&(e+=".mount(ige.$('"+this.parent().id()+"'))"),e+=this._stringify(t)},_stringify:function(t){t===void 0&&(t={});var e,i="";for(e in this)if(this.hasOwnProperty(e)&&this[e]!==void 0)switch(e){case"_category":i+=".category("+this.category()+")";break;case"_drawBounds":i+=".drawBounds("+this.drawBounds()+")";break;case"_drawBoundsData":i+=".drawBoundsData("+this.drawBoundsData()+")";break;case"_drawMouse":i+=".drawMouse("+this.drawMouse()+")";break;case"_mode":i+=".mode("+this.mode()+")";break;case"_isometricMounts":i+=".isometricMounts("+this.isometricMounts()+")";break;case"_indestructible":i+=".indestructible("+this.indestructible()+")";break;case"_layer":i+=".layer("+this.layer()+")";break;case"_depth":i+=".depth("+this.depth()+")"}return i}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_59);var $i_60=$i_59.extend({classId:"$i_60",init:function(){$i_59.prototype.init.call(this),this._specialProp.push("_texture"),this._specialProp.push("_eventListeners"),this._specialProp.push("_aabb"),this._anchor=new $i_4(0,0),this._renderPos={x:0,y:0},this._computedOpacity=1,this._opacity=1,this._cell=1,this._deathTime=void 0,this._bornTime=ige._currentTime,this._translate=new $i_5(0,0,0),this._oldTranslate=new $i_5(0,0,0),this._rotate=new $i_5(0,0,0),this._oldRotate=new $i_5(0,0,0),this._scale=new $i_5(1,1,1),this._origin=new $i_5(.5,.5,.5),this._bounds2d=new $i_4(40,40),this._bounds3d=new $i_5(0,0,0),this._oldBounds2d=new $i_4(40,40),this._oldBounds3d=new $i_5(0,0,0),this._highlight=!1,this._mouseEventsActive=!1,this._velocity=new $i_5(0,0,0),this._localMatrix=new $i_8,this._worldMatrix=new $i_8,this._oldWorldMatrix=new $i_8,this._lastSeenBy={},this._inView=!0,this._hidden=!1,this.streamSections(["transform"])
},show:function(){return this._hidden=!1,this},hide:function(){return this._hidden=!0,this},isVisible:function(){return this._hidden===!1},isHidden:function(){return this._hidden===!0},cache:function(t){if(t!==void 0){if(this._cache=t,t){this._cacheCanvas=ige.isClient?document.createElement("canvas"):new $i_49,this._cacheCtx=this._cacheCanvas.getContext("2d"),this._cacheDirty=!0;var e=this._cacheSmoothing!==void 0?this._cacheSmoothing:ige._globalSmoothing;e?(this._cacheCtx.imageSmoothingEnabled=!0,this._cacheCtx.mozImageSmoothingEnabled=!0):(this._cacheCtx.imageSmoothingEnabled=!1,this._cacheCtx.mozImageSmoothingEnabled=!1),this.compositeCache()&&this.compositeCache(!1)}else delete this._cacheCanvas;return this}return this._cache},cacheSmoothing:function(t){return t!==void 0?(this._cacheSmoothing=t,this):this._cacheSmoothing},compositeCache:function(t){if(ige.isClient){if(t!==void 0){if(t){this.cache(!1),this._cacheCanvas=document.createElement("canvas"),this._cacheCtx=this._cacheCanvas.getContext("2d"),this._cacheDirty=!0;var e=this._cacheSmoothing!==void 0?this._cacheSmoothing:ige._globalSmoothing;e?(this._cacheCtx.imageSmoothingEnabled=!0,this._cacheCtx.webkitImageSmoothingEnabled=!0,this._cacheCtx.mozImageSmoothingEnabled=!0):(this._cacheCtx.imageSmoothingEnabled=!1,this._cacheCtx.webkitImageSmoothingEnabled=!1,this._cacheCtx.mozImageSmoothingEnabled=!1)}return this._children.each(function(){t?this._compositeParent=!0:delete this._compositeParent}),this._compositeCache=t,this}return this._compositeCache}return this},cacheDirty:function(t){return t!==void 0?(this._cacheDirty=t,t&&this._compositeParent&&this._parent&&(this._parent.cacheDirty(t),this._cache||this._compositeCache||(this._cacheDirty=!1)),this):this._cacheDirty},mousePos:function(t){if(t=t||ige._currentViewport){var e=t._mousePos.clone();return this._ignoreCamera,e.x+=t._translate.x,e.y+=t._translate.y,this._transformPoint(e),e}return new $i_5(0,0,0)},mousePosAbsolute:function(t){if(t=t||ige._currentViewport){var e=t._mousePos.clone();return this._transformPoint(e),e}return new $i_5(0,0,0)},mousePosWorld:function(t){t=t||ige._currentViewport;var e=this.mousePos(t);return this.localToWorldPoint(e,t),this._ignoreCamera,e},rotateToPoint:function(t){var e=this.worldPosition();return this.rotateTo(this._rotate.x,this._rotate.y,Math.atan2(e.y-t.y,e.x-t.x)-this._parent._rotate.z+Math.radians(270)),this},backgroundPattern:function(t,e,i,o){return t!==void 0?(this._backgroundPattern=t,this._backgroundPatternRepeat=e||"repeat",this._backgroundPatternTrackCamera=i,this._backgroundPatternIsoTile=o,this._backgroundPatternFill=null,this):this._backgroundPattern},widthByTile:function(t,e){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var i,o=this._mode===0?this._parent._tileWidth:this._parent._tileWidth*2;this.width(t*o),e&&(this._texture?(i=this._texture._sizeX/this._bounds2d.x,this.height(this._texture._sizeY/i)):this.log("Cannot set height based on texture aspect ratio and new width because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set width by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},heightByTile:function(t,e){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var i,o=this._mode===0?this._parent._tileHeight:this._parent._tileHeight*2;this.height(t*o),e&&(this._texture?(i=this._texture._sizeY/this._bounds2d.y,this.width(this._texture._sizeX/i)):this.log("Cannot set width based on texture aspect ratio and new height because no texture is currently assigned to the entity!","error"))}else this.log("Cannot set height by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},occupyTile:function(t,e,i,o){if(this._parent&&this._parent.$i_67)if(t!==void 0&&e!==void 0)this._parent.occupyTile(t,e,i,o,this);else{var n=new $i_5(this._translate.x-(this._tileWidth/2-.5)*this._parent._tileWidth,this._translate.y-(this._tileHeight/2-.5)*this._parent._tileHeight,0),s=this._parent.pointToTile(n);this._parent._mountMode===1&&s.thisToIso(),this._parent.occupyTile(s.x,s.y,this._tileWidth,this._tileHeight,this)}return this},unOccupyTile:function(t,e,i,o){if(this._parent&&this._parent.$i_67)if(t!==void 0&&e!==void 0)this._parent.unOccupyTile(t,e,i,o);else{var n=new $i_5(this._translate.x-(this._tileWidth/2-.5)*this._parent._tileWidth,this._translate.y-(this._tileHeight/2-.5)*this._parent._tileHeight,0),s=this._parent.pointToTile(n);this._parent._mountMode===1&&s.thisToIso(),this._parent.unOccupyTile(s.x,s.y,this._tileWidth,this._tileHeight)}return this},overTiles:function(){if(this._parent&&this._parent.$i_67){var t,e,i=this._tileWidth||1,o=this._tileHeight||1,n=this._parent.pointToTile(this._translate),s=[];for(t=0;i>t;t++)for(e=0;o>e;e++)s.push(new $i_5(n.x+t,n.y+e,0));return s}},anchor:function(t,e){return t!==void 0&&e!==void 0?(this._anchor=new $i_4(t,e),this):this._anchor},width:function(t,e){if(t!==void 0){if(e){var i=t/this._bounds2d.x;this.height(this._bounds2d.y*i)}return this._bounds2d.x=t,this._bounds2d.x2=t/2,this}return this._bounds2d.x},height:function(t,e){if(t!==void 0){if(e){var i=t/this._bounds2d.y;this.width(this._bounds2d.x*i)}return this._bounds2d.y=t,this._bounds2d.y2=t/2,this}return this._bounds2d.y},bounds2d:function(t,e){return t!==void 0&&e!==void 0?(this._bounds2d=new $i_4(t,e,0),this):(t!==void 0&&e===void 0&&(this._bounds2d=new $i_4(t.x,t.y)),this._bounds2d)},bounds3d:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._bounds3d=new $i_5(t,e,i),this):this._bounds3d},size3d:function(){this.log("size3d has been renamed to bounds3d but is exactly the same so please search/replace your code to update calls.","warning")},lifeSpan:function(t,e){return t!==void 0?(this.deathTime(ige._currentTime+t,e),this):this.deathTime()-ige._currentTime},deathTime:function(t,e){return t!==void 0?(this._deathTime=t,e!==void 0&&(this._deathCallBack=e),this):this._deathTime},opacity:function(t){return t!==void 0?(this._opacity=t,this):this._opacity},noAabb:function(t){return t!==void 0?(this._noAabb=t,this):this._noAabb},texture:function(t){return t!==void 0?(this._texture=t,this):this._texture},cell:function(t){return t>0||t===null?(this._cell=t,this):this._cell},cellById:function(t){if(t!==void 0)if(this._texture){var e,i=this._texture,o=i._cells;for(e=1;o.length>e;e++)if(o[e][4]===t)return this.cell(e),this;this.log('Could not find the cell id "'+t+'" in the assigned entity texture '+i.id()+', please check your sprite sheet (texture) cell definition to ensure the cell id "'+t+'" has been assigned to a cell!',"error")}else this.log("Cannot assign cell index from cell ID until an $i_56 has been set as the texture for this entity. Please set the texture before calling cellById().","error");return this._cell},dimensionsFromTexture:function(t){return this._texture&&(t===void 0?(this.width(this._texture._sizeX),this.height(this._texture._sizeY)):(this.width(Math.floor(this._texture._sizeX/100*t)),this.height(Math.floor(this._texture._sizeY/100*t))),this.localAabb(!0)),this},dimensionsFromCell:function(t){return this._texture&&this._texture._cells&&this._texture._cells.length&&(t===void 0?(this.width(this._texture._cells[this._cell][2]),this.height(this._texture._cells[this._cell][3])):(this.width(Math.floor(this._texture._cells[this._cell][2]/100*t)),this.height(Math.floor(this._texture._cells[this._cell][3]/100*t))),this.localAabb(!0)),this},highlight:function(t){return t!==void 0?(this._highlight=t,this):this._highlight},worldPosition:function(){return new $i_5(this._worldMatrix.matrix[2],this._worldMatrix.matrix[5],0)},worldRotationZ:function(){return this._worldMatrix.rotationRadians()},localToWorld:function(t,e,i){e=e||ige._currentViewport,this._adjustmentMatrix&&this._worldMatrix.multiply(this._adjustmentMatrix),i?this._localMatrix.transform(t,this):this._worldMatrix.transform(t,this),this._ignoreCamera},localToWorldPoint:function(t,e){e=e||ige._currentViewport,this._worldMatrix.transform([t],this)},screenPosition:function(){return new $i_5(Math.floor((this._worldMatrix.matrix[2]-ige._currentCamera._translate.x)*ige._currentCamera._scale.x+ige._bounds2d.x2),Math.floor((this._worldMatrix.matrix[5]-ige._currentCamera._translate.y)*ige._currentCamera._scale.y+ige._bounds2d.y2),0)},localIsoBoundsPoly:function(){},localBounds3dPolygon:function(t){if(this._bounds3dPolygonDirty||!this._localBounds3dPolygon||t){var e=this._bounds3d,i=new $i_6,o=Math.toIso(+e.x2,-e.y2,-e.z2),n=Math.toIso(+e.x2,+e.y2,-e.z2),s=Math.toIso(-e.x2,+e.y2,-e.z2),r=Math.toIso(-e.x2,-e.y2,e.z2),a=Math.toIso(+e.x2,-e.y2,e.z2),h=Math.toIso(-e.x2,+e.y2,e.z2);i.addPoint(r.x,r.y).addPoint(a.x,a.y).addPoint(o.x,o.y).addPoint(n.x,n.y).addPoint(s.x,s.y).addPoint(h.x,h.y).addPoint(r.x,r.y),this._localBounds3dPolygon=i,this._bounds3dPolygonDirty=!1}return this._localBounds3dPolygon},isoBoundsPoly:function(){},bounds3dPolygon:function(t){if(this._bounds3dPolygonDirty||!this._bounds3dPolygon||t){var e=this.localBounds3dPolygon(t).clone();this.localToWorld(e._poly),this._bounds3dPolygon=e}return this._bounds3dPolygon},mouseInIsoBounds:function(){},mouseInBounds3d:function(t){var e=this.localBounds3dPolygon(t),i=this.mousePos();return e.pointInside(i)},aabb:function(t,e){if(this._aabbDirty||!this._aabb||t){var i,o,n,s,r,a,h,l,c,m,_=new $i_6,u=this._anchor,d=u.x,p=u.y;a=this._bounds2d,h=a.x2,l=a.y2,c=h,m=l,_.addPoint(-c+d,-m+p),_.addPoint(c+d,-m+p),_.addPoint(c+d,m+p),_.addPoint(-c+d,m+p),this._renderPos={x:-c+d,y:-m+p},this.localToWorld(_._poly,null,e),i=Math.min(_._poly[0].x,_._poly[1].x,_._poly[2].x,_._poly[3].x),o=Math.min(_._poly[0].y,_._poly[1].y,_._poly[2].y,_._poly[3].y),n=Math.max(_._poly[0].x,_._poly[1].x,_._poly[2].x,_._poly[3].x),s=Math.max(_._poly[0].y,_._poly[1].y,_._poly[2].y,_._poly[3].y),r=new $i_7(i,o,n-i,s-o),this._aabb=r,this._aabbDirty=!1}return this._aabb},localAabb:function(t){if(!this._localAabb||t){var e=this.aabb();this._localAabb=new $i_7(-Math.floor(e.width/2),-Math.floor(e.height/2),Math.floor(e.width),Math.floor(e.height))}return this._localAabb},compositeAabb:function(t){var e,i,o=this._children;if(i=t?this.aabb(!0,t).clone():this.aabb().clone(),o){e=o.length;while(e--)i.thisCombineRect(o[e].compositeAabb(t))}return i},compositeStream:function(t){return t!==void 0?(this._compositeStream=t,this):this._compositeStream},_childMounted:function(t){this.compositeStream()&&(t.compositeStream(!0),t.streamMode(this.streamMode()),t.streamControl(this.streamControl())),$i_59.prototype._childMounted.call(this,t),this.compositeCache()&&this.cacheDirty(!0)},_swapVars:function(t,e){return[e,t]},_internalsOverlap:function(t,e,i,o){var n;return t>e&&(n=this._swapVars(t,e),t=n[0],e=n[1]),i>o&&(n=this._swapVars(i,o),i=n[0],o=n[1]),t>i&&(n=this._swapVars(t,i),t=n[0],i=n[1],n=this._swapVars(e,o),e=n[0],o=n[1]),e>i},_projectionOverlap:function(t){var e=this._bounds3d,i={x:this._translate.x-e.x/2,y:this._translate.y-e.y/2,z:this._translate.z-e.z},o={x:this._translate.x+e.x/2,y:this._translate.y+e.y/2,z:this._translate.z+e.z},n=t._bounds3d,s={x:t._translate.x-n.x/2,y:t._translate.y-n.y/2,z:t._translate.z-n.z},r={x:t._translate.x+n.x/2,y:t._translate.y+n.y/2,z:t._translate.z+n.z};return this._internalsOverlap(i.x-o.y,o.x-i.y,s.x-r.y,r.x-s.y)&&this._internalsOverlap(i.x-o.z,o.x-i.z,s.x-r.z,r.x-s.z)&&this._internalsOverlap(i.z-o.y,o.z-i.y,s.z-r.y,r.z-s.y)},isBehind:function(t){var e=this._bounds3d,i=t._bounds3d,o=this._translate.clone(),n=t._translate.clone();(this._origin.x!==.5||this._origin.y!==.5)&&(o.x+=this._bounds2d.x*(.5-this._origin.x),o.y+=this._bounds2d.y*(.5-this._origin.y)),(t._origin.x!==.5||t._origin.y!==.5)&&(n.x+=t._bounds2d.x*(.5-t._origin.x),n.y+=t._bounds2d.y*(.5-t._origin.y));var s=o.x,r=o.y,a=n.x,h=n.y,l=new $i_5(s-e.x/2,r-e.y/2,this._translate.z),c=new $i_5(s+e.x/2,r+e.y/2,this._translate.z+e.z),m=new $i_5(a-i.x/2,h-i.y/2,t._translate.z),_=new $i_5(a+i.x/2,h+i.y/2,t._translate.z+i.z);return c.x>m.x?_.x>l.x?c.y>m.y?_.y>l.y?c.z>m.z?_.z>l.z?s+r+this._translate.z>a+h+t._translate.z:!0:!1:!0:!1:!0:!1},mouseEventsActive:function(t){return t!==void 0?(this._mouseEventsActive=t,this):this._mouseEventsActive},ignoreCameraComposite:function(t){var e,i=this._children,o=i.length;for(this._ignoreCamera=t,e=0;o>e;e++)i[e].ignoreCameraComposite&&i[e].ignoreCameraComposite(t)},newFrame:function(){return ige._frameAlternator!==this._frameAlternatorCurrent},_transformContext:function(t,e){t.globalAlpha=this._computedOpacity=this._parent?this._parent._computedOpacity*this._opacity:this._opacity,e?this._localMatrix.getInverse().transformRenderingContext(t):this._localMatrix.transformRenderingContext(t)},mouseAlwaysInside:function(t){return t!==void 0?(this._mouseAlwaysInside=t,this):this._mouseAlwaysInside},update:function(t,e){this._deathTime===void 0||this._deathTime>ige._tickStart?this._bornTime!==void 0&&this._bornTime>ige._currentTime?(this._birthMount=this._parent.id(),this.unMount(),ige.spawnQueue(this)):(delete this._streamDataCache,this._processUpdateBehaviours(t,e),(this._velocity.x||this._velocity.y)&&(this._translate.x+=this._velocity.x/16*e,this._translate.y+=this._velocity.y/16*e),this._timeStream.length&&this._processInterpolate(ige._tickStart-ige.network.stream._renderLatency),this.updateTransform(),!this._noAabb&&this._aabbDirty&&this.aabb(),this._frameAlternatorCurrent=ige._frameAlternator):(this._deathCallBack&&(this._deathCallBack.apply(this),delete this._deathCallback),this.destroy()),$i_59.prototype.update.call(this,t,e)},tick:function(t,e){this._hidden||!this._inView||this._parent&&!this._parent._inView||this._streamJustCreated||(this._processTickBehaviours(t),this._mouseEventsActive&&(this._processTriggerHitTests()?ige.input.queueEvent(this,this._mouseInTrigger,null):ige.input.mouseMove&&this._handleMouseOut(ige.input.mouseMove)),this._dontRender||(this._cache||this._compositeCache?(this._cacheDirty&&this._refreshCache(e),this._renderCache(t)):(e||this._transformContext(t),this._renderEntity(t,e))),this._streamMode===1&&this.streamSync(),this._compositeCache?this._cacheDirty&&($i_59.prototype.tick.call(this,this._cacheCtx),this._renderCache(t),this._cacheDirty=!1):$i_59.prototype.tick.call(this,t))},_processTriggerHitTests:function(){var t,e;if(ige._currentViewport){if(this._mouseAlwaysInside)return!0;if(t=this.mousePosWorld())return e=this._triggerPolygon&&this[this._triggerPolygon]?this[this._triggerPolygon](t):this._parent&&this._parent._mountMode===1?this.bounds3dPolygon():this.aabb(),e.xyInside(t.x,t.y)}return!1},_refreshCache:function(t){var e=this._cacheCanvas,i=this._cacheCtx;if(this._compositeCache){var o=this.compositeAabb(!0);this._compositeAabbCache=o,o.width>0&&o.height>0?(e.width=Math.ceil(o.width),e.height=Math.ceil(o.height)):(e.width=2,e.height=2),i.translate(-o.x,-o.y),this.emit("compositeReady")}else this._bounds2d.x>0&&this._bounds2d.y>0?(e.width=this._bounds2d.x,e.height=this._bounds2d.y):(e.width=1,e.height=1),i.translate(this._bounds2d.x2,this._bounds2d.y2),this._cacheDirty=!1;t||this._transformContext(i),this._renderEntity(i,t)},_renderEntity:function(t){if(this._opacity>0){this._backgroundPattern&&(this._backgroundPatternFill||t&&(this._backgroundPatternFill=t.createPattern(this._backgroundPattern.image,this._backgroundPatternRepeat)),this._backgroundPatternFill&&(t.save(),t.fillStyle=this._backgroundPatternFill,t.translate(-this._bounds2d.x2,-this._bounds2d.y2),t.rect(0,0,this._bounds2d.x,this._bounds2d.y),this._backgroundPatternTrackCamera&&(t.translate(-ige._currentCamera._translate.x,-ige._currentCamera._translate.y),t.scale(ige._currentCamera._scale.x,ige._currentCamera._scale.y)),t.fill(),ige._drawCount++,this._backgroundPatternIsoTile&&(t.translate(-Math.floor(this._backgroundPattern.image.width)/2,-Math.floor(this._backgroundPattern.image.height/2)),t.fill(),ige._drawCount++),t.restore()));var e=this._texture;e&&e._loaded&&(e.render(t,this,ige._tickDelta),this._highlight&&(t.globalCompositeOperation="lighter",e.render(t,this))),this._compositeCache&&ige._currentViewport._drawCompositeBounds&&(t.fillStyle="rgba(0, 0, 255, 0.3)",t.fillRect(-this._bounds2d.x2,-this._bounds2d.y2,this._bounds2d.x,this._bounds2d.y),t.fillStyle="#ffffff",t.fillText("Composite Entity",-this._bounds2d.x2,-this._bounds2d.y2-15),t.fillText(this.id(),-this._bounds2d.x2,-this._bounds2d.y2-5))}},_renderCache:function(t){if(t.save(),this._compositeCache){var e=this._compositeAabbCache;t.translate(this._bounds2d.x2+e.x,this._bounds2d.y2+e.y),this._parent&&this._parent._ignoreCamera&&ige._currentCamera}t.drawImage(this._cacheCanvas,-this._bounds2d.x2,-this._bounds2d.y2),ige._currentViewport._drawCompositeBounds&&(t.fillStyle="rgba(0, 255, 0, 0.5)",t.fillRect(-this._bounds2d.x2,-this._bounds2d.y2,this._cacheCanvas.width,this._cacheCanvas.height),t.fillStyle="#ffffff",t.fillText("Composite Cache",-this._bounds2d.x2,-this._bounds2d.y2-15),t.fillText(this.id(),-this._bounds2d.x2,-this._bounds2d.y2-5)),ige._drawCount++,this._highlight&&(t.globalCompositeOperation="lighter",t.drawImage(this._cacheCanvas,-this._bounds2d.x2,-this._bounds2d.y2),ige._drawCount++),t.restore()},_transformPoint:function(t){if(this._parent){var e=new $i_8;e.copy(this._parent._worldMatrix),e.multiply(this._localMatrix),e.getInverse().transformCoord(t,this)}else this._localMatrix.transformCoord(t,this);return t},_transformPoints:function(t){var e,i=t.length;while(i--)if(e=t[i],this._parent){var o=new $i_8;o.copy(this._parent._worldMatrix),o.multiply(this._localMatrix),o.getInverse().transformCoord(e,this)}else this._localMatrix.transformCoord(e,this)},_stringify:function(t){t===void 0&&(t={});var e,i=$i_59.prototype._stringify.call(this,t);for(e in this)if(this.hasOwnProperty(e)&&this[e]!==void 0)switch(e){case"_opacity":i+=".opacity("+this.opacity()+")";break;case"_texture":i+=".texture(ige.$('"+this.texture().id()+"'))";break;case"_cell":i+=".cell("+this.cell()+")";break;case"_translate":t.transform!==!1&&t.translate!==!1&&(i+=".translateTo("+this._translate.x+", "+this._translate.y+", "+this._translate.z+")");break;case"_rotate":t.transform!==!1&&t.rotate!==!1&&(i+=".rotateTo("+this._rotate.x+", "+this._rotate.y+", "+this._rotate.z+")");break;case"_scale":t.transform!==!1&&t.scale!==!1&&(i+=".scaleTo("+this._scale.x+", "+this._scale.y+", "+this._scale.z+")");break;case"_origin":t.origin!==!1&&(i+=".originTo("+this._origin.x+", "+this._origin.y+", "+this._origin.z+")");break;case"_anchor":t.anchor!==!1&&(i+=".anchor("+this._anchor.x+", "+this._anchor.y+")");break;case"_width":i+=typeof this.width()=="string"?".width('"+this.width()+"')":".width("+this.width()+")";break;case"_height":i+=typeof this.height()=="string"?".height('"+this.height()+"')":".height("+this.height()+")";break;case"_bounds3d":i+=".bounds3d("+this._bounds3d.x+", "+this._bounds3d.y+", "+this._bounds3d.z+")";break;case"_deathTime":t.deathTime!==!1&&t.lifeSpan!==!1&&(i+=".deathTime("+this.deathTime()+")");break;case"_highlight":i+=".highlight("+this.highlight()+")"}return i},destroy:function(){this._alive=!1,this.emit("destroyed",this),$i_59.prototype.destroy.call(this)},saveSpecialProp:function(t,e){switch(e){case"_texture":if(t._texture)return{_texture:t._texture.id()};break;default:return $i_59.prototype.saveSpecialProp.call(this,t,e)}return void 0},loadSpecialProp:function(t,e){switch(e){case"_texture":return{_texture:ige.$(t[e])};default:return $i_59.prototype.loadSpecialProp.call(this,t,e)}return void 0},mouseMove:function(t){return t?(this._mouseMove=t,this._mouseEventsActive=!0,this):this._mouseMove},mouseOver:function(t){return t?(this._mouseOver=t,this._mouseEventsActive=!0,this):this._mouseOver},mouseOut:function(t){return t?(this._mouseOut=t,this._mouseEventsActive=!0,this):this._mouseOut},mouseUp:function(t){return t?(this._mouseUp=t,this._mouseEventsActive=!0,this):this._mouseUp},mouseDown:function(t){return t?(this._mouseDown=t,this._mouseEventsActive=!0,this):this._mouseDown},mouseWheel:function(t){return t?(this._mouseWheel=t,this._mouseEventsActive=!0,this):this._mouseWheel},mouseMoveOff:function(){return delete this._mouseMove,this},mouseOverOff:function(){return delete this._mouseOver,this},mouseOutOff:function(){return delete this._mouseOut,this},mouseUpOff:function(){return delete this._mouseUp,this},mouseDownOff:function(){return delete this._mouseDown,this},mouseWheelOff:function(){return delete this._mouseWheel,this},triggerPolygon:function(t){return t!==void 0?(this._triggerPolygon=t,this):this._triggerPolygon},mouseEventTrigger:function(){this.log("mouseEventTrigger is no longer in use. Please see triggerPolygon() instead.","warning")},_handleMouseIn:function(t,e,i){this._mouseStateOver||(this._mouseStateOver=!0,this._mouseOver&&this._mouseOver(t,e,i),this.emit("mouseOver",[t,e,i])),this._mouseMove&&this._mouseMove(t,e,i),this.emit("mouseMove",[t,e,i])},_handleMouseOut:function(t,e,i){this._mouseStateDown=!1,this._mouseStateOver&&(this._mouseStateOver=!1,this._mouseOut&&this._mouseOut(t,e,i),this.emit("mouseOut",[t,e,i]))},_handleMouseWheel:function(t,e,i){this._mouseWheel&&this._mouseWheel(t,e,i),this.emit("mouseWheel",[t,e,i])},_handleMouseUp:function(t,e,i){this._mouseStateDown=!1,this._mouseUp&&this._mouseUp(t,e,i),this.emit("mouseUp",[t,e,i])},_handleMouseDown:function(t,e,i){this._mouseStateDown||(this._mouseStateDown=!0,this._mouseDown&&this._mouseDown(t,e,i),this.emit("mouseDown",[t,e,i]))},_mouseInTrigger:function(t,e){ige.input.mouseMove&&this._handleMouseIn(ige.input.mouseMove,t,e),ige.input.mouseDown&&this._handleMouseDown(ige.input.mouseDown,t,e),ige.input.mouseUp&&this._handleMouseUp(ige.input.mouseUp,t,e),ige.input.mouseWheel&&this._handleMouseWheel(ige.input.mouseWheel,t,e)},debugTransforms:function(){return ige.traceSet(this._translate,"x",1,function(t){return isNaN(t)}),ige.traceSet(this._translate,"y",1,function(t){return isNaN(t)}),ige.traceSet(this._translate,"z",1,function(t){return isNaN(t)}),ige.traceSet(this._rotate,"x",1,function(t){return isNaN(t)}),ige.traceSet(this._rotate,"y",1,function(t){return isNaN(t)}),ige.traceSet(this._rotate,"z",1,function(t){return isNaN(t)}),ige.traceSet(this._scale,"x",1,function(t){return isNaN(t)}),ige.traceSet(this._scale,"y",1,function(t){return isNaN(t)}),ige.traceSet(this._scale,"z",1,function(t){return isNaN(t)}),this},velocityTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._velocity.x=t,this._velocity.y=e,this._velocity.z=i):this.log("velocityTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},velocityBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._velocity.x+=t,this._velocity.y+=e,this._velocity.z+=i):this.log("velocityBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translateBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._translate.x+=t,this._translate.y+=e,this._translate.z+=i):this.log("translateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translateTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._translate.x=t,this._translate.y=e,this._translate.z=i):this.log("translateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},translateToPoint:function(t){return t!==void 0?(this._translate.x=t.x,this._translate.y=t.y,this._translate.z=t.z):this.log("translateToPoint() called with a missing or undefined point parameter!","error"),this._entity||this},translateToTile:function(t,e,i){if(this._parent&&this._parent._tileWidth!==void 0&&this._parent._tileHeight!==void 0){var o;o=i!==void 0?i*this._parent._tileWidth:this._translate.z,this.translateTo(t*this._parent._tileWidth+this._parent._tileWidth/2,e*this._parent._tileHeight+this._parent._tileWidth/2,o)}else this.log("Cannot translate to tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.","warning");return this},translate:function(){return arguments.length&&this.log("You called translate with arguments, did you mean translateTo or translateBy instead of translate?","warning"),this.x=this._translateAccessorX,this.y=this._translateAccessorY,this.z=this._translateAccessorZ,this._entity||this},_translateAccessorX:function(t){return t!==void 0?(this._translate.x=t,this._entity||this):this._translate.x},_translateAccessorY:function(t){return t!==void 0?(this._translate.y=t,this._entity||this):this._translate.y},_translateAccessorZ:function(t){return t!==void 0?(this._translate.z=t,this._entity||this):this._translate.z},rotateBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._rotate.x+=t,this._rotate.y+=e,console.log(i,this._rotate.z,i-this._rotate.z),this.rotateBy(0,0,i-this._rotate.z),this._rotate.z+=i):this.log("rotateBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotateTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._rotate.x=t,this._rotate.y=e,this._rotate.z=i):this.log("rotateTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},rotate:function(){return arguments.length&&this.log("You called rotate with arguments, did you mean rotateTo or rotateBy instead of rotate?","warning"),this.x=this._rotateAccessorX,this.y=this._rotateAccessorY,this.z=this._rotateAccessorZ,this._entity||this},_rotateAccessorX:function(t){return t!==void 0?(this._rotate.x=t,this._entity||this):this._rotate.x},_rotateAccessorY:function(t){return t!==void 0?(this._rotate.y=t,this._entity||this):this._rotate.y},_rotateAccessorZ:function(t){return t!==void 0?(this._rotate.z=t,this._entity||this):this._rotate.z},scaleBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._scale.x+=t,this._scale.y+=e,this._scale.z+=i):this.log("scaleBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scaleTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._scale.x=t,this._scale.y=e,this._scale.z=i):this.log("scaleTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},scale:function(){return arguments.length&&this.log("You called scale with arguments, did you mean scaleTo or scaleBy instead of scale?","warning"),this.x=this._scaleAccessorX,this.y=this._scaleAccessorY,this.z=this._scaleAccessorZ,this._entity||this},_scaleAccessorX:function(t){return t!==void 0?(this._scale.x=t,this._entity||this):this._scale.x},_scaleAccessorY:function(t){return t!==void 0?(this._scale.y=t,this._entity||this):this._scale.y},_scaleAccessorZ:function(t){return t!==void 0?(this._scale.z=t,this._entity||this):this._scale.z},originBy:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._origin.x+=t,this._origin.y+=e,this._origin.z+=i):this.log("originBy() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},originTo:function(t,e,i){return t!==void 0&&e!==void 0&&i!==void 0?(this._origin.x=t,this._origin.y=e,this._origin.z=i):this.log("originTo() called with a missing or undefined x, y or z parameter!","error"),this._entity||this},origin:function(){return this.x=this._originAccessorX,this.y=this._originAccessorY,this.z=this._originAccessorZ,this._entity||this},_originAccessorX:function(t){return t!==void 0?(this._origin.x=t,this._entity||this):this._origin.x},_originAccessorY:function(t){return t!==void 0?(this._origin.y=t,this._entity||this):this._origin.y},_originAccessorZ:function(t){return t!==void 0?(this._origin.z=t,this._entity||this):this._origin.z},_rotatePoint:function(t,e,i){var o=Math.cos(e),n=Math.sin(e);return{x:i.x+(t.x-i.x)*o+(t.y-i.y)*n,y:i.y-(t.x-i.x)*n+(t.y-i.y)*o}},updateTransform:function(){if(this._localMatrix.identity(),this._mode===0&&this._localMatrix.multiply(this._localMatrix._newTranslate(this._translate.x,this._translate.y)),this._mode===1){var t=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this._bounds3d.z/2).toIso();this._parent&&this._parent._bounds3d.z&&(t.y+=this._parent._bounds3d.z/1.6),this._localMatrix.multiply(this._localMatrix._newTranslate(t.x,t.y))}return this._localMatrix.rotateBy(this._rotate.z),this._localMatrix.scaleBy(this._scale.x,this._scale.y),(this._origin.x!==.5||this._origin.y!==.5)&&this._localMatrix.translateBy(this._bounds2d.x*(.5-this._origin.x),this._bounds2d.y*(.5-this._origin.y)),this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix),this._worldMatrix.compare(this._oldWorldMatrix)?this._transformChanged=!1:(this._oldWorldMatrix.copy(this._worldMatrix),this._transformChanged=!0,this._aabbDirty=!0,this._bounds3dPolygonDirty=!0),this._oldBounds2d.compare(this._bounds2d)||(this._aabbDirty=!0,this._oldBounds2d.copy(this._bounds2d)),this._oldBounds3d.compare(this._bounds3d)||(this._bounds3dPolygonDirty=!0,this._oldBounds3d.copy(this._bounds3d)),this},disableInterpolation:function(t){return t!==void 0?(this._disableInterpolation=t,this):this._disableInterpolation},streamSections:function(t){return t!==void 0?(this._streamSections=t,this):this._streamSections},streamSectionsPush:function(t){return this._streamSections=this._streamSections||[],this._streamSections.push(t),this},streamSectionsPull:function(t){return this._streamSections&&this._streamSections.pull(t),this},streamProperty:function(t,e){return this._streamProperty=this._streamProperty||{},t!==void 0?e!==void 0?(this._streamProperty[t]=e,this):this._streamProperty[t]:void 0},streamSectionData:function(t,e,i){switch(t){case"transform":if(!e){var o=this._translate.x.toFixed(0)+","+this._translate.y.toFixed(0)+","+this._rotate.z.toFixed(2);return this._oldTranslate=this._translate.clone(),this._oldRotate=this._rotate.clone(),o}var n=e.split(",");this._disableInterpolation||i||this._streamJustCreated?(n[0]&&(this._translate.x=parseFloat(n[0])),n[1]&&(this._translate.y=parseFloat(n[1])),n[2]&&(this._rotate.z=parseFloat(n[2])),this._compositeCache&&this.cacheDirty(!0)):(n[0]&&(n[0]=parseFloat(n[0])),n[1]&&(n[1]=parseFloat(n[1])),n[2]&&(n[2]=parseFloat(n[2])),this._timeStream.push([ige.network.stream._streamDataTime+ige.network._latency,n]),this._timeStream.length>10&&this._timeStream.shift());break;case"depth":if(e===void 0)return this.depth()+"";ige.isClient&&this.depth(parseInt(e));break;case"layer":if(e===void 0)return this.layer()+"";ige.isClient&&this.layer(parseInt(e));break;case"bounds2d":if(e===void 0)return this._bounds2d.x+","+this._bounds2d.y+"";if(ige.isClient){var s=e.split(",");this.bounds2d(parseFloat(s[0]),parseFloat(s[1]))}break;case"bounds3d":if(e===void 0)return this._bounds3d.x+","+this._bounds3d.y+","+this._bounds3d.z+"";if(ige.isClient){var s=e.split(",");this.bounds3d(parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2]))}break;case"hidden":if(e===void 0)return this.isHidden()+"";ige.isClient&&(e=="true"?this.hide():this.show());break;case"mount":if(e===void 0){var r=this.parent();return r?this.parent().id():""}if(ige.isClient)if(e){var a=ige.$(e);a&&this.mount(a)}else this.unMount();break;case"origin":if(e===void 0)return this._origin.x+","+this._origin.y+","+this._origin.z+"";if(ige.isClient){var s=e.split(",");this.origin(parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2]))}break;case"props":var h,l,c;if(e===void 0){h={};for(c in this._streamProperty)this._streamProperty.hasOwnProperty(c)&&(h[c]=this._streamProperty[c]);return JSON.stringify(h)}if(ige.isClient){var m=JSON.parse(e);for(c in m)l=!1,m.hasOwnProperty(c)&&(this._streamProperty[c]!=m[c]&&(l=!0),this._streamProperty[c]=m[c],this.emit("streamPropChange",[c,m[c]]))
}}},interpolateValue:function(t,e,i,o,n){var s=e-t,r=n-i,a=o-i,h=a/r;return 0>h?h=0:h>1&&(h=1),s*h+t},_processInterpolate:function(t,e){e||(e=200);var i,o,n,s,r,a,h,l=this._timeStream,c=[],m=1;while(l[m]){if(l[m][0]>t){i=l[m-1],o=l[m];break}m++}o||i?l.splice(0,m-1):l.length>2&&t>l[l.length-1][0]&&(i=l[l.length-2],o=l[l.length-1],l.shift(),this.emit("interpolationLag")),o&&i&&(isNaN(i[0])&&(i[0]=o[0]),this._timeStreamPreviousData=i,this._timeStreamNextData=o,n=o[0]-i[0],s=t-i[0],this._timeStreamDataDelta=Math.floor(n),this._timeStreamOffsetDelta=Math.floor(s),r=s/n,this._timeStreamCurrentInterpolateTime=r,a=i[1],h=o[1],c[0]=this.interpolateValue(a[0],h[0],i[0],t,o[0]),c[1]=this.interpolateValue(a[1],h[1],i[0],t,o[0]),c[2]=this.interpolateValue(a[2],h[2],i[0],t,o[0]),this.translateTo(parseFloat(c[0]),parseFloat(c[1]),0),this.rotateTo(0,0,parseFloat(c[2])),this._lastUpdate=(new Date).getTime())}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_60);var $i_61=$i_60.extend([{extension:$i_45,overwrite:!0},{extension:$i_44,overwrite:!0}],{classId:"$i_61",init:function(){$i_60.prototype.init.call(this),this._color="#000000",this._borderLeftWidth=0,this._borderTopWidth=0,this._borderRightWidth=0,this._borderBottomWidth=0,this._borderTopLeftRadius=0,this._borderTopRightRadius=0,this._borderBottomRightRadius=0,this._borderBottomLeftRadius=0,this._backgroundPosition={x:0,y:0},this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0},disabled:function(t){return t!==void 0?(this._disabled=t,this):this._disabled},overflow:function(t){return t!==void 0?(this._overflow=t,this):this._overflow},_renderBackground:function(t){var e,i,o,n,s=this._bounds2d;(this._backgroundColor||this._patternFill)&&(e=-(s.x/2)|0,i=-(s.y/2)|0,o=s.x,n=s.y,t.save(),t.beginPath(),this._borderTopRightRadius||this._borderBottomRightRadius||this._borderBottomLeftRadius||this._borderTopLeftRadius?(t.moveTo(e+this._borderTopLeftRadius,i),t.lineTo(e+o-this._borderTopRightRadius,i),this._borderTopRightRadius>0&&t.arcTo(e+o,i,e+o,i+this._borderTopRightRadius,this._borderTopRightRadius),t.lineTo(e+o,i+n-this._borderBottomRightRadius),this._borderBottomRightRadius>0&&t.arcTo(e+o,i+n,e+o-this._borderBottomRightRadius,i+n,this._borderBottomRightRadius),t.lineTo(e+this._borderBottomLeftRadius,i+n),this._borderBottomLeftRadius>0&&t.arcTo(e,i+n,e,i+n-this._borderBottomLeftRadius,this._borderBottomLeftRadius),t.lineTo(e,i+this._borderTopLeftRadius),this._borderTopLeftRadius>0&&t.arcTo(e,i,e+this._borderTopLeftRadius,i,this._borderTopLeftRadius),t.clip()):t.rect(e,i,o,n),this._backgroundColor&&(t.fillStyle=this._backgroundColor,t.fill()),this._patternFill&&(t.translate(-(o/2|0)+this._backgroundPosition.x,-(n/2|0)+this._backgroundPosition.y),t.fillStyle=this._patternFill,t.fill()),t.restore())},_renderBorder:function(t){var e,i=this._bounds2d,o=(-i.x2|0)+.5,n=(-i.y2|0)+.5,s=i.x-1,r=i.y-1;if(this._borderTopRightRadius||this._borderBottomRightRadius||this._borderBottomLeftRadius||this._borderTopLeftRadius||this._borderLeftWidth!==this._borderWidth||this._borderTopWidth!==this._borderWidth||this._borderRightWidth!==this._borderWidth||this._borderBottomWidth!==this._borderWidth){var a=function(){t.stroke(),t.beginPath()};e=Math.PI/180,t.beginPath(),this._borderTopWidth&&(t.strokeStyle=this._borderTopColor,t.lineWidth=this._borderTopWidth,this._borderTopLeftRadius>0&&t.arc(o+this._borderTopLeftRadius,n+this._borderTopLeftRadius,this._borderTopLeftRadius,225*e,270*e),t.moveTo(o+this._borderTopLeftRadius,n),t.lineTo(o+s-this._borderTopRightRadius,n),this._borderTopRightRadius>0&&t.arc(o+s-this._borderTopRightRadius,n+this._borderTopRightRadius,this._borderTopRightRadius,-90*e,-44*e)),this._borderRightWidth&&this._borderTopColor==this._borderRightColor&&this._borderTopWidth==this._borderRightWidth||a(),this._borderRightWidth&&(t.strokeStyle=this._borderRightColor,t.lineWidth=this._borderRightWidth,this._borderTopRightRadius>0&&t.arc(o+s-this._borderTopRightRadius,n+this._borderTopRightRadius,this._borderTopRightRadius,-45*e,0),t.moveTo(o+s,n+this._borderTopRightRadius),t.lineTo(o+s,n+r-this._borderBottomRightRadius),this._borderBottomRightRadius>0&&t.arc(o+s-this._borderBottomRightRadius,n+r-this._borderBottomRightRadius,this._borderTopRightRadius,0,46*e)),this._borderBottomWidth&&this._borderRightColor==this._borderBottomColor&&this._borderRightWidth==this._borderBottomWidth||a(),this._borderBottomWidth&&(t.strokeStyle=this._borderBottomColor,t.lineWidth=this._borderBottomWidth,this._borderBottomRightRadius>0&&t.arc(o+s-this._borderBottomRightRadius,n+r-this._borderBottomRightRadius,this._borderBottomRightRadius,45*e,90*e),t.moveTo(o+s-this._borderBottomRightRadius,n+r),t.lineTo(o+this._borderBottomLeftRadius,n+r),this._borderBottomLeftRadius>0&&t.arc(o+this._borderBottomLeftRadius,n+r-this._borderBottomLeftRadius,this._borderBottomLeftRadius,90*e,136*e)),this._borderLeftWidth&&this._borderBottomColor==this._borderLeftColor&&this._borderBottomWidth==this._borderLeftWidth||a(),this._borderLeftWidth&&(t.strokeStyle=this._borderLeftColor,t.lineWidth=this._borderLeftWidth,this._borderBottomLeftRadius>0&&t.arc(o+this._borderBottomLeftRadius,n+r-this._borderBottomLeftRadius,this._borderBottomLeftRadius,135*e,180*e),t.moveTo(o,n+r-this._borderBottomLeftRadius),t.lineTo(o,n+this._borderTopLeftRadius),this._borderTopLeftRadius>0&&t.arc(o+this._borderTopLeftRadius,n+this._borderTopLeftRadius,this._borderTopLeftRadius,180*e,226*e)),t.stroke()}else t.strokeStyle=this._borderColor,t.lineWidth=this._borderWidth,t.strokeRect(o,n,s,r)},cell:function(t){var e=$i_60.prototype.cell.call(this,t);return e===this&&this._patternTexture&&this.backgroundImage(this._patternTexture,this._patternRepeat),e},mount:function(t){var e=$i_60.prototype.mount.call(this,t);return this._parent&&(this._updateUiPosition&&this._updateUiPosition(),this._children.length&&this.updateUiChildren(),this._updateStyle&&this._updateStyle()),e},tick:function(t,e){if(!this._hidden&&this._inView&&(!this._parent||this._parent._inView)&&!this._streamJustCreated){if(e||this._transformContext(t),this._renderBackground(t),this._renderBorder(t),this._overflow==="hidden"){var i=this._bounds2d,o=-(i.x/2)+this._paddingLeft|0,n=-(i.y/2)+this._paddingTop|0,s=i.x+this._paddingRight,r=i.y+this._paddingBottom;t.rect(o,n,s,r),t.clip()}t.translate(this._paddingLeft,this._paddingTop),$i_60.prototype.tick.call(this,t,!0)}},_resizeEvent:function(t){this._updateUiPosition&&this._updateUiPosition(),this._updateStyle&&this._updateStyle(),$i_60.prototype._resizeEvent.call(this,t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_61);var $i_62=$i_61.extend({classId:"$i_62",init:function(){var t=this;$i_61.prototype.init.call(this),ige.ui.registerElement(this),this._focused=!1,this._allowHover=!0,this._allowFocus=!0,this._allowActive=!0;var e=function(){t._updateStyle()};this.on("mouseOver",function(){this._allowHover?(e(),ige.input.stopPropagation()):this._mouseStateOver=!1}),this.on("mouseOut",function(){this._allowHover?(e(),ige.input.stopPropagation()):this._mouseStateOver=!1}),this.on("mouseDown",function(){this._allowActive?(e(),ige.input.stopPropagation()):this._mouseStateDown=!1}),this.on("mouseUp",function(){this._allowFocus?t.focus()?ige.input.stopPropagation():e():this._allowActive&&e()}),this.mouseEventsActive(!0)},allowHover:function(t){return t!==void 0?(this._allowHover=t,this):this._allowHover},allowFocus:function(t){return t!==void 0?(this._allowFocus=t,this):this._allowFocus},allowActive:function(t){return t!==void 0?(this._allowActive=t,this):this._allowActive},styleClass:function(t){return t!==void 0?(t="."+t,this._styleClass&&this._styleClass!==t&&ige.ui.unRegisterElementStyle(this),this._styleClass=t,ige.ui.registerElementStyle(this),this._updateStyle(),this):this._styleClass},_updateStyle:function(){this._processStyle(this._classId),this._processStyle(this._styleClass),this._processStyle("#"+this._id),this._focused&&(this._processStyle(this._classId,"focus"),this._processStyle(this._styleClass,"focus"),this._processStyle("#"+this._id,"focus")),this._mouseStateOver&&(this._processStyle(this._classId,"hover"),this._processStyle(this._styleClass,"hover"),this._processStyle("#"+this._id,"hover")),this._mouseStateDown&&(this._processStyle(this._classId,"active"),this._processStyle(this._styleClass,"active"),this._processStyle("#"+this._id,"active"))},_processStyle:function(t,e){if(t){e&&(t+=":"+e);var i=ige.ui.style(t);i&&this.applyStyle(i)}},applyStyle:function(t){var e;if(t!==void 0)for(var i in t)t.hasOwnProperty(i)&&typeof this[i]=="function"&&(e=t[i]instanceof Array?t[i]:[t[i]],this[i].apply(this,e));return this},focus:function(){return ige.ui.focus(this)?(this._updateStyle(),!0):!1},blur:function(){return ige.ui.blur(this)?(this._updateStyle(),!0):!1},focused:function(){return this._focused},value:function(t){return t!==void 0?(this._value=t,this):this._value},_mounted:function(){this._updateStyle()},destroy:function(){ige.ui.unRegisterElement(this),$i_61.prototype.destroy.call(this)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_62);var $i_63=$i_61.extend({classId:"$i_63",init:function(){$i_61.prototype.init.call(this),this._renderText=void 0,this._text=void 0,this._textAlignX=1,this._textAlignY=1,this._textLineSpacing=0,this._nativeMode=!1,this.cache(!0)},width:function(t,e,i,o){t!==void 0&&this._bounds2d.x!==t&&this.clearCache();var n=$i_61.prototype.width.call(this,t,e,i,o);return this._autoWrap&&this._applyAutoWrap(),n},height:function(t,e,i,o){return t!==void 0&&this._bounds2d.y!==t&&this.clearCache(),$i_61.prototype.height.call(this,t,e,i,o)},text:function(t){if(t!==void 0){var e=!1;return t+="",this._text!==t&&(this.clearCache(),e=!0),this._text=t,this._autoWrap&&e?this._applyAutoWrap():this._renderText=t,this}return this._text},bindData:function(t,e,i,o){return t!==void 0&&e!==void 0&&(this._bindDataObject=t,this._bindDataProperty=e,this._bindDataPreText=i||"",this._bindDataPostText=o||""),this},textAlignX:function(t){return t!==void 0?(this._textAlignX!==t&&this.clearCache(),this._textAlignX=t,this):this._textAlignX},textAlignY:function(t){return t!==void 0?(this._textAlignY!==t&&this.clearCache(),this._textAlignY=t,this):this._textAlignY},textLineSpacing:function(t){return t!==void 0?(this._textLineSpacing!==t&&this.clearCache(),this._textLineSpacing=t,this):this._textLineSpacing},colorOverlay:function(t){return t!==void 0?(this._colorOverlay!==t&&this.clearCache(),this._colorOverlay=t,this):this._colorOverlay},color:function(t){return this.colorOverlay(t)},clearCache:function(){this._cache&&this.cacheDirty(!0),this._texture&&this._texture._caching&&this._texture._cacheText[this._renderText]&&delete this._texture._cacheText[this._renderText]},nativeFont:function(t){if(t!==void 0){this._nativeFont!==t&&this.clearCache(),this._nativeFont=t;var e=new $i_54($i_58);return this.texture(e),this._nativeMode=!0,this}return this._nativeFont},nativeStroke:function(t){return t!==void 0?(this._nativeStroke!==t&&this.clearCache(),this._nativeStroke=t,this):this._nativeStroke},nativeStrokeColor:function(t){return t!==void 0?(this._nativeStrokeColor!==t&&this.clearCache(),this._nativeStrokeColor=t,this):this._nativeStrokeColor},autoWrap:function(t){return t!==void 0?(this._autoWrap=t,this._text&&(this._applyAutoWrap(),this.clearCache()),this):this._autoWrap},_applyAutoWrap:function(){if(this._text){var t,e,i,o=this._text.replace(/\n/g," "),n=[],s="";for(t=o.split(" "),e=0;t.length>e;e++)s&&(s+=" "),s+=t[e],i=this.measureTextWidth(s),this._bounds2d.x>i?n.push(t[e]):(s=t[e],n.push("\n"+t[e]));this._renderText=n.join(" ")}},measureTextWidth:function(t){return t=t||this._text,this._texture._mode===0?this._texture.measureTextWidth(t):this._texture.script.measureTextWidth(t,this)},tick:function(t){this._bindDataObject&&this._bindDataProperty&&(this._bindDataObject._alive===!1?delete this._bindDataObject:this.text(this._bindDataPreText+this._bindDataObject[this._bindDataProperty]+this._bindDataPostText)),$i_61.prototype.tick.call(this,t)},_stringify:function(){var t,e=$i_61.prototype._stringify.call(this);for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_text":e+=".text("+this.text()+")";break;case"_textAlignX":e+=".textAlignX("+this.textAlignX()+")";break;case"_textAlignY":e+=".textAlignY("+this.textAlignY()+")";break;case"_textLineSpacing":e+=".textLineSpacing("+this.textLineSpacing()+")"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_63);var $i_64=$i_61.extend({classId:"$i_64",$i_64:!0,init:function(){$i_61.prototype.init.call(this),this._currentDelta=0,this._started=!1,this._particles=[],this.applyDepthToParticles(!0),this.applyLayerToParticles(!0),this.quantityTimespan(1e3),this.quantityBase(10),this.quantityVariance(0,0),this.translateBaseX(0),this.translateBaseY(0),this.translateBaseZ(0),this.translateVarianceX(0,0),this.translateVarianceY(0,0),this.translateVarianceZ(0,0),this.rotateBase(0),this.rotateVariance(0,0),this.deathRotateBase(0),this.deathRotateVariance(0,0),this.scaleBaseX(1),this.scaleBaseY(1),this.scaleBaseZ(1),this.scaleVarianceX(0,0),this.scaleVarianceY(0,0),this.scaleVarianceZ(0,0),this.scaleLockAspect(!1),this.deathScaleBaseX(0),this.deathScaleBaseY(0),this.deathScaleBaseZ(0),this.deathScaleVarianceX(0,0),this.deathScaleVarianceY(0,0),this.deathScaleVarianceZ(0,0),this.deathScaleLockAspect(!1),this.opacityBase(1),this.opacityVariance(0,0),this.deathOpacityBase(1),this.deathOpacityVariance(0,0),this.lifeBase(1e3),this.lifeVariance(0,0)},particle:function(t){return this._particle=t,this},particleMountTarget:function(t){return this._particleMountTarget=t,this},applyDepthToParticles:function(t){return this._applyDepthToParticles=t,this},applyLayerToParticles:function(t){return this._applyLayerToParticles=t,this},quantityTimespan:function(t){return this._quantityTimespan=t,this},quantityBase:function(t){return this._quantityBase=t,this},quantityVariance:function(t,e){return this._quantityVariance=[t,e],this},quantityMax:function(t){return this._quantityMax=t,this._quantityProduced=0,this},translateBaseX:function(t){return this._translateBaseX=t,this},translateBaseY:function(t){return this._translateBaseY=t,this},translateBaseZ:function(t){return this._translateBaseZ=t,this},translateVarianceX:function(t,e){return this._translateVarianceX=[t,e],this},translateVarianceY:function(t,e){return this._translateVarianceY=[t,e],this},translateVarianceZ:function(t,e){return this._translateVarianceZ=[t,e],this},rotateBase:function(t){return this._rotateBase=t,this},rotateVariance:function(t,e){return this._rotateVariance=[t,e],this},deathRotateBase:function(t){return this._deathRotateBase=t,this},deathRotateVariance:function(t,e){return this._deathRotateVariance=[t,e],this},scaleBaseX:function(t){return this._scaleBaseX=t,this},scaleBaseY:function(t){return this._scaleBaseY=t,this},scaleBaseZ:function(t){return this._scaleBaseZ=t,this},scaleVarianceX:function(t,e){return this._scaleVarianceX=[t,e],this},scaleVarianceY:function(t,e){return this._scaleVarianceY=[t,e],this},scaleVarianceZ:function(t,e){return this._scaleVarianceZ=[t,e],this},scaleLockAspect:function(t){return this._scaleLockAspect=t,this},deathScaleBaseX:function(t){return this._deathScaleBaseX=t,this},deathScaleBaseY:function(t){return this._deathScaleBaseY=t,this},deathScaleBaseZ:function(t){return this._deathScaleBaseZ=t,this},deathScaleVarianceX:function(t,e){return this._deathScaleVarianceX=[t,e],this},deathScaleVarianceY:function(t,e){return this._deathScaleVarianceY=[t,e],this},deathScaleVarianceZ:function(t,e){return this._deathScaleVarianceZ=[t,e],this},deathScaleLockAspect:function(t){return this._deathScaleLockAspect=t,this},opacityBase:function(t){return this._opacityBase=t,this},opacityVariance:function(t,e){return this._opacityVariance=[t,e],this},deathOpacityBase:function(t){return this._deathOpacityBase=t,this},deathOpacityVariance:function(t,e){return this._deathOpacityVariance=[t,e],this},lifeBase:function(t){return this._lifeBase=t,this},lifeVariance:function(t,e){return this._lifeVariance=[t,e],this},velocityVector:function(t,e,i){return this._velocityVector={base:t,min:e,max:i},this},linearForceVector:function(t,e,i){return this._linearForceVector={base:t,min:e,max:i},this},start:function(){return this._particle?(this.updateTransform(),this._quantityTimespan=this._quantityTimespan!==void 0?this._quantityTimespan:1e3,this._maxParticles=this.baseAndVarianceValue(this._quantityBase,this._quantityVariance,!0),this._particlesPerTimeVector=this._quantityTimespan/this._maxParticles,this._currentDelta=0,this._quantityProduced=0,this._started=!0):this.log("Cannot start particle emitter because no particle class was specified with a call to particle()","error"),this},updateSettings:function(){this._maxParticles=this.baseAndVarianceValue(this._quantityBase,this._quantityVariance,!0),this._particlesPerTimeVector=this._quantityTimespan/this._maxParticles},stop:function(){return this._started=!1,this},stopAndKill:function(){this._started=!1;var t=this._particles,e=t.length;while(e--)t[e].destroy();return this._particles=[],this},baseAndVarianceValue:function(t,e,i){t=t||0,e=e||[0,0];var o=0;return o=i?Math.floor(e[0]+Math.random()*(e[1]-e[0])):e[0]+Math.random()*(e[1]-e[0]),t+o},vectorFromBaseMinMax:function(t){if(t.min&&t.max){var e=t.base,i=t.min,o=t.max,n={};return n.x=e.x+(i.x+Math.random()*(o.x-i.x)),n.y=e.y+(i.y+Math.random()*(o.y-i.y)),n.z=e.z+(i.z+Math.random()*(o.z-i.z)),n}return t.base},tick:function(t){if(this._currentDelta+=ige._tickDelta,this._parent&&this._started&&(!this._quantityMax||this._quantityMax>this._quantityProduced)){var e,i,o,n,s,r,a,h,l,c,m,_,u,d,p,y,x,f,g,v,b,C,w,D,S,B,I;if(this._currentDelta>this._quantityTimespan&&(this._currentDelta=this._quantityTimespan),this._currentDelta>=this._particlesPerTimeVector&&(e=this._currentDelta/this._particlesPerTimeVector|0,this._currentDelta-=this._particlesPerTimeVector*e,e))while(e--){if(this._quantityMax&&(this._quantityProduced++,this._quantityProduced>=this._quantityMax)){this.stop();break}for(i=this.baseAndVarianceValue(this._translateBaseX,this._translateVarianceX,!0),o=this.baseAndVarianceValue(this._translateBaseY,this._translateVarianceY,!0),n=this.baseAndVarianceValue(this._translateBaseZ,this._translateVarianceZ,!0),this._velocityVector&&(s=this.vectorFromBaseMinMax(this._velocityVector),h=s.x,l=s.y,c=this._worldMatrix.matrix[0],m=this._worldMatrix.matrix[3],r=h*c-l*m,a=l*c+h*m,s.x=r,s.y=a),_=this.baseAndVarianceValue(this._scaleBaseX,this._scaleVarianceX,!1),d=u=_,this._scaleLockAspect||(u=this.baseAndVarianceValue(this._scaleBaseY,this._scaleVarianceY,!1),d=this.baseAndVarianceValue(this._scaleBaseZ,this._scaleVarianceZ,!1)),p=this.baseAndVarianceValue(this._rotateBase,this._rotateVariance,!0),y=this.baseAndVarianceValue(this._opacityBase,this._opacityVariance,!1),x=this.baseAndVarianceValue(this._lifeBase,this._lifeVariance,!0),this._linearForceVector&&(f=this.vectorFromBaseMinMax(this._linearForceVector),h=f.x,l=f.y,c=this._worldMatrix.matrix[0],m=this._worldMatrix.matrix[3],r=h*c-l*m,a=l*c+h*m,f.x=r,f.y=a),this._deathScaleBaseX!==void 0&&(g=this.baseAndVarianceValue(this._deathScaleBaseX,this._deathScaleVarianceX,!1)),this._deathScaleBaseY===void 0||this._deathScaleLockAspect||(v=this.baseAndVarianceValue(this._deathScaleBaseY,this._deathScaleVarianceY,!1)),this._deathScaleBaseZ===void 0||this._deathScaleLockAspect||(b=this.baseAndVarianceValue(this._deathScaleBaseZ,this._deathScaleVarianceZ,!1)),this._deathScaleLockAspect&&(b=v=g),this._deathRotateBase!==void 0&&(C=this.baseAndVarianceValue(this._deathRotateBase,this._deathRotateVariance,!0)),this._deathOpacityBase!==void 0&&(w=this.baseAndVarianceValue(this._deathOpacityBase,this._deathOpacityVariance,!1)),D=new this._particle(this),this._ignoreCamera?(i+=this._translate.x,o+=this._translate.y):(i+=this._worldMatrix.matrix[2],o+=this._worldMatrix.matrix[5]),n+=this._translate.z,_*=this._scale.x,u*=this._scale.y,d*=this._scale.z,g*=this._scale.x,v*=this._scale.y,b*=this._scale.z,D.translateTo(i,o,n),D.rotateTo(0,0,Math.radians(p)),D.scaleTo(_,u,d),D.opacity(y),this._applyDepthToParticles&&D.depth(this._depth),this._applyLayerToParticles&&D.layer(this._layer),typeof s=="object"&&D.velocity.vector3(s,!1),typeof f=="object"&&D.velocity.linearForceVector3(f,!1),S=[],C!==void 0&&S.push((new $i_53).targetObj(D._rotate).properties({z:Math.radians(C)}).duration(x)),w!==void 0&&S.push((new $i_53).targetObj(D).properties({_opacity:w}).duration(x)),B={},g!==void 0&&(B.x=g),v!==void 0&&(B.y=v),b!==void 0&&(B.z=b),(B.x||B.y||B.z)&&S.push((new $i_53).targetObj(D._scale).properties(B).duration(x)),typeof x=="number"&&D.lifeSpan(x),this._particles.push(D),D.mount(this._particleMountTarget||this._parent),I=0;S.length>I;I++)S[I].start()}}$i_61.prototype.tick.call(this,t)},particles:function(){return this._particles},_stringify:function(){var t=$i_61.prototype._stringify.call(this);return t}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_64);var $i_65=$i_60.extend({classId:"$i_65",init:function(t){this._emitter=t,$i_60.prototype.init.call(this),this.addComponent($i_11)},destroy:function(){this._emitter!==void 0&&this._emitter._particles.pull(this),$i_60.prototype.destroy.call(this)}}),$i_66=$i_2.extend({classId:"$i_66",init:function(t){this._mapData=t||[]},tileData:function(t,e,i){if(t!==void 0&&e!==void 0){if(i!==void 0)return this._mapData[e]=this._mapData[e]||[],this._mapData[e][t]=i,this;if(this._mapData[e])return this._mapData[e][t]}return void 0},clearData:function(t,e){return t!==void 0&&e!==void 0&&this._mapData[e]!==void 0?(delete this._mapData[e][t],!0):!1},collision:function(t,e,i,o){var n,s;if(i===void 0&&(i=1),o===void 0&&(o=1),t!==void 0&&e!==void 0)for(s=0;o>s;s++)for(n=0;i>n;n++)if(this.tileData(t+n,e+s))return!0;return!1},collisionWith:function(t,e,i,o,n){var s,r;if(i===void 0&&(i=1),o===void 0&&(o=1),t!==void 0&&e!==void 0)for(r=0;o>r;r++)for(s=0;i>s;s++)if(this.tileData(t+s,e+r)===n)return!0;return!1},collisionWithOnly:function(t,e,i,o,n){var s,r,a,h=!1;if(i===void 0&&(i=1),o===void 0&&(o=1),t!==void 0&&e!==void 0)for(r=0;o>r;r++)for(s=0;i>s;s++)if(a=this.tileData(t+s,e+r)){if(this.tileData(t+s,e+r)!==n)return!1;h=!0}return h},mapData:function(t,e,i){if(t!==void 0){if(e||i){var o,n;for(n in t)for(o in t[n])this._mapData[i+parseInt(n)][e+parseInt(o)]=t[n][o]}else this._mapData=t;return this}return this._mapData},sortedMapDataAsArray:function(){var t,e,i,o,n,s,r=this.mapData(),a={};for(o=this._sortKeys(r),n=0;o.length>n;n++)for(e=o[n],i=this._sortKeys(r[e]),a[e]=a[e]||{},s=0;i.length>s;s++)t=i[s],a[e][t]=r[e][t];return a},_sortKeys:function(t){var e=[];for(var i in t)e.push(i);return e.sort(),e},mapDataString:function(){return JSON.stringify(this.mapData())},insertMapData:function(){},rotateData:function(t,e){switch(e){case-90:break;case 180:break;case 90:default:}},translateDataBy:function(t,e){var i,o,n,s,r,a=this.mapData(),h=[];for(o in a)if(a.hasOwnProperty(o)){s=parseInt(o,10),n=a[s],h[s+e]=h[s+e]||{};for(i in n)n.hasOwnProperty(i)&&(r=parseInt(i,10),h[s+e][r+t]=a[o][i])}this.mapData(h,0,0)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_66);var $i_67=$i_60.extend({classId:"$i_67",$i_67:!0,init:function(t,e){$i_60.prototype.init.call(this),t=t!==void 0?t:40,e=e!==void 0?e:40;var i=this;if(!ige.isServer){var o=new $i_54($i_67SmartTexture);i.texture(o)}i.map=new $i_66,i._adjustmentMatrix=new $i_8,i.tileWidth(t),i.tileHeight(e),i.gridSize(3,3),i._drawGrid=0,i._gridColor="#ffffff"},highlightOccupied:function(t){return t!==void 0?(this._highlightOccupied=t,this):this._highlightOccupied},highlightTileRect:function(t){return t!==void 0?(this._highlightTileRect=t,this):this._highlightTileRect},tileWidth:function(t){return t!==void 0?(this._tileWidth=t,this._gridSize&&this._gridSize.x&&(this.width(this._tileWidth*this._gridSize.x),this._updateAdjustmentMatrix()),this):this._tileWidth},tileHeight:function(t){return t!==void 0?(this._tileHeight=t,this._gridSize&&this._gridSize.y&&(this.height(this._tileHeight*this._gridSize.y),this._updateAdjustmentMatrix()),this):this._tileHeight},gridSize:function(t,e){return t!==void 0&&e!==void 0?(this._gridSize=new $i_4(t,e),this._mountMode===0&&this._tileWidth&&this.width(this._tileWidth*this._gridSize.x),this._mountMode===1&&this._tileWidth&&this.width(this._tileWidth*2*this._gridSize.x),this._tileHeight&&this.height(this._tileHeight*this._gridSize.y),this._updateAdjustmentMatrix(),this):this._gridSize},drawGrid:function(t){return t!==void 0?(this._drawGrid=t,this):this._drawGrid},gridColor:function(t){return t!==void 0?(this._gridColor=t,this):this._gridColor},occupyTile:function(t,e,i,o,n){var s,r;if(i===void 0&&(i=1),o===void 0&&(o=1),t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),o=Math.floor(o),t!==void 0&&e!==void 0){for(s=0;i>s;s++)for(r=0;o>r;r++)this.map.tileData(t+s,e+r,n);n._classId&&(n._occupiedRect=new $i_7(t,e,i,o))}return this},unOccupyTile:function(t,e,i,o){var n,s,r;if(i===void 0&&(i=1),o===void 0&&(o=1),t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),o=Math.floor(o),t!==void 0&&e!==void 0)for(n=0;i>n;n++)for(s=0;o>s;s++)r=this.map.tileData(t+n,e+s),r&&r._occupiedRect&&delete r._occupiedRect,this.map.clearData(t+n,e+s);return this},isTileOccupied:function(t,e,i,o){return i===void 0&&(i=1),o===void 0&&(o=1),this.map.collision(t,e,i,o)},tileOccupiedBy:function(t,e){return this.map.tileData(t,e)},pointToTile:function(t){var e,i,o,n=t.x,s=t.y;return this._mountMode===0&&(e=n,i=s,o=new $i_5(Math.floor(e/this._tileWidth),Math.floor(i/this._tileWidth),0)),this._mountMode===1&&(e=n,i=s,o=new $i_5(Math.floor(e/this._tileWidth),Math.floor(i/this._tileHeight),0)),o},mouseTilePoint:function(){var t=this.mouseToTile().thisMultiply(this._tileWidth,this._tileHeight,1);return t.x+=this._tileWidth/2,t.y+=this._tileHeight/2,t},tileToPoint:function(t,e){var i;return this._mountMode===0&&(i=new $i_5(t,e,0).thisMultiply(this._tileWidth,this._tileHeight,1),i.x-=this._bounds2d.x2-this._tileWidth/2,i.y-=this._bounds2d.y2-this._tileHeight/2),this._mountMode===1&&(i=new $i_5(t*this._tileWidth+this._tileWidth/2,e*this._tileHeight+this._tileHeight/2,0),i.x-=this._bounds2d.x2/2,i.y-=this._bounds2d.y2),i.x2=i.x/2,i.y2=i.y/2,i},mouseToTile:function(){var t;return t=this._mountMode===0?this.pointToTile(this.mousePos()):this.pointToTile(this.mousePos().to2d())},scanRects:function(t){var e,i,o=[],n=this.map._mapData.clone();for(i in n)if(n.hasOwnProperty(i))for(e in n[i])n[i].hasOwnProperty(e)&&n[i][e]&&(!t||t&&t(n[i][e],e,i))&&o.push(this._scanRects(n,parseInt(e,10),parseInt(i,10),t));return o},_scanRects:function(t,e,i,o){var n={x:e,y:i,width:1,height:1},s=e+1,r=i+1;t[i][e]=0;while(t[i][s]&&(!o||o&&o(t[i][s],s,i)))n.width++,t[i][s]=0,s++;while(t[r]&&t[r][e]&&(!o||o&&o(t[r][e],e,r))){if(t[r][e-1]&&(!o||o&&o(t[r][e-1],e-1,r))||t[r][e+n.width]&&(!o||o&&o(t[r][e+n.width],e+n.width,r)))return n;for(s=e;e+n.width>s;s++)if(!t[r][s]||o&&!o(t[r][s],s,r))return n;for(s=e;e+n.width>s;s++)t[r][s]=0;n.height++,r++}return n},inGrid:function(t,e,i,o){return i===void 0&&(i=1),o===void 0&&(o=1),!(0>t||0>e||t+i>this._gridSize.x||e+o>this._gridSize.y)},hoverColor:function(t){return t!==void 0?(this._hoverColor=t,this):this._hoverColor},loadMap:function(t){return this.map.mapData(t.data,0,0),this},saveMap:function(){var t,e,i=0,o=0,n=this.map._mapData;for(e in n)if(n.hasOwnProperty(e))for(t in n[e])n[e].hasOwnProperty(t)&&(parseInt(i)>parseInt(t)&&(i=parseInt(t)),parseInt(o)>parseInt(e)&&(o=parseInt(e)));return JSON.stringify({data:this.map.sortedMapDataAsArray(),dataXY:[parseInt(i,10),parseInt(o,10)]})},isometricMounts:function(t){return t!==void 0?($i_60.prototype.isometricMounts.call(this,t),this.tileWidth(this._tileWidth),this.tileHeight(this._tileHeight),this.gridSize(this._gridSize.x,this._gridSize.y),this._updateAdjustmentMatrix(),this):this._mountMode},tileMapHitPolygon:function(){if(this._mountMode===0)return this.aabb();if(this._mountMode===1){var t=this.aabb(),e=new $i_6;return e.addPoint(t.x+t.width/2,t.y),e.addPoint(t.x+t.width,t.y+t.height/2),e.addPoint(t.x+t.width/2,t.y+t.height-1),e.addPoint(t.x-1,t.y+t.height/2-1),e}},_processTriggerHitTests:function(){if(this._mouseEventsActive&&ige._currentViewport){if(this._mouseAlwaysInside)return!0;var t=this.mouseToTile();return t.x>=0&&t.y>=0&&this._gridSize.x>t.x&&this._gridSize.y>t.y?!0:!1}return!1},_updateAdjustmentMatrix:function(){this._bounds2d.x2&&this._bounds2d.y2&&this._tileWidth&&this._tileHeight&&(this._mountMode===0&&this._adjustmentMatrix.translateTo(this._bounds2d.x2,this._bounds2d.y2),this._mountMode===1&&this._adjustmentMatrix.translateTo(0,this._bounds2d.y2))},_childMounted:function(t){t.tileWidth=t.tileWidth||this.tileWidth,t.tileHeight=t.tileHeight||this.tileHeight,t._tileWidth=t._tileWidth||1,t._tileHeight=t._tileHeight||1,$i_60.prototype._childMounted.call(this,t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_67);var $i_54Map=$i_67.extend({classId:"$i_54Map",init:function(t,e){$i_67.prototype.init.call(this,t,e),this.map=new $i_66,this._textureList=[],this._renderCenter=new $i_5(0,0,0),this._cacheDirty=!0},autoSection:function(t){return t!==void 0?(this._autoSection=t,this):this._autoSection},drawSectionBounds:function(t){return t!==void 0?(this._drawSectionBounds=t,this):this._drawSectionBounds},cacheForceFrame:function(){this._cacheDirty=!0},negate:function(t){if(t!==void 0){var e,i,o=t.map._mapData,n=this.map._mapData;for(i in o)if(o.hasOwnProperty(i))for(e in o[i])o[i].hasOwnProperty(e)&&n[i]&&n[i][e]&&delete n[i][e]}return this},addTexture:function(t){return this._textureList.push(t),t._loaded||(this._allTexturesLoaded=!1),this._textureList.length-1},allTexturesLoaded:function(){if(!this._allTexturesLoaded){var t=this._textureList,e=t.length;while(e--)if(!t[e]._loaded)return!1}return this._allTexturesLoaded=!0,!0},paintTile:function(t,e,i,o){t!==void 0&&e!==void 0&&i!==void 0&&((o===void 0||1>o)&&(o=1),this.map.tileData(t,e,[i,o]))},clearTile:function(t,e){this.map.clearData(t,e)},loadMap:function(map){if(map.textures){this._textureList=[];var tex=[],i,self=this;for(i=0;map.textures.length>i;i++)eval("tex["+i+"] = "+map.textures[i]),self.addTexture(tex[i]);self.map.mapData(map.data)}else this.map.mapData(map.data);return this},saveMap:function(){var t,e,i,o=[],n=0,s=0,r=this.map._mapData;for(t=0;this._textureList.length>t;t++)o.push(this._textureList[t].stringify());for(i in r)if(r.hasOwnProperty(i))for(e in r[i])r[i].hasOwnProperty(e)&&(n>e&&(n=e),s>i&&(s=i));return JSON.stringify({textures:o,data:this.map.mapData(),dataXY:[n,s]})},clearMap:function(){return this.map.mapData([]),this},reset:function(){return this.clearMap(),this._textureList=[],this},tileTextureIndex:function(t,e,i){if(t!==void 0&&e!==void 0){var o=this.map.tileData(t,e);if(i===void 0)return o[0];o[0]=i}},tileTextureCell:function(t,e,i){if(t!==void 0&&e!==void 0){var o=this.map.tileData(t,e);if(i===void 0)return o[1];o[1]=i}},convertHorizontalData:function(t){var e,i,o=[];for(e in t)if(t.hasOwnProperty(e))for(i in t[e])t[e].hasOwnProperty(i)&&(o[i]=o[i]||[],o[i][e]=t[e][i]);return o},tick:function(t){$i_67.prototype.tick.call(this,t);var e,i,o,n,s,r,a,h,l,c,m,_,u,d,p,y,x,f=this.map._mapData,g=this._newTileEntity();if(this._autoSection>0){if(this._cacheDirty&&this.allTexturesLoaded()){this._sections=[],this._sectionCtx=[];
for(i in f)if(f.hasOwnProperty(i))for(e in f[i])if(f[i].hasOwnProperty(e)&&(s=parseInt(e),r=parseInt(i),this._mountMode===0&&(a=s,h=r),this._mountMode===1&&(o=s*this._tileWidth,n=r*this._tileHeight,a=(o-n)/this._tileWidth,h=(o+n)*.5/this._tileHeight),l=f[i][e],c=Math.floor(a/this._autoSection),m=Math.floor(h/this._autoSection),this._ensureSectionExists(c,m),d=this._sectionCtx[c][m],l&&(p=this._renderTile(d,s,r,l,g,null,c,m))))for(x=0;p.length>x;x++)y=p[x],_=c,u=m,y.x&&(_+=y.x),y.y&&(u+=y.y),this._ensureSectionExists(_,u),d=this._sectionCtx[_][u],this._sectionTileRegion=this._sectionTileRegion||[],this._sectionTileRegion[_]=this._sectionTileRegion[_]||[],this._sectionTileRegion[_][u]=this._sectionTileRegion[_][u]||[],this._sectionTileRegion[_][u][s]=this._sectionTileRegion[_][u][s]||[],this._sectionTileRegion[_][u][s][r]||(this._sectionTileRegion[_][u][s][r]=!0,this._renderTile(d,s,r,l,g,null,_,u));this._cacheDirty=!1,delete this._sectionTileRegion}this._drawSectionsToCtx(t)}else if(this.allTexturesLoaded())for(i in f)if(f.hasOwnProperty(i))for(e in f[i])f[i].hasOwnProperty(e)&&(l=f[i][e],l&&this._renderTile(t,e,i,l,g))},_ensureSectionExists:function(t,e){var i;this._sections[t]=this._sections[t]||[],this._sectionCtx[t]=this._sectionCtx[t]||[],this._sections[t][e]||(this._sections[t][e]=document.createElement("canvas"),this._sections[t][e].width=this._tileWidth*this._autoSection,this._sections[t][e].height=this._tileHeight*this._autoSection,i=this._sectionCtx[t][e]=this._sections[t][e].getContext("2d"),ige._globalSmoothing?(i.imageSmoothingEnabled=!0,i.mozImageSmoothingEnabled=!0):(i.imageSmoothingEnabled=!1,i.mozImageSmoothingEnabled=!1),i.translate(this._tileWidth/2,this._tileHeight/2))},_drawSectionsToCtx:function(t){var e,i,o,n,s,r,a,h,l,c=ige._currentViewport.viewArea();h=this._tileWidth*this._autoSection,l=this._tileHeight*this._autoSection;for(e in this._sections)if(this._sections.hasOwnProperty(e))for(i in this._sections[e])this._sections[e].hasOwnProperty(i)&&(n=e*this._tileWidth*this._autoSection,s=i*this._tileHeight*this._autoSection,r=this._translate.x+n-ige._currentCamera._translate.x,a=this._translate.y+s-ige._currentCamera._translate.y,this._mountMode===1&&(r-=this._tileWidth/2,a-=this._tileHeight/2),-(c.width/2)>r+h+this._tileHeight/2||r-this._tileWidth/2>c.width/2||-(c.height/2)>a+l+this._tileHeight/2||a>c.height/2||(o=this._sections[e][i],t.drawImage(o,0,0,h,l,n,s,h,l),ige._drawCount++,this._drawSectionBounds&&(t.strokeStyle="#ff00f6",t.strokeRect(e*this._tileWidth*this._autoSection,i*this._tileHeight*this._autoSection,this._tileWidth*this._autoSection,this._tileHeight*this._autoSection))))},_renderTile:function(t,e,i,o,n,s,r,a){var h,l,c,m,_,u,d,p,y,x,f,g,v,b=this._mountMode===1?this._tileWidth/2:0;return this._mountMode===1?this._tileHeight/2:0,this._mountMode===0&&(h=e*this._tileWidth,l=i*this._tileHeight),this._mountMode===1&&(y=e*this._tileWidth,x=i*this._tileHeight,f=y-x,g=(y+x)*.5,h=f-this._tileWidth/2,l=g),r!==void 0&&(h-=r*this._autoSection*this._tileWidth),a!==void 0&&(l-=a*this._autoSection*this._tileHeight),!s||s.xyInside(h,l)?(0>h-b&&(c=c||[],c.push({x:-1}),m=!0,p=p||{},p.x=-1),h+b>t.canvas.width-this._tileWidth&&(c=c||[],c.push({x:1}),_=!0,p=p||{},p.x=1),0>l-0&&(c=c||[],c.push({y:-1}),u=!0,p=p||{},p.y=-1),l+0>t.canvas.height-this._tileHeight&&(c=c||[],c.push({y:1}),d=!0,p=p||{},p.y=1),(m||u||_||d)&&c.push(p),t.save(),t.translate(h,l),v=this._textureList[o[0]],n._cell=o[1],v&&v.render(t,n,ige._tickDelta),t.restore(),c):void 0},_newTileEntity:function(){return this._mountMode===0?{_cell:1,_bounds2d:{x:this._tileWidth,y:this._tileHeight},_renderPos:{x:-this._tileWidth/2,y:-this._tileHeight/2}}:this._mountMode===1?{_cell:1,_bounds2d:{x:this._tileWidth*2,y:this._tileHeight},_renderPos:{x:-this._tileWidth,y:-this._tileHeight/2}}:void 0}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_54Map);var $i_67SmartTexture={render:function(t,e){var i=e._tileWidth,o=e._tileHeight,n=(e.bounds2d(),e._gridSize),s=0,r=0;if(e._drawGrid){t.strokeStyle=e._gridColor;var a,h,l,c=s+i*n.x,m=r+o*n.y;for(s=0,r=0,a=0;n.y>=a;a++)h=new $i_4(s,r+o*a),l=new $i_4(c,r+o*a),e._mountMode===1&&(h=h.toIso(),l=l.toIso()),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.stroke();for(a=0;n.x>=a;a++)h=new $i_4(s+i*a,r),l=new $i_4(s+i*a,m),e._mountMode===1&&(h=h.toIso(),l=l.toIso()),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.stroke()}if(e._highlightOccupied){t.fillStyle="#ff0000";for(r in e.map._mapData)if(e.map._mapData[r])for(s in e.map._mapData[r])e.map._mapData[r][s]&&(_=new $i_4(i*s,o*r),e._mountMode===0&&t.fillRect(_.x,_.y,i,o),e._mountMode===1&&(_.thisToIso(),t.beginPath(),t.moveTo(_.x,_.y),t.lineTo(_.x+i,_.y+o/2),t.lineTo(_.x,_.y+o),t.lineTo(_.x-i,_.y+o/2),t.lineTo(_.x,_.y),t.fill()))}if(e._highlightTileRect)for(t.fillStyle="#e4ff00",r=e._highlightTileRect.y;e._highlightTileRect.y+e._highlightTileRect.height>r;r++)for(s=e._highlightTileRect.x;e._highlightTileRect.x+e._highlightTileRect.width>s;s++)_=new $i_4(i*s,o*r),e._mountMode===0&&t.fillRect(_.x,_.y,i,o),e._mountMode===1&&(_.thisToIso(),t.beginPath(),t.moveTo(_.x,_.y-o/2),t.lineTo(_.x+i,_.y),t.lineTo(_.x,_.y+o/2),t.lineTo(_.x-i,_.y),t.lineTo(_.x,_.y-o/2),t.fill());if(e._drawMouse){var _,u,d,p=e.mousePos(),y=e.mouseToTile();y.x>=0&&y.y>=0&&n.x>y.x&&n.y>y.y&&(t.fillStyle=e._hoverColor||"#6000ff",e._mountMode===0&&t.fillRect(y.x*i,y.y*o,i,o),e._mountMode===1&&(_=y.clone().thisMultiply(i,o,0).thisToIso(),_.y+=o/2,t.beginPath(),t.moveTo(_.x,_.y-o/2),t.lineTo(_.x+i,_.y),t.lineTo(_.x,_.y+o/2),t.lineTo(_.x-i,_.y),t.lineTo(_.x,_.y-o/2),t.fill()),e._drawMouseData&&(u="Tile X: "+y.x+" Y: "+y.y,d=t.measureText(u),t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(Math.floor(p.x-d.width/2-5),Math.floor(p.y-40),Math.floor(d.width+10),14),t.fillStyle="#ffffff",t.fillText(u,Math.floor(p.x-d.width/2),Math.floor(p.y-30))))}}},$i_71=$i_60.extend({classId:"$i_71",init:function(t){$i_60.prototype.init.call(this),this._trackRotateTarget=void 0,this._trackTranslateTarget=void 0,this._trackRotateSmoothing=void 0,this._trackTranslateSmoothing=void 0,this._entity=t},limit:function(t){return t!==void 0?(this._limit=t,this._entity):this._limit},panTo:function(t,e,i){return t!==void 0&&this._translate.tween().properties({x:t.x,y:t.y,z:t.z}).duration(e).easing(i).start(),this._entity},panBy:function(t,e,i){return t!==void 0&&this._translate.tween().properties({x:t.x+this._translate.x,y:t.y+this._translate.y,z:t.z+this._translate.z}).duration(e).easing(i).start(),this._entity},trackTranslate:function(t,e,i){return t!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking translation target "+t.id()),i!==void 0&&(this._trackTranslateRounding=i),e!==void 0&&(this._trackTranslateSmoothing=1>e?0:e),this._trackTranslateTarget=t,this._entity):this._trackTranslateTarget},trackTranslateSmoothing:function(t){return t!==void 0?(this._trackTranslateSmoothing=t,this):this._trackTranslateSmoothing},trackTranslateRounding:function(t){return t!==void 0?(this._trackTranslateRounding=t,this):this._trackTranslateRounding},unTrackTranslate:function(){delete this._trackTranslateTarget},trackRotate:function(t,e){return t!==void 0?(this.log("Camera on viewport "+this._entity.id()+" is now tracking rotation of target "+t.id()),this._trackRotateSmoothing=1>e?0:e,this._trackRotateTarget=t,this._entity):this._trackRotateTarget},trackRotateSmoothing:function(t){return t!==void 0?(this._trackRotateSmoothing=t,this):this._trackRotateSmoothing},unTrackRotate:function(){delete this._trackRotateTarget},lookAt:function(t,e,i){return t!==void 0&&(t.updateTransform(),e?this._translate.tween().properties({x:Math.floor(t._worldMatrix.matrix[2]),y:Math.floor(t._worldMatrix.matrix[5]),z:0}).duration(e).easing(i).start():(this._translate.x=Math.floor(t._worldMatrix.matrix[2]),this._translate.y=Math.floor(t._worldMatrix.matrix[5])),this.updateTransform()),this},update:function(t){if(this._processUpdateBehaviours(t),this._trackTranslateTarget){var e,i,o,n,s,r,a=this._trackTranslateTarget,h=a._worldMatrix.matrix,l=h[2],c=h[5];this._trackTranslateSmoothing?(e=this._translate.x,i=this._translate.y,o=Math.round(l-e),n=Math.round(c-i),this._trackTranslateRounding?(s=this._translate.x+Math.round(o/this._trackTranslateSmoothing),r=this._translate.y+Math.round(n/this._trackTranslateSmoothing)):(s=this._translate.x+o/this._trackTranslateSmoothing,r=this._translate.y+n/this._trackTranslateSmoothing),this._limit&&(this._limit.x>s&&(s=this._limit.x),s>this._limit.x+this._limit.width&&(s=this._limit.x+this._limit.width),this._limit.y>r&&(r=this._limit.y),r>this._limit.y+this._limit.height&&(r=this._limit.y+this._limit.height)),this._translate.x=s,this._translate.y=r):this.lookAt(this._trackTranslateTarget)}if(this._trackRotateTarget){var m,_,u=this._trackRotateTarget._parent!==void 0?this._trackRotateTarget._parent._rotate.z:0,d=-(u+this._trackRotateTarget._rotate.z);this._trackRotateSmoothing?(m=this._rotate.z,_=d-m,this._rotate.z+=_/this._trackRotateSmoothing):this._rotate.z=d}this.updateTransform()},tick:function(t){this._processTickBehaviours(t),this._localMatrix.transformRenderingContext(t)},updateTransform:function(){this._localMatrix.identity(),this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z)),this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y)),this._localMatrix.multiply(this._localMatrix._newTranslate(-this._translate.x,-this._translate.y)),this._parent?(this._worldMatrix.copy(this._parent._worldMatrix),this._worldMatrix.multiply(this._localMatrix)):this._worldMatrix.copy(this._localMatrix)},_stringify:function(){var t,e=$i_60.prototype._stringify.call(this);for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_trackTranslateTarget":e+=".trackTranslate(ige.$('"+this._trackTranslateTarget.id()+"'), "+this.trackTranslateSmoothing()+")";break;case"_trackRotateTarget":e+=".trackRotate(ige.$('"+this._trackRotateTarget.id()+"'), "+this.trackRotateSmoothing()+")"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_71);var $i_72=$i_60.extend([{extension:$i_45,overwrite:!0},{extension:$i_44,overwrite:!0}],{classId:"$i_72",$i_72:!0,init:function(t){var e,i;this._alwaysInView=!0,$i_60.prototype.init.call(this),this._mouseAlwaysInside=!0,this._mousePos=new $i_5(0,0,0),this._overflow="",this._clipping=!0,this._bornTime=void 0,t&&(e=t.width,i=t.height,t&&t.scaleToWidth&&t.scaleToHeight&&(this._lockDimension=new $i_5(t.scaleToWidth,t.scaleToHeight,0))),this._bounds2d=new $i_5(e||ige._bounds2d.x,i||ige._bounds2d.y,0),this.camera=new $i_71(this),this.camera._entity=this},minimumVisibleArea:function(t,e){return this._lockDimension=new $i_5(t,e,0),ige.isClient&&this._resizeEvent({}),this},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},scene:function(t){return t!==void 0?(this._scene=t,this):this._scene},mousePos:function(){return this._mousePos.clone()},mousePosWorld:function(){return this._transformPoint(this._mousePos.clone())},viewArea:function(){var t=this.aabb(),e=this.camera._translate,i=this.camera._scale,o=t.width*(1/i.x),n=t.height*(1/i.y);return new $i_7(e.x-o/2,e.y-n/2,o,n)},update:function(t,e){this._scene&&(ige._currentCamera=this.camera,ige._currentViewport=this,this._scene._parent=this,this.camera.update(t,e),$i_60.prototype.update.call(this,t,e),this._scene.newFrame()&&this._scene.update(t,e))},tick:function(t){if(this._scene){if(ige._currentCamera=this.camera,ige._currentViewport=this,this._scene._parent=this,$i_60.prototype.tick.call(this,t),t.translate(-(this._bounds2d.x*this._origin.x)|0,-(this._bounds2d.y*this._origin.y)|0),t.clearRect(0,0,this._bounds2d.x,this._bounds2d.y),(this._clipping||this._borderColor)&&(t.beginPath(),t.rect(0,0,this._bounds2d.x/ige._scale.x,this._bounds2d.y/ige._scale.x),this._borderColor&&(t.strokeStyle=this._borderColor,t.stroke()),this._clipping&&t.clip()),t.translate((this._bounds2d.x/2|0)+ige._translate.x,(this._bounds2d.y/2|0)+ige._translate.y),(ige._scale.x!==1||ige._scale.y!==1)&&t.scale(ige._scale.x,ige._scale.y),this.camera.tick(t),t.save(),this._scene.tick(t),t.restore(),this._drawGuides&&t===ige._ctx&&(t.save(),t.translate(-this._translate.x,-this._translate.y),this.paintGuides(t),t.restore()),this._drawBounds&&t===ige._ctx&&(t.save(),t.translate(-this._translate.x,-this._translate.y),this.paintAabbs(t,this._scene,0),t.restore()),this._drawMouse&&t===ige._ctx){t.save();var e,i,o,n,s=this.mousePos();t.scale(1/this.camera._scale.x,1/this.camera._scale.y),i=Math.floor(s.x*this.camera._scale.x),o=Math.floor(s.y*this.camera._scale.y),t.fillStyle="#fc00ff",t.fillRect(i-5,o-5,10,10),e=this.id()+" X: "+i+", Y: "+o,n=t.measureText(e),t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(Math.floor(i-n.width/2-5),Math.floor(o-25),Math.floor(n.width+10),14),t.fillStyle="#ffffff",t.fillText(e,i-n.width/2,o-15),t.restore()}if(this._drawViewArea){t.save();var r=this.viewArea();t.rect(r.x,r.y,r.width,r.height),t.stroke(),t.restore()}}},screenPosition:function(){return new $i_5(Math.floor(this._worldMatrix.matrix[2]+ige._bounds2d.x2),Math.floor(this._worldMatrix.matrix[5]+ige._bounds2d.y2),0)},drawViewArea:function(t){return t!==void 0?(this._drawViewArea=t,this):this._drawViewArea},drawBoundsLimitId:function(t){return t!==void 0?(this._drawBoundsLimitId=t,this):this._drawBoundsLimitId},drawBoundsLimitCategory:function(t){return t!==void 0?(this._drawBoundsLimitCategory=t,this):this._drawBoundsLimitCategory},drawCompositeBounds:function(t){return t!==void 0?(this._drawCompositeBounds=t,this):this._drawCompositeBounds},drawGuides:function(t){return t!==void 0?(this._drawGuides=t,this):this._drawGuides},paintGuides:function(t){var e=ige._bounds2d;this._drawGuides&&(t.strokeStyle="#ffffff",t.translate(.5,.5),t.beginPath(),t.moveTo(0,-e.y2),t.lineTo(0,e.y),t.stroke(),t.beginPath(),t.moveTo(-e.x2,0),t.lineTo(e.x,0),t.stroke())},paintAabbs:function(t,e,i){var o,n,s,r,a,h,l,c,m,_,u,d,p,y,x,f,g,v,b,C,w,D=e._children;if(D){o=D.length;while(o--)n=D[o],i++,n._shouldRender!==!1&&((n._classId!=="$i_73"&&!this._drawBoundsLimitId&&!this._drawBoundsLimitCategory||this._drawBoundsLimitId&&(this._drawBoundsLimitId instanceof Array?this._drawBoundsLimitId.indexOf(n.id())>-1:this._drawBoundsLimitId===n.id())||this._drawBoundsLimitCategory&&this._drawBoundsLimitCategory===n.category())&&typeof n.aabb=="function"&&(s=n.aabb(),this._drawCompositeBounds&&n._compositeCache&&(r=n.compositeAabb(),t.strokeStyle="#ff0000",t.strokeRect(r.x,r.y,r.width,r.height)),s&&((n._drawBounds||n._drawBounds===void 0)&&(t.strokeStyle="#00deff",t.strokeRect(s.x,s.y,s.width,s.height),n._parent&&n._parent._mountMode===1&&(a=n.bounds3dPolygon().aabb(),t.save(),t.strokeStyle="#0068b8",t.strokeRect(a.x,a.y,a.width,a.height),t.restore(),t.save(),t.translate(a.x+a.width/2,a.y+a.height/2),l=n._bounds3d,c=new $i_5(-(l.x/2),0,0).toIso(),m=new $i_5(+(l.x/2),0,0).toIso(),_=new $i_5(0,-(l.y/2),0).toIso(),u=new $i_5(0,+(l.y/2),0).toIso(),d=new $i_5(0,0,-(l.z/2)).toIso(),p=new $i_5(0,0,+(l.z/2)).toIso(),y=new $i_5(-(l.x/2),-(l.y/2),-(l.z/2)).toIso(),x=new $i_5(+(l.x/2),-(l.y/2),-(l.z/2)).toIso(),f=new $i_5(+(l.x/2),+(l.y/2),-(l.z/2)).toIso(),g=new $i_5(-(l.x/2),+(l.y/2),-(l.z/2)).toIso(),v=new $i_5(-(l.x/2),-(l.y/2),l.z/2).toIso(),b=new $i_5(+(l.x/2),-(l.y/2),l.z/2).toIso(),C=new $i_5(+(l.x/2),+(l.y/2),l.z/2).toIso(),w=new $i_5(-(l.x/2),+(l.y/2),l.z/2).toIso(),h=t.globalAlpha,t.globalAlpha=1,t.strokeStyle="#ff0000",t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(m.x,m.y),t.stroke(),t.strokeStyle="#00ff00",t.beginPath(),t.moveTo(_.x,_.y),t.lineTo(u.x,u.y),t.stroke(),t.strokeStyle="#fffc00",t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(p.x,p.y),t.stroke(),t.strokeStyle="#a200ff",t.globalAlpha=n._highlight?.9:.6,t.fillStyle="#545454",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(g.x,g.y),t.lineTo(w.x,w.y),t.lineTo(C.x,C.y),t.lineTo(f.x,f.y),t.fill(),t.stroke(),t.fillStyle="#282828",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(x.x,x.y),t.lineTo(b.x,b.y),t.lineTo(C.x,C.y),t.lineTo(f.x,f.y),t.fill(),t.stroke(),t.fillStyle="#676767",t.beginPath(),t.moveTo(v.x,v.y),t.lineTo(b.x,b.y),t.lineTo(C.x,C.y),t.lineTo(w.x,w.y),t.lineTo(v.x,v.y),t.fill(),t.stroke(),t.globalAlpha=h,t.restore())),this._drawBoundsData&&(n._drawBounds||n._drawBoundsData===void 0)&&(t.globalAlpha=1,t.fillStyle="#f6ff00",t.fillText("ID: "+n.id()+" "+"("+n.classId()+") "+n.layer()+":"+n.depth().toFixed(0),s.x+s.width+3,s.y+10),t.fillText("X: "+n._translate.x.toFixed(2)+", "+"Y: "+n._translate.y.toFixed(2)+", "+"Z: "+n._translate.z.toFixed(2),s.x+s.width+3,s.y+20),t.fillText("Num Children: "+n._children.length,s.x+s.width+3,s.y+40)))),this.paintAabbs(t,n,i))}},_resizeEvent:function(t){if(this._autoSize&&this._parent&&(this._bounds2d=this._parent._bounds2d.clone()),this._updateUiPosition(),this._scene&&this._scene._resizeEvent(t),this._lockDimension){var e,i,o=1;this._bounds2d.x>this._lockDimension.x&&this._bounds2d.y>this._lockDimension.y?(e=this._bounds2d.x/this._lockDimension.x,i=this._bounds2d.y/this._lockDimension.y,o=i>e?e:i):(this._bounds2d.x>this._lockDimension.x&&this._lockDimension.y>this._bounds2d.y&&(o=this._bounds2d.y/this._lockDimension.y),this._lockDimension.x>this._bounds2d.x&&this._bounds2d.y>this._lockDimension.y&&(o=this._bounds2d.x/this._lockDimension.x),this._lockDimension.x>this._bounds2d.x&&this._lockDimension.y>this._bounds2d.y&&(e=this._bounds2d.x/this._lockDimension.x,i=this._bounds2d.y/this._lockDimension.y,o=i>e?e:i)),this.camera.scaleTo(o,o,o)}},_stringify:function(){var t,e=$i_60.prototype._stringify.call(this);for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_autoSize":e+=".autoSize("+this._autoSize+")";break;case"_scene":e+=".scene(ige.$('"+this.scene().id()+"'))"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_72);var $i_73=$i_60.extend({classId:"$i_73",init:function(){this._mouseAlwaysInside=!0,this._alwaysInView=!0,$i_60.prototype.init.call(this),this._shouldRender=!0,this._autoSize=!0,this._bounds2d.x=ige._bounds2d.x,this._bounds2d.y=ige._bounds2d.y,this.streamSections(["transform","ignoreCamera"])},streamRoomId:function(t){return t!==void 0?(this._streamRoomId=t,this):this._streamRoomId},streamSectionData:function(t,e){switch(t){case"ignoreCamera":if(e===void 0)return this._ignoreCamera+"";e==="false"?this.ignoreCamera(!1):this.ignoreCamera(!0);break;default:$i_60.prototype.streamSectionData.call(this,t,e)}},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},shouldRender:function(t){return t!==void 0?(this._shouldRender=t,this):this._shouldRender},ignoreCamera:function(t){return t!==void 0?(this._ignoreCamera=t,this):this._ignoreCamera},update:function(t,e){if(this._ignoreCamera){var i=ige._currentCamera;this.translateTo(i._translate.x,i._translate.y,i._translate.z),this.scaleTo(1/i._scale.x,1/i._scale.y,1/i._scale.z),this.rotateTo(-i._rotate.x,-i._rotate.y,-i._rotate.z)}$i_60.prototype.update.call(this,t,e)},tick:function(t){this._shouldRender&&$i_60.prototype.tick.call(this,t)},_resizeEvent:function(t){this._autoSize&&(this._bounds2d=ige._bounds2d.clone());var e=this._children,i=e.length;while(i--)e[i]._resizeEvent(t)},_stringify:function(){var t,e=$i_60.prototype._stringify.call(this);for(t in this)if(this.hasOwnProperty(t)&&this[t]!==void 0)switch(t){case"_shouldRender":e+=".shouldRender("+this.shouldRender()+")";break;case"_autoSize":e+=".autoSize("+this.autoSize()+")"}return e}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_73);var $i_79=function(){};$i_79.prototype=[];for(var methodName in $i_60.prototype)$i_60.prototype.hasOwnProperty(methodName)&&methodName!=="init"&&($i_79.prototype[methodName]=function(t){return function(){for(var e=this.length,i=0;e>i;i++)this[i][t].apply(this[i],arguments)}}(methodName));typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_79);var $i_60Box2d=$i_60.extend({classId:"$i_60Box2d",init:function(t){$i_60.prototype.init.call(this),t?(typeof t=="string"&&(t=ige.box2d.world(t)),this._box2dWorld=t,this._b2dRef=t):this._b2dRef=ige.box2d,ige.box2d&&(this._b2dRef._networkDebugMode?(this._translateToProto=function(){},this._translateByProto=function(){},this._rotateToProto=function(){},this._rotateByProto=function(){},this._updateProto=this.update,this.update=this._update):(this._translateToProto=this.translateTo,this._translateByProto=this.translateBy,this._rotateToProto=this.rotateTo,this._rotateByProto=this.rotateBy,this.translateTo=this._translateTo,this.translateBy=this._translateBy,this.rotateTo=this._rotateTo,this.rotateBy=this._rotateBy))},box2dActive:function(t){return this._box2dBody?t!==void 0?(this._box2dBody.SetActive(t),this):this._box2dBody.IsActive():this},box2dBody:function(t){return t!==void 0?(this._box2dBodyDef=t,ige.box2d?this._box2dBody=this._b2dRef.createBody(this,t):this.log("You are trying to create a box2d entity but you have not added the box2d component to the ige instance!","error"),this):this._box2dBodyDef},gravitic:function(t){return this._box2dBody?t!==void 0?(this._box2dBody.m_nonGravitic=!t,this._box2dBodyDef.gravitic=t,this._box2dBody.SetAwake(!0),this):!this._box2dBody.m_nonGravitic:void 0},on:function(){if(arguments.length===3){var t,e=arguments[0],i=arguments[1],o=arguments[2];switch(i.substr(0,1)){case"#":t=0;break;case".":t=1}switch(i=i.substr(1,i.length-1),e){case"collisionStart":this._collisionStartListeners=this._collisionStartListeners||[],this._collisionStartListeners.push({type:t,target:i,callback:o}),this._contactListener||(this._contactListener=this._setupContactListeners());break;case"collisionEnd":this._collisionEndListeners=this._collisionEndListeners||[],this._collisionEndListeners.push({type:t,target:i,callback:o}),this._contactListener||(this._contactListener=this._setupContactListeners());break;default:this.log("Cannot add event listener, event type "+e+" not recognised","error")}}else $i_60.prototype.on.apply(this,arguments)},off:function(){arguments.length===3||$i_60.prototype.off.apply(this,arguments)},_setupContactListeners:function(){var t=this;ige.box2d.contactListener(function(e){var i=t._collisionStartListeners;i&&t._checkContact(e,i)},function(e){var i=t._collisionEndListeners;i&&t._checkContact(e,i)})},_checkContact:function(t,e){var i,o,n,s=this,r=e.length;if(t.igeEntityA()._id===s._id)i=t.igeEntityB();else{if(t.igeEntityB()._id!==s._id)return;i=t.igeEntityA()}for(n=0;r>n;n++)o=e[n],o.type===0&&i._id===o.target&&o.callback(t),e[n].type===1&&i._category===o.target&&o.callback(t)},_translateTo:function(t,e,i){var o=this._box2dBody;return this._translateToProto(t,e,i),o&&!o.updating&&(o.SetPosition({x:t/this._b2dRef._scaleRatio,y:e/this._b2dRef._scaleRatio}),o.SetAwake(!0)),this},_translateBy:function(t,e,i){this._translateTo(this._translate.x+t,this._translate.y+e,this._translate.z+i)},_rotateTo:function(t,e,i){var o=this._box2dBody;return this._rotateToProto(t,e,i),o&&!o.updating&&(o.SetAngle(i),o.SetAwake(!0)),this},_rotateBy:function(t,e,i){this._rotateTo(this._rotate.x+t,this._rotate.y+e,this._rotate.z+i)},_update:function(t){this._updateProto(t),this._translateTo(this._translate.x,this._translate.y,this._translate.z),this._rotateTo(this._rotate.x,this._rotate.y,this._rotate.z)},box2dNoDebug:function(t){return t!==void 0?(this._box2dNoDebug=t,this):this._box2dNoDebug},destroy:function(){this._box2dBody&&this._b2dRef.destroyBody(this._box2dBody),$i_60.prototype.destroy.call(this)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_60Box2d);var $i_93=$i_62.extend({classId:"$i_93",init:function(){$i_62.prototype.init.call(this),this._value="",this._fontEntity=(new $i_63).left(0).middle(0).textAlignX(0).textAlignY(0).mount(this),this.font("10px Verdana"),this.paddingLeft(5),this.allowActive(!1),this.allowFocus(!1),this.allowHover(!1)},width:function(t,e,i,o){var n;return n=$i_62.prototype.width.call(this,t,e,i,o),this._fontEntity.width(t-10,e,i,o),n},height:function(t,e,i,o){var n;return n=$i_62.prototype.height.call(this,t,e,i,o),this._fontEntity.height(t,e,i,o),n},value:function(t){return t!==void 0?(this._value!==t&&(this._value=t,!t&&this._placeHolder?(this._fontEntity.text(this._placeHolder),this._fontEntity.color(this._placeHolderColor)):(this._mask?this._fontEntity.text(Array(this._value.length+1).join(this._mask)):this._fontEntity.text(this._value),this._fontEntity.color(this._color)),this.emit("change",this._value)),this):this._value},fontSheet:function(t){return t!==void 0?(this._fontSheet=t,this._fontEntity.texture(this._fontSheet),this):this._fontSheet},font:function(t){return t!==void 0?typeof t=="string"?this.nativeFont(t):this.fontSheet(t):this._fontEntity._nativeMode?this.nativeFont():this.fontSheet()},nativeFont:function(t){return t!==void 0?(this._fontEntity.nativeFont(t),this):this._fontEntity.nativeFont()},nativeStroke:function(t){return t!==void 0?(this._fontEntity.nativeStroke(t),this):this._fontEntity.nativeStroke()},nativeStrokeColor:function(t){return t!==void 0?(this._fontEntity.nativeStrokeColor(t),this):this._fontEntity.nativeStrokeColor()},color:function(t){return t!==void 0?(this._color=t,!this._value&&this._placeHolder&&this._placeHolderColor?this._fontEntity.color(this._placeHolderColor):this._fontEntity.color(t),this):this._color},_mounted:function(){!this._value&&this._placeHolder&&(this._fontEntity.text(this._placeHolder),this._fontEntity.color(this._placeHolderColor)),$i_62.prototype._mounted.call(this)}}),$i_114=$i_60.extend({classId:"$i_114",init:function(){igeConfig.debug&&(igeConfig.debug._enabled||(igeConfig.debug._timing=!1)),this._alwaysInView=!0,this._id="ige",this.basePath="",this.isServer=typeof module!="undefined"&&module.exports!==void 0,this.isClient=!this.isServer,ige=this,$i_60.prototype.init.call(this),this.isClient&&this.addComponent($i_43),this._textureStore=[],this._idCounter=(new Date).getTime(),this.isServer,this.addComponent($i_14),this.addComponent($i_12),this.addComponent($i_9),this.isClient&&this.addComponent($i_19),this._renderModes=["2d","three"],this._requireScriptTotal=0,this._requireScriptLoading=0,this._loadingPreText=void 0,this._enableUpdates=!0,this._enableRenders=!0,this._showSgTree=!1,this._debugEvents={},this._renderContext="2d",this._renderMode=this._renderModes[this._renderContext],this._tickTime="NA",this._updateTime="NA",this._renderTime="NA",this._tickDelta=0,this._fpsRate=60,this._state=0,this._textureImageStore={},this._texturesLoading=0,this._texturesTotal=0,this._dependencyQueue=[],this._drawCount=0,this._dps=0,this._dpf=0,this._frames=0,this._fps=0,this._clientNetDiff=0,this._frameAlternator=!1,this._viewportDepth=!1,this._mousePos=new $i_5(0,0,0),this._currentViewport=null,this._currentCamera=null,this._currentTime=0,this._globalSmoothing=!1,this._register={ige:this},this._categoryRegister={},this._groupRegister={},this._postTick=[],this._timeSpentInUpdate={},this._timeSpentLastUpdate={},this._timeSpentInTick={},this._timeSpentLastTick={},this._timeScale=1,this._globalScale=new $i_5(1,1,1),this._graphInstances=[],this._spawnQueue=[],this._ctx=$i_50,this._headless=!0,this.dependencyTimeout(3e4),this._dependencyQueue.push(this.texturesLoaded),this._secondTimer=setInterval(this._secondTick,1e3)},$:function(t){return typeof t=="string"?this._register[t]:typeof t=="object"?t:this},$$:function(t){return this._categoryRegister[t]||new $i_79},$$$:function(t){return this._groupRegister[t]||new $i_79},register:function(t){return t!==void 0?this._register[t.id()]?(t._registered=!1,this.log('Cannot add object id "'+t.id()+'" to scenegraph because there is already another object in the graph with the same ID!',"error"),!1):(this._register[t.id()]=t,t._registered=!0,this):this._register},unRegister:function(t){return t!==void 0&&this._register[t.id()]&&(delete this._register[t.id()],t._registered=!1),this},categoryRegister:function(t){return t!==void 0&&(this._categoryRegister[t._category]=this._categoryRegister[t._category]||new $i_79,this._categoryRegister[t._category].push(t),t._categoryRegistered=!0),this._register},categoryUnRegister:function(t){return t!==void 0&&this._categoryRegister[t._category]&&(this._categoryRegister[t._category].pull(t),t._categoryRegistered=!1),this},groupRegister:function(t,e){return t!==void 0&&(this._groupRegister[e]=this._groupRegister[e]||new $i_79,this._groupRegister[e].push(t),t._groupRegistered=!0),this._register},groupUnRegister:function(t,e){return t!==void 0&&(e!==void 0?this._groupRegister[e]&&(this._groupRegister[e].pull(t),t.groupCount()||(t._groupRegister=!1)):t.removeAllGroups()),this},sync:function(t,e){typeof e=="string"&&(e=[e]),this._syncArr=this._syncArr||[],this._syncArr.push({method:t,attrArr:e}),this._syncArr.length===1&&(this._syncIndex=0,this._processSync())},_processSync:function(){var t;ige._syncArr.length>ige._syncIndex?(t=ige._syncArr[ige._syncIndex],t.attrArr.push(function(){ige._syncIndex++,setTimeout(ige._processSync,1)}),t.method.apply(ige,t.attrArr)):(delete ige._syncArr,delete ige._syncIndex,ige.emit("syncComplete"))},requireScript:function(t,e){if(t!==void 0){var i=this;i._requireScriptTotal++,i._requireScriptLoading++;var o=document.createElement("script");o.addEventListener("load",function(){i._requireScriptLoaded(this),e&&setTimeout(function(){e()},100)}),document.body.appendChild(o),o.src=t,this.log("Loading script from: "+t),this.emit("requireScriptLoading",t)}},_requireScriptLoaded:function(t){this._requireScriptLoading--,this.emit("requireScriptLoaded",t.src),this._requireScriptLoading===0&&this.emit("allRequireScriptsLoaded")},requireStylesheet:function(t){if(t!==void 0){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.media="all",e.href=t,document.getElementsByTagName("head")[0].appendChild(e),this.log("Load css stylesheet from: "+t)}},addGraph:function(t,e){if(t!==void 0){var i,o=this.getClass(t);o?(this.log("Loading SceneGraph data class: "+t),i=this.newClassInstance(t),typeof i.addGraph=="function"&&typeof i.removeGraph=="function"?(i.addGraph(e),this._graphInstances[t]=i):this.log('Could not load graph for class name "'+t+'" because the class does not implement both the require methods "addGraph()" and "removeGraph()".',"error")):this.log('Cannot load graph for class name "'+t+'" because the class could not be found. Have you included it in your server/clientConfig.js file?',"error")}return this},removeGraph:function(t,e){if(t!==void 0){var i=this._graphInstances[t];i?(this.log("Removing SceneGraph data class: "+t),i.removeGraph(e),delete this._graphInstances[t]):this.log('Cannot remove graph for class name "'+t+'" because the class instance could not be found. Did you add it via ige.addGraph() ?',"error")}return this},enableUpdates:function(t){return t!==void 0?(this._enableUpdates=t,this):this._enableUpdates},enableRenders:function(t){return t!==void 0?(this._enableRenders=t,this):this._enableRenders},debugEnabled:function(t){return t!==void 0?(igeConfig.debug&&(igeConfig.debug._enabled=t),this):igeConfig.debug._enabled},debugTiming:function(t){return t!==void 0?(igeConfig.debug&&(igeConfig.debug._timing=t),this):igeConfig.debug._timing},debug:function(t){this._debugEvents[t]===!0||this._debugEvents[t]===ige._frames},debugEventOn:function(t){this._debugEvents[t]=!0},debugEventOff:function(t){this._debugEvents[t]=!1},triggerDebugEventFrame:function(t){this._debugEvents[t]=ige._frames
},hideAllExcept:function(t){var e,i=this._register;for(e in i)e!==t&&i[e].opacity(0)},showAll:function(){var t,e=this._register;for(t in e)e[t].show()},setFps:function(t){t!==void 0&&(this.isServer?requestAnimFrame=function(e){setTimeout(function(){e((new Date).getTime())},1e3/t)}:window.requestAnimFrame=function(e){setTimeout(function(){e((new Date).getTime())},1e3/t)})},showStats:function(){this.log("showStats has been removed from the ige in favour of the new editor component, please remove this call from your code.")},defineClass:function(t,e){igeClassStore[t]=e},getClass:function(t){return igeClassStore[t]},classDefined:function(t){return Boolean(igeClassStore[t])},newClassInstance:function(t,e){return new igeClassStore[t](e)},dependencyCheck:function(){var t=this._dependencyQueue,e=t.length;while(e--)if(!this._dependencyQueue[e]())return!1;return!0},viewportDepth:function(t){return t!==void 0?(this._viewportDepth=t,this):this._viewportDepth},dependencyTimeout:function(t){this._dependencyCheckTimeout=t},updateProgress:function(){if(typeof document!="undefined"&&document.getElementById){var t=document.getElementById("loadingProgressBar"),e=document.getElementById("loadingText");if(t){var i=parseInt(t.parentNode.offsetWidth),o=Math.floor(i/this._texturesTotal*(this._texturesTotal-this._texturesLoading));t.style.width=o+"px",e&&(this._loadingPreText===void 0&&(this._loadingPreText=e.innerHTML),e.innerHTML=this._loadingPreText+" "+Math.floor(100/this._texturesTotal*(this._texturesTotal-this._texturesLoading))+"%")}}},textureLoadStart:function(t,e){this._texturesLoading++,this._texturesTotal++,this.updateProgress(),this.emit("textureLoadStart",e)},textureLoadEnd:function(t,e){var i=this;e._destroyed||this._textureStore.push(e),this._texturesLoading--,this.updateProgress(),this.emit("textureLoadEnd",e),this._texturesLoading===0&&(this.updateProgress(),setTimeout(function(){i._allTexturesLoaded()},100))},textureFromUrl:function(t){var e,i=this._textureStore,o=i.length;while(o--)if(e=i[o],e._url===t)return e},texturesLoaded:function(){return ige._texturesLoading===0},_allTexturesLoaded:function(){this._loggedATL||(this._loggedATL=!0,this.log("All textures have loaded")),this.emit("texturesLoaded")},globalSmoothing:function(t){return t!==void 0?(this._globalSmoothing=t,this):this._globalSmoothing},canvasReady:function(){return ige._canvas!==void 0||ige.isServer},newId:function(){return this._idCounter++,this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))+""},newIdHex:function(){return this._idCounter++,(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16)},newIdFromString:function(t){if(t!==void 0){var e,i,o=0,n=t.length;for(i=0;n>i;i++)o+=t.charCodeAt(i)*Math.pow(10,17);e=o.toString(16);while(ige.$(e))o+=Math.pow(10,17),e=o.toString(16);return e}},start:function(t){if(!ige._state)if(ige.dependencyCheck()){if(ige.log("Starting engine..."),ige._state=1,this.isClient&&document.getElementsByClassName&&document.getElementsByClassName("igeLoading")){var e=document.getElementsByClassName("igeLoading"),i=e.length;while(i--)e[i].parentNode.removeChild(e[i])}requestAnimFrame(ige.engineStep),ige.log("Engine started"),typeof t=="function"&&t(!0)}else{var o=(new Date).getTime();ige._dependencyCheckStart||(ige._dependencyCheckStart=o),o-ige._dependencyCheckStart>this._dependencyCheckTimeout?(this.log("Engine start failed because the dependency check timed out after "+this._dependencyCheckTimeout/1e3+" seconds","error"),typeof t=="function"&&t(!1)):setTimeout(function(){ige.start(t)},200)}},stop:function(){return this._state?(this.log("Stopping engine..."),this._state=0,!0):!1},autoSize:function(t){return t!==void 0?(this._autoSize=t,this):this._autoSize},pixelRatioScaling:function(t){return t!==void 0?(this._pixelRatioScaling=t,this):this._pixelRatioScaling},renderContext:function(t){return t!==void 0?(this._renderContext=t,this._renderMode=this._renderModes[t],this.log("Rendering mode set to: "+t),this):this._renderContext},createFrontBuffer:function(t,e){this.isClient&&(this._canvas||(this._createdFrontBuffer=!0,this._pixelRatioScaling=!e,this._frontBufferSetup(t,e)))},_frontBufferSetup:function(t){var e=document.createElement("canvas");e.id="igeFrontBuffer",this.canvas(e,t),document.getElementById("game-div").appendChild(e)},canvas:function(t,e){return t!==void 0&&(this._canvas||(this._canvas=t,this._ctx=this._canvas.getContext(this._renderContext),this._pixelRatioScaling?(this._devicePixelRatio=window.devicePixelRatio||1,this._backingStoreRatio=this._ctx.webkitBackingStorePixelRatio||this._ctx.mozBackingStorePixelRatio||this._ctx.msBackingStorePixelRatio||this._ctx.oBackingStorePixelRatio||this._ctx.backingStorePixelRatio||1,this._deviceFinalDrawRatio=this._devicePixelRatio/this._backingStoreRatio):(this._devicePixelRatio=1,this._backingStoreRatio=1,this._deviceFinalDrawRatio=1),e&&(this._autoSize=e),window.addEventListener("resize",this._resizeEvent),this._resizeEvent(),this._ctx=this._canvas.getContext(this._renderContext),this._headless=!1,this.input.setupListeners(this._canvas))),this._canvas},clearCanvas:function(){this._ctx&&this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},removeCanvas:function(){this.input&&this.input.destroyListeners(),window.removeEventListener("resize",this._resizeEvent),this._createdFrontBuffer&&document.body.removeChild(this._canvas),delete this._canvas,delete this._ctx,this._ctx=$i_50,this._headless=!0},openUrl:function(t){t!==void 0&&(ige.cocoonJs&&ige.cocoonJs.detected?ige.cocoonJs.openUrl(t):window.open(t))},showWebView:function(t){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.showWebView(t);else{var e=document.getElementById("igeOverlay");e||(e=document.createElement("iframe"),e.id="igeOverlay",e.style.position="absolute",e.style.border="none",e.style.left="0px",e.style.top="0px",e.style.width="100%",e.style.height="100%",document.body.appendChild(e)),t!==void 0&&(e.src=t),e.style.display="block"}return this},hideWebView:function(){if(ige.cocoonJs&&ige.cocoonJs.detected)ige.cocoonJs.hideWebView();else{var t=document.getElementById("igeOverlay");t&&(t.style.display="none")}return this},layerCall:function(js){js!==void 0&&eval(js)},mousePos:function(){return this._mousePos.clone()},mouseOverList:function(t,e){var i,o,n,s,r=!1;if(t||(t=ige,e=[],r=!0),t===ige){if(i=t._children){o=i.length;while(o--)i[o]._scene&&i[o]._scene._shouldRender&&this.mouseOverList(i[o]._scene,e)}}else if(n=this.mousePosWorld(),n&&t.aabb&&(s=t.aabb(),s.xyInside(n.x,n.y)&&e.push(t)),i=t._children){o=i.length;while(o--)this.mouseOverList(i[o],e)}return r&&e.reverse(),e},_resizeEvent:function(t){var e;if(ige._autoSize){var i=window.innerWidth,o=window.innerHeight,n=ige._children,s=n.length;ige._canvas&&(e=ige._canvasPosition(),i-=parseInt(e.left),o-=parseInt(e.top),i%2&&i--,o%2&&o--,ige._canvas.width=i*ige._deviceFinalDrawRatio,ige._canvas.height=o*ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio!==1&&(ige._canvas.style.width=i+"px",ige._canvas.style.height=o+"px",ige._ctx.scale(ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio))),ige._bounds2d=new $i_5(i,o,0);while(s--)n[s]._resizeEvent(t)}else ige._canvas&&(ige._bounds2d=new $i_5(ige._canvas.width,ige._canvas.height,0));if(ige._showSgTree){var r=document.getElementById("igeSgTree");e=ige._canvasPosition(),r.style.top=parseInt(e.top)+5+"px",r.style.left=parseInt(e.left)+5+"px",r.style.height=ige._bounds2d.y-30+"px"}ige._resized=!0},_canvasPosition:function(){try{return ige._canvas.getBoundingClientRect()}catch(t){return{top:ige._canvas.offsetTop,left:ige._canvas.offsetLeft}}},toggleFullScreen:function(){var t=this._canvas;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},watchStart:function(t){return this._watch=this._watch||[],this._watch.push(t),this._watch.length-1},watchStop:function(t){this._watch=this._watch||[],this._watch.splice(t,1)},traceSet:function(t,e,i,o){t.___igeTraceCurrentVal=t.___igeTraceCurrentVal||{},t.___igeTraceCurrentVal[e]=t[e],t.___igeTraceMax=i||1,t.___igeTraceCount=0,Object.defineProperty(t,e,{get:function(){return t.___igeTraceCurrentVal[e]},set:function(i){o&&o(i),t.___igeTraceCurrentVal[e]=i,t.___igeTraceCount++,t.___igeTraceCount===t.___igeTraceMax&&ige.traceSetOff(t,e)}})},traceSetOff:function(t,e){Object.defineProperty(t,e,{set:function(t){this.___igeTraceCurrentVal[e]=t}})},findBaseClass:function(t){return t&&t._classId?t._classId.substr(0,3)==="Ige"?t._classId:t.__proto__._classId?this.findBaseClass(t.__proto__):"":""},getClassDerivedList:function(t,e){return e?t._classId&&e.push(t._classId):e=[],t.__proto__._classId&&this.getClassDerivedList(t.__proto__,e),e},spawnQueue:function(t){return t!==void 0?(this._spawnQueue.push(t),this):this._spawnQueue},_secondTick:function(){var t=ige;t._fps=t._frames,t._dps=t._dpf*t._fps,t._frames=0,t._drawCount=0},timeScale:function(t){return t!==void 0?(this._timeScale=t,this):this._timeScale},incrementTime:function(t,e){return this._pause||(e||(e=t),this._currentTime+=(t-e)*this._timeScale),this._currentTime},currentTime:function(){return this._currentTime},pause:function(t){return t!==void 0?(this._pause=t,this):this._pause},useManualTicks:function(t){return t!==void 0?(this._useManualTicks=t,this):this._useManualTicks},manualTick:function(){this._manualFrameAlternator!==this._frameAlternator&&(this._manualFrameAlternator=this._frameAlternator,requestAnimFrame(this.engineStep))},useManualRender:function(t){return t!==void 0?(this._useManualRender=t,this):this._useManualRender},manualRender:function(){this._manualRender=!0},engineStep:function(t,e){var i,o,n,s,r,a,h,l,c,m=ige,_=m._postTick,u=_.length;if(m.incrementTime(t,m._timeScaleLastTimestamp),m._timeScaleLastTimestamp=t,t=Math.floor(m._currentTime),igeConfig.debug._timing&&(i=(new Date).getTime()),m._state){for(e===void 0&&(e=m._ctx),m._frameAlternator=!m._frameAlternator,ige._useManualTicks?m._manualFrameAlternator=!m._frameAlternator:requestAnimFrame(m.engineStep),m._tickStart=t,m._tickStart-=m._clientNetDiff,m.lastTick?m._tickDelta=m._tickStart-m.lastTick:(m.lastTick=0,m._tickDelta=0),a=ige._spawnQueue,h=a.length,l=h-1;l>=0;l--)c=a[l],c._bornTime>ige._currentTime||(c.mount(ige.$(c._birthMount)),a.splice(l,1));for(m._enableUpdates&&(igeConfig.debug._timing?(n=(new Date).getTime(),m.updateSceneGraph(e),ige._updateTime=(new Date).getTime()-n):m.updateSceneGraph(e)),m._enableRenders&&(m._useManualRender?m._manualRender&&(igeConfig.debug._timing?(s=(new Date).getTime(),m.renderSceneGraph(e),ige._renderTime=(new Date).getTime()-s):m.renderSceneGraph(e),m._manualRender=!1):igeConfig.debug._timing?(s=(new Date).getTime(),m.renderSceneGraph(e),ige._renderTime=(new Date).getTime()-s):m.renderSceneGraph(e)),r=0;u>r;r++)_[r]();m.lastTick=m._tickStart,m._frames++,m._dpf=m._drawCount,m._drawCount=0,m.input.tick()}m._resized=!1,igeConfig.debug._timing&&(o=(new Date).getTime(),ige._tickTime=o-i)},updateSceneGraph:function(t){var e,i,o,n=this._children,s=ige._tickDelta;if(this._processUpdateBehaviours(t,s),n)if(e=n.length,igeConfig.debug._timing)while(e--)i=(new Date).getTime(),n[e].update(t,s),o=(new Date).getTime()-i,n[e]&&(ige._timeSpentInUpdate[n[e].id()]||(ige._timeSpentInUpdate[n[e].id()]=0),ige._timeSpentLastUpdate[n[e].id()]||(ige._timeSpentLastUpdate[n[e].id()]={}),ige._timeSpentInUpdate[n[e].id()]+=o,ige._timeSpentLastUpdate[n[e].id()].ms=o);else while(e--)n[e].update(t,s)},renderSceneGraph:function(t){var e,i;this._processTickBehaviours(t),this._viewportDepth&&(igeConfig.debug._timing?(e=(new Date).getTime(),this.depthSortChildren(),i=(new Date).getTime()-e,ige._timeSpentLastTick[this.id()]||(ige._timeSpentLastTick[this.id()]={}),ige._timeSpentLastTick[this.id()].depthSortChildren=i):this.depthSortChildren()),t.save(),t.translate(this._bounds2d.x2,this._bounds2d.y2);var o,n=this._children;if(n)if(o=n.length,igeConfig.debug._timing)while(o--)t.save(),e=(new Date).getTime(),n[o].tick(t),i=(new Date).getTime()-e,n[o]&&(ige._timeSpentInTick[n[o].id()]||(ige._timeSpentInTick[n[o].id()]=0),ige._timeSpentLastTick[n[o].id()]||(ige._timeSpentLastTick[n[o].id()]={}),ige._timeSpentInTick[n[o].id()]+=i,ige._timeSpentLastTick[n[o].id()].ms=i),t.restore();else while(o--)t.save(),n[o].tick(t),t.restore();t.restore()},fps:function(){return this._fps},dpf:function(){return this._dpf},dps:function(){return this._dps},analyseTiming:function(){igeConfig.debug._timing||this.log("Cannot analyse timing because the igeConfig.debug._timing flag is not enabled so no timing data has been recorded!","warning")},saveSceneGraph:function(t){var e,i,o;if(t||(t=this.getSceneGraphData()),t.obj.stringify?t.str=t.obj.stringify():console.log("Class "+t.classId+" has no stringify() method! For object: "+t.id,t.obj),e=t.items)for(i=e.length,o=0;i>o;o++)this.saveSceneGraph(e[o]);return t},sceneGraph:function(t,e){var i,o,n,s,r="";for(e===void 0&&(e=0),t||(t=ige),i=0;e>i;i++)r+="----";if(igeConfig.debug._timing?(o="",o+="T: "+ige._timeSpentInTick[t.id()],ige._timeSpentLastTick[t.id()]&&(typeof ige._timeSpentLastTick[t.id()].ms=="number"&&(o+=" | LastTick: "+ige._timeSpentLastTick[t.id()].ms),typeof ige._timeSpentLastTick[t.id()].depthSortChildren=="number"&&(o+=" | ChildDepthSort: "+ige._timeSpentLastTick[t.id()].depthSortChildren)),console.log(r+t.id()+" ("+t._classId+") : "+t._inView+" Timing("+o+")")):console.log(r+t.id()+" ("+t._classId+") : "+t._inView),e++,t===ige){if(n=t._children){s=n.length;while(s--)n[s]._scene&&n[s]._scene._shouldRender&&(igeConfig.debug._timing?(o="",o+="T: "+ige._timeSpentInTick[n[s].id()],ige._timeSpentLastTick[n[s].id()]&&(typeof ige._timeSpentLastTick[n[s].id()].ms=="number"&&(o+=" | LastTick: "+ige._timeSpentLastTick[n[s].id()].ms),typeof ige._timeSpentLastTick[n[s].id()].depthSortChildren=="number"&&(o+=" | ChildDepthSort: "+ige._timeSpentLastTick[n[s].id()].depthSortChildren)),console.log(r+"----"+n[s].id()+" ("+n[s]._classId+") : "+n[s]._inView+" Timing("+o+")")):console.log(r+"----"+n[s].id()+" ("+n[s]._classId+") : "+n[s]._inView),this.sceneGraph(n[s]._scene,e+1))}}else if(n=t._children){s=n.length;while(s--)this.sceneGraph(n[s],e)}},getSceneGraphData:function(t,e){var i,o,n,s,r,a,h=[];if(t||(t=ige),i={text:"["+t._classId+"] "+t.id(),id:t.id(),classId:t.classId()},e?i.parentId=t._parent?t._parent.id():"sceneGraph":(i.parent=t._parent,i.obj=t),t===ige){if(r=t._children){a=r.length;while(a--)o={text:"["+r[a]._classId+"] "+r[a].id(),id:r[a].id(),classId:r[a].classId()},e?r[a]._parent&&(o.parentId=r[a]._parent.id()):(o.parent=r[a]._parent,o.obj=r[a]),r[a].camera?(s={text:"[$i_71] "+r[a].id(),id:r[a].camera.id(),classId:r[a].camera.classId()},e?s.parentId=r[a].id():(s.parent=r[a],s.obj=r[a].camera),r[a]._scene&&(n=this.getSceneGraphData(r[a]._scene,e),o.items=[s,n])):r[a]._scene&&(n=this.getSceneGraphData(r[a]._scene,e),o.items=[n]),h.push(o)}}else if(r=t._children){a=r.length;while(a--)o=this.getSceneGraphData(r[a],e),h.push(o)}return h.length>0&&(i.items=h),i},_childMounted:function(t){t.$i_72&&(ige._currentViewport||(ige._currentViewport=t,ige._currentCamera=t.camera)),$i_60.prototype._childMounted.call(this,t)},destroy:function(){this.stop(),this.isClient&&this.removeCanvas(),$i_60.prototype.destroy.call(this),this.log("Engine destroy complete.")}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=$i_114);var Unit=$i_60Box2d.extend({classId:"Unit",init:function(t){$i_60Box2d.prototype.init.call(this);var e=this;if(this.category("unit"),this._stats=t,this.equippedItems=[,,,],this.currentItemIndex=0,this.inventoryItems={},this.buff={speed:0},ige.isServer?this.map=ige.server.map:ige.isClient&&(this.map=ige.client.map),this.facingAngle=0,this.lastItem=void 0,this.holdingBody=void 0,e._stats.stamina=e._stats.maxStamina,this._currentTransform=[],this._previousTransform=[],e._nextBody=void 0,e._actionQueue=[],ige.isServer){e.scaleRatio=ige.box2d.scaleRatio();var i=ige.server.getSpawnPosition();this.addComponent(PlayerComponent).addComponent($i_11).box2dBody(this.map.unitTypes[this._stats.type].body).translateTo(i.x,i.y,0).category("unit").streamMode(1).mount(ige.$("baseScene")),this.updateFixture()}else ige.isClient&&(ige.ui.style(".player-name",{font:"1.3em Open Sans","margin-left":"auto",color:"white",width:60,height:50,top:10}),e.unitNameLabel=(new $i_93).styleClass("player-name").value(this._stats.name).layer(10).mount(e),this.depth(4).layer(2).updateTexture());this.resizeUnit()},streamUpdateData:function(t){var e=this;t.type&&(e._stats.maxStamina=e.map.unitTypes[t.type].maxStamina),this._stats.type!="human"&&this._stats.type!="sick"||t.type!="zombie"&&t.type!="zombieKing"||e.dropAllItems(),t.name!=void 0&&(this._stats.name=t.name),t.skin!=void 0&&(this._stats.skin=t.skin),t.gold!=void 0&&(this._stats.gold=parseInt(t.gold)),t.survivalTime!=void 0&&(this._stats.survivalTime=parseInt(t.survivalTime)),t.type!=void 0&&(this._stats.type=t.type),t.action!=void 0&&(this._stats.currentAction=t.action),ige.isServer?ige.network.send("updateUnit",{unitId:this.id(),stats:t}):ige.isClient&&(t.type!=void 0||t.skin!=void 0||t.action!=void 0)&&this.updateTexture(),this.resizeUnit()},updateTexture:function(){if(ige.isClient){var t=new $i_54(ige.client.mapUrl+"/spritesheet/"+this.getSkinFileName());this.texture(t)}},getSkinFileName:function(){if(ige.isClient){var t=this._stats.skin+"";return this._stats.type=="sick"?this._stats.skin=="man"&&(t="man_sick"):this._stats.type!="human"&&(t=this._stats.skin+"_zombie",this._stats.type=="zombieKing"&&this._stats.skin=="man"&&(t="man_zombie_king")),t+=this._stats.currentAction!="hold"||t!="man_zombie_king"&&t!="man_zombie"&&t!="man"&&t!="man_sick"?".png":"_hold.png"}},buyItem:function(t){var e=this,i=e.map.items[t];if(ige.isServer&&i&&e._stats.gold>=i.price&&ige.server.gameState==e.map.constants.PREOUTBREAK){e._stats.gold-=i.price,e.streamUpdateData({gold:e._stats.gold});var i=JSON.parse(JSON.stringify(e.map.items[t]));e._actionQueue.push({type:"pickup",itemData:i}),e.dropItem(e.getCurrentItem())}},pickUpItem:function(t){var e=this;if(t){var i=ige.$(t);if(ige.isServer){if(i&&i._category=="item"&&e._stats.type=="human"){var o=JSON.parse(JSON.stringify(i._stats));e._actionQueue.push({type:"pickup",itemData:o}),i.destroy()}}else ige.isClient&&(e.setCurrentItem(i),ige.client.myUnit&&ige.client.myUnit.id()==e.id()&&ige.client.updateInventory())}},dropItem:function(t){for(var e=this,i=0;e.equippedItems.length>i;i++){var o=e.equippedItems[i];o&&t&&o.id()==t.id()&&(e.equippedItems[i]=void 0,ige.isServer?(e._actionQueue.push({type:"spawn",itemData:JSON.parse(JSON.stringify(o._stats))}),e._actionQueue.push({type:"hide",entityId:o.id()})):ige.isClient&&ige.client.myUnit&&ige.client.myUnit.id()==e.id()&&ige.client.updateInventory())}},dropAllItems:function(){for(var t=0;this.equippedItems.length>t;t++){var e=this.equippedItems[t];this.dropItem(e)}},changeItem:function(t){var e=this;e._actionQueue.push({type:"change",slotIndex:t}),ige.isClient&&ige.client.myUnit&&ige.client.myUnit.id()==e.id()&&(e.currentItemIndex=t,ige.client.updateInventory(),ige.network.send("playerControlChangeItem",{index:t}))},getCurrentItem:function(){return this.equippedItems[this.currentItemIndex]},setCurrentItem:function(t){this.equippedItems[this.currentItemIndex]=t},getEntityInFrontOfUnit:function(){function t(t){var e=t.GetShape(),o=new ige.box2d.b2Vec2(i.x,i.y),n=e.TestPoint(t.GetBody().GetTransform(),o);return n&&t&&t.m_body&&t.m_body.m_fixtureList?(s=t.m_body.m_fixtureList.igeId,!1):!0}var e=this;if(ige.isServer){var i={x:(e._translate.x+40*Math.cos(e._rotate.z+Math.radians(-90)))/e.scaleRatio,y:(e._translate.y+40*Math.sin(e._rotate.z+Math.radians(-90)))/e.scaleRatio},o=20,n=new ige.box2d.b2AABB;n.lowerBound.Set(i.x-o,i.y-o),n.upperBound.Set(i.x+o,i.y+o);var s=null;return ige.box2d.world().QueryAABB(t,n),s}},hold:function(){var t=this;if(ige.isServer){var e=t.getEntityInFrontOfUnit();if(e){var i=ige.$(e);if(i&&(i._category=="debris"||i._category=="unit")&&t._stats.stamina>=this._stats.maxStamina){t._stats.stamina-=100;var o=$i_23.Dynamics.Joints.b2WeldJointDef,n=new o;n.Initialize(t._box2dBody,i._box2dBody,t._box2dBody.GetWorldCenter(),i._box2dBody.GetWorldCenter()),t.holdingJoint=ige.box2d.world().CreateJoint(n),t.holdingEntity=i,t._stats.currentAction="hold",t.streamUpdateData({action:t._stats.currentAction})}}}},release:function(){var t=this;ige.isServer&&(t.holdingJoint&&(ige.box2d.world().DestroyJoint(t.holdingJoint),t.holdingJoint=void 0,t.holdingEntity=void 0),t.streamUpdateData({action:"idle"}))},updateFixture:function(){var t=this;if(ige.isServer){var e=this.map.unitTypes[this._stats.type].body,i=(new $i_6).addPoint(-this._bounds2d.x2,-this._bounds2d.y2).addPoint(-this._bounds2d.x2,this._bounds2d.y2).addPoint(this._bounds2d.x2,this._bounds2d.y2).addPoint(this._bounds2d.x2,-this._bounds2d.y2),o=t.getCurrentItem();o&&o._stats.type=="weapon"&&!o._stats.isGun&&i.addPoint(3,-this._bounds2d.y2).addPoint(3,-this._bounds2d.y2-o._stats.height).addPoint(-3,-this._bounds2d.y2-o._stats.height).addPoint(-3,-this._bounds2d.y2),i.divide(ige.box2d._scaleRatio),triangles=i.triangulate(),fixDefs=[];for(var n=0;triangles.length>n;n++)fixDefs.push({density:1,friction:1,restitution:.2,filter:{categoryBits:4,maskBits:65527},shape:{type:"polygon",data:triangles[n]},igeId:this.id()});e.fixtures=fixDefs,t._nextBody=e}},resizeUnit:function(){var t=this,e=1+t._stats.gold/18e3;ige.isServer?t.buff.speed=t._stats.gold/28e3:ige.isClient&&t.scaleTo(e,e,0)},updateStamina:function(){var t=this;t._stats.currentAction=="hold"?(t._stats.stamina==t._stats.maxStamina&&(t._stats.stamina-=100),t._stats.stamina>0?t._stats.stamina=Math.max(0,t._stats.stamina-2):t.release()):t._stats.maxStamina>t._stats.stamina?t._stats.stamina=Math.min(t._stats.maxStamina,t._stats.stamina+2):t._stats.stamina>t._stats.maxStamina&&(t._stats.stamina=Math.max(0,t._stats.stamina-2)),ige.isClient&&ige.client.myUnit&&ige.client.myUnit.id()==t.id()&&($("#stamina").text(t._stats.stamina),$("#stamina").css("width",t._stats.stamina/t._stats.maxStamina*100+"%"))},streamCreateData:function(){return this._stats},tick:function(t){var e=this;if(e.updateStamina(),ige.isServer){if(e._stats.currentAction=="hold")var i=Math.atan2(e.holdingEntity._translate.x-e._translate.x,e._translate.y-e.holdingEntity._translate.y);else var i=e.facingAngle;var o=e._rotate.z;if(rotateDiff=(i-o%(Math.PI*2))%(Math.PI*2),rotateDiff>Math.PI?rotateDiff=-(2*Math.PI)%rotateDiff:-Math.PI>rotateDiff&&(rotateDiff=2*Math.PI%rotateDiff),e.rotateBy(0,0,rotateDiff),!ige.box2d._world.IsLocked()){if(e._actionQueue.length>0){var n=e._actionQueue.shift();if(n.type=="hide"){var s=ige.$(n.entityId);s&&(s.owner=void 0,s.destroy(),this.updateFixture())}else if(n.type=="pickup"){var s=new Item(n.itemData);e.setCurrentItem(s),s.attachTo(e),ige.network.send("pickUpItem",{itemId:s.id(),unitId:e.id()}),this.updateFixture()}else if(n.type=="spawn"){var r=new Item(n.itemData).translateTo(e._translate.x+n.itemData.holdingDistance*Math.cos(e._rotate.z+Math.radians(-90)),e._translate.y+n.itemData.holdingDistance*Math.sin(e._rotate.z+Math.radians(-90)),0).rotateTo(0,0,e._rotate.z);r.createBody(),this.updateFixture()}else if(n.type=="change"){var a=e.getCurrentItem();a&&(a.owner=void 0,a.destroy());var h=n.slotIndex;e.currentItemIndex=h;var r=e.getCurrentItem();if(r){var s=new Item(r._stats);e.setCurrentItem(s),s.attachTo(e),ige.network.send("pickUpItem",{itemId:r.id(),unitId:e.id()})}this.updateFixture()}}if(e._nextBody){var l=ige.box2d._world.DestroyBody(e._box2dBody);l&&(e.box2dBody(e._nextBody),e._nextBody=void 0)}}}$i_60Box2d.prototype.tick.call(this,t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Unit);var ClientScore=$i_63.extend({classId:"ClientScore",init:function(t){$i_63.prototype.init.call(this),this.depth(1).layer(2e4).width(400).height(80).texture(ige.client.fontTexture).textLineSpacing(0).text(t).hide()},start:function(t){var e=this;return t?(setTimeout(function(){e.start()},t),void 0):(this.show(),this._translate.tween().duration(1e3).properties({y:this._translate.y-25}).afterTween(function(){e.tween().duration(300).properties({_opacity:0}).afterTween(function(){e.destroy()}).start()}).start(),void 0)}}),Item=$i_60Box2d.extend({classId:"Item",init:function(t){$i_60Box2d.prototype.init.call(this);var e=this;if(e._stats=t,e.owner=void 0,e.isReloading=!1,e.lastFired=(new Date).getTime(),e.isFiring=!1,e.reloadingTimer=void 0,ige.isServer)e.addComponent($i_11).category("item").mount(ige.$("baseScene")).streamMode(1).streamCreateData(),e.scaleRatio=ige.box2d.scaleRatio(),e.bodies={},e.joints=[],e.raycastTargets=[],ige.server.items[e.id()]=e;else if(ige.isClient){var i=new $i_54(ige.client.mapUrl+"/spritesheet/"+e._stats.texture);e.layer(2).depth(3).width(t.width).height(t.height).texture(i).mountParticleEmitter()}},createBody:function(){this.box2dBody({type:"dynamic",linearDamping:5,angularDamping:5,allowSleep:!0,bullet:!1,fixtures:[{density:1,friction:.01,restitution:.01,shape:{type:"rectangle"},filter:{categoryBits:1,maskBits:0},igeId:this.id()}]})},hasOwner:function(){return this.owner!=void 0},attachTo:function(t){var e=this;e.owner=t,e.mount(t).translateTo(0,-e._stats.holdingDistance,0)},use:function(){var t=this,e=t.owner,i=(new Date).getTime();if(this._stats.isGun&&i>t.lastFired+this._stats.fireRate&&t._stats.ammo>0){if(t._stats.ammo--,t.lastFired=i,t.isReloading=!1,ige.isServer){if(this._stats.bulletType=="projectile")new Projectile(t._stats.bullet,e).streamMode(1).mount(ige.$("baseScene"));else if(this._stats.bulletType=="raycast"){distanceFromUnit=this._stats.bullet.distanceStart/t.scaleRatio;var o={x:e._translate.x/t.scaleRatio+distanceFromUnit*Math.cos(e._rotate.z+Math.radians(-90)),y:e._translate.y/t.scaleRatio+distanceFromUnit*Math.sin(e._rotate.z+Math.radians(-90))};distanceFromUnit=this._stats.bullet.distanceEnd/t.scaleRatio;var n={x:e._translate.x/t.scaleRatio+distanceFromUnit*Math.cos(e._rotate.z+Math.radians(-90)),y:e._translate.y/t.scaleRatio+distanceFromUnit*Math.sin(e._rotate.z+Math.radians(-90))},s=function(){this.m_hit=!1,t.raycastTargets=[]};s.prototype.ReportFixture=function(e,i,o,n){return t.raycastTargets.push({fixture:e,point:i,normal:o}),this.m_hit=!0,this.m_point=i,this.m_normal=o,n};var r=new s;if(ige.box2d.world().RayCast(r,o,n),r.m_hit)for(targetId=t.raycastTargets.length-1;targetId>=0;targetId--){var a=t.raycastTargets[targetId],h=a.fixture.m_body.m_fixtureList.igeId;if(h&&ige.$(h)&&ige.$(h)._stats){var l=ige.$(h)._stats.type;if(ige.$(h)&&ige.$(h)._stats&&(l=="zombie"||l=="zombieKing")){var c=t._stats.bullet.force,m=new ige.box2d.b2Vec2(-a.normal.x*c,-a.normal.y*c);if(a.fixture.m_body.ApplyImpulse(m,a.point),!t._stats.bullet.penetration)break}}}if(t._stats.recoilForce){var _=t._stats.recoilForce,m=new ige.box2d.b2Vec2(_*Math.cos(e._rotate.z+Math.radians(90)),_*Math.sin(e._rotate.z+Math.radians(90)));t.owner._box2dBody.ApplyImpulse(m,t.owner._box2dBody.GetWorldCenter())}ige.network.send("startParticle",{unitId:t.owner.id()})}}else ige.isClient&&(ige.client.hideReloadingText(),ige.client.updateItemInfo());t.isFiring=!0}else 1>t._stats.ammo&&t.isFiring&&t.stop()},refillAmmo:function(){var t=this;t._stats.ammo=t._stats.ammoSize,t._stats.ammoTotal=t._stats.ammoSize*3,ige.isClient&&t.owner&&t.owner.id()==ige.client.myUnit.id()&&ige.client.updateItemInfo()},mountParticleEmitter:function(){var t=this;ige.isClient&&(t.particleEmitter=(new $i_64).particle(Particle).layer(1).lifeBase(30).quantityBase(8).quantityTimespan(30).deathOpacityBase(1).velocityVector(new $i_5(0,0,0),new $i_5(-1,-1,0),new $i_5(1,1.5,0)).particleMountTarget(ige.client.mainScene).translateTo(0,-20,0).mount(t))},startEmitting:function(){ige.isClient&&this.particleEmitter&&!this.particleEmitter._started&&(this.particleEmitter.start(),this.emitStartedAt=(new Date).getTime())},stopEmitting:function(){ige.isClient&&this.particleEmitter&&this.particleEmitter._started&&this.particleEmitter.stop()},stop:function(){var t=this;t.isFiring&&(t._stats.ammoTotal>0&&t.reload(),t.isFiring=!1,ige.isServer&&ige.network.send("stopParticle",{unitId:t.owner.id()}))},reload:function(){var t=this;!t.isReloading&&t._stats.ammoTotal>0&&(t.isReloading=!0,ige.isClient&&ige.client.showReloadingText(),clearTimeout(t.reloadingTimer),t.reloadingTimer=setTimeout(function(){if(t&&t._stats&&t.isReloading){var e=Math.min(t._stats.ammoTotal,t._stats.ammoSize-t._stats.ammo);t._stats.ammoTotal-=e,t._stats.ammo+=e,t.isReloading=!1,ige.isClient&&(ige.client.hideReloadingText(),ige.client.updateItemInfo())}},2e3))},addRandomBuff:function(){if(ige.isServer)for(var t,e,i=0;this._stats.buffTypes.length>i;i++)t=this._stats.buffTypes[i],e=ige.server.map.buffTypes[e]},streamCreateData:function(){return this._stats},tick:function(t){var e=(new Date).getTime();e>this.emitStartedAt+60&&this.stopEmitting(),$i_60Box2d.prototype.tick.call(this,t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Item);var Projectile=$i_60Box2d.extend({classId:"Projectile",init:function(t,e){$i_60Box2d.prototype.init.call(this);var i,o=this;if(o.data=t,ige.isServer){this.addComponent($i_11),this.translateTo(e._translate.x+t.distanceStart*Math.cos(e._rotate.z+Math.radians(-90)),e._translate.y+t.distanceStart*Math.sin(e._rotate.z+Math.radians(-90)),0).box2dBody(t.body).lifeSpan(t.lifeSpan);var n=e._rotate.z+Math.radians(-90),s=Math.cos(n)*t.force,r=Math.sin(n)*t.force;if(!isNaN(s)&&!isNaN(r)&&isFinite(s)&&isFinite(r)){var a=new ige.box2d.b2Vec2(s,r);this._box2dBody.ApplyForce(a,this._box2dBody.GetWorldCenter())}else console.log("naughty NaN moving projectile!")}if(ige.isClient){var i=new $i_54(ige.client.mapUrl+"/spritesheet/"+t.body.texture);o.depth(3).layer(2).width(t.width).height(t.height).texture(i)}},streamCreateData:function(){return this.data},tick:function(t){$i_60Box2d.prototype.tick.call(this,t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Projectile);var Particle=$i_60Box2d.extend({classId:"Particle",init:function(t){this._emitter=t,$i_60Box2d.prototype.init.call(this),this._rectColor="#fff200",this.addComponent($i_11).texture(ige.client.textures.rectangle).width(10).height(10).layer(1).category("particle")},destroy:function(){this._emitter!==void 0&&this._emitter._particles.pull(this),$i_60Box2d.prototype.destroy.call(this)}}),ClientNetworkEvents={_onGameOver:function(){isShoppingTime=!1,$("#gameover-label").show(),ige.client.adsDue&&(setTimeout(function(){showAipMidroll()},3e3),ige.client.adsDue=!1);var t=!1,e=ige.client.units;$("#survivor-list").html("");var i=[];for(var o in e)e[o]._stats.type=="human"&&(t=!0,i.push({key:o,value:e[o]._stats}));for(i.sort(function(t,e){return t.value.survivalTime-e.value.survivalTime}),o=i.length-1;o>=0;o--)t=!0,$("#survivor-list").append("<li class='text-left list-group-item "+(o==i.length-1?"list-group-item-warning":"")+"'>"+i[o].value.name+" <span class='badge '>"+ige.client.toHHMMSS(i[o].value.survivalTime)+"</span></li>");t?($("#gameover-label").removeClass("text-danger"),$("#gameover-label").addClass("text-success").html("Survivors WIN!!"),$("#gameover-modal").modal("show")):($("#gameover-label").removeClass("text-success"),$("#gameover-label").addClass("text-danger").html("ZOMBIES WIN!!"))},_onReset:function(t){isShoppingTime=!0,$("#gameover-modal").modal("hide"),$("#gameover-label").hide(),$("#store-button").show(),adIsPlaying||$("#shopping-modal").modal("show"),ige.client.myUnit.getCurrentItem()&&ige.client.myUnit.getCurrentItem().refillAmmo();for(clientId in t)ige.client.units[clientId]&&ige.client.units[clientId].streamUpdateData(t[clientId])
},_onPlayerEntity:function(t){var e=this,i=ige.$(t);i?ige.client.initMyUnit(i):e._eventListener=ige.network.stream.on("entityCreated",function(e){e.id()===t&&ige.client.initMyUnit(e)})},_onGameState:function(t){ige.client.gameState=t.state,ige.client.timeRemaining=t.timeRemaining},_onUpdateUnit:function(t){var e=ige.$(t.unitId);e&&e.streamUpdateData(t.stats)},_onKillStreakMessage:function(t){ige.client.showKillStreakMessage(t.playerName,t.killStreakCount)},_onPickUpItem:function(t){var e=this,i=ige.$(t.unitId),o=t.itemId;ige.$(o)?i.pickUpItem(o):e._eventListener=ige.network.stream.on("entityCreated",function(t){t.id()==o&&(i.pickUpItem(o),ige.network.stream.off("entityCreated",e._eventListener,function(t){t||this.log("Could not disable event listener!","warning")}))})},_onUpdateItemInfo:function(t){t?ige.client.updateItemInfo({name:t._stats.name,ammo:t._stats.ammo,ammoTotal:t._stats.ammoTotal}):ige.client.updateItemInfo({name:""})},_onStartParticle:function(t){var e=t.unitId;ige.$(e)&&ige.$(e).getCurrentItem()&&ige.$(e).getCurrentItem().startEmitting()},_onStopParticle:function(t){var e=t.unitId;ige.$(e)&&ige.$(e).getCurrentItem()&&ige.$(e).getCurrentItem().stopEmitting()},_onBuySkin:function(t){$(".btn-buy-skin[name='"+t+"']").html("Purchased")},_onPlayerDisconnect:function(t){var e=t.clientId;e==ige.clientclientId&&alert("Disconnected. Reason:",t),ige.client.units[e]&&(ige.client.units[e].destroy(),delete ige.client.units[e])}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=ClientNetworkEvents);var PlayerComponent=$i_60.extend({classId:"PlayerComponent",componentId:"playerControl",init:function(t,e){this._entity=t,this._options=e,this.mouseLocked=!1,this.facingAngle=0,this.controls={moveKeyPressed:!1,facingAngle:0,left:!1,right:!1,up:!1,down:!1,mouseButton1:!1,mouseButton3:!1,1:!1,2:!1,3:!1,4:!1},this._facingAngle=0,ige.input.mapAction("mouseButton1",ige.input.mouse.button1),ige.input.mapAction("mouseButton3",ige.input.mouse.button3),ige.input.mapAction("a",ige.input.key.a),ige.input.mapAction("d",ige.input.key.d),ige.input.mapAction("w",ige.input.key.w),ige.input.mapAction("s",ige.input.key.s),ige.input.mapAction("r",ige.input.key.r),ige.input.mapAction("g",ige.input.key.g),ige.input.mapAction("1",ige.input.key["1"]),ige.input.mapAction("2",ige.input.key["2"]),ige.input.mapAction("3",ige.input.key["3"]),ige.input.mapAction("4",ige.input.key["4"]),ige.input.mapAction("left",ige.input.key.left),ige.input.mapAction("right",ige.input.key.right),ige.input.mapAction("up",ige.input.key.up),ige.input.mapAction("down",ige.input.key.down),ige.input.mapAction("enter",ige.input.key.enter),ige.input.mapAction("esc",ige.input.key.escape),this._entity.addBehaviour("playerComponent_behaviour",this._behaviour)},_behaviour:function(){var t=this,e=t.getCurrentItem();if(e&&(this.playerControl.controls.mouseButton1?e.use():!this.playerControl.controls.mouseButton1&&t.isFiring&&e.stop()),ige.isClient){var i=90*Math.PI/180,o=Math.atan2(ige.mousePos().y,ige.mousePos().x)+i;if(o!=t.facingAngle&&(ige.network.send("playerMouseMoved",o),t.facingAngle=o),ige.input.actionState("enter")||ige.input.actionState("enter")?this.playerControl.controls.enter||(this.playerControl.controls.enter=!0):this.playerControl.controls.enter&&(this.playerControl.controls.enter=!1,$("#message").is(":focus")?$("#message").blur():$("#message").focus()),ige.input.actionState("mouseButton1")){if(!this.playerControl.controls.mouseButton1){this.playerControl.controls.mouseButton1=!0;var e=this.getCurrentItem();e&&e.use(),ige.network.send("playerControlMouseButton1Down")}}else this.playerControl.controls.mouseButton1&&(this.playerControl.controls.mouseButton1=!1,ige.network.send("playerControlMouseButton1Up"));if(ige.input.actionState("mouseButton3")||ige.input.actionState("g")){if(!this.playerControl.controls.mouseButton3&&!$("#message").is(":focus")){this.playerControl.controls.mouseButton3=!0;var e=this.getCurrentItem();e&&this.dropItem(e),ige.network.send("playerControlMouseButton3Down")}}else this.playerControl.controls.mouseButton3&&(this.playerControl.controls.mouseButton3=!1,ige.network.send("playerControlMouseButton3Up"));ige.input.actionState("esc"),ige.input.actionState("r")&&(ige.network.send("playerControlReloadItem"),t.getCurrentItem()&&t.getCurrentItem().reload());for(var n=1;4>=n;n++)ige.input.actionState(n)?this.playerControl.controls[n]||(this.playerControl.controls[n]=!0,t.changeItem(n-1)):this.playerControl.controls[n]&&(this.playerControl.controls[n]=!1);ige.input.actionState("left")||ige.input.actionState("a")?this.playerControl.controls.left||$("#message").is(":focus")||(this.playerControl.controls.left=!0,ige.network.send("playerControlLeftDown")):this.playerControl.controls.left&&(this.playerControl.controls.left=!1,ige.network.send("playerControlLeftUp")),ige.input.actionState("right")||ige.input.actionState("d")?this.playerControl.controls.right||$("#message").is(":focus")||(this.playerControl.controls.right=!0,ige.network.send("playerControlRightDown")):this.playerControl.controls.right&&(this.playerControl.controls.right=!1,ige.network.send("playerControlRightUp")),ige.input.actionState("up")||ige.input.actionState("w")?this.playerControl.controls.up||$("#message").is(":focus")||(this.playerControl.controls.up=!0,ige.network.send("playerControlUpDown")):this.playerControl.controls.up&&(this.playerControl.controls.up=!1,ige.network.send("playerControlUpUp")),ige.input.actionState("down")||ige.input.actionState("s")?this.playerControl.controls.down||$("#message").is(":focus")||(this.playerControl.controls.down=!0,ige.network.send("playerControlDownDown")):this.playerControl.controls.down&&(this.playerControl.controls.down=!1,ige.network.send("playerControlDownUp"))}}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=PlayerComponent);var Debris=$i_60Box2d.extend({classId:"Debris",init:function(t){$i_60Box2d.prototype.init.call(this);var e=this;if(e.original=t,e.resetQueued=!1,this.category("debris"),ige.isServer&&this.addComponent($i_11),ige.isClient){var i=t.cellSheet,o=new $i_55(i[0],i[1],i[2]),n=o.textureFromCell(e.original.gid-(i[3]-1));e.layer(2).depth(5).width(t.width).height(t.height).texture(n)}},setTexture:function(t){this.cellSheets=t},streamCreateData:function(){return this.original},reset:function(){this.resetQueued=!0},tick:function(t){ige.isServer&&!ige.box2d._world.IsLocked()&&this.resetQueued&&(this.translateTo(this.original.x,this.original.y,0).rotateTo(0,0,Math.radians(this.original.rotation)),ige.server.generateRandomItemUnderDebris(this),this.resetQueued=!1),$i_60Box2d.prototype.tick.call(this,t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Debris);var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};isMobile.Android()?window.location.replace("https://play.google.com/store/apps/details?id=com.jaeyunnoh.braainsio"):isMobile.iOS()&&window.location.replace("https://itunes.apple.com/us/app/braains.io/id1177022124?mt=8");var adIsPlaying=!1,isShoppingTime=!1,servers=[],server={},quickPlay=function(){var t,e=$("#region-ddl").val(),i=$("#max-players-ddl").val(),o=$("#map-ddl").val();if(host=="localhost")t={ip:"localhost",port:2e3,playerCount:0,maxPlayers:10,map:"two_houses-0.16"};else for(var n=0;servers.length>n;n++){var s=servers[n];if(!(!(s.ip&&s.playerCount>0&&s.maxPlayers>s.playerCount)||i&&i!=s.maxPlayers||e&&e!=s.region||o&&o!=s.map)){t=s;break}}t&&($("#quick-play-button").text("Connecting...").attr("disabled","disabled"),ige.client.connectToServer(t))};pathArray=window.location.href.split("/"),host=pathArray[2];var populateServerList=function(){var t="http://registryget.azurewebsites.net/";(host=="localhost"||host=="beta.braains.io")&&(t="http://registryget.azurewebsites.net/?beta=1"),$.ajax({url:t,data:{},dataType:"jsonp",jsonpCallback:"callback",type:"GET",success:function(t){var e=[],o=[],n=[],s=0,r=0;for(i in t){var a=JSON.parse(t[i]);(host=="localhost"||a.map!="two_houses-0.14"&&a.map!="two_houses-0.15"&&a.ip!="localhost")&&(servers.push({id:a.id,map:a.map,playerCount:a.playerCount,maxPlayers:a.maxPlayers,region:a.region?a.region:"",ip:a.ip,port:a.port}),s+=a.playerCount,r+=a.maxPlayers,$.inArray(a.map,e)==-1&&(e.push(a.map),$("#map-ddl").append($("<option/>",{val:a.map,html:a.map}))),$.inArray(a.maxPlayers,o)==-1&&(o.push(a.maxPlayers),$("#max-players-ddl").append($("<option/>",{val:a.maxPlayers,html:a.maxPlayers+" players"}))),$.inArray(a.region,n)==-1&&(n.push(a.region),$("#region-ddl").append($("<option/>",{val:a.region,html:a.region}))))}var h=$("#server-list").DataTable({pageLength:200,bPaginate:!1,bInfo:!1,data:servers,columns:[{data:"id"},{data:"map"},{data:"playerCount"},{data:"maxPlayers"},{data:"region"}]});$("#server-list tbody").on("click","tr",function(){server=h.row(this).data(),console.log(server),$("#server-region").text(server.region),$("#server-address").text(server.ip+(server.port?":"+server.port:"")),$("#server-players").text(server.playerCount+" / "+server.maxPlayers),server.maxPlayers>server.playerCount?$("#join-server-button").removeClass("disabled"):$("#join-server-button").addClass("disabled"),$("#join-server-modal").modal("show")}),$("#player-name").keyup(function(t){t.keyCode==13&&ige.client.connectToServer(server)}),$("#join-server-button").on("click",function(){server.maxPlayers>server.playerCount&&($(this).addClass("disabled"),ige.client.connectToServer(server))}),$(".selectpicker").selectpicker({style:"btn-default"}),$("#map-ddl").on("change",function(){h.columns(1).search(this.value).draw()}),$("#max-players-ddl").on("change",function(){h.columns(3).search(this.value).draw()}),$("#region-ddl").on("change",function(){h.columns(4).search(this.value).draw()}),$("#player-count").html(s+" / "+r+" players online")}}),$("#quick-play-button").on("click",function(){quickPlay()})};$(document).ready(function(){populateServerList(),getScript("//api.adinplay.com/player/v2/BRN/braains.io/player.min.js")});var Cursor=$i_60.extend({classId:"Cursor",init:function(){$i_60.prototype.init.call(this);var t=this;if(ige.isClient){var e=new $i_54(ige.client.mapUrl+"/spritesheet/baseball_bat.png");t.depth(10).layer(20).width(50).height(50).texture(e)}},tick:function(t){$i_60.prototype.tick.call(this,t)}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Cursor);const PREOUTBREAK=0,POSTOUTBREAK=1,GAMEOVER=2;var Client=$i_2.extend({classId:"Client",init:function(){var t=this;t.previousScore=0,t.servers={},this.clientId="",this.myUnit=void 0,t.igeEngineStarted=$.Deferred(),t.mapLoaded=$.Deferred(),t.adFinished=$.Deferred(),t.mapUrl="",t.units={},t.fontTexture=new $i_57("../assets/fonts/verdana_12pt.png"),t.textures={},ige.addComponent(Ige$i_32Component),t.implement(ClientNetworkEvents),$("#disconnected-modal").modal({show:!1,backdrop:"static",keyboard:!1}),$("#invite-a-friend-modal").modal({show:!1,backdrop:"static",keyboard:!1}),$("#reconnect-button").on("click",function(){location.reload()}),$(".inventory-item-button").on("click",function(){t.myUnit.changeItem($(this).attr("name"))}),$("#refresh-server-list-button").on("click",function(){t.refreshServerList()}),$("#max-players").on("change",function(){t.refreshServerList()}),$("#map-list").on("change",function(){t.refreshServerList()}),$("#login-modal").modal({show:!0,backdrop:"static",keyboard:!1}).on("hidden.bs.modal",function(){$("#footer").hide()}),$("#gameover-modal").modal({show:!1}),$("#shopping-modal").modal({show:!1,backdrop:"static",keyboard:!1}).on("hidden.bs.modal",function(){$("#footer").hide()}),$("#send-message").on("click",function(){t.sendChatMessage()}),$("#hide-chat").on("click",function(){$("#show-chat").show(),$("#chat-box").hide()}),$("#show-chat").on("click",function(){$("#show-chat").hide(),$("#chat-box").show()}),$("#message").keyup(function(e){e.keyCode==13&&t.sendChatMessage()})},initAdInPlay:function(){var t=this;t.adsDue=!0,showAipPreroll(),setInterval(function(){t.adsDue=!0},3e5)},start$i_114:function(){var t=this;ige.createFrontBuffer(!0),ige.on("texturesLoaded",function(){ige.start(function(e){e&&(console.log("textures loaded"),t.mainScene=(new $i_73).id("baseScene").drawBounds(!0),t.objectScene=(new $i_73).id("objectScene").mount(t.mainScene),t.vp1=(new $i_72).id("vp1").autoSize(!0).scene(t.mainScene).drawBounds(!1).minimumVisibleArea(700,700).mount(ige),console.log("igeEngine Started"),t.igeEngineStarted.resolve())})})},loadMap:function(){var t=this;$.when($.getScript("../assets/maps/"+t.mapName+"/map.js"),$.Deferred(function(t){$(t.resolve)})).done(function(){ige.addComponent($i_18).tiled.loadJson(Map,function(e){t.map=Map,$.when(t.igeEngineStarted).done(function(){for(i=0;e.length>i;i++)e[i].name!=="debris"&&e[i].layer(i).autoSection(20).drawBounds(!1).drawBoundsData(!1).mount(t.mainScene);for(skinName in Map.skins){var o=$("<div/>",{"class":"col-sm-6",style:"padding: 5px;"}).append($("<div/>",{"class":"btn btn-warning pull-right btn-buy-skin",name:skinName,html:Map.skins[skinName].price}).on("click",function(){ige.network.send("buySkin",$(this).attr("name"))})).append($("<img/>",{src:t.mapUrl+"/spritesheet/"+skinName+".png"})).append(" "+skinName);$("#skins-div").append(o)}for(handle in Map.items){var n=Map.items[handle],s=$("<div/>",{"class":"col-sm-6",style:"padding: 5px;"}).append($("<div/>",{"class":"btn btn-warning pull-right btn-buy-item",name:handle,html:n.price}).on("click",function(){ige.client.myUnit.buyItem($(this).attr("name")),ige.network.send("buyItem",$(this).attr("name"))})).append($("<img/>",{style:"max-height: 30px",src:t.mapUrl+"/spritesheet/"+n.texture})).append(" "+n.name);$("#items-div").append(s)}console.log("map loaded"),t.mapLoaded.resolve()})})})},connectToServer:function(t){var e=this;e.adFinished=$.Deferred(),this.initAdInPlay(),console.log("connecting to server",t),$("#login-wrapper").hide(),e.start$i_114(),e.mapName=t.map,console.log("map",e.mapName),e.mapUrl="../assets/maps/"+e.mapName,e.loadMap(),e.textures.rectangle=new $i_54(e.mapUrl+"/particles/Rectangle.js"),$.when(e.mapLoaded,e.adFinished).done(function(){$(".game-ui").show();var i="ws://"+t.ip+(t.port?":"+t.port:"");ige.network.start(i,function(){var i=$("#player-name").val();i=i.replace(/</g,"&lt;").replace(/>/g,"&gt;"),$("#server-id").text(t.id),$("#join-server-modal").modal("hide"),$("#join-server-button").removeClass("disabled"),ige.network.define("gameState",e._onGameState),ige.network.define("playerEntity",e._onPlayerEntity),ige.network.define("pickUpItem",e._onPickUpItem),ige.network.define("updateItemInfo",e._onUpdateItemInfo),ige.network.define("updateUnit",e._onUpdateUnit),ige.network.define("startParticle",e._onStartParticle),ige.network.define("stopParticle",e._onStopParticle),ige.network.define("playerDisconnect",e._onPlayerDisconnect),ige.network.define("noDuplicateIps",e._onNoDuplicateIps),ige.network.define("afkKick",e._onAfkKick),ige.network.define("killStreakMessage",e._onKillStreakMessage),ige.network.define("gameOver",e._onGameOver),ige.network.define("reset",e._onReset),ige.network.define("buySkin",e._onBuySkin),ige.network.addComponent($i_27).stream.renderLatency(100).stream.on("entityCreated",function(t){if(t._category=="unit"){var i=t;e.units[t._stats.clientId]=i}}),ige.addComponent($i_38),ige.network.send("igeChatJoinRoom","1"),ige.chat.on("messageFromServer",function(t){e.receiveChatMessage(t)}),ige.network.send("playerEntity",{name:i})})})},initMyUnit:function(t){var e=this;e.myUnit=t,e.clientId=t._stats.clientId,e.units[e.clientId]=t,e.myUnit.addComponent(PlayerComponent),ige.ui.style(".my-name",{color:"lime"}),e.myUnit.unitNameLabel.styleClass("my-name"),ige.network.stream.off("entityCreated",e._eventListener,function(t){t||this.log("Could not disable event listener!","warning")}),e.vp1.camera.lookAt(e.myUnit,0,""),e.vp1.camera.trackTranslate(e.myUnit,15),ige.client.startGame()},startGame:function(){var t=this,e="";setInterval(function(){3>Object.keys(t.units).length?e="Waiting for more players...":t.gameState==t.map.constants.PREOUTBREAK?e="Outbreak in "+t.timeRemaining+" seconds":t.gameState==t.map.constants.POSTOUTBREAK?(t.myUnit&&(e=t.myUnit._stats.type!="human"?"Infect all humans in "+t.timeRemaining+" seconds":"Stay alive for "+t.timeRemaining+" seconds"),$("#shopping-modal").modal("hide"),$("#store-button").hide()):t.gameState==t.map.constants.GAMEOVER&&(e="Game restarting in "+t.timeRemaining+" seconds"),$("#counter-div").text(e),t.timeRemaining--;var i=0,o="",n=[];for(var s in t.units)t.units[s]._stats.type!="human"&&i++,n.push({key:s,value:t.units[s]._stats});for(n.sort(function(t,e){return t.value.gold-e.value.gold}),s=n.length-1;s>=0;s--){var r=t.units[n[s].key];if(r){var a="";r._stats.type=="human"?t.gameState==t.map.constants.POSTOUTBREAK&&(r._stats.gold+=i,r._stats.survivalTime++):(t.gameState==t.map.constants.POSTOUTBREAK&&(r._stats.gold=Math.max(0,r._stats.gold-r._stats.gold*t.map.constants.ZOMBIE_GOLD_DECREMENT)),a="text-danger"),n.length-10>s||(r._stats.clientId==t.myUnit._stats.clientId&&(a="text-primary"),o+="<div class='"+a+"'>"+r._stats.name+" <small><span class='text-warning'>"+parseInt(r._stats.gold)+"</span></small></div>")}}ige.client.clientCount=n.length;var h=ige.client.clientCount-i;$("#zombie-count").html(i),$("#survivor-count").html(h),$("#scoreboard").html(o);var l=t.myUnit._stats.gold;$(".gold").text(parseInt(l)),$("#player-speed-buff").text((1+l/8e3).toFixed(2))},1e3)},showKillStreakMessage:function(t,e){var i="",o=30;switch($("#kill-streak-message").show(),e){case 2:i=t+"'s got a DOUBLE KILL",o=30;break;case 3:i=t+"'s got a TRIPLE KILL",o=35;break;case 4:i=t+" is a PLAGUE",o=40;break;case 5:default:i=t+" is the RAPTURE!!!",o=60}$("#kill-streak-message").css({fontSize:o}).text(i).delay(5e3).fadeOut("slow")},updateItemInfo:function(){var t=this,e=t.myUnit.getCurrentItem();if(e){var i=e._stats;$("#item-name").html(i.name);var o="";i.ammo!=void 0&&(o=i.ammo+" / "+i.ammoTotal),$("#item-ammo").html(o)}else $("#item-name").html(""),$("#item-ammo").html("")},getItemHtml:function(t){var e="<h4>"+t._stats.name+"</h4>",i=$("<div/>",{"class":"caption text-center",html:e}),o=$("<div/>");for(attr in t._stats){var n=t._stats[attr],s=$("<p/>");switch(attr){case"ammoSize":s.append("<strong>Ammo size:</strong> "+n);break;case"fireRate":s.append("<strong>Fire rate:</strong> "+(1e3/n).toFixed(2)+" round/s");break;case"isGun":s.append("<strong>Weapon type:</strong> "+(n==1?"Range":"Melee"));break;case"reloadRate":s.append("<strong>Reload time:</strong> "+(n/1e3).toFixed(2)+" s");break;case"bullet":s.append("<strong>Force:</strong> "+n.force.toFixed(2));break;case"recoilForce":s.append("<strong>Recoil:</strong> "+n.toFixed(2))}o.append(s)}return i.append(o),i},updateInventory:function(){$(".popover").popover("hide");var t=this.myUnit.equippedItems,e=this.myUnit.currentItemIndex;ige.client.updateItemInfo();for(var i=0;t.length>i;i++){if(t[i]){var o=t[i],n=$("<div/>",{style:"font-size: 16px; width: 200px;",html:this.getItemHtml(o)}),s=$("<div/>",{"class":"item-div",role:"button",html:"<img src='"+this.mapUrl+"/spritesheet/"+o._stats.texture+"' style='height:30px'/>","data-container":"body","data-toggle":"popover","data-placement":"top","data-content":n.prop("outerHTML")});$(s).popover({html:!0,trigger:"hover"}),$("#item-"+i).html(s)}else $("#item-"+i).html("");i==e?$("#item-"+i).addClass("active"):$("#item-"+i).removeClass("active")}},showReloadingText:function(){$("#reloading-message").show()},hideReloadingText:function(){$("#reloading-message").hide()},sendChatMessage:function(){var t=$("#message").val();t.length>80&&(t=t.substr(0,80)),ige.network.send("igeChatMsg",{text:t,roomId:"1"}),$("#message").val("")},receiveChatMessage:function(t){var e=this.units[t.from];e&&(msgDiv=$("<div/>",{text:e._stats.name+": "+t.text}).delay(3e4).fadeOut("slow"),messageCount=$("#chat-history div").length,messageCount>20&&$("#chat-history div:first-child").remove(),$("#chat-history").append(msgDiv))},toHHMMSS:function(t){var e=Math.floor(t/3600),i=Math.floor((t-e*3600)/60),t=t-e*3600-i*60;return 10>e&&(e="0"+e),10>i&&(i="0"+i),10>t&&(t="0"+t),e+":"+i+":"+t},getUrlVars:function(){var t={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,i,o){t[i]=o}),t}});typeof module!="undefined"&&module.exports!==void 0&&(module.exports=Client);var Game=$i_2.extend({classId:"Game",init:function(t,e){ige=new $i_114,ige.isClient&&(ige.client=new t),ige.isServer&&(ige.server=new t(e))}});if(typeof module!="undefined"&&module.exports!==void 0)module.exports=Game;else var game=new Game(Client)